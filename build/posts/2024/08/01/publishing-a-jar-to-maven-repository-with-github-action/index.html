<!DOCTYPE html>
<html class="no-js" lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Github Action 发布 Jar 到 Maven 中央仓库 - Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="Github Action 发布 Jar 到 Maven 中央仓库">
	<meta property="og:description" content="Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps">
	<meta property="og:type" content="article">
	<meta property="og:url" content="https://blog.chensoul.cc/posts/2024/08/01/publishing-a-jar-to-maven-repository-with-github-action/">
	<meta property="og:site_name" content="ChenSoul Blog">
	<meta property="og:image" content="">
	
  <meta itemprop="name" content="Github Action 发布 Jar 到 Maven 中央仓库">
  <meta itemprop="description" content="作为一名 Java 开发者,将自己的项目发布到 Maven 中央仓库是一个非常重要的步骤。这不仅可以让更多的开发者发现和使用您的项目,也可以提高项目的知名度和影响力。">
  <meta itemprop="datePublished" content="2024-08-01T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-08-01T00:00:00+00:00">
  <meta itemprop="wordCount" content="1150">
  <meta itemprop="keywords" content="Docker,Javascript,Redis,Backend">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="Github Action 发布 Jar 到 Maven 中央仓库">
	<meta name="twitter:description" content="Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps">
	<meta name="twitter:image" content="">

	<link rel="preconnect" href="//fonts.loli.net" crossorigin>
	<link rel="dns-prefetch" href="//fonts.loli.net">
	<link rel="stylesheet" href="https://fonts.loli.net/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="/css/style.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="ChenSoul Blog" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/logo.svg" loading="lazy" alt="Site logo" width="60" height="60">
				</div><div class="logo__item logo__text">
					<div class="logo__title">ChenSoul Blog</div>
					<div class="logo__tagline">Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">菜单</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">首页</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/">
				
				<span class="menu__text">分类</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/tags/">
				
				<span class="menu__text">标签</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/index.xml">
				
				<span class="menu__text">订阅</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">关于</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Github Action 发布 Jar 到 Maven 中央仓库</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 1 1 0 28 1 1 0 0 1 0-28m0 3a3 3 0 1 0 0 22 3 3 0 0 0 0-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class="meta__text" datetime="2024-08-01">2024-08-01</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/java/" rel="category">Java</a>
	</span>
</div><div class="meta__item-tags meta__item"><svg class="meta__icon icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg><span class="meta__text"><a class="meta__link" href="/tags/docker/" rel="tag">Docker</a>, <a class="meta__link" href="/tags/javascript/" rel="tag">Javascript</a>, <a class="meta__link" href="/tags/redis/" rel="tag">Redis</a>, <a class="meta__link" href="/tags/backend/" rel="tag">Backend</a>
	</span>
</div>
</div>
		</header>
		
		<div class="content post__content clearfix">
			<p>作为一名 Java 开发者,将自己的项目发布到 Maven 中央仓库是一个非常重要的步骤。这不仅可以让更多的开发者发现和使用您的项目,也可以提高项目的知名度和影响力。</p>
<p>在过去,发布 Jar 到 Maven 中央仓库通常需要手动完成一系列繁琐的步骤，比如：申请 JIRA 账号、创建 Sonatype JIRA Issure、上传 Jar 包、签名 Jar 包等。但是随着 Github Action 的出现，这个过程变得更加自动化和简单。</p>
<p>下面我将以一个简单的 Maven 项目为例，介绍如何使用 Github Action 实现自动发布 Jar 到 Maven 中央仓库。</p>
<h2 id="前提条件">前提条件</h2>
<ol>
<li>在 Github 创建一个 Maven 项目</li>
<li>安装 gpg 并创建 gpg 秘钥和公钥，参考 <a href="https://dzone.com/articles/how-to-publish-artifacts-to-maven-central" target="_blank">How to Publish Artifacts to Maven Central</a></li>
<li>创建 OSSRH 账号，参考 <a href="https://central.sonatype.org/publish/generate-token/#generate-a-token-on-ossrh-sonatype-nexus-repository-manager-servers" target="_blank">Generate a Token on OSSRH Sonatype Nexus Repository Manager servers</a></li>
</ol>
<h2 id="创建-maven-项目">创建 Maven 项目</h2>
<p>首先在Github上面创建项目：<a href="https://github.com/chensoul/maven-hello-world" target="_blank">https://github.com/chensoul/maven-hello-world</a></p>
<p>增加两个 Maven 插件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;artifactId&gt;</span>maven-gpg-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;version&gt;</span>3.2.2<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;executions&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;execution&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;goals&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;goal&gt;</span>sign<span style="color:#f92672">&lt;/goal&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;phase&gt;</span>verify<span style="color:#f92672">&lt;/phase&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/execution&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/executions&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;groupId&gt;</span>org.sonatype.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;artifactId&gt;</span>nexus-staging-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;version&gt;</span>1.7.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;extensions&gt;</span>true<span style="color:#f92672">&lt;/extensions&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;serverId&gt;</span>ossrh<span style="color:#f92672">&lt;/serverId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;nexusUrl&gt;</span>https://s01.oss.sonatype.org/<span style="color:#f92672">&lt;/nexusUrl&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;autoReleaseAfterClose&gt;</span>true<span style="color:#f92672">&lt;/autoReleaseAfterClose&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;keepStagingRepositoryOnCloseRuleFailure&gt;</span>false<span style="color:#f92672">&lt;/keepStagingRepositoryOnCloseRuleFailure&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>可以将上面的两个插件加入到 pom.xml 的 build 节点下面，也可以配置到 profile 节点下。<a href="https://github.com/chensoul/maven-hello-world" target="_blank">https://github.com/chensoul/maven-hello-world</a> 项目中使用的是第二种方式，具体见 <a href="https://github.com/chensoul/chensoul-parent" target="_blank">https://github.com/chensoul/chensoul-parent</a> 的 pom.xml 文件。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;profiles&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;profile&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;id&gt;</span>release<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;build&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;plugins&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>maven-source-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>maven-javadoc-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>maven-enforcer-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>pl.project13.maven<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>git-commit-id-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>maven-release-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;version&gt;</span>${maven-release-plugin.version}<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;scmCommentPrefix&gt;</span>[CI Skip]<span style="color:#f92672">&lt;/scmCommentPrefix&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;autoVersionSubmodules&gt;</span>true<span style="color:#f92672">&lt;/autoVersionSubmodules&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;useReleaseProfile&gt;</span>false<span style="color:#f92672">&lt;/useReleaseProfile&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;releaseProfiles&gt;</span>release<span style="color:#f92672">&lt;/releaseProfiles&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;goals&gt;</span>deploy<span style="color:#f92672">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">&lt;!-- https://blog.sonatype.com/2010/01/how-to-generate-pgp-signatures-with-maven/ --&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>maven-gpg-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;version&gt;</span>${maven-gpg-plugin.version}<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;executions&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;execution&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;goals&gt;</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">&lt;goal&gt;</span>sign<span style="color:#f92672">&lt;/goal&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&lt;phase&gt;</span>verify<span style="color:#f92672">&lt;/phase&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;/execution&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/executions&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;groupId&gt;</span>org.sonatype.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;artifactId&gt;</span>nexus-staging-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;version&gt;</span>${nexus-staging-maven-plugin.version}<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;extensions&gt;</span>true<span style="color:#f92672">&lt;/extensions&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;serverId&gt;</span>ossrh<span style="color:#f92672">&lt;/serverId&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;nexusUrl&gt;</span>https://s01.oss.sonatype.org/<span style="color:#f92672">&lt;/nexusUrl&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;autoReleaseAfterClose&gt;</span>true<span style="color:#f92672">&lt;/autoReleaseAfterClose&gt;</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">&lt;keepStagingRepositoryOnCloseRuleFailure&gt;</span>false<span style="color:#f92672">&lt;/keepStagingRepositoryOnCloseRuleFailure&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/plugins&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/build&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/profile&gt;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/profiles&gt;</span>
</span></span></code></pre></div><p>nexus-staging-maven-plugin 插件配置的 serverId 是 ossrh ，需要和 distributionManagement 中的配置一致：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;distributionManagement&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;snapshotRepository&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;id&gt;</span>ossrh<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;url&gt;</span>https://s01.oss.sonatype.org/content/repositories/snapshots<span style="color:#f92672">&lt;/url&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/snapshotRepository&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;repository&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;id&gt;</span>ossrh<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;url&gt;</span>https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/<span style="color:#f92672">&lt;/url&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/repository&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/distributionManagement&gt;</span>
</span></span></code></pre></div><p>您需要在 <a href="https://issues.sonatype.org/secure/Dashboard.jspa" target="_blank">Sonatype JIRA</a> 上注册一个帐户并为此创建一个<a href="https://issues.sonatype.org/secure/CreateIssue.jspa?issuetype=21&amp;pid=10134" target="_blank">Issure</a>。</p>
<p>将您的 Sonatype JIRA 凭证添加到您的<code>~/.m2/settings.xml</code>文件中，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;server&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;id&gt;</span>ossrh<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;username&gt;</span>LSJkOqOi<span style="color:#f92672">&lt;/username&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;password&gt;</span>3oJOIO5+ah7LIcRSmDC2YDGjE9PRbgxoE2UbXjOrSzC1<span style="color:#f92672">&lt;/password&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/server&gt;</span>
</span></span></code></pre></div><h2 id="安装-gpg-并创建公秘钥">安装 GPG 并创建公秘钥</h2>
<p>macos 上安装 gpg：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew install gpg
</span></span></code></pre></div><p>参考 <a href="https://central.sonatype.org/publish/requirements/gpg/#generating-a-key-pair" target="_blank">Generating a Key Pair</a> 生成 GPG 密钥。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gpg --gen-key
</span></span><span style="display:flex;"><span>gpg <span style="color:#f92672">(</span>GnuPG<span style="color:#f92672">)</span> 2.4.5; Copyright <span style="color:#f92672">(</span>C<span style="color:#f92672">)</span> <span style="color:#ae81ff">2024</span> g10 Code GmbH
</span></span><span style="display:flex;"><span>This is free software: you are free to change and redistribute it.
</span></span><span style="display:flex;"><span>There is NO WARRANTY, to the extent permitted by law.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>注意：使用 “gpg --full-generate-key” 以获得一个全功能的密钥生成对话框。
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>GnuPG 需要构建用户标识以辨认您的密钥。
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>真实姓名： chensoul
</span></span><span style="display:flex;"><span>电子邮件地址： ichensoul@gmail.com
</span></span><span style="display:flex;"><span>您选定了此用户标识：
</span></span><span style="display:flex;"><span>    “chensoul &lt;ichensoul@gmail.com&gt;”
</span></span></code></pre></div><p>按提示输入两次密码，这里我使用 chensoul 作为密码 。</p>
<p>查看生成的 key：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># gpg --list-secret-keys --keyid-format=long</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>keyboxd<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>---------
</span></span><span style="display:flex;"><span>sec   ed25519/93C5993B9F7B43EE 2024-05-08 <span style="color:#f92672">[</span>SC<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>有效至：2027-05-08<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      C83119F1B90238633D766D4B93C5993B9F7B43EE
</span></span><span style="display:flex;"><span>uid                   <span style="color:#f92672">[</span> 绝对 <span style="color:#f92672">]</span> chensoul &lt;ichensoul@gmail.com&gt;
</span></span><span style="display:flex;"><span>ssb   cv25519/116B95FF0068A7E8 2024-05-08 <span style="color:#f92672">[</span>E<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>有效至：2027-05-08<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>上传公开的 key：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># keyserver.ubuntu.com</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># keys.openpgp.org</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pgp.mit.edu</span>
</span></span><span style="display:flex;"><span>gpg --keyserver keys.openpgp.org --send-keys C83119F1B90238633D766D4B93C5993B9F7B43EE
</span></span></code></pre></div><p>修改 <code>~/.m2/settings.xml</code> 文件，添加：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;server&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;id&gt;</span>gpg.passphrase<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;passphrase&gt;&lt;PASSPHRASE_GPG&gt;&lt;/passphrase&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/server&gt;</span>
</span></span></code></pre></div><p>将 <code>&lt;PASSPHRASE_GPG&gt;</code> 替换为创建 gpg key 时设置的密码。</p>
<h2 id="使用-maven-发布-jar">使用 Maven 发布 jar</h2>
<p>使用下面命令发布 jar 到 sonatype 仓库：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mvn -P release clean deploy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mvn -P release clean deploy
</span></span></code></pre></div><p>如果当前项目的版本为快照版，则发布后的 jar 在 <a href="https://s01.oss.sonatype.org/content/repositories/snapshots/com/chensoul/maven-hello-world/" target="_blank">https://s01.oss.sonatype.org/content/repositories/snapshots/com/chensoul/maven-hello-world/</a></p>
<p>如果当前项目的版本为正式版，稍等几分钟，可以在以下仓库查看发布的 jar:</p>
<ul>
<li><a href="https://central.sonatype.com/artifact/com.chensoul/maven-hello-world" target="_blank">https://central.sonatype.com/artifact/com.chensoul/maven-hello-world</a></li>
<li><a href="https://s01.oss.sonatype.org/service/local/repositories/releases/content/com/chensoul/maven-hello-world" target="_blank">https://s01.oss.sonatype.org/service/local/repositories/releases/content/com/chensoul/maven-hello-world</a></li>
<li><a href="https://repo.maven.apache.org/maven2/com/chensoul/maven-hello-world" target="_blank">https://repo.maven.apache.org/maven2/com/chensoul/maven-hello-world</a></li>
</ul>
<h2 id="配置github-actions">配置Github Actions</h2>
<p>使用 Github Actions 发布 jar 到 maven 仓库，目前发现有两个 action 可以实现该目的：</p>
<ul>
<li>
<p><a href="https://github.com/actions/setup-java" target="_blank">actions/setup-java</a></p>
</li>
<li>
<p><a href="https://github.com/qcastel/github-actions-maven-release" target="_blank">qcastel/github-actions-maven-release</a></p>
</li>
<li>
<p><a href="https://github.com/marketplace/actions/action-maven-publish" target="_blank">action-maven-publish</a></p>
</li>
</ul>
<h3 id="actionssetup-java">actions/setup-java</h3>
<p>使用 <a href="https://github.com/actions/setup-java" target="_blank">actions/setup-java</a> ，参考使用文档，在项目的 .github/workflows 目录下创建 maven-release.yml文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Maven Release</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#e6db74">&#34;main&#34;</span> ]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tags</span>: [<span style="color:#e6db74">&#39;java&#39;</span>, <span style="color:#e6db74">&#39;backend&#39;</span>, <span style="color:#e6db74">&#39;tutorial&#39;</span>, <span style="color:#e6db74">&#39;redis&#39;</span>, <span style="color:#e6db74">&#39;docker&#39;</span>, <span style="color:#e6db74">&#39;javascript&#39;</span>, <span style="color:#e6db74">&#39;git&#39;</span>, <span style="color:#e6db74">&#39;maven&#39;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">release</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">types</span>: [ <span style="color:#ae81ff">created ]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">if</span>: <span style="color:#e6db74">&#34;!contains(github.event.head_commit.message, &#39;[CI Skip]&#39;)&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Set up JDK 8</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-java@v4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">distribution</span>: <span style="color:#e6db74">&#39;temurin&#39;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">java-version</span>: <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cache</span>: <span style="color:#ae81ff">maven</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">server-id</span>: <span style="color:#ae81ff">ossrh</span> <span style="color:#75715e"># Value of the distributionManagement/repository/id field of the pom.xml</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">server-username</span>: <span style="color:#ae81ff">MAVEN_USERNAME</span> <span style="color:#75715e"># 变量</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">server-password</span>: <span style="color:#ae81ff">MAVEN_TOKEN</span> <span style="color:#75715e"># 变量</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">gpg-passphrase</span>: <span style="color:#ae81ff">GPG_PASSPHRASE</span> <span style="color:#75715e"># 变量</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">gpg-private-key</span>: <span style="color:#ae81ff">${{ secrets.MAVEN_GPG_PRIVATE_KEY }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Java Maven Release</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">mvn -ntp -B -U clean deploy -P release -DskipTests</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">MAVEN_USERNAME</span>: <span style="color:#ae81ff">${{ secrets.OSSRH_USERNAME }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">MAVEN_TOKEN</span>: <span style="color:#ae81ff">${{ secrets.OSSRH_TOKEN }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">GPG_PASSPHRASE</span>: <span style="color:#ae81ff">${{ secrets.MAVEN_GPG_PASSPHRASE }}</span>
</span></span></code></pre></div><p>根据上面的 yaml 文件，需要在当前项目的 Settings&ndash;&gt;Secrets&ndash;&gt;Actions 创建以下 Secrets：</p>
<ul>
<li><strong>OSSRH_TOKEN</strong>：您在 Sonatype 上的密码</li>
<li><strong>OSSRH_USERNAME</strong>：您在 Sonatype 上的用户名</li>
<li><strong>MAVEN_GPG_PRIVATE_KEY</strong>：用于签名 Jar 包的 GPG 密钥</li>
<li><strong>MAVEN_GPG_PASSPHRASE</strong>：用于签名的 GPG 密钥密码</li>
</ul>
<p><strong>MAVEN_GPG_PRIVATE_KEY</strong> 通过如下命令获取：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gpg --list-keys
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>keyboxd<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>---------
</span></span><span style="display:flex;"><span>pub   ed25519 2024-05-08 <span style="color:#f92672">[</span>SC<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>有效至：2027-05-08<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      C83119F1B90238633D766D4B93C5993B9F7B43EE
</span></span><span style="display:flex;"><span>uid             <span style="color:#f92672">[</span> 绝对 <span style="color:#f92672">]</span> chensoul &lt;ichensoul@gmail.com&gt;
</span></span><span style="display:flex;"><span>sub   cv25519 2024-05-08 <span style="color:#f92672">[</span>E<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>有效至：2027-05-08<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ gpg --armor --export-secret-keys C83119F1B90238633D766D4B93C5993B9F7B43EE
</span></span><span style="display:flex;"><span>-----BEGIN PGP PRIVATE KEY BLOCK-----
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lIYEZjrnpBYJKwYBBAHaRw8BAQdAmMtUf7k2poUBYhlca7U7le2vGPEHgAtHZ1MH
</span></span><span style="display:flex;"><span>DGOSZR3+BwMCiYrT2G14W736nwBjZvOLsJKjxsSqVN9bRLATEg3veHW/59Jw4DaI
</span></span><span style="display:flex;"><span>QN5DX8ier7D2rXM9fkJfYyLg3wNVAcT7dmcQOVM5wkgL1B7EEz3/aLQeY2hlbnNv
</span></span><span style="display:flex;"><span>dWwgPGljaGVuc291bEBnbWFpbC5jb20+iJkEExYKAEEWIQTIMRnxuQI4Yz12bUuT
</span></span><span style="display:flex;"><span>xZk7n3tD7gUCZjrnpAIbAwUJBaOagAULCQgHAgIiAgYVCgkICwIEFgIDAQIeBwIX
</span></span><span style="display:flex;"><span>gAAKCRCTxZk7n3tD7sgGAQCBRsbdVDn1NuVYXOPEAKAFUFWgowb0tkH7w5VzWWD2
</span></span><span style="display:flex;"><span>hwD+IHR5JiegnI376upOLiUzQ5cZN8gJ3fn0oau5ELp1lQSciwRmOuekEgorBgEE
</span></span><span style="display:flex;"><span>AZdVAQUBAQdAnfkcIuOOyU+ihUX/Z8nU9634MbTG0OHfEZCbm9pgdH4DAQgH/gcD
</span></span><span style="display:flex;"><span>AqPKEqB6fGQq+u4+7gYGW2vgkeiTjWJCwVw8VJEwn53+gdQ0q7irfnOOqYNXJbye
</span></span><span style="display:flex;"><span>n2NM9IucSZpcVk8gKhJmc8hJR4uNifh0i820vEjyszeIfgQYFgoAJhYhBMgxGfG5
</span></span><span style="display:flex;"><span>AjhjPXZtS5PFmTufe0PuBQJmOuekAhsMBQkFo5qAAAoJEJPFmTufe0PubSkA/R6I
</span></span><span style="display:flex;"><span>/7+oavy/FP9r6PfV1oI5yiAy7RMue1BuIcbRMoabAPkBBQq/ms9DZ5GA25ZpSuOH
</span></span><span style="display:flex;"><span>S3ee7QZPNjtkA2s/eQsPAQ<span style="color:#f92672">==</span>
</span></span></code></pre></div><h3 id="qcastelgithub-actions-maven-release">qcastel/github-actions-maven-release</h3>
<p>使用 <a href="https://github.com/qcastel/github-actions-maven-release" target="_blank">qcastel/github-actions-maven-release</a> ，参考使用文档，在项目的 .github/workflows 目录下创建 maven-release.yml文件：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Maven Release</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#e6db74">&#34;main&#34;</span> ]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tags</span>: [<span style="color:#e6db74">&#39;java&#39;</span>, <span style="color:#e6db74">&#39;backend&#39;</span>, <span style="color:#e6db74">&#39;tutorial&#39;</span>, <span style="color:#e6db74">&#39;redis&#39;</span>, <span style="color:#e6db74">&#39;docker&#39;</span>, <span style="color:#e6db74">&#39;javascript&#39;</span>, <span style="color:#e6db74">&#39;git&#39;</span>, <span style="color:#e6db74">&#39;maven&#39;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">release</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">types</span>: [ <span style="color:#ae81ff">created ]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">if</span>: <span style="color:#e6db74">&#34;!contains(github.event.head_commit.message, &#39;[CI Skip]&#39;)&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Java Maven Release</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">qcastel/github-actions-maven-release@master</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">JAVA_HOME</span>: <span style="color:#ae81ff">/usr/lib/jvm/java-1.8-openjdk/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">git-release-bot-name</span>: <span style="color:#e6db74">&#34;release-bot&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">git-release-bot-email</span>: <span style="color:#e6db74">&#34;release-bot@chensoul.cc&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">release-branch-name</span>: <span style="color:#e6db74">&#34;main&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">maven-args</span>: <span style="color:#e6db74">&#34;-ntp -B -U -P release&#34;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">maven-servers</span>: <span style="color:#ae81ff">${{ secrets.MVN_REPO_SERVERS }}</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">ssh-private-key</span>: <span style="color:#ae81ff">${{ secrets.SSH_PRIVATE_KEY }}</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">gpg-enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">gpg-key-id</span>: <span style="color:#ae81ff">${{ secrets.MAVEN_GPG_ID }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">gpg-key</span>: <span style="color:#ae81ff">${{ secrets.MAVEN_GPG_KEY }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">gpg-passphrase</span>: <span style="color:#ae81ff">${{ secrets.MAVEN_GPG_PASSPHRASE }}</span>
</span></span></code></pre></div><p>根据上面的 yaml 文件，需要在当前项目的 Settings&ndash;&gt;Secrets&ndash;&gt;Actions 创建以下 Secrets：</p>
<ul>
<li><strong>MVN_REPO_SERVERS</strong></li>
<li><strong>SSH_PRIVATE_KEY</strong></li>
<li><strong>MAVEN_GPG_ID</strong></li>
<li><strong>MAVEN_GPG_KEY</strong></li>
<li><strong>MAVEN_GPG_PASSPHRASE</strong></li>
</ul>
<p><strong>MVN_REPO_SERVERS</strong> 如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;ossrh&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;LSJkOqOi&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;3oJOIO5+ah7LIcRSmDC2YDGjE9PRbgxoE2UbXjOrSzC1&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;gpg.passphrase&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;passphrase&#34;</span>: <span style="color:#e6db74">&#34;chensoul&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p><strong>SSH_PRIVATE_KEY</strong> 通过下面命令获取：</p>
<p>1、在 docker 容器中生成</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -it qcastel/maven-release:latest  bash
</span></span></code></pre></div><p>ssh 公钥和秘钥</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh-keygen -b <span style="color:#ae81ff">2048</span> -t rsa -f ~/.ssh/id_rsa -q -N <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;Copy the following SSH private key and add it to your repo secrets under the name &#39;SSH_PRIVATE_KEY&#39;:&#34;</span>
</span></span><span style="display:flex;"><span>base64 ~/.ssh/id_rsa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;Copy the encoded SSH public key and add it as one of your repo deploy keys with write access:&#34;</span>
</span></span><span style="display:flex;"><span>cat ~/.ssh/id_rsa.pub
</span></span></code></pre></div><p>输出内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Copy the following SSH private key and add it to your repo secrets under the name <span style="color:#e6db74">&#39;SSH_PRIVATE_KEY&#39;</span>:
</span></span><span style="display:flex;"><span>LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFB QUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUJGd0FBQUFkemMyZ3RjbgpOaEFBQUFB d0VBQVFBQUFRRUExQUFBclFpZFNRS25pY3g5VmNaQVdtTlI1ZWY0Q2tSbEJCZTdVdk5QNGNMMlAv eDRReXJpCmdWcGV2Um8wVHE0eUptWFN2L3hnclByNk5CQmk0STlXRmp6Q2l0a3phcTg3OGwyNVdt UUt5cTUyang5TWJ0MmhCZzVrdUsKZ05pRGxvMWNaY1VpZHd4ak9sNzVlVHpWaHpoSGZ4ZnphZTZY N0QybE1jeFUrd2d3MFJHZlpITjUvRUZWQ3JHRUhKdHlGSQpReFd1VDY0c3RNMElrVjA3azBPRlQy SHhYNlB6OUpvRjhRRm9SZmVjU0RUM2tPRk5rTVVicDVTNkkxNWxtTjB0YnNHVGNsClYxWFpwWUkr NHRFWWphN1EwWnlWaVBCVUJnWnBuUlpQNFRmOEIwRzhsVDdqSlNPWDM0YkRFWkFoMVM4bnRCQzc3 aFUyMUIKWGJDZHV6ZlpXUUFBQThoN29jU3VlNkhFcmdBQUFBZHpjMmd0Y25OaEFBQUJBUURVQUFD dENKMUpBcWVKekgxVnhrQmFZMQpIbDUvZ0tSR1VFRjd0UzgwL2h3dlkvL0hoREt1S0JXbDY5R2pS T3JqSW1aZEsvL0dDcyt2bzBFR0xnajFZV1BNS0syVE5xCnJ6dnlYYmxhWkFyS3JuYVBIMHh1M2FF R0RtUzRxQTJJT1dqVnhseFNKM0RHTTZYdmw1UE5XSE9FZC9GL05wN3Bmc1BhVXgKekZUN0NERFJF WjlrYzNuOFFWVUtzWVFjbTNJVWhERmE1UHJpeTB6UWlSWFR1VFE0VlBZZkZmby9QMG1nWHhBV2hG OTV4SQpOUGVRNFUyUXhSdW5sTG9qWG1XWTNTMXV3Wk55VlhWZG1sZ2o3aTBSaU5ydERSbkpXSThG UUdCbW1kRmsvaE4vd0hRYnlWClB1TWxJNWZmaHNNUmtDSFZMeWUwRUx2dUZUYlVGZHNKMjdOOWxa QUFBQUF3RUFBUUFBQVFCSzBqMXExSEYraFJ0UVBRVzMKTWlNZ1E1RnlETzZ6NFBPdUFCb3k2b0Mw OHpRcDNSY3N6WVBubDFkOGNqVW4xNzhIWWtTQlViZGxGYWNjblBQb3dXM21wMApjWjdoS0JncHNy clB4djlJTUNpWlI2YXRkMUFXK0ZUYXNxcU5VdDBPVTVIYXNUcTZ2WHAvN1drcTZ0ZUp3OGtvQi9I MjN5CmhyVGs1eFJ1WnZPckxGcS9vdXBQeXhVS1M0SzRVOG5JYjBnZjVjT3RXeUlWZFdKQ05EdU9R ZW1sdDBRajN3RjZPWkNpcU8KRGxaMFd3MWwrRzJpUWZFLzM2ODR0UXpKemVKeFgybEJaN0tmQStP bEcyZENPeXZwY01Ic1J4TE5ITy85aWpqUmNXWUVtMgp4SDVYQmRkZldlKzBkYkxxZFhoWHJHTnpx QjlSbjBTWGZ1QVRnSzZENjBsSkFBQUFnUUN6VmhONUh1YXVvOExzVVR1dkNRCkNibVhnakhuS1hB NDBqV1pyVmlucEgvbmcxNkNudlE5UmJhb041am1JWURUZEJ3TVp4dXZSck9JUTloeUZnUDVCSHRL dTgKQlhvZ08ybERySDFVRzA4bzN6ZHNhUTJaaGp0aEE5TFlMcXpvYkVtSEpndkwxemJjRVBWMHJC cm1SMXArL0trN3Y5OHd0eQpPT2VnYXVqK0djUXdBQUFJRUE5ZklKc0t2SGdsQVp1eS9sMzJWS3Q4 cTN4UFl4SUlrMVJKczV4bDRJUGFTZ0xsR0pzVFgwCll2bll1THcrb2NCMlVaazRxUUlML3I5bTRt cVhEOTF6bXhxZTNUKzZqOHk0ODBvbS91UWRma3h6MWdNWkljdDlkR2Z3RE8KczRBckNPSkx0TVI4 WG53emxXM1VLZnJhTDFRUFZMVUs3OWpSM29kN2k2VmNWMlpnY0FBQUNCQU55cXRMZk85NUhkU3Mz RwpyMWYvOStVRUJjV0xMSnpHMEl2OEZtd3J6ci9ZbksrbXpmR2dMVHNPeUgwV1pMZkVnYlJkUGxC aVJmTjFXQk1oWHZKRWhaCkp4YTY1N0IxTUExano1eEE2OElCcEJxUlhvNWZ6QmdHNFg0UGVNZkQz dXR5M0NENVR4Y2sxL0c1L2krUXpXNFhlR2RLNkkKaml1OGg5TXo3YkUxZHUyZkFBQUFFWEp2YjNS QVlqa3dZelJtWWpKbE9HVmxBUT09Ci0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Copy the encoded SSH public key and add it as one of your repo deploy keys with write access:
</span></span><span style="display:flex;"><span>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDUAACtCJ1JAqeJzH1VxkBaY1Hl5/gKRGUEF7tS80/hwvY/HhDKuKBWl69GjROrjImZdK/GCs+vo0EGLgj1YWPMKK2TNqrzvyXblaZArKrnaPH0xu3aEGDmS4qA2IOWjVxlxSJ3DGM6Xvl5PNWHOEd/F/Np7pfsPaUxzFT7CDDREZ9kc3n8QVUKsYQcm3IUhDFa5Priy0zQiRXTuTQ4VPYfFfo/P0mgXxAWhF95xINPeQ4U2QxRunlLojXmWY3S1uwZNyVXVdmlgj7i0RiNrtDRnJWI8FQGBmmdFk/hN/wHQbyVPuMlI5ffhsMRkCHVLye0ELvuFTbUFdsJ27N9lZ root@b90c4fb2e8ee
</span></span></code></pre></div><p>2、或者直接使用本地的 ssh</p>
<p>macos 系统上执行命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;Copy the following SSH private key and add it to your repo secrets under the name &#39;SSH_PRIVATE_KEY&#39;:&#34;</span>
</span></span><span style="display:flex;"><span>base64 -i ~/.ssh/id_rsa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34; &#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#34;Copy the encoded SSH public key and add it as one of your repo deploy keys with write access:&#34;</span>
</span></span><span style="display:flex;"><span>cat ~/.ssh/id_rsa.pub
</span></span></code></pre></div><p>将私钥粘贴到 Secrets 中 <strong>SSH_PRIVATE_KEY</strong> 的值内，将公钥添加到你的 github 账号的 <a href="https://github.com/settings/ssh/new" target="_blank">SSH keys</a> 中。</p>
<p>获取 <strong>MAVEN_GPG_ID</strong>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ gpg --list-secret-keys --keyid-format LONG
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>keyboxd<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>---------
</span></span><span style="display:flex;"><span>sec   ed25519/93C5993B9F7B43EE 2024-05-08 <span style="color:#f92672">[</span>SC<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>有效至：2027-05-08<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      C83119F1B90238633D766D4B93C5993B9F7B43EE
</span></span><span style="display:flex;"><span>uid                   <span style="color:#f92672">[</span> 绝对 <span style="color:#f92672">]</span> chensoul &lt;ichensoul@gmail.com&gt;
</span></span><span style="display:flex;"><span>ssb   cv25519/116B95FF0068A7E8 2024-05-08 <span style="color:#f92672">[</span>E<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>有效至：2027-05-08<span style="color:#f92672">]</span>
</span></span></code></pre></div><blockquote>
<p>这里 <strong>MAVEN_GPG_ID</strong> 对应 93C5993B9F7B43EE</p></blockquote>
<p>获取 <strong>MAVEN_GPG_KEY</strong>，运行下面命令，输入密码，即 <strong>MAVEN_GPG_PASSPHRASE</strong> 对应的内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;Public key to add in your bot github account:&#39;</span>
</span></span><span style="display:flex;"><span>gpg --armor --export 93C5993B9F7B43EE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;Private key to add to the CI secrets under GITHUB_GPG_KEY:&#39;</span>
</span></span><span style="display:flex;"><span>gpg --export-secret-keys --armor 93C5993B9F7B43EE | base64
</span></span></code></pre></div><p>输出内容：</p>
<p>公钥：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-----BEGIN PGP PUBLIC KEY BLOCK-----
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mDMEZjrnpBYJKwYBBAHaRw8BAQdAmMtUf7k2poUBYhlca7U7le2vGPEHgAtHZ1MH
</span></span><span style="display:flex;"><span>DGOSZR20HmNoZW5zb3VsIDxpY2hlbnNvdWxAZ21haWwuY29tPoiZBBMWCgBBFiEE
</span></span><span style="display:flex;"><span>yDEZ8bkCOGM9dm1Lk8WZO597Q+4FAmY656QCGwMFCQWjmoAFCwkIBwICIgIGFQoJ
</span></span><span style="display:flex;"><span>CAsCBBYCAwECHgcCF4AACgkQk8WZO597Q+7IBgEAgUbG3VQ59TblWFzjxACgBVBV
</span></span><span style="display:flex;"><span>oKMG9LZB+8OVc1lg9ocA/iB0eSYnoJyN++rqTi4lM0OXGTfICd359KGruRC6dZUE
</span></span><span style="display:flex;"><span>uDgEZjrnpBIKKwYBBAGXVQEFAQEHQJ35HCLjjslPooVF/2fJ1Pet+DG0xtDh3xGQ
</span></span><span style="display:flex;"><span>m5vaYHR+AwEIB4h+BBgWCgAmFiEEyDEZ8bkCOGM9dm1Lk8WZO597Q+4FAmY656QC
</span></span><span style="display:flex;"><span>GwwFCQWjmoAACgkQk8WZO597Q+5tKQD9Hoj/v6hq/L8U/2vo99XWgjnKIDLtEy57
</span></span><span style="display:flex;"><span>UG4hxtEyhpsA+QEFCr+az0NnkYDblmlK44dLd57tBk82O2QDaz95Cw8B
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>YFZg
</span></span><span style="display:flex;"><span>-----END PGP PUBLIC KEY BLOCK-----
</span></span></code></pre></div><p>私钥：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>LS0tLS1CRUdJTiBQR1AgUFJJVkFURSBLRVkgQkxPQ0stLS0tLQoKbElZRVpqcm5wQllKS3dZQkJBSGFSdzhCQVFkQW1NdFVmN2sycG9VQllobGNhN1U3bGUydkdQRUhnQXRIWjFNSApER09TWlIzK0J3TUNwOTJOaVVIQnU0VDZ3UHRFSWt1cGtTM2M0c21WOWZUUXRtRDM3bTJuOTlzbnRWNmllYU8vCi9TKzUvR2FyWDNMTUhoTmtkdnVpOHZSMk1hNDNhNFdzVmFpR1RiZWF6eHNHbVE1TGo4ZXUvTFFlWTJobGJuTnYKZFd3Z1BHbGphR1Z1YzI5MWJFQm5iV0ZwYkM1amIyMCtpSmtFRXhZS0FFRVdJUVRJTVJueHVRSTRZejEyYlV1VAp4Wms3bjN0RDdnVUNaanJucEFJYkF3VUpCYU9hZ0FVTENRZ0hBZ0lpQWdZVkNna0lDd0lFRmdJREFRSWVCd0lYCmdBQUtDUkNUeFprN24zdEQ3c2dHQVFDQlJzYmRWRG4xTnVWWVhPUEVBS0FGVUZXZ293YjB0a0g3dzVWeldXRDIKaHdEK0lIUjVKaWVnbkkzNzZ1cE9MaVV6UTVjWk44Z0ozZm4wb2F1NUVMcDFsUVNjaXdSbU91ZWtFZ29yQmdFRQpBWmRWQVFVQkFRZEFuZmtjSXVPT3lVK2loVVgvWjhuVTk2MzRNYlRHME9IZkVaQ2JtOXBnZEg0REFRZ0gvZ2NECkFtYllUMStNNjB6bStna1lyMk54Yys1U3hqYmd6bTA1ajFURW42TnUwVTUyUmRoMzJvTVRYU2ZIa2RlakdiVmkKMDNKemRkVnZ6Kzl6U2FzQVpMMVA1ZytBa0dGbTBHYVFLTldnOUVRQzVBK0lmZ1FZRmdvQUpoWWhCTWd4R2ZHNQpBamhqUFhadFM1UEZtVHVmZTBQdUJRSm1PdWVrQWhzTUJRa0ZvNXFBQUFvSkVKUEZtVHVmZTBQdWJTa0EvUjZJCi83K29hdnkvRlA5cjZQZl
</span></span></code></pre></div><p>将上面输出私钥的内容添加到 Secrets 中 <strong>MAVEN_GPG_KEY</strong> 的值里面，将公钥内容添加到你的 github 账号的 <a href="https://github.com/settings/gpg/new" target="_blank">GPG keys</a> 中。</p>
<p>修改代码，提交到 github，会触发一个 github action ，查看日志，可以看到：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Not using access token authentication, as no access token <span style="color:#f92672">(</span>via env GITREPO_ACCESS_TOKEN<span style="color:#f92672">)</span> defined or because an SSH key is defined and setup <span style="color:#f92672">(</span>via env SSH_PRIVATE_KEY<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Do mvn release:prepare with options  -DdevelopmentVersion<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>parsedVersion.majorVersion<span style="color:#e6db74">}</span>.<span style="color:#e6db74">${</span>parsedVersion.minorVersion<span style="color:#e6db74">}</span>.<span style="color:#e6db74">${</span>parsedVersion.nextIncrementalVersion<span style="color:#e6db74">}</span>-SNAPSHOT and arguments -ntp -B -U -P release
</span></span></code></pre></div><p>从日志可以看到，qcastel/github-actions-maven-release 使用了 maven 的 maven-release-plugin 插件，会发布正式版的 jar 到 maven 中央仓库。为了 避免在开发阶段每次提交都发布一个正式版本到中央仓库，可以修改 release-branch-name 为 release 分支，即限定提交到指定分支时候，从触发 maven 发布。</p>
<p>可以添加下面参数，跳过 release:perform ，即不会发布 jar 到 maven 中央仓库，<strong>但是 maven-release-plugin 插件还是会修改项目的版本，并创建 tag。</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>with:
</span></span><span style="display:flex;"><span>    skip-perform: true
</span></span></code></pre></div><p>创建的 tag 名称格式为：项目名称-版本。tag 名称格式可以在 maven-release-plugin 插件中配置：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;artifactId&gt;</span>maven-release-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;version&gt;</span>${maven-release-plugin.version}<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;scmCommentPrefix&gt;</span>[CI Skip]<span style="color:#f92672">&lt;/scmCommentPrefix&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;autoVersionSubmodules&gt;</span>true<span style="color:#f92672">&lt;/autoVersionSubmodules&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;useReleaseProfile&gt;</span>false<span style="color:#f92672">&lt;/useReleaseProfile&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;releaseProfiles&gt;</span>release<span style="color:#f92672">&lt;/releaseProfiles&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;tagNameFormat&gt;</span>v@{version}<span style="color:#f92672">&lt;/tagNameFormat&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;goals&gt;</span>deploy<span style="color:#f92672">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span></code></pre></div><h3 id="action-maven-publish">action-maven-publish</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Release</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">tags</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#39;v*&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">release</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v3</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Set up JDK 8</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-java@v4</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">java-version</span>: <span style="color:#e6db74">&#39;8&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">distribution</span>: <span style="color:#e6db74">&#39;temurin&#39;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build with Maven</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">run</span>: <span style="color:#ae81ff">mvn clean install</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Publish to Maven Central</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">samuelmeuli/action-maven-publish@v1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">gpg_private_key</span>: <span style="color:#ae81ff">${{ secrets.MAVEN_GPG_PRIVATE_KEY }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">gpg_passphrase</span>: <span style="color:#ae81ff">${{ secrets.MAVEN_GPG_PASSPHRASE }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">nexus_username</span>: <span style="color:#ae81ff">${{ secrets.OSSRH_USERNAME }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">nexus_password</span>: <span style="color:#ae81ff">${{ secrets.OSSRH_TOKEN }}</span>
</span></span></code></pre></div><h2 id="总结">总结</h2>
<p>如果使用 <a href="https://github.com/qcastel/github-actions-maven-release" target="_blank">qcastel/github-actions-maven-release</a> ，maven-release-plugin 插件会修改版本，并且创建 tag ，但是并不会创建 github release。</p>
<p>使用 <a href="https://github.com/release-drafter/release-drafter" target="_blank">https://github.com/release-drafter/release-drafter</a> 这个 actions 可以更加 pull request 自动创建 github releae，基于此，更倾向于使用 <a href="https://github.com/actions/setup-java" target="_blank">actions/setup-java</a> 来发布 jar 到 Maven 仓库。</p>

		</div>


	</article>
</main>
<footer class="post__footer">
	

<div class="post-related">
	<h3>相关文章</h3>
	<ul class="post-related-list">
		
		<li class="post-related-item">
			<a href="/posts/2024/07/19/gitlab-runner-install/" target="_blank" title="GitLab Runner安装和部署">GitLab Runner安装和部署</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2024/06/26/install-gitlab/" target="_blank" title="Gitlab安装和部署-使用Docker">Gitlab安装和部署-使用Docker</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2024/04/17/thingsboard-tbmq-local-docker-run/" target="_blank" title="ThingsBoard TBMQ本地和通过Docker运行">ThingsBoard TBMQ本地和通过Docker运行</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2024/07/24/jms20/" target="_blank" title="[译]JMS 2.0 中的新增功能（第一部分）- 易于使用">[译]JMS 2.0 中的新增功能（第一部分）- 易于使用</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2024/07/24/jms20/" target="_blank" title="[译]JMS 2.0 中的新增功能（第二部分）- 新的消息传送功能">[译]JMS 2.0 中的新增功能（第二部分）- 新的消息传送功能</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2024/07/23/jms-transactions-in-action/" target="_blank" title="[译]JMS 事务的实际应用">[译]JMS 事务的实际应用</a>
		</li>
		
	</ul>
</div>

</footer>

<footer class="post__footer">
	<footer class="post__footer">
		
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/docker/" rel="tag">docker</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/javascript/" rel="tag">javascript</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/redis/" rel="tag">redis</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/backend/" rel="tag">backend</a>
		</li>
	</ul>
</div>
	</footer>
</footer>


<nav class="pagination flex">
	<div class="pagination__item pagination__item--prev">
		<a class="pagination__link" href="/posts/2024/07/24/jms20-means-less-code/" rel="prev">
			<p class="pagination__title">«&thinsp;上一篇: [译]JMS 2.0 的十个好处意味着可以减少代码编写量</p>
		</a>
	</div>
	<div class="pagination__item pagination__item--next">
		<a class="pagination__link" href="/posts/2024/08/05/a-crash-course-in-database-scaling/" rel="next">
			<p class="pagination__title">&thinsp;» 下一篇: [译]数据库扩展策略速成课程</p>
		</a>
	</div>
</nav>



<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="ChenSoul avatar" src="/avatar.jpg" class="avatar" height="60" width="60" loading="lazy">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">关于 ChenSoul</span>
	</div>
	<div class="authorbox__description">
		一个来自中国武汉的开发者，主要撰写软件开发和开源方面的文章。浏览我的<a href="%28/posts%29">博客文章</a>，订阅我的 <a href="/index.xml">RSS</a> 源，或了解更多<a href="/about/">关于我</a>的信息。
	</div>
</div>




	<p><h3>欢迎留言！</h3></p>
<div id="remark42"></div>
<script>
	var remark_config = {
		host: 'https:\/\/comment.chensoul.cc',
		site_id: 'remark',
		components: ['embed'],
		url: 'https:\/\/blog.chensoul.cc\/posts\/2024\/08\/01\/publishing-a-jar-to-maven-repository-with-github-action\/',
		locale: 'zh'
	};

	!function(e, n) {
		for (var o = 0; o < e.length; o++) {
			var r = n.createElement('script'),
			c = '.js',
			d = n.head || n.body;
			'noModule' in r ? (r.type = 'module', c = '.mjs') : r.async = !0, r.defer = !0, r.src = remark_config.host + '/web/' + e[o] + c, d.appendChild(r)
		}
	}(remark_config.components || ['embed'], document);

</script>





			</div>
			

<aside class="sidebar sidebar--right">
	<div class="post__toc toc">
		<div class="toc__title">目录</div>
		<div class="toc__menu">
			<nav id="TableOfContents">
  <ul>
    <li><a href="#前提条件">前提条件</a></li>
    <li><a href="#创建-maven-项目">创建 Maven 项目</a></li>
    <li><a href="#安装-gpg-并创建公秘钥">安装 GPG 并创建公秘钥</a></li>
    <li><a href="#使用-maven-发布-jar">使用 Maven 发布 jar</a></li>
    <li><a href="#配置github-actions">配置Github Actions</a>
      <ul>
        <li><a href="#actionssetup-java">actions/setup-java</a></li>
        <li><a href="#qcastelgithub-actions-maven-release">qcastel/github-actions-maven-release</a></li>
        <li><a href="#action-maven-publish">action-maven-publish</a></li>
      </ul>
    </li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
		</div>
	</div>
</aside>

		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
<div class="footer__links">
	<a class="footer__link" href="/">首页</a> | <a class="footer__link" href="/categories/">分类</a> | <a class="footer__link" href="/tags/">标签</a> | <a class="footer__link" href="/index.xml">订阅</a> | <a class="footer__link" href="/about/">关于</a>
</div>
		<div class="footer__copyright">
			&copy; 2025 ChenSoul.
			<span class="footer__copyright-credits">基于 <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> 引擎和 <a href="https://github.com/chensoul/rose-hugo/" rel="nofollow noopener" target="_blank">Rose Hugo</a> 主题</span>
		</div>
	</div>

	






<style>
	.scroll-up a {
		display: block;
		height: 3.125rem;
		width: 3.125rem;
		text-align: center;
		line-height: 2.7;
		border-radius: 50px;
		font-size: 1.125rem;
		color: #fff;
		opacity: 1;
		transition: all 0.3s ease 0s;
		box-shadow: 0 0 10px rgb(0 0 0 / 20%);
	}
	.scroll-up a {
		background: #ee591f;
	}
	.scroll-up {
		position: fixed;
		display: none;
		bottom: 50px;
		z-index: 999;
	}
	.scroll-up.right {
		right: 60px;
	}
</style>

<div class="scroll-up custom right" style="display: block;"><a href="#top" id="top-link" accesskey="g"><i
	class="fa fa-arrow-up"></i></a></div>

<script>
	var mybutton = document.getElementById("top-link");
	window.onscroll = function () {
		if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
			mybutton.style.visibility = "visible";
			mybutton.style.opacity = "1";
		} else {
			mybutton.style.visibility = "hidden";
			mybutton.style.opacity = "0";
		}
	};
</script>


    <script defer src="https://umami.chensoul.cc/random-string.js" data-website-id="1e07d36d-bec3-4ba6-9459-876b1ac3bbe7"></script>
</footer>


	</div>

	<script>
		'use strict';
		(function iifeMenu(document, window, undefined) {
			var menuBtn = document.querySelector('.menu__btn');
			var	menu = document.querySelector('.menu__list');
			function toggleMenu() {
				menu.classList.toggle('menu__list--active');
				menu.classList.toggle('menu__list--transition');
				this.classList.toggle('menu__btn--active');
				this.setAttribute(
					'aria-expanded',
					this.getAttribute('aria-expanded') === 'true' ? 'false' : 'true'
				);
			}
			function removeMenuTransition() {
				this.classList.remove('menu__list--transition');
			}
			if (menuBtn && menu) {
				menuBtn.addEventListener('click', toggleMenu, false);
				menu.addEventListener('transitionend', removeMenuTransition, false);
			}
		}(document, window));
	</script>
</body>
</html>