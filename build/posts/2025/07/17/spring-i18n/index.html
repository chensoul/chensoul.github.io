<!DOCTYPE html>
<html class="no-js" lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring å›½é™…åŒ–å®ç° - Javaã€Springã€Spring Bootã€MicroServicesã€Architectureã€Kubernetesã€DevOps</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="Spring å›½é™…åŒ–å®ç°">
	<meta property="og:description" content="Javaã€Springã€Spring Bootã€MicroServicesã€Architectureã€Kubernetesã€DevOps">
	<meta property="og:type" content="article">
	<meta property="og:url" content="https://blog.chensoul.cc/posts/2025/07/17/spring-i18n/">
	<meta property="og:site_name" content="ChenSoul Blog">
	<meta property="og:image" content="">
	
  <meta itemprop="name" content="Spring å›½é™…åŒ–å®ç°">
  <meta itemprop="description" content="ğŸ“œ ä¸€ã€è®¾è®¡èƒŒæ™¯ 1.1 å›½é™…åŒ–éœ€æ±‚çš„äº§ç”Ÿ éšç€è½¯ä»¶åº”ç”¨çš„å…¨çƒåŒ–å‘å±•ï¼Œä¼ä¸šçº§åº”ç”¨éœ€è¦æ”¯æŒå¤šç§è¯­è¨€å’Œåœ°åŒºè®¾ç½®ã€‚Spring Framework ä½œä¸º Java ä¼ä¸šçº§å¼€å‘çš„æ ¸å¿ƒæ¡†æ¶ï¼Œå¿…é¡»æä¾›å®Œå–„çš„å›½é™…åŒ–ï¼ˆi18nï¼‰æ”¯æŒæ¥æ»¡è¶³ä»¥ä¸‹éœ€æ±‚ï¼š">
  <meta itemprop="datePublished" content="2025-07-17T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-07-17T00:00:00+00:00">
  <meta itemprop="wordCount" content="2759">
  <meta itemprop="keywords" content="Kubernetes,Javascript,Redis,Microservice">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="Spring å›½é™…åŒ–å®ç°">
	<meta name="twitter:description" content="Javaã€Springã€Spring Bootã€MicroServicesã€Architectureã€Kubernetesã€DevOps">
	<meta name="twitter:image" content="">

	<link rel="preconnect" href="//fonts.loli.net" crossorigin>
	<link rel="dns-prefetch" href="//fonts.loli.net">
	<link rel="stylesheet" href="https://fonts.loli.net/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="/css/style.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="ChenSoul Blog" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/logo.svg" loading="lazy" alt="Site logo" width="60" height="60">
				</div><div class="logo__item logo__text">
					<div class="logo__title">ChenSoul Blog</div>
					<div class="logo__tagline">Javaã€Springã€Spring Bootã€MicroServicesã€Architectureã€Kubernetesã€DevOps</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">èœå•</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">é¦–é¡µ</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/">
				
				<span class="menu__text">åˆ†ç±»</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/tags/">
				
				<span class="menu__text">æ ‡ç­¾</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/index.xml">
				
				<span class="menu__text">è®¢é˜…</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">å…³äº</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring å›½é™…åŒ–å®ç°</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 1 1 0 28 1 1 0 0 1 0-28m0 3a3 3 0 1 0 0 22 3 3 0 0 0 0-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class="meta__text" datetime="2025-07-17">2025-07-17</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/java/" rel="category">Java</a>
	</span>
</div><div class="meta__item-tags meta__item"><svg class="meta__icon icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg><span class="meta__text"><a class="meta__link" href="/tags/kubernetes/" rel="tag">Kubernetes</a>, <a class="meta__link" href="/tags/javascript/" rel="tag">Javascript</a>, <a class="meta__link" href="/tags/redis/" rel="tag">Redis</a>, <a class="meta__link" href="/tags/microservice/" rel="tag">Microservice</a>
	</span>
</div>
</div>
		</header>
		
		<div class="content post__content clearfix">
			<h2 id="-ä¸€è®¾è®¡èƒŒæ™¯">ğŸ“œ ä¸€ã€è®¾è®¡èƒŒæ™¯</h2>
<h3 id="11-å›½é™…åŒ–éœ€æ±‚çš„äº§ç”Ÿ">1.1 å›½é™…åŒ–éœ€æ±‚çš„äº§ç”Ÿ</h3>
<p>éšç€è½¯ä»¶åº”ç”¨çš„å…¨çƒåŒ–å‘å±•ï¼Œä¼ä¸šçº§åº”ç”¨éœ€è¦æ”¯æŒå¤šç§è¯­è¨€å’Œåœ°åŒºè®¾ç½®ã€‚Spring Framework ä½œä¸º Java ä¼ä¸šçº§å¼€å‘çš„æ ¸å¿ƒæ¡†æ¶ï¼Œå¿…é¡»æä¾›å®Œå–„çš„å›½é™…åŒ–ï¼ˆi18nï¼‰æ”¯æŒæ¥æ»¡è¶³ä»¥ä¸‹éœ€æ±‚ï¼š</p>
<ul>
<li><strong>å¤šè¯­è¨€æ”¯æŒ</strong>ï¼šåº”ç”¨ç¨‹åºéœ€è¦æ ¹æ®ç”¨æˆ·çš„è¯­è¨€åå¥½æ˜¾ç¤ºç›¸åº”çš„æ–‡æœ¬å†…å®¹</li>
<li><strong>åœ°åŒºåŒ–é€‚é…</strong>ï¼šä¸åŒåœ°åŒºçš„æ—¥æœŸã€æ•°å­—ã€è´§å¸æ ¼å¼éœ€è¦æœ¬åœ°åŒ–å¤„ç†</li>
<li><strong>åŠ¨æ€åˆ‡æ¢</strong>ï¼šç”¨æˆ·å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢è¯­è¨€ç¯å¢ƒ</li>
<li><strong>ä¼ä¸šçº§ç‰¹æ€§</strong>ï¼šéœ€è¦æ”¯æŒå¤§è§„æ¨¡ã€é«˜å¹¶å‘çš„ä¼ä¸šçº§åº”ç”¨åœºæ™¯</li>
</ul>
<h3 id="12-java-å¹³å°åŸºç¡€">1.2 Java å¹³å°åŸºç¡€</h3>
<p>Spring çš„å›½é™…åŒ–è®¾è®¡åŸºäº Java å¹³å°çš„æ ‡å‡†å›½é™…åŒ–æœºåˆ¶ï¼š</p>
<ul>
<li><strong>ResourceBundle</strong>ï¼šJava SE æä¾›çš„æ ‡å‡†èµ„æºåŒ…æœºåˆ¶</li>
<li><strong>Locale</strong>ï¼šè¡¨ç¤ºç‰¹å®šçš„åœ°ç†ã€æ”¿æ²»æˆ–æ–‡åŒ–åŒºåŸŸ</li>
<li><strong>MessageFormat</strong>ï¼šç”¨äºæ ¼å¼åŒ–å¸¦å‚æ•°çš„æ¶ˆæ¯æ–‡æœ¬</li>
<li><strong>Properties æ–‡ä»¶</strong>ï¼šå­˜å‚¨é”®å€¼å¯¹å½¢å¼çš„å›½é™…åŒ–èµ„æº</li>
</ul>
<h3 id="13-spring-çš„è®¾è®¡ç†å¿µ">1.3 Spring çš„è®¾è®¡ç†å¿µ</h3>
<p>Spring åœ¨ Java æ ‡å‡†å›½é™…åŒ–åŸºç¡€ä¸Šï¼Œéµå¾ªä»¥ä¸‹è®¾è®¡ç†å¿µï¼š</p>
<ul>
<li><strong>æŠ½è±¡åŒ–</strong>ï¼šé€šè¿‡æ¥å£æŠ½è±¡å±è”½åº•å±‚å®ç°ç»†èŠ‚</li>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ”¯æŒå¤šç§èµ„æºåŠ è½½ç­–ç•¥å’Œå­˜å‚¨æ–¹å¼</li>
<li><strong>é›†æˆæ€§</strong>ï¼šä¸ Spring å®¹å™¨å’Œå…¶ä»–ç»„ä»¶æ— ç¼é›†æˆ</li>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šæä¾›ç»Ÿä¸€çš„ API å’Œé…ç½®æ–¹å¼</li>
</ul>
<hr>
<h2 id="-äºŒæ¶æ„ä¸æ ¸å¿ƒç»„ä»¶">ğŸ§± äºŒã€æ¶æ„ä¸æ ¸å¿ƒç»„ä»¶</h2>
<h3 id="1-æ ¸å¿ƒæ¥å£">1. æ ¸å¿ƒæ¥å£</h3>
<p>Spring å›½é™…åŒ–çš„æ ¸å¿ƒæ¶æ„å›´ç»•ä»¥ä¸‹å‡ ä¸ªå…³é”®æ¥å£å±•å¼€ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// æ ¸å¿ƒæ¶ˆæ¯æºæ¥å£</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">MessageSource</span> {
</span></span><span style="display:flex;"><span>    String <span style="color:#a6e22e">getMessage</span>(String code, Object<span style="color:#f92672">[]</span> args, String defaultMessage, Locale locale);
</span></span><span style="display:flex;"><span>    String <span style="color:#a6e22e">getMessage</span>(String code, Object<span style="color:#f92672">[]</span> args, Locale locale) <span style="color:#66d9ef">throws</span> NoSuchMessageException;
</span></span><span style="display:flex;"><span>    String <span style="color:#a6e22e">getMessage</span>(MessageSourceResolvable resolvable, Locale locale) <span style="color:#66d9ef">throws</span> NoSuchMessageException;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å±‚æ¬¡åŒ–æ¶ˆæ¯æºæ¥å£</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">HierarchicalMessageSource</span> <span style="color:#66d9ef">extends</span> MessageSource {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setParentMessageSource</span>(MessageSource parent);
</span></span><span style="display:flex;"><span>    MessageSource <span style="color:#a6e22e">getParentMessageSource</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// æ¶ˆæ¯æºå¯è§£æå¯¹è±¡</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">MessageSourceResolvable</span> {
</span></span><span style="display:flex;"><span>    String<span style="color:#f92672">[]</span> <span style="color:#a6e22e">getCodes</span>();
</span></span><span style="display:flex;"><span>    Object<span style="color:#f92672">[]</span> <span style="color:#a6e22e">getArguments</span>();
</span></span><span style="display:flex;"><span>    String <span style="color:#a6e22e">getDefaultMessage</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Spring çš„å›½é™…åŒ–æ¶ˆæ¯è§£ææ ¸å¿ƒæ¥å£ï¼Œå®šä¹‰äº†æ ¹æ® key å’Œ Locale è·å–æœ¬åœ°åŒ–æ¶ˆæ¯çš„æ–¹æ³•ã€‚</li>
<li>å¸¸ç”¨å®ç°æœ‰ï¼š
<ul>
<li><code>ResourceBundleMessageSource</code></li>
<li><code>ReloadableResourceBundleMessageSource</code></li>
<li>è‡ªå®šä¹‰å®ç°ï¼ˆå¦‚æœ¬é¡¹ç›®çš„ <code>AbstractResourceMessageSource</code>ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="2-æ ¸å¿ƒæ¶æ„">2. æ ¸å¿ƒæ¶æ„</h3>
<pre class="mermaid">
	graph TD
    A[ApplicationContext] --&gt; B[MessageSource]
    B --&gt; C[HierarchicalMessageSource]
    C --&gt; D[ResourceBundleMessageSource]
    C --&gt; E[ReloadableResourceBundleMessageSource]
    C --&gt; F[StaticMessageSource]
    
    G[LocaleResolver] --&gt; H[AcceptHeaderLocaleResolver]
    G --&gt; I[SessionLocaleResolver]
    G --&gt; J[CookieLocaleResolver]
    G --&gt; K[FixedLocaleResolver]
    
    B --&gt; L[MessageSourceResolvable]
    L --&gt; M[DefaultMessageSourceResolvable]
    
    N[LocaleContextHolder] --&gt; O[ThreadLocal Locale Storage]
</pre>
<p>ç»„ä»¶èŒè´£åˆ†å·¥</p>
<table>
  <thead>
      <tr>
          <th>ç»„ä»¶</th>
          <th>èŒè´£</th>
          <th>ç‰¹ç‚¹</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>MessageSource</strong></td>
          <td>å®šä¹‰æ¶ˆæ¯è§£æçš„æ ¸å¿ƒæ¥å£</td>
          <td>æä¾›ç»Ÿä¸€çš„æ¶ˆæ¯è·å–API</td>
      </tr>
      <tr>
          <td><strong>HierarchicalMessageSource</strong></td>
          <td>æ”¯æŒçˆ¶å­å…³ç³»çš„æ¶ˆæ¯æº</td>
          <td>å®ç°æ¶ˆæ¯çš„å±‚æ¬¡åŒ–æŸ¥æ‰¾</td>
      </tr>
      <tr>
          <td><strong>AbstractMessageSource</strong></td>
          <td>æä¾›æ¶ˆæ¯è§£æçš„é€šç”¨é€»è¾‘</td>
          <td>å¤„ç†å‚æ•°è§£æã€é»˜è®¤æ¶ˆæ¯ç­‰</td>
      </tr>
      <tr>
          <td><strong>ResourceBundleMessageSource</strong></td>
          <td>åŸºäºResourceBundleçš„å®ç°</td>
          <td>æ€§èƒ½é«˜ï¼Œä½†ä¸æ”¯æŒçƒ­é‡è½½</td>
      </tr>
      <tr>
          <td><strong>ReloadableResourceBundleMessageSource</strong></td>
          <td>æ”¯æŒçƒ­é‡è½½çš„å®ç°</td>
          <td>çµæ´»æ€§é«˜ï¼Œæ”¯æŒå¤šç§èµ„æºä½ç½®</td>
      </tr>
      <tr>
          <td><strong>LocaleResolver</strong></td>
          <td>è§£æå½“å‰è¯·æ±‚çš„Locale</td>
          <td>æ”¯æŒå¤šç§Localeç¡®å®šç­–ç•¥</td>
      </tr>
      <tr>
          <td><strong>LocaleContextHolder</strong></td>
          <td>çº¿ç¨‹çº§Localeå­˜å‚¨</td>
          <td>æä¾›çº¿ç¨‹å®‰å…¨çš„Localeè®¿é—®</td>
      </tr>
  </tbody>
</table>
<h3 id="3-æŠ€æœ¯å®ç°">3. æŠ€æœ¯å®ç°</h3>
<h4 id="31-messagesource-å®ç°ç±»è¯¦è§£">3.1 MessageSource å®ç°ç±»è¯¦è§£</h4>
<h5 id="311-resourcebundlemessagesource">3.1.1 ResourceBundleMessageSource</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ResourceBundleMessageSource</span> <span style="color:#66d9ef">extends</span> AbstractResourceBasedMessageSource {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ç¼“å­˜ResourceBundleå®ä¾‹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Map<span style="color:#f92672">&lt;</span>String, Map<span style="color:#f92672">&lt;</span>Locale, ResourceBundle<span style="color:#f92672">&gt;&gt;</span> cachedResourceBundles <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ç¼“å­˜ç”Ÿæˆçš„MessageFormatå®ä¾‹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Map<span style="color:#f92672">&lt;</span>String, Map<span style="color:#f92672">&lt;</span>Locale, MessageFormat<span style="color:#f92672">&gt;&gt;</span> cachedBundleMessageFormats <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> MessageFormat <span style="color:#a6e22e">resolveCode</span>(String code, Locale locale) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ä»ç¼“å­˜è·å–æˆ–åˆ›å»ºMessageFormat</span>
</span></span><span style="display:flex;"><span>        MessageFormat messageFormat <span style="color:#f92672">=</span> getCachedMessageFormat(code, locale);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (messageFormat <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> messageFormat;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// è·å–ResourceBundle</span>
</span></span><span style="display:flex;"><span>        ResourceBundle bundle <span style="color:#f92672">=</span> getResourceBundle(getBasename(), locale);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (bundle <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            String message <span style="color:#f92672">=</span> getStringOrNull(bundle, code);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (message <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                messageFormat <span style="color:#f92672">=</span> createMessageFormat(message, locale);
</span></span><span style="display:flex;"><span>                cacheMessageFormat(code, locale, messageFormat);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> messageFormat;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>ç‰¹ç‚¹åˆ†æï¼š</strong></p>
<ul>
<li><strong>é«˜æ€§èƒ½</strong>ï¼šåŸºäºJDKåŸç”ŸResourceBundleï¼Œæ€§èƒ½ä¼˜å¼‚</li>
<li><strong>å¼ºç¼“å­˜</strong>ï¼šResourceBundleå’ŒMessageFormatéƒ½è¢«ç¼“å­˜ï¼Œé¿å…é‡å¤åˆ›å»º</li>
<li><strong>ç±»è·¯å¾„é™åˆ¶</strong>ï¼šåªèƒ½åŠ è½½ç±»è·¯å¾„ä¸‹çš„èµ„æºæ–‡ä»¶</li>
<li><strong>æ— çƒ­é‡è½½</strong>ï¼šèµ„æºæ–‡ä»¶ä¿®æ”¹åéœ€è¦é‡å¯åº”ç”¨</li>
</ul>
<h5 id="312-reloadableresourcebundlemessagesource">3.1.2 ReloadableResourceBundleMessageSource</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ReloadableResourceBundleMessageSource</span> <span style="color:#66d9ef">extends</span> AbstractResourceBasedMessageSource {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å±æ€§æŒæœ‰è€…ç¼“å­˜</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> ConcurrentHashMap<span style="color:#f92672">&lt;</span>String, PropertiesHolder<span style="color:#f92672">&gt;</span> cachedProperties <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// åˆå¹¶åçš„å±æ€§ç¼“å­˜</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> ConcurrentHashMap<span style="color:#f92672">&lt;</span>Locale, PropertiesHolder<span style="color:#f92672">&gt;</span> cachedMergedProperties <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> MessageFormat <span style="color:#a6e22e">resolveCode</span>(String code, Locale locale) {
</span></span><span style="display:flex;"><span>        PropertiesHolder propHolder <span style="color:#f92672">=</span> getMergedProperties(locale);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (propHolder <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            MessageFormat messageFormat <span style="color:#f92672">=</span> propHolder.<span style="color:#a6e22e">getMessageFormat</span>(code);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (messageFormat <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> messageFormat;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            String message <span style="color:#f92672">=</span> propHolder.<span style="color:#a6e22e">getProperty</span>(code);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (message <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                messageFormat <span style="color:#f92672">=</span> createMessageFormat(message, locale);
</span></span><span style="display:flex;"><span>                propHolder.<span style="color:#a6e22e">setMessageFormat</span>(code, messageFormat);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> messageFormat;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å±æ€§æŒæœ‰è€…å†…éƒ¨ç±»</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PropertiesHolder</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> Properties properties;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">long</span> fileTimestamp <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">volatile</span> Map<span style="color:#f92672">&lt;</span>String, MessageFormat<span style="color:#f92672">&gt;</span> cachedMessageFormats;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦éœ€è¦é‡æ–°åŠ è½½</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isRefreshTimestamp</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fileTimestamp</span> <span style="color:#f92672">&gt;=</span> 0 <span style="color:#f92672">&amp;&amp;</span> 
</span></span><span style="display:flex;"><span>                    System.<span style="color:#a6e22e">currentTimeMillis</span>() <span style="color:#f92672">-</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">fileTimestamp</span> <span style="color:#f92672">&gt;</span> getCacheMillis());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>ç‰¹ç‚¹åˆ†æï¼š</strong></p>
<ul>
<li><strong>çƒ­é‡è½½æ”¯æŒ</strong>ï¼šæ”¯æŒè¿è¡Œæ—¶é‡æ–°åŠ è½½èµ„æºæ–‡ä»¶</li>
<li><strong>å¤šä½ç½®æ”¯æŒ</strong>ï¼šæ”¯æŒæ–‡ä»¶ç³»ç»Ÿã€ç±»è·¯å¾„ã€URLç­‰å¤šç§èµ„æºä½ç½®</li>
<li><strong>æ—¶é—´æˆ³æ£€æŸ¥</strong>ï¼šé€šè¿‡æ–‡ä»¶æ—¶é—´æˆ³åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°åŠ è½½</li>
<li><strong>å¹¶å‘ä¼˜åŒ–</strong>ï¼šæ”¯æŒå¹¶å‘åˆ·æ–°ï¼Œå‡å°‘çº¿ç¨‹é˜»å¡</li>
</ul>
<h4 id="32-locale-è§£ææœºåˆ¶">3.2 Locale è§£ææœºåˆ¶</h4>
<h5 id="321-localeresolver-ç­–ç•¥æ¨¡å¼">3.2.1 LocaleResolver ç­–ç•¥æ¨¡å¼</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// åŸºäºHTTP Accept-Languageå¤´çš„è§£æå™¨</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AcceptHeaderLocaleResolver</span> <span style="color:#66d9ef">implements</span> LocaleResolver {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Locale <span style="color:#a6e22e">resolveLocale</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>        Locale defaultLocale <span style="color:#f92672">=</span> getDefaultLocale();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (defaultLocale <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> request.<span style="color:#a6e22e">getHeader</span>(<span style="color:#e6db74">&#34;Accept-Language&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> defaultLocale;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Locale requestLocale <span style="color:#f92672">=</span> request.<span style="color:#a6e22e">getLocale</span>();
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>Locale<span style="color:#f92672">&gt;</span> supportedLocales <span style="color:#f92672">=</span> getSupportedLocales();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (supportedLocales.<span style="color:#a6e22e">isEmpty</span>() <span style="color:#f92672">||</span> supportedLocales.<span style="color:#a6e22e">contains</span>(requestLocale)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> requestLocale;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æŸ¥æ‰¾æœ€åŒ¹é…çš„Locale</span>
</span></span><span style="display:flex;"><span>        Locale supportedLocale <span style="color:#f92672">=</span> findSupportedLocale(request, supportedLocales);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (supportedLocale <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> supportedLocale : 
</span></span><span style="display:flex;"><span>                (defaultLocale <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> defaultLocale : requestLocale));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// åŸºäºSessionçš„è§£æå™¨</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SessionLocaleResolver</span> <span style="color:#66d9ef">implements</span> LocaleResolver {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String LOCALE_SESSION_ATTRIBUTE_NAME <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        SessionLocaleResolver.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.LOCALE&#34;</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Locale <span style="color:#a6e22e">resolveLocale</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>        Locale locale <span style="color:#f92672">=</span> (Locale) WebUtils.<span style="color:#a6e22e">getSessionAttribute</span>(
</span></span><span style="display:flex;"><span>            request, LOCALE_SESSION_ATTRIBUTE_NAME);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (locale <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> locale : determineDefaultLocale(request));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setLocale</span>(HttpServletRequest request, HttpServletResponse response, 
</span></span><span style="display:flex;"><span>                         Locale locale) {
</span></span><span style="display:flex;"><span>        WebUtils.<span style="color:#a6e22e">setSessionAttribute</span>(request, LOCALE_SESSION_ATTRIBUTE_NAME, locale);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="322-localecontextholder-çº¿ç¨‹å®‰å…¨å®ç°">3.2.2 LocaleContextHolder çº¿ç¨‹å®‰å…¨å®ç°</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LocaleContextHolder</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> ThreadLocal<span style="color:#f92672">&lt;</span>LocaleContext<span style="color:#f92672">&gt;</span> localeContextHolder <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> NamedThreadLocal<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;LocaleContext&#34;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> ThreadLocal<span style="color:#f92672">&lt;</span>LocaleContext<span style="color:#f92672">&gt;</span> inheritableLocaleContextHolder <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> NamedInheritableThreadLocal<span style="color:#f92672">&lt;&gt;</span>(<span style="color:#e6db74">&#34;LocaleContext&#34;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setLocale</span>(Locale locale) {
</span></span><span style="display:flex;"><span>        setLocale(locale, <span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setLocale</span>(Locale locale, <span style="color:#66d9ef">boolean</span> inheritable) {
</span></span><span style="display:flex;"><span>        LocaleContext localeContext <span style="color:#f92672">=</span> (locale <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">new</span> SimpleLocaleContext(locale) : <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        setLocaleContext(localeContext, inheritable);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Locale <span style="color:#a6e22e">getLocale</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> getLocale(getLocaleContext());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Locale <span style="color:#a6e22e">getLocale</span>(LocaleContext localeContext) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (localeContext <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            Locale locale <span style="color:#f92672">=</span> localeContext.<span style="color:#a6e22e">getLocale</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (locale <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> locale;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Locale.<span style="color:#a6e22e">getDefault</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="33-æ¶ˆæ¯æ ¼å¼åŒ–æœºåˆ¶">3.3 æ¶ˆæ¯æ ¼å¼åŒ–æœºåˆ¶</h4>
<h5 id="331-messageformat-é›†æˆä¸ä¼˜åŒ–">3.3.1 MessageFormat é›†æˆä¸ä¼˜åŒ–</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessageSourceSupport</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> alwaysUseMessageFormat <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> String <span style="color:#a6e22e">formatMessage</span>(String msg, Object<span style="color:#f92672">[]</span> args, Locale locale) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (msg <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> (<span style="color:#f92672">!</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">alwaysUseMessageFormat</span> <span style="color:#f92672">&amp;&amp;</span> ObjectUtils.<span style="color:#a6e22e">isEmpty</span>(args))) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> msg;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        MessageFormat messageFormat <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">synchronized</span> (<span style="color:#66d9ef">this</span>) {
</span></span><span style="display:flex;"><span>            messageFormat <span style="color:#f92672">=</span> createMessageFormat(msg, locale);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (messageFormat <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">synchronized</span> (messageFormat) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> messageFormat.<span style="color:#a6e22e">format</span>(resolveArguments(args, locale));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> msg;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> MessageFormat <span style="color:#a6e22e">createMessageFormat</span>(String msg, Locale locale) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> MessageFormat(msg, locale);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IllegalArgumentException ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// å¤„ç†æ ¼å¼é”™è¯¯ï¼Œè¿”å›nullæˆ–æŠ›å‡ºå¼‚å¸¸</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException(<span style="color:#e6db74">&#34;Invalid message format for locale [&#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                locale <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;]: &#34;</span> <span style="color:#f92672">+</span> ex.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="332-å‚æ•°è§£æä¸å¤„ç†">3.3.2 å‚æ•°è§£æä¸å¤„ç†</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AbstractMessageSource</span> <span style="color:#66d9ef">extends</span> MessageSourceSupport 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">implements</span> HierarchicalMessageSource {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> Object<span style="color:#f92672">[]</span> <span style="color:#a6e22e">resolveArguments</span>(Object<span style="color:#f92672">[]</span> args, Locale locale) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (ObjectUtils.<span style="color:#a6e22e">isEmpty</span>(args)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> args;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span> resolvedArgs <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>(args.<span style="color:#a6e22e">length</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (Object arg : args) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (arg <span style="color:#66d9ef">instanceof</span> MessageSourceResolvable) {
</span></span><span style="display:flex;"><span>                resolvedArgs.<span style="color:#a6e22e">add</span>(getMessage((MessageSourceResolvable) arg, locale));
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                resolvedArgs.<span style="color:#a6e22e">add</span>(arg);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> resolvedArgs.<span style="color:#a6e22e">toArray</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="4-ä¸»è¦åŠŸèƒ½ç‰¹æ€§">4. ä¸»è¦åŠŸèƒ½ç‰¹æ€§</h3>
<h4 id="41-æ¶ˆæ¯è§£æåŠŸèƒ½">4.1 æ¶ˆæ¯è§£æåŠŸèƒ½</h4>
<h5 id="411-åŸºç¡€æ¶ˆæ¯è§£æ">4.1.1 åŸºç¡€æ¶ˆæ¯è§£æ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// ç®€å•æ¶ˆæ¯è·å–</span>
</span></span><span style="display:flex;"><span>String message <span style="color:#f92672">=</span> messageSource.<span style="color:#a6e22e">getMessage</span>(<span style="color:#e6db74">&#34;welcome.message&#34;</span>, <span style="color:#66d9ef">null</span>, locale);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å¸¦é»˜è®¤å€¼çš„æ¶ˆæ¯è·å–</span>
</span></span><span style="display:flex;"><span>String message <span style="color:#f92672">=</span> messageSource.<span style="color:#a6e22e">getMessage</span>(<span style="color:#e6db74">&#34;unknown.key&#34;</span>, <span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#34;Default Message&#34;</span>, locale);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å‚æ•°åŒ–æ¶ˆæ¯</span>
</span></span><span style="display:flex;"><span>String message <span style="color:#f92672">=</span> messageSource.<span style="color:#a6e22e">getMessage</span>(<span style="color:#e6db74">&#34;welcome.user&#34;</span>, <span style="color:#66d9ef">new</span> Object<span style="color:#f92672">[]</span>{<span style="color:#e6db74">&#34;John&#34;</span>}, locale);
</span></span></code></pre></div><h5 id="412-å±‚æ¬¡åŒ–æ¶ˆæ¯æŸ¥æ‰¾">4.1.2 å±‚æ¬¡åŒ–æ¶ˆæ¯æŸ¥æ‰¾</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// çˆ¶å­MessageSourceé…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessageConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> MessageSource <span style="color:#a6e22e">messageSource</span>() {
</span></span><span style="display:flex;"><span>        ReloadableResourceBundleMessageSource messageSource <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">new</span> ReloadableResourceBundleMessageSource();
</span></span><span style="display:flex;"><span>        messageSource.<span style="color:#a6e22e">setBasename</span>(<span style="color:#e6db74">&#34;classpath:messages/app&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// è®¾ç½®çˆ¶MessageSource</span>
</span></span><span style="display:flex;"><span>        ResourceBundleMessageSource parentSource <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ResourceBundleMessageSource();
</span></span><span style="display:flex;"><span>        parentSource.<span style="color:#a6e22e">setBasename</span>(<span style="color:#e6db74">&#34;messages/common&#34;</span>);
</span></span><span style="display:flex;"><span>        messageSource.<span style="color:#a6e22e">setParentMessageSource</span>(parentSource);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> messageSource;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="42-èµ„æºåŠ è½½åŠŸèƒ½">4.2 èµ„æºåŠ è½½åŠŸèƒ½</h4>
<h5 id="421-å¤šæ ¼å¼æ”¯æŒ">4.2.1 å¤šæ ¼å¼æ”¯æŒ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Propertiesæ ¼å¼ (messages.properties)</span>
</span></span><span style="display:flex;"><span>welcome.<span style="color:#a6e22e">message</span><span style="color:#f92672">=</span>Welcome to our application<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>user.<span style="color:#a6e22e">greeting</span><span style="color:#f92672">=</span>Hello, {0}<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// XMLæ ¼å¼ (messages.xml)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span>xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;!</span>DOCTYPE properties SYSTEM <span style="color:#e6db74">&#34;http://java.sun.com/dtd/properties.dtd&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span>properties<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span>entry key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;welcome.message&#34;</span><span style="color:#f92672">&gt;</span>Welcome to our application<span style="color:#f92672">!&lt;/</span>entry<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span>entry key<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;user.greeting&#34;</span><span style="color:#f92672">&gt;</span>Hello, {0}<span style="color:#f92672">!&lt;/</span>entry<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/</span>properties<span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><h5 id="422-ç¼–ç å¤„ç†">4.2.2 ç¼–ç å¤„ç†</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> MessageSource <span style="color:#a6e22e">messageSource</span>() {
</span></span><span style="display:flex;"><span>    ReloadableResourceBundleMessageSource messageSource <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> ReloadableResourceBundleMessageSource();
</span></span><span style="display:flex;"><span>    messageSource.<span style="color:#a6e22e">setBasename</span>(<span style="color:#e6db74">&#34;classpath:messages/app&#34;</span>);
</span></span><span style="display:flex;"><span>    messageSource.<span style="color:#a6e22e">setDefaultEncoding</span>(<span style="color:#e6db74">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è®¾ç½®ç‰¹å®šæ–‡ä»¶çš„ç¼–ç </span>
</span></span><span style="display:flex;"><span>    Properties fileEncodings <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties();
</span></span><span style="display:flex;"><span>    fileEncodings.<span style="color:#a6e22e">setProperty</span>(<span style="color:#e6db74">&#34;messages/app_zh_CN&#34;</span>, <span style="color:#e6db74">&#34;GBK&#34;</span>);
</span></span><span style="display:flex;"><span>    messageSource.<span style="color:#a6e22e">setFileEncodings</span>(fileEncodings);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> messageSource;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="43-spring-é›†æˆåŠŸèƒ½">4.3 Spring é›†æˆåŠŸèƒ½</h4>
<h5 id="431-web-mvc-é›†æˆ">4.3.1 Web MVC é›†æˆ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Controller</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HomeController</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> MessageSource messageSource;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">welcome</span>(Model model, Locale locale) {
</span></span><span style="display:flex;"><span>        String message <span style="color:#f92672">=</span> messageSource.<span style="color:#a6e22e">getMessage</span>(<span style="color:#e6db74">&#34;welcome.message&#34;</span>, <span style="color:#66d9ef">null</span>, locale);
</span></span><span style="display:flex;"><span>        model.<span style="color:#a6e22e">addAttribute</span>(<span style="color:#e6db74">&#34;message&#34;</span>, message);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;welcome&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// åœ¨JSPä¸­ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span>spring:message code<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;welcome.message&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span>spring:message code<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;user.greeting&#34;</span> arguments<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${username}&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span></code></pre></div><h5 id="432-éªŒè¯æ¡†æ¶é›†æˆ">4.3.2 éªŒè¯æ¡†æ¶é›†æˆ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ValidationConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> LocalValidatorFactoryBean <span style="color:#a6e22e">validator</span>(MessageSource messageSource) {
</span></span><span style="display:flex;"><span>        LocalValidatorFactoryBean validator <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LocalValidatorFactoryBean();
</span></span><span style="display:flex;"><span>        validator.<span style="color:#a6e22e">setValidationMessageSource</span>(messageSource);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> validator;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// éªŒè¯æ¶ˆæ¯é…ç½® (ValidationMessages.properties)</span>
</span></span><span style="display:flex;"><span>javax.<span style="color:#a6e22e">validation</span>.<span style="color:#a6e22e">constraints</span>.<span style="color:#a6e22e">NotNull</span>.<span style="color:#a6e22e">message</span><span style="color:#f92672">=</span>Field cannot be <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>javax.<span style="color:#a6e22e">validation</span>.<span style="color:#a6e22e">constraints</span>.<span style="color:#a6e22e">Size</span>.<span style="color:#a6e22e">message</span><span style="color:#f92672">=</span>Size must be between {min} and {max}
</span></span></code></pre></div><h3 id="5-å­˜åœ¨çš„ç¼ºé™·å’Œä¸è¶³">5. å­˜åœ¨çš„ç¼ºé™·å’Œä¸è¶³</h3>
<h4 id="51-æ€§èƒ½é—®é¢˜">5.1 æ€§èƒ½é—®é¢˜</h4>
<h5 id="511-resourcebundle-æ€§èƒ½ç“¶é¢ˆ">5.1.1 ResourceBundle æ€§èƒ½ç“¶é¢ˆ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// é—®é¢˜ä»£ç ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ResourceBundleMessageSource</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> MessageFormat <span style="color:#a6e22e">resolveCode</span>(String code, Locale locale) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æ¯æ¬¡éƒ½å¯èƒ½è§¦å‘ResourceBundle.getBundle()è°ƒç”¨</span>
</span></span><span style="display:flex;"><span>        ResourceBundle bundle <span style="color:#f92672">=</span> ResourceBundle.<span style="color:#a6e22e">getBundle</span>(basename, locale, bundleClassLoader);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// é—®é¢˜ï¼š</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 1. é¢‘ç¹çš„ç±»åŠ è½½å™¨æŸ¥æ‰¾</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 2. æ–‡ä»¶ç³»ç»Ÿè®¿é—®å¼€é”€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 3. Propertiesæ–‡ä»¶è§£æå¼€é”€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (bundle <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                MessageFormat messageFormat <span style="color:#f92672">=</span> createMessageFormat(bundle.<span style="color:#a6e22e">getString</span>(code), locale);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> messageFormat;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (MissingResourceException ex) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// å¼‚å¸¸å¤„ç†ä¹Ÿæœ‰æ€§èƒ½å¼€é”€</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>æ€§èƒ½é—®é¢˜åˆ†æï¼š</strong></p>
<ul>
<li><strong>é‡å¤åŠ è½½</strong>ï¼šç›¸åŒçš„ResourceBundleå¯èƒ½è¢«é‡å¤åŠ è½½</li>
<li><strong>åŒæ­¥å¼€é”€</strong>ï¼šResourceBundle.getBundle()æ–¹æ³•å†…éƒ¨ä½¿ç”¨åŒæ­¥æœºåˆ¶</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šå¤§é‡MessageFormatå®ä¾‹å ç”¨å†…å­˜</li>
<li><strong>GCå‹åŠ›</strong>ï¼šé¢‘ç¹åˆ›å»ºä¸´æ—¶å¯¹è±¡å¢åŠ GCå‹åŠ›</li>
</ul>
<h5 id="512-messageformat-åˆ›å»ºå¼€é”€">5.1.2 MessageFormat åˆ›å»ºå¼€é”€</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// æ€§èƒ½ç“¶é¢ˆä»£ç </span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">protected</span> MessageFormat <span style="color:#a6e22e">createMessageFormat</span>(String msg, Locale locale) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// é—®é¢˜ï¼šæ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„MessageFormatå®ä¾‹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> MessageFormat(msg, locale);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (IllegalArgumentException ex) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// å¼‚å¸¸å¤„ç†å¼€é”€</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> IllegalArgumentException(<span style="color:#e6db74">&#34;Invalid message format: &#34;</span> <span style="color:#f92672">+</span> ex.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="52-åŠŸèƒ½é™åˆ¶">5.2 åŠŸèƒ½é™åˆ¶</h4>
<h5 id="521-èµ„æºæ ¼å¼é™åˆ¶">5.2.1 èµ„æºæ ¼å¼é™åˆ¶</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#75715e"># Propertiesæ ¼å¼çš„å±€é™æ€§</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. åªæ”¯æŒkey-valueæ ¼å¼ï¼Œä¸æ”¯æŒåµŒå¥—ç»“æ„</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">user.profile.name</span><span style="color:#f92672">=</span><span style="color:#e6db74">Name</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">user.profile.email</span><span style="color:#f92672">=</span><span style="color:#e6db74">Email</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">user.profile.address.street</span><span style="color:#f92672">=</span><span style="color:#e6db74">Street</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">user.profile.address.city</span><span style="color:#f92672">=</span><span style="color:#e6db74">City</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. Unicodeç¼–ç é—®é¢˜</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">welcome.chinese</span><span style="color:#f92672">=</span><span style="color:#e6db74">\u6b22\u8fce  # éœ€è¦è½¬ä¹‰ä¸­æ–‡å­—ç¬¦</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. æ³¨é‡ŠåŠŸèƒ½æœ‰é™</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This is a comment - åªæ”¯æŒè¡Œæ³¨é‡Š</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">user.message</span><span style="color:#f92672">=</span><span style="color:#e6db74">Hello World</span>
</span></span></code></pre></div><p><strong>å¯¹æ¯”ç°ä»£æ ¼å¼çš„ä¼˜åŠ¿ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#75715e">// JSONæ ¼å¼ - æ”¯æŒåµŒå¥—ç»“æ„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;user&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;profile&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Name&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;Email&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;address&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;street&#34;</span>: <span style="color:#e6db74">&#34;Street&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;city&#34;</span>: <span style="color:#e6db74">&#34;City&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;welcome&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;chinese&#34;</span>: <span style="color:#e6db74">&#34;æ¬¢è¿&#34;</span>  <span style="color:#75715e">// ç›´æ¥æ”¯æŒUnicode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="522-åŠ¨æ€æ›´æ–°é™åˆ¶">5.2.2 åŠ¨æ€æ›´æ–°é™åˆ¶</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// ResourceBundleMessageSourceçš„é™åˆ¶</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ResourceBundleMessageSource</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é—®é¢˜ï¼šç¼“å­˜æ— æ³•åŠ¨æ€æ¸…ç†</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Map<span style="color:#f92672">&lt;</span>String, Map<span style="color:#f92672">&lt;</span>Locale, ResourceBundle<span style="color:#f92672">&gt;&gt;</span> cachedResourceBundles <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// æ²¡æœ‰æä¾›æ¸…ç†ç¼“å­˜çš„æ–¹æ³•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// èµ„æºæ–‡ä»¶æ›´æ–°åå¿…é¡»é‡å¯åº”ç”¨</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ReloadableResourceBundleMessageSourceçš„é™åˆ¶</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ReloadableResourceBundleMessageSource</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é—®é¢˜ï¼šåªæ”¯æŒåŸºäºæ—¶é—´æˆ³çš„é‡è½½æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isRefreshTimestamp</span>(PropertiesHolder propHolder) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (propHolder.<span style="color:#a6e22e">getRefreshTimestamp</span>() <span style="color:#f92672">&lt;</span> 0 <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>                propHolder.<span style="color:#a6e22e">getRefreshTimestamp</span>() <span style="color:#f92672">&gt;</span> System.<span style="color:#a6e22e">currentTimeMillis</span>() <span style="color:#f92672">-</span> getCacheMillis());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é™åˆ¶ï¼š</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. æ— æ³•æ„ŸçŸ¥æ–‡ä»¶å†…å®¹å˜åŒ–ï¼Œåªèƒ½å®šæ—¶æ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. åœ¨é›†ç¾¤ç¯å¢ƒä¸‹æ— æ³•åŒæ­¥æ›´æ–°</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. é‡è½½ç²’åº¦ç²—ç³™ï¼Œæ•´ä¸ªæ–‡ä»¶é‡æ–°åŠ è½½</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="53-æ‰©å±•æ€§é—®é¢˜">5.3 æ‰©å±•æ€§é—®é¢˜</h4>
<h5 id="531-æ•°æ®æºå•ä¸€åŒ–">5.3.1 æ•°æ®æºå•ä¸€åŒ–</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// å½“å‰å®ç°åªæ”¯æŒæ–‡ä»¶ç³»ç»Ÿæ•°æ®æº</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AbstractResourceBasedMessageSource</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> basenameSet <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedHashSet<span style="color:#f92672">&lt;&gt;</span>(4);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é™åˆ¶ï¼šåªèƒ½ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½èµ„æº</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setBasenames</span>(String... basenames) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">basenameSet</span>.<span style="color:#a6e22e">clear</span>();
</span></span><span style="display:flex;"><span>        addBasenames(basenames);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é—®é¢˜ï¼šæ— æ³•æ”¯æŒæ•°æ®åº“ã€Redisã€HTTP APIç­‰æ•°æ®æº</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>æ‰©å±•éœ€æ±‚ç¤ºä¾‹ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// ç†æƒ³çš„æ‰©å±•æ¥å£</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">MessageSourceProvider</span> {
</span></span><span style="display:flex;"><span>    Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">loadMessages</span>(Locale locale);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveMessage</span>(String key, String value, Locale locale);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">supportsHotReload</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addChangeListener</span>(MessageChangeListener listener);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// æ•°æ®åº“å®ç°</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DatabaseMessageSourceProvider</span> <span style="color:#66d9ef">implements</span> MessageSourceProvider {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> JdbcTemplate jdbcTemplate;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">loadMessages</span>(Locale locale) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> jdbcTemplate.<span style="color:#a6e22e">query</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;SELECT message_key, message_value FROM i18n_messages WHERE locale = ?&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">new</span> Object<span style="color:#f92672">[]</span>{locale.<span style="color:#a6e22e">toString</span>()},
</span></span><span style="display:flex;"><span>            (rs, rowNum) <span style="color:#f92672">-&gt;</span> Map.<span style="color:#a6e22e">entry</span>(rs.<span style="color:#a6e22e">getString</span>(<span style="color:#e6db74">&#34;message_key&#34;</span>), rs.<span style="color:#a6e22e">getString</span>(<span style="color:#e6db74">&#34;message_value&#34;</span>))
</span></span><span style="display:flex;"><span>        ).<span style="color:#a6e22e">stream</span>().<span style="color:#a6e22e">collect</span>(Collectors.<span style="color:#a6e22e">toMap</span>(Map.<span style="color:#a6e22e">Entry</span>::getKey, Map.<span style="color:#a6e22e">Entry</span>::getValue));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="532-ç¼“å­˜ç­–ç•¥å›ºåŒ–">5.3.2 ç¼“å­˜ç­–ç•¥å›ºåŒ–</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// å½“å‰ç¼“å­˜ç­–ç•¥ä¸å¤Ÿçµæ´»</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AbstractMessageSource</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é—®é¢˜ï¼šç¼“å­˜ç­–ç•¥ç¡¬ç¼–ç ï¼Œæ— æ³•é…ç½®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Map<span style="color:#f92672">&lt;</span>String, MessageFormat<span style="color:#f92672">&gt;</span> messageFormatsPerMessage <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é™åˆ¶ï¼š</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. æ— æ³•é…ç½®ç¼“å­˜å¤§å°é™åˆ¶</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. æ— æ³•é…ç½®è¿‡æœŸç­–ç•¥</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. æ— æ³•é…ç½®ç¼“å­˜æ·˜æ±°ç®—æ³•</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 4. æ— æ³•æ”¯æŒåˆ†å¸ƒå¼ç¼“å­˜</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="54-å¼€å‘ä½“éªŒé—®é¢˜">5.4 å¼€å‘ä½“éªŒé—®é¢˜</h4>
<h5 id="541-é…ç½®å¤æ‚æ€§">5.4.1 é…ç½®å¤æ‚æ€§</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- ä¼ ç»ŸXMLé…ç½®æ–¹å¼ç¹ç --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;messageSource&#34;</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.springframework.context.support.ReloadableResourceBundleMessageSource&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;basenames&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;list&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;value&gt;</span>classpath:messages/application<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;value&gt;</span>classpath:messages/validation<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;value&gt;</span>classpath:messages/security<span style="color:#f92672">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/list&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;defaultEncoding&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;cacheSeconds&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;300&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;fallbackToSystemLocale&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;fileEncodings&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;props&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&lt;prop</span> <span style="color:#a6e22e">key=</span><span style="color:#e6db74">&#34;messages/application_zh_CN&#34;</span><span style="color:#f92672">&gt;</span>GBK<span style="color:#f92672">&lt;/prop&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/props&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- LocaleResolveré…ç½® --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;localeResolver&#34;</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.springframework.web.servlet.i18n.SessionLocaleResolver&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;defaultLocale&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;en&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- LocaleChangeInterceptoré…ç½® --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;mvc:interceptors&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;paramName&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;lang&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/mvc:interceptors&gt;</span>
</span></span></code></pre></div><h5 id="542-è°ƒè¯•å›°éš¾">5.4.2 è°ƒè¯•å›°éš¾</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// é—®é¢˜ï¼šé”™è¯¯ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getMessage</span>(String code, Object<span style="color:#f92672">[]</span> args, Locale locale) 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throws</span> NoSuchMessageException {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    MessageFormat format <span style="color:#f92672">=</span> resolveCode(code, locale);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (format <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> formatMessage(format, args, locale);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é—®é¢˜ï¼šå¼‚å¸¸ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†ï¼Œéš¾ä»¥å®šä½é—®é¢˜</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NoSuchMessageException(code, locale);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å®é™…å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜ï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 1. ä¸çŸ¥é“æ¶ˆæ¯æ˜¯ä»å“ªä¸ªæ–‡ä»¶åŠ è½½çš„</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 2. ä¸çŸ¥é“æ˜¯å¦æœ‰çˆ¶MessageSourceå‚ä¸æŸ¥æ‰¾</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 3. å‚æ•°æ ¼å¼åŒ–å¤±è´¥æ—¶é”™è¯¯ä¿¡æ¯ä¸æ˜ç¡®</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 4. ç¼ºä¹è°ƒè¯•å·¥å…·æ¥æŸ¥çœ‹å½“å‰åŠ è½½çš„æ‰€æœ‰æ¶ˆæ¯</span>
</span></span></code></pre></div><h5 id="543-æµ‹è¯•æ”¯æŒä¸è¶³">5.4.3 æµ‹è¯•æ”¯æŒä¸è¶³</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// å½“å‰æµ‹è¯•æ–¹å¼æ¯”è¾ƒåŸå§‹</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testMessageSource</span>() {
</span></span><span style="display:flex;"><span>    MessageSource messageSource <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StaticMessageSource();
</span></span><span style="display:flex;"><span>    ((StaticMessageSource) messageSource).<span style="color:#a6e22e">addMessage</span>(<span style="color:#e6db74">&#34;test.message&#34;</span>, Locale.<span style="color:#a6e22e">ENGLISH</span>, <span style="color:#e6db74">&#34;Test Message&#34;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    String message <span style="color:#f92672">=</span> messageSource.<span style="color:#a6e22e">getMessage</span>(<span style="color:#e6db74">&#34;test.message&#34;</span>, <span style="color:#66d9ef">null</span>, Locale.<span style="color:#a6e22e">ENGLISH</span>);
</span></span><span style="display:flex;"><span>    assertEquals(<span style="color:#e6db74">&#34;Test Message&#34;</span>, message);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é—®é¢˜ï¼š</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. éœ€è¦æ‰‹åŠ¨åˆ›å»ºMessageSource</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. æ— æ³•æ¨¡æ‹Ÿå¤æ‚çš„èµ„æºåŠ è½½åœºæ™¯</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. ç¼ºä¹ä¸“é—¨çš„æµ‹è¯•å·¥å…·ç±»</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 4. éš¾ä»¥æµ‹è¯•çƒ­é‡è½½åŠŸèƒ½</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="6-å¯ä»¥ä¼˜åŒ–æ”¹è¿›çš„åœ°æ–¹">6. å¯ä»¥ä¼˜åŒ–æ”¹è¿›çš„åœ°æ–¹</h3>
<h4 id="61-æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ">6.1 æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ</h4>
<h5 id="611-æ™ºèƒ½ç¼“å­˜ç­–ç•¥">6.1.1 æ™ºèƒ½ç¼“å­˜ç­–ç•¥</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// æ”¹è¿›çš„å¤šçº§ç¼“å­˜æ¶æ„</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EnhancedMessageSource</span> <span style="color:#66d9ef">implements</span> MessageSource {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// L1ç¼“å­˜ï¼šæœ¬åœ°é«˜é€Ÿç¼“å­˜</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Cache<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> localCache <span style="color:#f92672">=</span> Caffeine.<span style="color:#a6e22e">newBuilder</span>()
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">maximumSize</span>(10000)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">expireAfterWrite</span>(Duration.<span style="color:#a6e22e">ofMinutes</span>(30))
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">recordStats</span>()
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// L2ç¼“å­˜ï¼šåˆ†å¸ƒå¼ç¼“å­˜</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> RedisTemplate<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> redisTemplate;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ç¼“å­˜é¢„çƒ­</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostConstruct</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">preloadCache</span>() {
</span></span><span style="display:flex;"><span>        CompletableFuture.<span style="color:#a6e22e">runAsync</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            Set<span style="color:#f92672">&lt;</span>Locale<span style="color:#f92672">&gt;</span> supportedLocales <span style="color:#f92672">=</span> getSupportedLocales();
</span></span><span style="display:flex;"><span>            Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> commonKeys <span style="color:#f92672">=</span> getCommonMessageKeys();
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (Locale locale : supportedLocales) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> (String key : commonKeys) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                        getMessage(key, <span style="color:#66d9ef">null</span>, locale);
</span></span><span style="display:flex;"><span>                    } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">// å¿½ç•¥é¢„åŠ è½½å¤±è´¥çš„æ¶ˆæ¯</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// æ‰¹é‡æ¶ˆæ¯è·å–</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getMessages</span>(Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> codes, Locale locale) {
</span></span><span style="display:flex;"><span>        Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> result <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> missedKeys <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// å…ˆä»L1ç¼“å­˜è·å–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (String code : codes) {
</span></span><span style="display:flex;"><span>            String cacheKey <span style="color:#f92672">=</span> buildCacheKey(code, locale);
</span></span><span style="display:flex;"><span>            String message <span style="color:#f92672">=</span> localCache.<span style="color:#a6e22e">getIfPresent</span>(cacheKey);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (message <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                result.<span style="color:#a6e22e">put</span>(code, message);
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                missedKeys.<span style="color:#a6e22e">add</span>(code);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ä»L2ç¼“å­˜æ‰¹é‡è·å–</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>missedKeys.<span style="color:#a6e22e">isEmpty</span>()) {
</span></span><span style="display:flex;"><span>            List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> cacheKeys <span style="color:#f92672">=</span> missedKeys.<span style="color:#a6e22e">stream</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">map</span>(key <span style="color:#f92672">-&gt;</span> buildCacheKey(key, locale))
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">collect</span>(Collectors.<span style="color:#a6e22e">toList</span>());
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> cachedMessages <span style="color:#f92672">=</span> redisTemplate.<span style="color:#a6e22e">opsForValue</span>().<span style="color:#a6e22e">multiGet</span>(cacheKeys);
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// å¤„ç†L2ç¼“å­˜ç»“æœ...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="612-å¼‚æ­¥åŠ è½½ä¼˜åŒ–">6.1.2 å¼‚æ­¥åŠ è½½ä¼˜åŒ–</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// å¼‚æ­¥æ¶ˆæ¯åŠ è½½</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AsyncMessageLoader</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> TaskExecutor taskExecutor;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@EventListener</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onApplicationReady</span>(ApplicationReadyEvent event) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åº”ç”¨å¯åŠ¨åå¼‚æ­¥é¢„åŠ è½½æ¶ˆæ¯</span>
</span></span><span style="display:flex;"><span>        taskExecutor.<span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">this</span>::preloadMessages);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">preloadMessages</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// é¢„åŠ è½½å¸¸ç”¨æ¶ˆæ¯åˆ°ç¼“å­˜</span>
</span></span><span style="display:flex;"><span>        Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> commonKeys <span style="color:#f92672">=</span> Arrays.<span style="color:#a6e22e">asList</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;common.save&#34;</span>, <span style="color:#e6db74">&#34;common.cancel&#34;</span>, <span style="color:#e6db74">&#34;common.confirm&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;error.validation&#34;</span>, <span style="color:#e6db74">&#34;error.network&#34;</span>, <span style="color:#e6db74">&#34;error.system&#34;</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (Locale locale : getSupportedLocales()) {
</span></span><span style="display:flex;"><span>            loadMessagesAsync(commonKeys, locale);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Async</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> CompletableFuture<span style="color:#f92672">&lt;</span>Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;&gt;</span> <span style="color:#a6e22e">loadMessagesAsync</span>(
</span></span><span style="display:flex;"><span>            Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> keys, Locale locale) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> CompletableFuture.<span style="color:#a6e22e">supplyAsync</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> keys.<span style="color:#a6e22e">stream</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">collect</span>(Collectors.<span style="color:#a6e22e">toMap</span>(
</span></span><span style="display:flex;"><span>                    key <span style="color:#f92672">-&gt;</span> key,
</span></span><span style="display:flex;"><span>                    key <span style="color:#f92672">-&gt;</span> loadMessage(key, locale)
</span></span><span style="display:flex;"><span>                ));
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="62-åŠŸèƒ½å¢å¼ºæ–¹æ¡ˆ">6.2 åŠŸèƒ½å¢å¼ºæ–¹æ¡ˆ</h4>
<h5 id="621-ç°ä»£åŒ–é…ç½®æ ¼å¼æ”¯æŒ">6.2.1 ç°ä»£åŒ–é…ç½®æ ¼å¼æ”¯æŒ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// æ”¯æŒå¤šç§ç°ä»£é…ç½®æ ¼å¼</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ModernI18nConfig</span> {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> MessageSource <span style="color:#a6e22e">messageSource</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> MultiFormatMessageSourceBuilder.<span style="color:#a6e22e">create</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">addJsonResource</span>(<span style="color:#e6db74">&#34;classpath:i18n/messages.json&#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">addYamlResource</span>(<span style="color:#e6db74">&#34;classpath:i18n/messages.yml&#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">addPropertiesResource</span>(<span style="color:#e6db74">&#34;classpath:i18n/messages.properties&#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">setDefaultLocale</span>(Locale.<span style="color:#a6e22e">ENGLISH</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">setSupportedLocales</span>(Locale.<span style="color:#a6e22e">ENGLISH</span>, Locale.<span style="color:#a6e22e">SIMPLIFIED_CHINESE</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">enableHotReload</span>(Duration.<span style="color:#a6e22e">ofMinutes</span>(5))
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">enableCache</span>(CacheConfig.<span style="color:#a6e22e">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">maxSize</span>(10000)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">expireAfterWrite</span>(Duration.<span style="color:#a6e22e">ofHours</span>(1))
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">build</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// JSONæ ¼å¼æ¶ˆæ¯æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;common&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;buttons&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;save&#34;</span>: <span style="color:#e6db74">&#34;Save&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;cancel&#34;</span>: <span style="color:#e6db74">&#34;Cancel&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;confirm&#34;</span>: <span style="color:#e6db74">&#34;Confirm&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;messages&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;success&#34;</span>: <span style="color:#e6db74">&#34;Operation completed successfully&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;error&#34;</span>: <span style="color:#e6db74">&#34;An error occurred: {0}&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;user&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;profile&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;User Profile&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;fields&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Name&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;Email&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// YAMLæ ¼å¼æ¶ˆæ¯æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>common:
</span></span><span style="display:flex;"><span>  buttons:
</span></span><span style="display:flex;"><span>    save: Save
</span></span><span style="display:flex;"><span>    cancel: Cancel
</span></span><span style="display:flex;"><span>    confirm: Confirm
</span></span><span style="display:flex;"><span>  messages:
</span></span><span style="display:flex;"><span>    success: Operation completed successfully
</span></span><span style="display:flex;"><span>    error: <span style="color:#e6db74">&#34;An error occurred: {0}&#34;</span>
</span></span><span style="display:flex;"><span>user:
</span></span><span style="display:flex;"><span>  profile:
</span></span><span style="display:flex;"><span>    title: User Profile
</span></span><span style="display:flex;"><span>    fields:
</span></span><span style="display:flex;"><span>      name: Name
</span></span><span style="display:flex;"><span>      email: Email
</span></span></code></pre></div><h5 id="622-å¤šæ•°æ®æºæ”¯æŒ">6.2.2 å¤šæ•°æ®æºæ”¯æŒ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// å¯æ’æ‹”çš„æ•°æ®æºæä¾›è€…</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">MessageSourceProvider</span> {
</span></span><span style="display:flex;"><span>    String <span style="color:#a6e22e">getName</span>();
</span></span><span style="display:flex;"><span>    Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">loadMessages</span>(Locale locale);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveMessage</span>(String key, String value, Locale locale);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">supportsHotReload</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addChangeListener</span>(MessageChangeListener listener);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getPriority</span>(); <span style="color:#75715e">// æ•°æ®æºä¼˜å…ˆçº§</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// æ•°æ®åº“æ•°æ®æºå®ç°</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DatabaseMessageSourceProvider</span> <span style="color:#66d9ef">implements</span> MessageSourceProvider {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> MessageRepository messageRepository;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">loadMessages</span>(Locale locale) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> messageRepository.<span style="color:#a6e22e">findByLocale</span>(locale.<span style="color:#a6e22e">toString</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">stream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">collect</span>(Collectors.<span style="color:#a6e22e">toMap</span>(
</span></span><span style="display:flex;"><span>                Message::getKey, 
</span></span><span style="display:flex;"><span>                Message::getValue
</span></span><span style="display:flex;"><span>            ));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveMessage</span>(String key, String value, Locale locale) {
</span></span><span style="display:flex;"><span>        Message message <span style="color:#f92672">=</span> messageRepository.<span style="color:#a6e22e">findByKeyAndLocale</span>(key, locale.<span style="color:#a6e22e">toString</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">orElse</span>(<span style="color:#66d9ef">new</span> Message());
</span></span><span style="display:flex;"><span>        message.<span style="color:#a6e22e">setKey</span>(key);
</span></span><span style="display:flex;"><span>        message.<span style="color:#a6e22e">setValue</span>(value);
</span></span><span style="display:flex;"><span>        message.<span style="color:#a6e22e">setLocale</span>(locale.<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>        messageRepository.<span style="color:#a6e22e">save</span>(message);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// é€šçŸ¥å˜æ›´</span>
</span></span><span style="display:flex;"><span>        notifyChange(key, value, locale);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// HTTP APIæ•°æ®æºå®ç°</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HttpApiMessageSourceProvider</span> <span style="color:#66d9ef">implements</span> MessageSourceProvider {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> RestTemplate restTemplate;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Value</span>(<span style="color:#e6db74">&#34;${i18n.api.base-url}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String apiBaseUrl;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">loadMessages</span>(Locale locale) {
</span></span><span style="display:flex;"><span>        String url <span style="color:#f92672">=</span> apiBaseUrl <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/messages?locale=&#34;</span> <span style="color:#f92672">+</span> locale.<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span>        ResponseEntity<span style="color:#f92672">&lt;</span>Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;&gt;</span> response <span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>            restTemplate.<span style="color:#a6e22e">exchange</span>(url, HttpMethod.<span style="color:#a6e22e">GET</span>, <span style="color:#66d9ef">null</span>, 
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">new</span> ParameterizedTypeReference<span style="color:#f92672">&lt;</span>Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;&gt;</span>() {});
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> response.<span style="color:#a6e22e">getBody</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ç»„åˆæ•°æ®æºç®¡ç†å™¨</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CompositeMessageSourceManager</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> List<span style="color:#f92672">&lt;</span>MessageSourceProvider<span style="color:#f92672">&gt;</span> providers;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">CompositeMessageSourceManager</span>(List<span style="color:#f92672">&lt;</span>MessageSourceProvider<span style="color:#f92672">&gt;</span> providers) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// æŒ‰ä¼˜å…ˆçº§æ’åº</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">providers</span> <span style="color:#f92672">=</span> providers.<span style="color:#a6e22e">stream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">sorted</span>(Comparator.<span style="color:#a6e22e">comparingInt</span>(MessageSourceProvider::getPriority))
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">collect</span>(Collectors.<span style="color:#a6e22e">toList</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getMessage</span>(String key, Locale locale) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (MessageSourceProvider provider : providers) {
</span></span><span style="display:flex;"><span>            Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> messages <span style="color:#f92672">=</span> provider.<span style="color:#a6e22e">loadMessages</span>(locale);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (messages.<span style="color:#a6e22e">containsKey</span>(key)) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> messages.<span style="color:#a6e22e">get</span>(key);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="63-å¼€å‘ä½“éªŒæ”¹è¿›">6.3 å¼€å‘ä½“éªŒæ”¹è¿›</h4>
<h5 id="631-æ³¨è§£é©±åŠ¨é…ç½®">6.3.1 æ³¨è§£é©±åŠ¨é…ç½®</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// ç®€åŒ–çš„æ³¨è§£é…ç½®</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableI18n</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@I18nConfiguration</span>(
</span></span><span style="display:flex;"><span>    basenames <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;classpath:i18n/messages&#34;</span>, <span style="color:#e6db74">&#34;classpath:i18n/validation&#34;</span>},
</span></span><span style="display:flex;"><span>    defaultLocale <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en&#34;</span>,
</span></span><span style="display:flex;"><span>    supportedLocales <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;en&#34;</span>, <span style="color:#e6db74">&#34;zh_CN&#34;</span>, <span style="color:#e6db74">&#34;ja&#34;</span>},
</span></span><span style="display:flex;"><span>    cacheStrategy <span style="color:#f92672">=</span> CacheStrategy.<span style="color:#a6e22e">MULTI_LEVEL</span>,
</span></span><span style="display:flex;"><span>    hotReload <span style="color:#f92672">=</span> <span style="color:#a6e22e">@HotReload</span>(enabled <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>, checkInterval <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;5m&#34;</span>),
</span></span><span style="display:flex;"><span>    providers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@DataSource</span>(type <span style="color:#f92672">=</span> DataSourceType.<span style="color:#a6e22e">PROPERTIES</span>, location <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;classpath:i18n/&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@DataSource</span>(type <span style="color:#f92672">=</span> DataSourceType.<span style="color:#a6e22e">DATABASE</span>, table <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;i18n_messages&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@DataSource</span>(type <span style="color:#f92672">=</span> DataSourceType.<span style="color:#a6e22e">HTTP_API</span>, url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;${i18n.api.url}&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">I18nConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è‡ªåŠ¨é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»ºBean</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ç±»å‹å®‰å…¨çš„æ¶ˆæ¯é”®</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@MessageKeys</span>(<span style="color:#e6db74">&#34;classpath:i18n/messages&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">AppMessages</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@MessageKey</span>(<span style="color:#e6db74">&#34;common.save&#34;</span>)
</span></span><span style="display:flex;"><span>    String COMMON_SAVE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;common.save&#34;</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@MessageKey</span>(<span style="color:#e6db74">&#34;common.cancel&#34;</span>)
</span></span><span style="display:flex;"><span>    String COMMON_CANCEL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;common.cancel&#34;</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@MessageKey</span>(<span style="color:#e6db74">&#34;user.validation.email.invalid&#34;</span>)
</span></span><span style="display:flex;"><span>    String USER_EMAIL_INVALID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;user.validation.email.invalid&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ä½¿ç”¨æ–¹å¼</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserService</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> MessageSource messageSource;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">validateUser</span>(User user) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>isValidEmail(user.<span style="color:#a6e22e">getEmail</span>())) {
</span></span><span style="display:flex;"><span>            String message <span style="color:#f92672">=</span> messageSource.<span style="color:#a6e22e">getMessage</span>(
</span></span><span style="display:flex;"><span>                AppMessages.<span style="color:#a6e22e">USER_EMAIL_INVALID</span>, 
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">null</span>, 
</span></span><span style="display:flex;"><span>                LocaleContextHolder.<span style="color:#a6e22e">getLocale</span>()
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ValidationException(message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="632-å¼€å‘å·¥å…·æ”¯æŒ">6.3.2 å¼€å‘å·¥å…·æ”¯æŒ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// æ¶ˆæ¯ç®¡ç†REST API</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequestMapping</span>(<span style="color:#e6db74">&#34;/admin/i18n&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">I18nManagementController</span> {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> MessageSourceManager messageSourceManager;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/messages&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>PageResult<span style="color:#f92672">&lt;</span>MessageInfo<span style="color:#f92672">&gt;&gt;</span> <span style="color:#a6e22e">getMessages</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@RequestParam</span>(required <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>) String locale,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@RequestParam</span>(required <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>) String key,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@RequestParam</span>(defaultValue <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0&#34;</span>) <span style="color:#66d9ef">int</span> page,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@RequestParam</span>(defaultValue <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;20&#34;</span>) <span style="color:#66d9ef">int</span> size) {
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        PageRequest pageRequest <span style="color:#f92672">=</span> PageRequest.<span style="color:#a6e22e">of</span>(page, size);
</span></span><span style="display:flex;"><span>        Page<span style="color:#f92672">&lt;</span>MessageInfo<span style="color:#f92672">&gt;</span> messages <span style="color:#f92672">=</span> messageSourceManager.<span style="color:#a6e22e">findMessages</span>(locale, key, pageRequest);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ResponseEntity.<span style="color:#a6e22e">ok</span>(PageResult.<span style="color:#a6e22e">of</span>(messages));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span>(<span style="color:#e6db74">&#34;/messages&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">updateMessage</span>(<span style="color:#a6e22e">@RequestBody</span> MessageUpdateRequest request) {
</span></span><span style="display:flex;"><span>        messageSourceManager.<span style="color:#a6e22e">updateMessage</span>(
</span></span><span style="display:flex;"><span>            request.<span style="color:#a6e22e">getKey</span>(), 
</span></span><span style="display:flex;"><span>            request.<span style="color:#a6e22e">getValue</span>(), 
</span></span><span style="display:flex;"><span>            Locale.<span style="color:#a6e22e">forLanguageTag</span>(request.<span style="color:#a6e22e">getLocale</span>())
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ResponseEntity.<span style="color:#a6e22e">ok</span>().<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@DeleteMapping</span>(<span style="color:#e6db74">&#34;/messages/{key}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">deleteMessage</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@PathVariable</span> String key,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@RequestParam</span> String locale) {
</span></span><span style="display:flex;"><span>        messageSourceManager.<span style="color:#a6e22e">deleteMessage</span>(key, Locale.<span style="color:#a6e22e">forLanguageTag</span>(locale));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ResponseEntity.<span style="color:#a6e22e">ok</span>().<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span>(<span style="color:#e6db74">&#34;/cache/clear&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">clearCache</span>() {
</span></span><span style="display:flex;"><span>        messageSourceManager.<span style="color:#a6e22e">clearCache</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ResponseEntity.<span style="color:#a6e22e">ok</span>().<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/statistics&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>I18nStatistics<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getStatistics</span>() {
</span></span><span style="display:flex;"><span>        I18nStatistics stats <span style="color:#f92672">=</span> messageSourceManager.<span style="color:#a6e22e">getStatistics</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ResponseEntity.<span style="color:#a6e22e">ok</span>(stats);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Webç®¡ç†ç•Œé¢</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Controller</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequestMapping</span>(<span style="color:#e6db74">&#34;/admin/i18n/ui&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">I18nManagementUIController</span> {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">index</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;i18n/index&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/editor&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">editor</span>(<span style="color:#a6e22e">@RequestParam</span> String key, <span style="color:#a6e22e">@RequestParam</span> String locale, Model model) {
</span></span><span style="display:flex;"><span>        MessageInfo message <span style="color:#f92672">=</span> messageSourceManager.<span style="color:#a6e22e">getMessage</span>(key, Locale.<span style="color:#a6e22e">forLanguageTag</span>(locale));
</span></span><span style="display:flex;"><span>        model.<span style="color:#a6e22e">addAttribute</span>(<span style="color:#e6db74">&#34;message&#34;</span>, message);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;i18n/editor&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="633-ideæ’ä»¶æ”¯æŒ">6.3.3 IDEæ’ä»¶æ”¯æŒ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// IDEæ’ä»¶æ¥å£å®šä¹‰</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">I18nIDESupport</span> {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// éªŒè¯æ¶ˆæ¯é”®çš„å­˜åœ¨æ€§</span>
</span></span><span style="display:flex;"><span>    ValidationResult <span style="color:#a6e22e">validateMessageKey</span>(String key, Set<span style="color:#f92672">&lt;</span>Locale<span style="color:#f92672">&gt;</span> locales);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è‡ªåŠ¨å®Œæˆæ¶ˆæ¯é”®</span>
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getMessageKeyCompletions</span>(String prefix);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// æŸ¥æ‰¾æ¶ˆæ¯é”®çš„ä½¿ç”¨ä½ç½®</span>
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>Usage<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findMessageKeyUsages</span>(String key);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ç”Ÿæˆç¼ºå¤±çš„æ¶ˆæ¯é”®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">generateMissingKeys</span>(Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> keys, Set<span style="color:#f92672">&lt;</span>Locale<span style="color:#f92672">&gt;</span> locales);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é‡æ„æ¶ˆæ¯é”®</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">refactorMessageKey</span>(String oldKey, String newKey);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// æ¶ˆæ¯é”®éªŒè¯å™¨</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessageKeyValidator</span> <span style="color:#66d9ef">implements</span> I18nIDESupport {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ValidationResult <span style="color:#a6e22e">validateMessageKey</span>(String key, Set<span style="color:#f92672">&lt;</span>Locale<span style="color:#f92672">&gt;</span> locales) {
</span></span><span style="display:flex;"><span>        ValidationResult result <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ValidationResult();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (Locale locale : locales) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                String message <span style="color:#f92672">=</span> messageSource.<span style="color:#a6e22e">getMessage</span>(key, <span style="color:#66d9ef">null</span>, locale);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (message <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> message.<span style="color:#a6e22e">equals</span>(key)) {
</span></span><span style="display:flex;"><span>                    result.<span style="color:#a6e22e">addWarning</span>(<span style="color:#e6db74">&#34;Message key &#39;&#34;</span> <span style="color:#f92672">+</span> key <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39; not found for locale &#34;</span> <span style="color:#f92672">+</span> locale);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (NoSuchMessageException e) {
</span></span><span style="display:flex;"><span>                result.<span style="color:#a6e22e">addError</span>(<span style="color:#e6db74">&#34;Message key &#39;&#34;</span> <span style="color:#f92672">+</span> key <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39; missing for locale &#34;</span> <span style="color:#f92672">+</span> locale);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">generateMissingKeys</span>(Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> keys, Set<span style="color:#f92672">&lt;</span>Locale<span style="color:#f92672">&gt;</span> locales) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (String key : keys) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (Locale locale : locales) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>messageExists(key, locale)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// ç”Ÿæˆé»˜è®¤æ¶ˆæ¯</span>
</span></span><span style="display:flex;"><span>                    String defaultMessage <span style="color:#f92672">=</span> generateDefaultMessage(key);
</span></span><span style="display:flex;"><span>                    messageSourceManager.<span style="color:#a6e22e">saveMessage</span>(key, defaultMessage, locale);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="64-äº‘åŸç”Ÿå’Œå¾®æœåŠ¡æ”¯æŒ">6.4 äº‘åŸç”Ÿå’Œå¾®æœåŠ¡æ”¯æŒ</h4>
<h5 id="641-é…ç½®ä¸­å¿ƒé›†æˆ">6.4.1 é…ç½®ä¸­å¿ƒé›†æˆ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// ä¸Spring Cloud Configé›†æˆ</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RefreshScope</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConfigCenterMessageSource</span> <span style="color:#66d9ef">implements</span> MessageSource {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Value</span>(<span style="color:#e6db74">&#34;${i18n.config.enabled:true}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">boolean</span> configEnabled;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> ConfigurableEnvironment environment;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@EventListener</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onRefreshScopeRefreshed</span>(RefreshScopeRefreshedEvent event) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (configEnabled) {
</span></span><span style="display:flex;"><span>            refreshMessages();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">refreshMessages</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ä»é…ç½®ä¸­å¿ƒé‡æ–°åŠ è½½æ¶ˆæ¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (Locale locale : getSupportedLocales()) {
</span></span><span style="display:flex;"><span>            String prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;i18n.messages.&#34;</span> <span style="color:#f92672">+</span> locale.<span style="color:#a6e22e">toString</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.&#34;</span>;
</span></span><span style="display:flex;"><span>            Map<span style="color:#f92672">&lt;</span>String, Object<span style="color:#f92672">&gt;</span> properties <span style="color:#f92672">=</span> environment.<span style="color:#a6e22e">getSystemProperties</span>();
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> messages <span style="color:#f92672">=</span> properties.<span style="color:#a6e22e">entrySet</span>().<span style="color:#a6e22e">stream</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">filter</span>(entry <span style="color:#f92672">-&gt;</span> entry.<span style="color:#a6e22e">getKey</span>().<span style="color:#a6e22e">toString</span>().<span style="color:#a6e22e">startsWith</span>(prefix))
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">collect</span>(Collectors.<span style="color:#a6e22e">toMap</span>(
</span></span><span style="display:flex;"><span>                    entry <span style="color:#f92672">-&gt;</span> entry.<span style="color:#a6e22e">getKey</span>().<span style="color:#a6e22e">toString</span>().<span style="color:#a6e22e">substring</span>(prefix.<span style="color:#a6e22e">length</span>()),
</span></span><span style="display:flex;"><span>                    entry <span style="color:#f92672">-&gt;</span> entry.<span style="color:#a6e22e">getValue</span>().<span style="color:#a6e22e">toString</span>()
</span></span><span style="display:flex;"><span>                ));
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            updateMessages(locale, messages);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Kubernetes ConfigMapé›†æˆ</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">KubernetesConfigMapMessageSource</span> {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> KubernetesClient kubernetesClient;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Scheduled</span>(fixedDelay <span style="color:#f92672">=</span> 30000) <span style="color:#75715e">// æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">watchConfigMapChanges</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            ConfigMap configMap <span style="color:#f92672">=</span> kubernetesClient.<span style="color:#a6e22e">configMaps</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">inNamespace</span>(<span style="color:#e6db74">&#34;default&#34;</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">withName</span>(<span style="color:#e6db74">&#34;i18n-messages&#34;</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">get</span>();
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (configMap <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> hasChanged(configMap)) {
</span></span><span style="display:flex;"><span>                reloadFromConfigMap(configMap);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            log.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Failed to watch ConfigMap changes&#34;</span>, e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="642-æœåŠ¡ç½‘æ ¼æ”¯æŒ">6.4.2 æœåŠ¡ç½‘æ ¼æ”¯æŒ</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// åˆ†å¸ƒå¼æ¶ˆæ¯æœåŠ¡</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@FeignClient</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;i18n-service&#34;</span>, fallback <span style="color:#f92672">=</span> I18nServiceFallback.<span style="color:#a6e22e">class</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">I18nServiceClient</span> {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/api/v1/messages&#34;</span>)
</span></span><span style="display:flex;"><span>    Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getMessages</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@RequestParam</span> String locale,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@RequestParam</span>(required <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>) Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> keys
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/api/v1/messages/{key}&#34;</span>)
</span></span><span style="display:flex;"><span>    String <span style="color:#a6e22e">getMessage</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@PathVariable</span> String key,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@RequestParam</span> String locale,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@RequestParam</span>(required <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>) String defaultMessage
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span>(<span style="color:#e6db74">&#34;/api/v1/messages&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">updateMessage</span>(<span style="color:#a6e22e">@RequestBody</span> MessageUpdateRequest request);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/api/v1/locales&#34;</span>)
</span></span><span style="display:flex;"><span>    Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getSupportedLocales</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// é™çº§å¤„ç†</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">I18nServiceFallback</span> <span style="color:#66d9ef">implements</span> I18nServiceClient {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> LocalMessageSource localMessageSource;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Map<span style="color:#f92672">&lt;</span>String, String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getMessages</span>(String locale, Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> keys) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// é™çº§åˆ°æœ¬åœ°æ¶ˆæ¯æº</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> localMessageSource.<span style="color:#a6e22e">getMessages</span>(Locale.<span style="color:#a6e22e">forLanguageTag</span>(locale), keys);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getMessage</span>(String key, String locale, String defaultMessage) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> localMessageSource.<span style="color:#a6e22e">getMessage</span>(key, <span style="color:#66d9ef">null</span>, Locale.<span style="color:#a6e22e">forLanguageTag</span>(locale));
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (NoSuchMessageException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> defaultMessage <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> defaultMessage : key;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// æ¶ˆæ¯åŒæ­¥æœåŠ¡</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessageSyncService</span> {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> I18nServiceClient i18nServiceClient;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> LocalMessageSource localMessageSource;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@EventListener</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Async</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onMessageChanged</span>(MessageChangedEvent event) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// åŒæ­¥æ¶ˆæ¯å˜æ›´åˆ°å…¶ä»–æœåŠ¡å®ä¾‹</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            i18nServiceClient.<span style="color:#a6e22e">updateMessage</span>(MessageUpdateRequest.<span style="color:#a6e22e">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">key</span>(event.<span style="color:#a6e22e">getKey</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">value</span>(event.<span style="color:#a6e22e">getValue</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">locale</span>(event.<span style="color:#a6e22e">getLocale</span>().<span style="color:#a6e22e">toString</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">build</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            log.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Failed to sync message change&#34;</span>, e);
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// å¯ä»¥è€ƒè™‘ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå¼‚æ­¥é‡è¯•</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="7-æ€»ç»“">7. æ€»ç»“</h3>
<p>Spring çš„å›½é™…åŒ–è®¾è®¡åœ¨ä¼ä¸šçº§åº”ç”¨ä¸­å‘æŒ¥äº†é‡è¦ä½œç”¨ï¼Œå…¶åŸºäºæ¥å£æŠ½è±¡çš„è®¾è®¡ç†å¿µã€å±‚æ¬¡åŒ–çš„æ¶ˆæ¯æŸ¥æ‰¾æœºåˆ¶ã€ä»¥åŠä¸Springç”Ÿæ€çš„æ·±åº¦é›†æˆéƒ½ä½“ç°äº†ä¼˜ç§€çš„æ¶æ„è®¾è®¡ã€‚ç„¶è€Œï¼Œéšç€æŠ€æœ¯å‘å±•å’Œåº”ç”¨åœºæ™¯çš„å˜åŒ–ï¼Œç°æœ‰å®ç°åœ¨æ€§èƒ½ã€åŠŸèƒ½ã€æ‰©å±•æ€§å’Œå¼€å‘ä½“éªŒç­‰æ–¹é¢éƒ½å­˜åœ¨æ”¹è¿›ç©ºé—´ã€‚</p>
<p><strong>ä¸»è¦ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>æˆç†Ÿç¨³å®šçš„æ¶æ„è®¾è®¡</li>
<li>è‰¯å¥½çš„Springç”Ÿæ€é›†æˆ</li>
<li>æ”¯æŒå±‚æ¬¡åŒ–æ¶ˆæ¯æŸ¥æ‰¾</li>
<li>æä¾›å¤šç§LocaleResolverç­–ç•¥</li>
</ul>
<p><strong>ä¸»è¦ä¸è¶³ï¼š</strong></p>
<ul>
<li>æ€§èƒ½ç“¶é¢ˆï¼ˆç¼“å­˜ç­–ç•¥ã€MessageFormatåˆ›å»ºï¼‰</li>
<li>åŠŸèƒ½é™åˆ¶ï¼ˆèµ„æºæ ¼å¼ã€æ•°æ®æºå•ä¸€ï¼‰</li>
<li>æ‰©å±•æ€§é—®é¢˜ï¼ˆç¼“å­˜ç­–ç•¥å›ºåŒ–ã€æ•°æ®æºé™åˆ¶ï¼‰</li>
<li>å¼€å‘ä½“éªŒï¼ˆé…ç½®å¤æ‚ã€è°ƒè¯•å›°éš¾ã€å·¥å‘å·¥å…·ç¼ºå°‘ï¼‰</li>
</ul>

		</div>


	</article>
</main>
<footer class="post__footer">
	

<div class="post-related">
	<h3>ç›¸å…³æ–‡ç« </h3>
	<ul class="post-related-list">
		
		<li class="post-related-item">
			<a href="/posts/2024/07/19/gitlab-runner-install/" target="_blank" title="GitLab Runnerå®‰è£…å’Œéƒ¨ç½²">GitLab Runnerå®‰è£…å’Œéƒ¨ç½²</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2024/07/15/install-gitlab-using-yum/" target="_blank" title="Gitlabå®‰è£…å’Œéƒ¨ç½²-ä½¿ç”¨yumæº">Gitlabå®‰è£…å’Œéƒ¨ç½²-ä½¿ç”¨yumæº</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2024/05/11/argocd/" target="_blank" title="Argo CDå®‰è£…å’Œéƒ¨ç½²">Argo CDå®‰è£…å’Œéƒ¨ç½²</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2024/08/01/publishing-a-jar-to-maven-repository-with-github-action/" target="_blank" title="Github Action å‘å¸ƒ Jar åˆ° Maven ä¸­å¤®ä»“åº“">Github Action å‘å¸ƒ Jar åˆ° Maven ä¸­å¤®ä»“åº“</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2024/07/09/docker-for-spring-boot/" target="_blank" title="ä½¿ç”¨ Docker å®¹å™¨åŒ–å¹¶è¿è¡Œ Spring Boot åº”ç”¨ç¨‹åº">ä½¿ç”¨ Docker å®¹å™¨åŒ–å¹¶è¿è¡Œ Spring Boot åº”ç”¨ç¨‹åº</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2024/06/26/install-gitlab/" target="_blank" title="Gitlabå®‰è£…å’Œéƒ¨ç½²-ä½¿ç”¨Docker">Gitlabå®‰è£…å’Œéƒ¨ç½²-ä½¿ç”¨Docker</a>
		</li>
		
	</ul>
</div>

</footer>

<footer class="post__footer">
	<footer class="post__footer">
		
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/kubernetes/" rel="tag">kubernetes</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/javascript/" rel="tag">javascript</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/redis/" rel="tag">redis</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/microservice/" rel="tag">microservice</a>
		</li>
	</ul>
</div>
	</footer>
</footer>


<nav class="pagination flex">
	<div class="pagination__item pagination__item--prev">
		<a class="pagination__link" href="/posts/2025/07/15/ruoyi-ai/" rel="prev">
			<p class="pagination__title">Â«&thinsp;ä¸Šä¸€ç¯‡: RuoYi AI æºç åˆ†æ</p>
		</a>
	</div>
	<div class="pagination__item pagination__item--next">
		<a class="pagination__link" href="/posts/2025/07/24/thingsboard-api/" rel="next">
			<p class="pagination__title">&thinsp;Â» ä¸‹ä¸€ç¯‡: ThingsBoardæ¥å£è®¾è®¡</p>
		</a>
	</div>
</nav>



<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="ChenSoul avatar" src="/avatar.jpg" class="avatar" height="60" width="60" loading="lazy">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">å…³äº ChenSoul</span>
	</div>
	<div class="authorbox__description">
		ä¸€ä¸ªæ¥è‡ªä¸­å›½æ­¦æ±‰çš„å¼€å‘è€…ï¼Œä¸»è¦æ’°å†™è½¯ä»¶å¼€å‘å’Œå¼€æºæ–¹é¢çš„æ–‡ç« ã€‚æµè§ˆæˆ‘çš„<a href="%28/posts%29">åšå®¢æ–‡ç« </a>ï¼Œè®¢é˜…æˆ‘çš„ <a href="/index.xml">RSS</a> æºï¼Œæˆ–äº†è§£æ›´å¤š<a href="/about/">å…³äºæˆ‘</a>çš„ä¿¡æ¯ã€‚
	</div>
</div>




	<p><h3>æ¬¢è¿ç•™è¨€ï¼</h3></p>
<div id="remark42"></div>
<script>
	var remark_config = {
		host: 'https:\/\/comment.chensoul.cc',
		site_id: 'remark',
		components: ['embed'],
		url: 'https:\/\/blog.chensoul.cc\/posts\/2025\/07\/17\/spring-i18n\/',
		locale: 'zh'
	};

	!function(e, n) {
		for (var o = 0; o < e.length; o++) {
			var r = n.createElement('script'),
			c = '.js',
			d = n.head || n.body;
			'noModule' in r ? (r.type = 'module', c = '.mjs') : r.async = !0, r.defer = !0, r.src = remark_config.host + '/web/' + e[o] + c, d.appendChild(r)
		}
	}(remark_config.components || ['embed'], document);

</script>



<script defer src="https://cdn.jsdmirror.com/npm/mermaid@11.8.0/dist/mermaid.min.js" integrity="sha256-ozuDfeDhjEI9EXLi0CdigeIiAcaRYi3E5T+VLC9yIB4=" crossorigin="anonymous" async></script>



			</div>
			

<aside class="sidebar sidebar--right">
	<div class="post__toc toc">
		<div class="toc__title">ç›®å½•</div>
		<div class="toc__menu">
			<nav id="TableOfContents">
  <ul>
    <li><a href="#-ä¸€è®¾è®¡èƒŒæ™¯">ğŸ“œ ä¸€ã€è®¾è®¡èƒŒæ™¯</a>
      <ul>
        <li><a href="#11-å›½é™…åŒ–éœ€æ±‚çš„äº§ç”Ÿ">1.1 å›½é™…åŒ–éœ€æ±‚çš„äº§ç”Ÿ</a></li>
        <li><a href="#12-java-å¹³å°åŸºç¡€">1.2 Java å¹³å°åŸºç¡€</a></li>
        <li><a href="#13-spring-çš„è®¾è®¡ç†å¿µ">1.3 Spring çš„è®¾è®¡ç†å¿µ</a></li>
      </ul>
    </li>
    <li><a href="#-äºŒæ¶æ„ä¸æ ¸å¿ƒç»„ä»¶">ğŸ§± äºŒã€æ¶æ„ä¸æ ¸å¿ƒç»„ä»¶</a>
      <ul>
        <li><a href="#1-æ ¸å¿ƒæ¥å£">1. æ ¸å¿ƒæ¥å£</a></li>
        <li><a href="#2-æ ¸å¿ƒæ¶æ„">2. æ ¸å¿ƒæ¶æ„</a></li>
        <li><a href="#3-æŠ€æœ¯å®ç°">3. æŠ€æœ¯å®ç°</a></li>
        <li><a href="#4-ä¸»è¦åŠŸèƒ½ç‰¹æ€§">4. ä¸»è¦åŠŸèƒ½ç‰¹æ€§</a></li>
        <li><a href="#5-å­˜åœ¨çš„ç¼ºé™·å’Œä¸è¶³">5. å­˜åœ¨çš„ç¼ºé™·å’Œä¸è¶³</a></li>
        <li><a href="#6-å¯ä»¥ä¼˜åŒ–æ”¹è¿›çš„åœ°æ–¹">6. å¯ä»¥ä¼˜åŒ–æ”¹è¿›çš„åœ°æ–¹</a></li>
        <li><a href="#7-æ€»ç»“">7. æ€»ç»“</a></li>
      </ul>
    </li>
  </ul>
</nav>
		</div>
	</div>
</aside>

		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
<div class="footer__links">
	<a class="footer__link" href="/">é¦–é¡µ</a> | <a class="footer__link" href="/categories/">åˆ†ç±»</a> | <a class="footer__link" href="/tags/">æ ‡ç­¾</a> | <a class="footer__link" href="/index.xml">è®¢é˜…</a> | <a class="footer__link" href="/about/">å…³äº</a>
</div>
		<div class="footer__copyright">
			&copy; 2025 ChenSoul.
			<span class="footer__copyright-credits">åŸºäº <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> å¼•æ“å’Œ <a href="https://github.com/chensoul/rose-hugo/" rel="nofollow noopener" target="_blank">Rose Hugo</a> ä¸»é¢˜</span>
		</div>
	</div>

	






<style>
	.scroll-up a {
		display: block;
		height: 3.125rem;
		width: 3.125rem;
		text-align: center;
		line-height: 2.7;
		border-radius: 50px;
		font-size: 1.125rem;
		color: #fff;
		opacity: 1;
		transition: all 0.3s ease 0s;
		box-shadow: 0 0 10px rgb(0 0 0 / 20%);
	}
	.scroll-up a {
		background: #ee591f;
	}
	.scroll-up {
		position: fixed;
		display: none;
		bottom: 50px;
		z-index: 999;
	}
	.scroll-up.right {
		right: 60px;
	}
</style>

<div class="scroll-up custom right" style="display: block;"><a href="#top" id="top-link" accesskey="g"><i
	class="fa fa-arrow-up"></i></a></div>

<script>
	var mybutton = document.getElementById("top-link");
	window.onscroll = function () {
		if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
			mybutton.style.visibility = "visible";
			mybutton.style.opacity = "1";
		} else {
			mybutton.style.visibility = "hidden";
			mybutton.style.opacity = "0";
		}
	};
</script>


    <script defer src="https://umami.chensoul.cc/random-string.js" data-website-id="1e07d36d-bec3-4ba6-9459-876b1ac3bbe7"></script>
</footer>


	</div>

	<script>
		'use strict';
		(function iifeMenu(document, window, undefined) {
			var menuBtn = document.querySelector('.menu__btn');
			var	menu = document.querySelector('.menu__list');
			function toggleMenu() {
				menu.classList.toggle('menu__list--active');
				menu.classList.toggle('menu__list--transition');
				this.classList.toggle('menu__btn--active');
				this.setAttribute(
					'aria-expanded',
					this.getAttribute('aria-expanded') === 'true' ? 'false' : 'true'
				);
			}
			function removeMenuTransition() {
				this.classList.remove('menu__list--transition');
			}
			if (menuBtn && menu) {
				menuBtn.addEventListener('click', toggleMenu, false);
				menu.addEventListener('transitionend', removeMenuTransition, false);
			}
		}(document, window));
	</script>
</body>
</html>