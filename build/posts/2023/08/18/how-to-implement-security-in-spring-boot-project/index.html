<!DOCTYPE html>
<html class="no-js" lang="zh-cn">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[译]Spring Boot项目如何实现Security？ - Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="[译]Spring Boot项目如何实现Security？">
	<meta property="og:description" content="Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps">
	<meta property="og:type" content="article">
	<meta property="og:url" content="https://blog.chensoul.cc/posts/2023/08/18/how-to-implement-security-in-spring-boot-project/">
	<meta property="og:site_name" content="ChenSoul Blog">
	<meta property="og:image" content="">
	
  <meta itemprop="name" content="[译]Spring Boot项目如何实现Security？">
  <meta itemprop="description" content="">
  <meta itemprop="datePublished" content="2023-08-18T00:00:00+00:00">
  <meta itemprop="dateModified" content="2023-08-18T00:00:00+00:00">
  <meta itemprop="wordCount" content="1799">
  <meta itemprop="keywords" content="Mysql,Java,Backend,Security">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:title" content="[译]Spring Boot项目如何实现Security？">
	<meta name="twitter:description" content="Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps">
	<meta name="twitter:image" content="">

	<link rel="preconnect" href="//fonts.loli.net" crossorigin>
	<link rel="dns-prefetch" href="//fonts.loli.net">
	<link rel="stylesheet" href="https://fonts.loli.net/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="/css/style.css">

	<link rel="shortcut icon" href="/favicon.ico">
		
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="ChenSoul Blog" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/logo.svg" loading="lazy" alt="Site logo" width="60" height="60">
				</div><div class="logo__item logo__text">
					<div class="logo__title">ChenSoul Blog</div>
					<div class="logo__tagline">Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">菜单</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/">
				
				<span class="menu__text">首页</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/categories/">
				
				<span class="menu__text">分类</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/tags/">
				
				<span class="menu__text">标签</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/index.xml">
				
				<span class="menu__text">订阅</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">关于</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[译]Spring Boot项目如何实现Security？</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 1 1 0 28 1 1 0 0 1 0-28m0 3a3 3 0 1 0 0 22 3 3 0 0 0 0-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class="meta__text" datetime="2023-08-18">2023-08-18</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/spring-boot/" rel="category">Spring-Boot</a>
	</span>
</div><div class="meta__item-tags meta__item"><svg class="meta__icon icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg><span class="meta__text"><a class="meta__link" href="/tags/mysql/" rel="tag">Mysql</a>, <a class="meta__link" href="/tags/java/" rel="tag">Java</a>, <a class="meta__link" href="/tags/backend/" rel="tag">Backend</a>, <a class="meta__link" href="/tags/security/" rel="tag">Security</a>
	</span>
</div>
</div>
		</header>
		
		<div class="content post__content clearfix">
			<p><img src="../../../static/images/SpringSecurityBasics-2.webp" alt="How to implement Security in Spring Boot Project?"></p>
<p>如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的安全性，但我们作为开发人员将重点关注应用程序/软件安全性。</p>
<p>此外，在应用程序安全方面，我们的工作基本上是确保两件事。首先，只有有效的用户才能访问该应用程序。其次，如果用户有效，他/她只能访问该应用程序中允许的数据/信息。我认为，没有什么可以解释它们，因为您必须已经了解这两个术语，即身份验证和授权。</p>
<p>您可能已经猜到我们将在当前主题“如何在 Spring Boot 项目中实现安全性？”中讨论什么内容。</p>
<p>在本文中，我们将从基本原理开始学习。接下来，我们将逐步结束它，直到我们有信心在 Spring Boot 应用程序中实现安全功能。因此，让我们开始逐步讨论“如何在 Spring Boot 项目中实现安全性？”。 Spring Boot 教程页面上有一系列有关 <a href="https://javatechonline.com/spring-boot-tutorial/#Spring_Boot_Security" target="_blank">Spring Boot Security 的教程</a>。</p>
<p>我们在本文中介绍了两个版本的“如何在 Spring Boot 项目中实现安全性？”的示例：使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。此外，还涵盖了使用 Spring Boot 3.0 及更高版本的“如何在 Spring Boot 项目中实现安全性？”的示例。</p>
<h2 id="您将从本文中学到什么">您将从本文中学到什么？</h2>
<ol>
<li>
<p>为什么我们需要在 Spring Boot 应用程序中实现安全性？</p>
</li>
<li>
<p>Security 在 Spring Boot 应用程序内部如何工作？</p>
</li>
<li>
<p>javax.servlet.Filter 在 Spring Boot 应用程序中实现安全性方面的作用是什么？</p>
</li>
<li>
<p>Spring Boot 项目中使用了多少种授权类型？</p>
</li>
<li>
<p>Spring Boot 项目中有多少种实现安全性的方法？</p>
</li>
<li>
<p>在 Spring Boot 项目中实现 WebSecurity 的步骤是什么？</p>
</li>
<li>
<p>另外，如何在 Spring Boot 项目中使用@EnableWebSecurity、@Configuration、@Bean？</p>
</li>
<li>
<p>如何实现内存中身份验证安全示例</p>
</li>
<li>
<p>如何实现 JDBC 认证安全示例</p>
</li>
<li>
<p>如何在 Spring Boot 项目中使用 Thymeleaf ？</p>
</li>
<li>
<p>如何测试启用安全的功能？</p>
</li>
<li>
<p>相反，如何禁用应用程序的安全功能？</p>
</li>
<li>
<p>最后但并非最不重要的一点是，您将学习“如何在 Spring Boot 项目中实现安全性？”使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。</p>
</li>
</ol>
<h2 id="为什么我们需要应用程序中的安全性">为什么我们需要应用程序中的安全性？</h2>
<p>现在，随着恶意攻击将重点从操作系统和网络转移到应用程序/软件和移动设备/设备，一天的数据面临最大的风险。此外，从业务/客户的角度来看，应用程序安全在维护信任、建立品牌形象和降低风险方面发挥着重要作用。事实上，没有其中任何一项，都无法想象一家成功的企业。</p>
<p>总之，无论您是为了内部使用、销售目的还是购买目的而创建应用程序，安全性都是每个应用程序最重要的功能。</p>
<p>根据最新的 2020 年 Verizon 数据泄露调查报告，所有数据泄露中有 43% 是针对 Web 应用程序的攻击。这一数字比 2019 年增加了一倍。此外，86% 的违规行为都是出于经济动机。</p>
<h2 id="spring-boot-应用程序内部安全性如何工作">Spring Boot 应用程序内部安全性如何工作？</h2>
<p>从根本上来说，Spring Security 的工作原理是 JAAS（Java 身份验证和授权服务）。简而言之，它适用于 Filter (javax.servlet.Filter) 概念。我们都知道，如果我们想在 servlet 请求之前应用一些预处理逻辑，可以使用过滤器。同样的概念也被应用于在 Spring boot 项目中实现安全功能。</p>
<p>DelegatingFilterProxy 是 Spring Security 模块提供的 org.springframework.web.filter 包下的预定义类，在这里充当过滤器。</p>
<p>如下图所示，当用户向应用程序发送请求时，请求会先经过安全过滤器，然后再发送给 DispatcherServlet。如果用户验证此过滤器的安全性，则只有请求才会发送到 DispatcherServlet 来满足用户的目的。</p>
<p><img src="../../../static/images/SpringSecurity1-1-2.webp" alt="img"></p>
<h2 id="spring-boot-应用程序使用了多少种授权类型">Spring Boot 应用程序使用了多少种授权类型？</h2>
<p>有四种最常用的授权实现类型。他们是 ：</p>
<h3 id="1-permitall">1) permitAll</h3>
<p>PermitAll 表示无需任何授权即可访问当前页面。</p>
<p>示例 URL：/login、/home、/contactUs、/aboutUs ..等。</p>
<h3 id="2-authenticated">2) authenticated</h3>
<p>它表示需要登录（用户名/密码）并且不需要授权（基于角色的访问）。</p>
<p>示例 URL：/updateUserDetails、/inbox、/settings 等。</p>
<h3 id="3-hasauthority">3) hasAuthority</h3>
<p>hasAuthority 表示用户应该具有身份验证和基于角色的授权访问权限。</p>
<p>示例 URL+role：/approveRequest + MANAGER、/blockUser + ADMIN、/addUser + ADMIN …等。</p>
<h3 id="4-hasanyauthority">4) hasAnyAuthority</h3>
<p>它表示用户应该具有身份验证和基于多个角色的授权访问。就像经理和人力资源这两个角色都可以访问特定页面。
示例 URLs+role: /approveRequest + (MANAGER &amp; HR)</p>
<h2 id="在-spring-boot-web-应用程序中实现安全性有哪些不同的方法">在 Spring Boot Web 应用程序中实现安全性有哪些不同的方法？</h2>
<p>简而言之，在 Spring Boot Web 应用程序中实现安全性有三种最常见的方法。他们是</p>
<h3 id="in-memory-security">In-Memory Security</h3>
<p>在这种类型的实现中，我们将数据存储在 RAM（内存中）中，并在有请求时验证数据。我们在测试或开发环境中使用这种方法。在生产应用中不建议使用此方法。</p>
<h3 id="使用数据库">使用数据库</h3>
<p>在这种类型的实现中，我们将数据存储在数据库中，并在请求到来时验证数据/登录。但它是基于程序员提供的 SQL 查询来工作的。</p>
<h3 id="使用用户详细信息服务">使用用户详细信息服务</h3>
<p>我们将数据存储在数据库中，并在请求到来时验证数据。但 UserDetailsS​​ervice 是基于 ORM（Spring Data JPA）工作的。简而言之，UserDetailsS​​ervice 是 Spring Security 模块提供的一个接口。在登录表单中输入用户名后，当我们单击登录按钮时，将调用该服务。随后，它根据提供的用户名找到用户。它包含一个方法 loadUserByUsername(String username) 返回 UserDetails 对象。此外，UserDetails 对象为我们提供了用户名。</p>
<h2 id="在-spring-boot-应用程序中实现-web-安全的步骤是什么">在 Spring Boot 应用程序中实现 Web 安全的步骤是什么？</h2>
<p>以下是步骤：</p>
<p><img src="../../../static/images/SpringSecurity2-1-2.webp" alt="SpringSecurity2"></p>
<ol>
<li>
<p>编写一个类“SecurityConfig.java”，它扩展了预定义的抽象类 WebSecurityConfigurerAdapter.java</p>
</li>
<li>
<p>在“SecurityConfig.java”之上相应地应用注释@Configuration 和@EnableWebSecurity。不用说，注释@EnableWebSecurity 是为了在 Web 应用程序中启用安全功能。</p>
</li>
<li>
<p>覆盖下面两种方法同时实现身份验证和授权逻辑。</p>
</li>
</ol>
<ul>
<li>configure(AuthenticationManagerBuilder auth)</li>
<li>configure(HttpSecurity http)</li>
</ul>
<ol start="4">
<li>
<p>此外，通过使用@Autowired（如 DataSource、BCryptPasswordEncoder 等）注入其他对象依赖项（如果有），并在需要的地方使用它们。</p>
</li>
<li>
<p>同样重要的是，根据需要编写控制器类和视图页面。</p>
</li>
<li>
<p>最后，如果您不实施内存中身份验证，请更新 application.properties 文件中的数据库属性。</p>
</li>
</ol>
<p>注意：从 Spring Security 5.7.0-M2 开始，WebSecurityConfigurerAdapter 已被弃用。为了了解实现自定义配置类的新方法，请访问有关<a href="https://javatechonline.com/spring-security-without-websecurityconfigureradapter/" target="_blank">不使用 WebSecurityConfigurerAdapter 的 Spring Security</a> 的单独文章。</p>
<h2 id="如何实现内存中身份验证安全性的示例">如何实现内存中身份验证安全性的示例</h2>
<p>例如，让我们考虑一个小型组织的应用程序，其中我们有三个角色：员工、经理和管理员。此外，我们将对某些特定页面进行基于角色的限制访问。一方面，某些页面可供多个角色访问，另一方面，某些页面没有限制（所有角色均可访问）。此外，我们将使用 thymeleaf 来创建页面。此外，我们将有一个控制器类来满足用户的请求。</p>
<h3 id="softwaretechnologies-used-使用的软件技术">Software/Technologies Used 使用的软件/技术</h3>
<ul>
<li>STS (Spring Tool Suite) : Version-&gt; 4.7.1.RELEASE</li>
<li>JDK14 (JDK8 or later versions are sufficient)</li>
</ul>
<h3 id="步骤1在-stsspring-tool-suite中创建一个-spring-boot-starter-项目">步骤#1：在 STS(Spring Tool Suite)中创建一个 Spring Boot Starter 项目</h3>
<p>创建入门项目时，选择“Spring Security”、“Thymeleaf”、“Spring Web”和“Spring Boot DevTools”作为入门项目依赖项。要了解“如何创建 Spring Boot Starter 项目？”，请访问<a href="https://javatechonline.com/saving-data-into-database-using-spring-boot-data-jpa-step-by-step-tutorial/#Step_1_Creating_Starter_Project_using_STS" target="_blank">内部链接</a>。</p>
<h3 id="步骤2编写控制器类">步骤#2：编写控制器类</h3>
<p>请检查以下代码作为控制器类。</p>
<p>HomeController.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.dev.springboot.security.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Controller;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Controller</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HomeController</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/home&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getHomePage</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;homePage&#34;</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getWelcomePage</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;welcomePage&#34;</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/admin&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getAdminPage</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;adminPage&#34;</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/emp&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getEmployeePage</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;empPage&#34;</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/mgr&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getManagerPage</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;mgrPage&#34;</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/common&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getCommonPage</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;commonPage&#34;</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/accessDenied&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getAccessDeniedPage</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;accessDeniedPage&#34;</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="步骤3编写-ui-页面-thymeleaf">步骤#3：编写 UI 页面 (Thymeleaf)</h3>
<p>以下文件是 UI 页面。因此，仅将它们放在“src/main/resources/templates”文件夹中。</p>
<p>homepage.html</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">xmlns:th</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ISO-8859-1&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Insert title here&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h3</span>&gt;welcome to Home Page&lt;/<span style="color:#f92672">h3</span>&gt;
</span></span><span style="display:flex;"><span>    This page is accessible to ALL.
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>welcomePage.html</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">xmlns:th</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ISO-8859-1&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Insert title here&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h3</span>&gt;Welcome Page after successful Login&lt;/<span style="color:#f92672">h3</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/logout}&#34;</span>&gt;LOGOUT&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>adminPage.html</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">xmlns:th</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ISO-8859-1&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Insert title here&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h3</span>&gt;Admin Page&lt;/<span style="color:#f92672">h3</span>&gt;
</span></span><span style="display:flex;"><span>    Only Admins are allowed to access this page.!!!
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/logout}&#34;</span>&gt;LOGOUT&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>empPage.html</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">xmlns:th</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ISO-8859-1&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Insert title here&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h3</span>&gt;Employee Page&lt;/<span style="color:#f92672">h3</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/logout}&#34;</span>&gt;LOGOUT&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>mgrPage.html</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">xmlns:th</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ISO-8859-1&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Insert title here&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h3</span>&gt;Manager Page&lt;/<span style="color:#f92672">h3</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/logout}&#34;</span>&gt;LOGOUT&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>commonPage.html</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">xmlns:th</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ISO-8859-1&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Insert title here&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h3</span>&gt;COMMON Page&lt;/<span style="color:#f92672">h3</span>&gt;
</span></span><span style="display:flex;"><span>    Both Manager <span style="color:#960050;background-color:#1e0010">&amp;</span> Employee are allowed to access this page. !
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/logout}&#34;</span>&gt;LOGOUT&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>accessDeniedPage.html</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">xmlns:th</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ISO-8859-1&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Insert title here&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h3</span>&gt;You are not allowed to access this page. Please go to Welcome Page&lt;/<span style="color:#f92672">h3</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/welcome}&#34;</span>&gt;Welcome&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/logout}&#34;</span>&gt;LOGOUT&lt;/<span style="color:#f92672">a</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><h3 id="步骤4编写-securityconfig-类">步骤#4：编写 SecurityConfig 类</h3>
<p>此类对于实现包含所有安全相关逻辑的安全功能而言是最重要的。如下面的代码示例所示，如果我们不想对密码进行编码，我们可以在密码值之前使用“{noop}”。</p>
<h4 id="步骤4aspring-security-570-以下版本的代码">步骤#4A：Spring Security 5.7.0 以下版本的代码</h4>
<p>SecurityConfig.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.dev.springboot.security;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.web.util.matcher.AntPathRequestMatcher;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableWebSecurity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecurityConfig</span> <span style="color:#66d9ef">extends</span> WebSecurityConfigurerAdapter {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span>(AuthenticationManagerBuilder auth) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span> {noop} <span style="color:#f92672">=&gt;</span> No operation <span style="color:#66d9ef">for</span> password <span style="color:#a6e22e">encoder</span>	(no password encoding needed)
</span></span><span style="display:flex;"><span>		auth.<span style="color:#a6e22e">inMemoryAuthentication</span>().<span style="color:#a6e22e">withUser</span>(<span style="color:#e6db74">&#34;devs&#34;</span>).<span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#34;{noop}devs&#34;</span>).<span style="color:#a6e22e">authorities</span>(<span style="color:#e6db74">&#34;ADMIN&#34;</span>);
</span></span><span style="display:flex;"><span>		auth.<span style="color:#a6e22e">inMemoryAuthentication</span>().<span style="color:#a6e22e">withUser</span>(<span style="color:#e6db74">&#34;ns&#34;</span>).<span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#34;{noop}ns&#34;</span>).<span style="color:#a6e22e">authorities</span>(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>);
</span></span><span style="display:flex;"><span>		auth.<span style="color:#a6e22e">inMemoryAuthentication</span>().<span style="color:#a6e22e">withUser</span>(<span style="color:#e6db74">&#34;vs&#34;</span>).<span style="color:#a6e22e">password</span>(<span style="color:#e6db74">&#34;{noop}vs&#34;</span>).<span style="color:#a6e22e">authorities</span>(<span style="color:#e6db74">&#34;MANAGER&#34;</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span>(HttpSecurity http) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>declares which <span style="color:#a6e22e">Page</span>(URL) will have What access type
</span></span><span style="display:flex;"><span>		http.<span style="color:#a6e22e">authorizeRequests</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/home&#34;</span>).<span style="color:#a6e22e">permitAll</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>).<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/admin&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;ADMIN&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/emp&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/mgr&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;MANAGER&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/common&#34;</span>).<span style="color:#a6e22e">hasAnyAuthority</span>(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>,<span style="color:#e6db74">&#34;MANAGER&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span> Any other URLs which are not configured in above antMatchers
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span> generally declared <span style="color:#a6e22e">aunthenticated</span>() in real time
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">anyRequest</span>().<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>Login Form Details
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">formLogin</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">defaultSuccessUrl</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>, <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>Logout Form Details
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logout</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logoutRequestMatcher</span>(<span style="color:#66d9ef">new</span> AntPathRequestMatcher(<span style="color:#e6db74">&#34;/logout&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>Exception Details
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">exceptionHandling</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">accessDeniedPage</span>(<span style="color:#e6db74">&#34;/accessDenied&#34;</span>)
</span></span><span style="display:flex;"><span>		;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="步骤4bspring-security-57-以上版本和-spring-security-60-以下版本的代码">步骤#4B：Spring Security 5.7 以上版本和 Spring Security 6.0 以下版本的代码</h4>
<p>由于<a href="https://javatechonline.com/spring-security-without-websecurityconfigureradapter/" target="_blank">根据 Spring 官网发布的公告</a>，WebSecurityConfigurerAdapter 已从 Spring Security 5.7.0-M2 中弃用，因此，2022 年 2 月 21 日，我们将不使用 WebSecurityConfigurerAdapter 来编写 SecurityConfig 类，如下所示：</p>
<p>SecurityConfig.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.dev.springboot.security;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.ArrayList;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.GrantedAuthority;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.userdetails.User;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.userdetails.UserDetails;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.provisioning.InMemoryUserDetailsManager;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.web.SecurityFilterChain;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.web.util.matcher.AntPathRequestMatcher;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableWebSecurity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecurityConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">protected</span> InMemoryUserDetailsManager <span style="color:#a6e22e">configAuthentication</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		List<span style="color:#f92672">&lt;</span>UserDetails<span style="color:#f92672">&gt;</span> users <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>		List<span style="color:#f92672">&lt;</span>GrantedAuthority<span style="color:#f92672">&gt;</span> adminAuthority <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>		adminAuthority.<span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">new</span> SimpleGrantedAuthority(<span style="color:#e6db74">&#34;ADMIN&#34;</span>));
</span></span><span style="display:flex;"><span>		UserDetails admin<span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> User(<span style="color:#e6db74">&#34;devs&#34;</span>, <span style="color:#e6db74">&#34;{noop}devs&#34;</span>, adminAuthority);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">add</span>(admin);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		List<span style="color:#f92672">&lt;</span>GrantedAuthority<span style="color:#f92672">&gt;</span> employeeAuthority <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>		adminAuthority.<span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">new</span> SimpleGrantedAuthority(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>));
</span></span><span style="display:flex;"><span>		UserDetails employee<span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> User(<span style="color:#e6db74">&#34;ns&#34;</span>, <span style="color:#e6db74">&#34;{noop}ns&#34;</span>, employeeAuthority);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">add</span>(employee);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		List<span style="color:#f92672">&lt;</span>GrantedAuthority<span style="color:#f92672">&gt;</span> managerAuthority <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>		adminAuthority.<span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">new</span> SimpleGrantedAuthority(<span style="color:#e6db74">&#34;MANAGER&#34;</span>));
</span></span><span style="display:flex;"><span>		UserDetails manager<span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> User(<span style="color:#e6db74">&#34;vs&#34;</span>, <span style="color:#e6db74">&#34;{noop}vs&#34;</span>, managerAuthority);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">add</span>(manager);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> InMemoryUserDetailsManager(users);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">protected</span> SecurityFilterChain <span style="color:#a6e22e">filterChain</span>(HttpSecurity http) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>declares which <span style="color:#a6e22e">Page</span>(URL) will have What access type
</span></span><span style="display:flex;"><span>		http.<span style="color:#a6e22e">authorizeRequests</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/home&#34;</span>).<span style="color:#a6e22e">permitAll</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>).<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/admin&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;ADMIN&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/emp&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/mgr&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;MANAGER&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/common&#34;</span>).<span style="color:#a6e22e">hasAnyAuthority</span>(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>,<span style="color:#e6db74">&#34;MANAGER&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span> Any other URLs which are not configured in above antMatchers
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span> generally declared <span style="color:#a6e22e">aunthenticated</span>() in real time
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">anyRequest</span>().<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>Login Form Details
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">formLogin</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">defaultSuccessUrl</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>, <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>Logout Form Details
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logout</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logoutRequestMatcher</span>(<span style="color:#66d9ef">new</span> AntPathRequestMatcher(<span style="color:#e6db74">&#34;/logout&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>Exception Details
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">exceptionHandling</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">accessDeniedPage</span>(<span style="color:#e6db74">&#34;/accessDenied&#34;</span>)
</span></span><span style="display:flex;"><span>		;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> http.<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="步骤4cspring-security-600-及更高版本的代码spring-boot-30">步骤#4C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+）</h4>
<p>从 Spring Security 6.0（2022 年 11 月发布）开始，WebSecurityConfigurerAdapter 已从 Spring Security API 中完全删除。它还影响了 2022 年 11 月<a href="https://javatechonline.com/new-features-in-spring-boot-3-and-spring-6/" target="_blank">新发布的 Spring Boot 3.0</a>。因此，如果您使用 Spring Framework 6.0+ 或 Spring Boot 3.0+，无论哪种情况，SecurityConfig.java 的实现应如下所示。此外，您还可以检查<a href="https://javatechonline.com/how-to-migrate-spring-boot-2-to-spring-boot-3/#Review_Specific_to_Spring_Security_Dependency" target="_blank">Spring Framework 6.0 中与 Spring Security 相关的更改</a>。</p>
<p>SecurityConfig.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.dev.springboot.security;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.ArrayList;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.GrantedAuthority;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.userdetails.User;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.userdetails.UserDetails;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.provisioning.InMemoryUserDetailsManager;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.web.SecurityFilterChain;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.web.util.matcher.AntPathRequestMatcher;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableWebSecurity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecurityConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">protected</span> InMemoryUserDetailsManager <span style="color:#a6e22e">configAuthentication</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		List<span style="color:#f92672">&lt;</span>UserDetails<span style="color:#f92672">&gt;</span> users <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>		List<span style="color:#f92672">&lt;</span>GrantedAuthority<span style="color:#f92672">&gt;</span> adminAuthority <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>		adminAuthority.<span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">new</span> SimpleGrantedAuthority(<span style="color:#e6db74">&#34;ADMIN&#34;</span>));
</span></span><span style="display:flex;"><span>		UserDetails admin<span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> User(<span style="color:#e6db74">&#34;devs&#34;</span>, <span style="color:#e6db74">&#34;{noop}devs&#34;</span>, adminAuthority);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">add</span>(admin);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		List<span style="color:#f92672">&lt;</span>GrantedAuthority<span style="color:#f92672">&gt;</span> employeeAuthority <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>		adminAuthority.<span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">new</span> SimpleGrantedAuthority(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>));
</span></span><span style="display:flex;"><span>		UserDetails employee<span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> User(<span style="color:#e6db74">&#34;ns&#34;</span>, <span style="color:#e6db74">&#34;{noop}ns&#34;</span>, employeeAuthority);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">add</span>(employee);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		List<span style="color:#f92672">&lt;</span>GrantedAuthority<span style="color:#f92672">&gt;</span> managerAuthority <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>		adminAuthority.<span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">new</span> SimpleGrantedAuthority(<span style="color:#e6db74">&#34;MANAGER&#34;</span>));
</span></span><span style="display:flex;"><span>		UserDetails manager<span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> User(<span style="color:#e6db74">&#34;vs&#34;</span>, <span style="color:#e6db74">&#34;{noop}vs&#34;</span>, managerAuthority);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">add</span>(manager);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> InMemoryUserDetailsManager(users);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">protected</span> SecurityFilterChain <span style="color:#a6e22e">filterChain</span>(HttpSecurity http) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>declares which <span style="color:#a6e22e">Page</span>(URL) will have What access type
</span></span><span style="display:flex;"><span>		http.<span style="color:#a6e22e">authorizeHttpRequests</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/home&#34;</span>).<span style="color:#a6e22e">permitAll</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>).<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/admin&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;ADMIN&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/emp&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/mgr&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;MANAGER&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/common&#34;</span>).<span style="color:#a6e22e">hasAnyAuthority</span>(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>,<span style="color:#e6db74">&#34;MANAGER&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span> Any other URLs which are not configured in above antMatchers
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span> generally declared <span style="color:#a6e22e">aunthenticated</span>() in real time
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">anyRequest</span>().<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>Login Form Details
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">formLogin</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">defaultSuccessUrl</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>, <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>Logout Form Details
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logout</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logoutRequestMatcher</span>(<span style="color:#66d9ef">new</span> AntPathRequestMatcher(<span style="color:#e6db74">&#34;/logout&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">/</span>Exception Details
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">exceptionHandling</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">accessDeniedPage</span>(<span style="color:#e6db74">&#34;/accessDenied&#34;</span>)
</span></span><span style="display:flex;"><span>		;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> http.<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>注意：在上面的代码中，观察 Spring Security 6.0 中的 API 变化：antMatchers()被 requestMatchers()替换，authorizeRequests()被 authorizeHttpRequests()替换。</p>
<p>您的项目结构将如下图所示。</p>
<p><img src="../../../static/images/SpringSecurity6.webp" alt="img"></p>
<h2 id="如何实现-jdbc-身份验证安全性示例">如何实现 JDBC 身份验证安全性示例</h2>
<p>在这种身份验证方法中，我们根据数据库中的现有值验证凭据和角色。此外，在此示例中，我们还将研究密码加密逻辑。首先，我们将在数据库中插入一些虚拟数据，然后相应地测试安全功能。归根结底，如果我们比较前面示例的功能，我们将把用户凭据和角色保存到数据库而不是 RAM 中。</p>
<p>此外，在此示例中，我们将提供用于实现密码加密逻辑的附加代码。因此，上一个示例中的所有文件在此示例中也将有效。</p>
<p>此外，我们将有一个配置类来创建 BCryptPasswordEncoder 对象来对密码进行编码，并在 application.properties 中创建数据库属性条目以连接数据库。不用说，SecurityConfig 类的实现这次会有所不同。</p>
<h3 id="使用的软件技术">使用的软件/技术</h3>
<ul>
<li>STS (Spring Tool Suite) : Version-&gt; 4.7.1.RELEASE</li>
<li>MySQL Database : Version -&gt;8.0.19 MySQL Community Server</li>
<li>JDK14 (JDK8 or later versions are sufficient)</li>
</ul>
<h3 id="步骤1在数据库中插入一些虚拟记录">步骤#1：在数据库中插入一些虚拟记录</h3>
<p>请注意，此步骤仅用于测试目的。如果您最近已经使用用户凭据和角色映射创建了数据库，请忽略此步骤。在步骤#1A 中，我们将创建一些密码编码值，然后在步骤#1B 中将它们插入到数据库中。</p>
<h4 id="步骤1a使用-bcryptpasswordencoder-创建编码密码值">步骤#1A：使用 BCryptPasswordEncoder 创建编码密码值</h4>
<p>我们将使用 BCryptPasswordEncoder 生成一些编码密码值，如下所示</p>
<p>BCryptPasswordEncoderTest.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.dev.springboot.security.util;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BCryptPasswordEncoderTest</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>		BCryptPasswordEncoder bpe <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BCryptPasswordEncoder();
</span></span><span style="display:flex;"><span>		String encodedPWD <span style="color:#f92672">=</span> bpe.<span style="color:#a6e22e">encode</span>(<span style="color:#e6db74">&#34;devs@A!5003&#34;</span>);
</span></span><span style="display:flex;"><span>		System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(encodedPWD);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>输出</p>
<pre tabindex="0"><code>$2a$10$qnOB2PH1CqRvw8f5epvHzOlrounRkVGi.Y5ho6ENdmj/C1DmPdAsy
</code></pre><h4 id="步骤1b创建数据库并插入虚拟记录">步骤#1B：创建数据库并插入虚拟记录</h4>
<p>执行 MySQL DB 命令如下：</p>
<pre tabindex="0"><code>To create the database as &#39;testbootsecurity&#39;
♦ create database testbootsecurity;
To take &#39;testbootsecurity&#39; in use:
♦ use testbootsecurity;
To create the user table:
♦ create table user (user_id int, user_name varchar(30), user_pwd varchar(100), user_role varchar(20), user_enabled int);
To check the description of user table:
♦ desc user;
INSERT INTO user values(501,&#39;devs&#39;,&#39;$2a$10$qnOB2PH1CqRvw8f5epvHzOlrounRkVGi.Y5ho6ENdmj/C1DmPdAsy&#39;,&#39;ADMIN&#39;,1);
INSERT INTO user values(502,&#39;ns&#39;,&#39;$2a$10$mmUMC5ZwoVnEQYV7/R6m.uWWtj7EiIo3lKasBObkOCc12huVUWpMC&#39;,&#39;EMPLOYEE&#39;,1);
INSERT INTO user values(503,&#39;vs&#39;,&#39;$2a$10$kqEC/fhQ7SNDhnncOQ9pb.yXXxJ/c7a1SQx2QPNZ.47fUmvF3Wb.i&#39;,&#39;MANAGER&#39;,1);
♦ select * from user;  (To check if values are inserted into DB)
</code></pre><p>此外，在实现 SecurityConfig.java 类的 configure(AuthenticationManagerBuilder auth) 方法时，我们将需要以下两个查询。</p>
<pre tabindex="0"><code>Query#1 : Retrieve username,password,enabled using username ;

♦ select user_name,user_pwd,user_enabled from user where user_name=?;

Query#2 : Retrieve username,role using username;

♦ select user_name,user_role from user where user_name=?;
</code></pre><h3 id="步骤2在-sts中创建一个-spring-boot-starter-项目">步骤#2：在 STS中创建一个 Spring Boot Starter 项目</h3>
<p>创建入门项目时，选择“Spring Security”、“Thymeleaf”、“Spring Web”、“JDBC API”、“MySQL Driver”和“Spring Boot DevTools”作为入门项目依赖项。</p>
<h3 id="步骤3从上一个示例复制控制器类和-ui-页面">步骤#3：从上一个示例复制控制器类和 UI 页面</h3>
<p>复制 HomeController.java 以及前面示例中的所有 thymeleaf 页面。</p>
<h3 id="步骤4创建-appconfigjava-以创建-bcryptpasswordencoder-对象">步骤#4：创建 AppConfig.java 以创建 BCryptPasswordEncoder 对象</h3>
<p>如下创建 AppConfig.java。在实现 SecurityConfig.java 类时，我们将需要 BCryptPasswordEncoder 对象。</p>
<p>AppConfig.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.dev.springboot.security.jdbc.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> BCryptPasswordEncoder <span style="color:#a6e22e">encode</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> BCryptPasswordEncoder();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="步骤5更新-applicationproperties-文件中的数据库属性">步骤#5：更新 application.properties 文件中的数据库属性</h3>
<p>更新 application.properties 以连接到 MySQL DB，如下所示。请注意，我们可以省略 driver-class-name，因为 Spring Boot 会自动从数据库 URL 中找到它。</p>
<pre tabindex="0"><code>#application.properties
-------------------------------------------------------------------
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/testBootSecurity
spring.datasource.username=root
spring.datasource.password=devs
</code></pre><h3 id="步骤6更新-securityconfigjava">步骤#6：更新 SecurityConfig.java</h3>
<p>从前面的示例中复制 SecurityConfig.java 并更新 configure( AuthenticationManagerBuilder auth) 方法，如下所示。</p>
<h4 id="步骤6aspring-security-570-以下版本的代码">步骤#6A：Spring Security 5.7.0 以下版本的代码</h4>
<p>SecurityConfig.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.dev.springboot.security.jdbc.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.sql.DataSource;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.web.util.matcher.AntPathRequestMatcher;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableWebSecurity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecurityConfig</span> <span style="color:#66d9ef">extends</span> WebSecurityConfigurerAdapter {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> DataSource dataSource;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> BCryptPasswordEncoder passwordEncoder;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span>(AuthenticationManagerBuilder auth) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		auth.<span style="color:#a6e22e">jdbcAuthentication</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">dataSource</span>(dataSource)     <span style="color:#f92672">/</span>creates database connection
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">usersByUsernameQuery</span>(<span style="color:#e6db74">&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">authoritiesByUsernameQuery</span>(<span style="color:#e6db74">&#34;select user_name,user_role from user where user_name=?&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">passwordEncoder</span>(passwordEncoder);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configure</span>(HttpSecurity http) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		http.<span style="color:#a6e22e">authorizeRequests</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/home&#34;</span>).<span style="color:#a6e22e">permitAll</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>).<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/admin&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;ADMIN&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/emp&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/mgr&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;MANAGER&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">anyRequest</span>().<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">formLogin</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">defaultSuccessUrl</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>,<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logout</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logoutRequestMatcher</span>(<span style="color:#66d9ef">new</span> AntPathRequestMatcher(<span style="color:#e6db74">&#34;/logout&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">exceptionHandling</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">accessDeniedPage</span>(<span style="color:#e6db74">&#34;/accessDenied&#34;</span>)
</span></span><span style="display:flex;"><span>		;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="步骤6bspring-security-570-以上版本和-spring-security-600-以下版本的代码">步骤#6B：Spring Security 5.7.0 以上版本和 Spring Security 6.0.0 以下版本的代码</h4>
<p>由于根据 Spring 官网发布的公告，<a href="https://javatechonline.com/spring-security-without-websecurityconfigureradapter/" target="_blank">WebSecurityConfigurerAdapter 已从 Spring Security 5.7.0-M2 中弃用</a>，因此，2022 年 2 月 21 日，我们将不使用 WebSecurityConfigurerAdapter 来编写 SecurityConfig 类，如下所示：</p>
<p>SecurityConfig.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.dev.springboot.security.jdbc.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.sql.DataSource;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.userdetails.User;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.userdetails.UserDetails;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.crypto.factory.PasswordEncoderFactories;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.provisioning.JdbcUserDetailsManager;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.provisioning.UserDetailsManager;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.web.SecurityFilterChain;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.web.util.matcher.AntPathRequestMatcher;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableWebSecurity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecurityConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> DataSource dataSource;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> BCryptPasswordEncoder passwordEncoder;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> UserDetailsManager <span style="color:#a6e22e">authenticateUsers</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		UserDetails user <span style="color:#f92672">=</span> User.<span style="color:#a6e22e">withUsername</span>(<span style="color:#e6db74">&#34;devs&#34;</span>).
</span></span><span style="display:flex;"><span>				password(PasswordEncoderFactories.<span style="color:#a6e22e">createDelegatingPasswordEncoder</span>().<span style="color:#a6e22e">encode</span>(<span style="color:#e6db74">&#34;password&#34;</span>)).<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>		JdbcUserDetailsManager users <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JdbcUserDetailsManager(dataSource);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">setAuthoritiesByUsernameQuery</span>(<span style="color:#e6db74">&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span>);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">setUsersByUsernameQuery</span>(<span style="color:#e6db74">&#34;select user_name,user_role from user where user_name=?&#34;</span>);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">createUser</span>(user);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> users;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">protected</span> SecurityFilterChain <span style="color:#a6e22e">filterChain</span>(HttpSecurity http) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		http.<span style="color:#a6e22e">authorizeRequests</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/home&#34;</span>).<span style="color:#a6e22e">permitAll</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>).<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/admin&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;ADMIN&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/emp&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">antMatchers</span>(<span style="color:#e6db74">&#34;/mgr&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;MANAGER&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">anyRequest</span>().<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">formLogin</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">defaultSuccessUrl</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>,<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logout</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logoutRequestMatcher</span>(<span style="color:#66d9ef">new</span> AntPathRequestMatcher(<span style="color:#e6db74">&#34;/logout&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">exceptionHandling</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">accessDeniedPage</span>(<span style="color:#e6db74">&#34;/accessDenied&#34;</span>)
</span></span><span style="display:flex;"><span>		;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> http.<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="步骤6cspring-security-600-及更高版本的代码spring-boot-30">步骤#6C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+）</h4>
<p>从 Spring Security 6.0（2022 年 11 月发布）开始，WebSecurityConfigurerAdapter 已从 Spring Security API 中完全删除。它还影响了 2022 年 11 月新发布的 Spring Boot 3.0。因此，如果您使用 Spring Framework 6.0+ 或 Spring Boot 3.0+，无论哪种情况，SecurityConfig.java 的实现应如下所示。此外，您还可以检查 Spring Framework 6.0 中与 Spring Security 相关的更改。</p>
<p>SecurityConfig.java</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.dev.springboot.security.jdbc.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.sql.DataSource;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.userdetails.User;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.core.userdetails.UserDetails;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.crypto.factory.PasswordEncoderFactories;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.provisioning.JdbcUserDetailsManager;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.provisioning.UserDetailsManager;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.web.SecurityFilterChain;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.security.web.util.matcher.AntPathRequestMatcher;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableWebSecurity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SecurityConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> DataSource dataSource;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> BCryptPasswordEncoder passwordEncoder;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> UserDetailsManager <span style="color:#a6e22e">authenticateUsers</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		UserDetails user <span style="color:#f92672">=</span> User.<span style="color:#a6e22e">withUsername</span>(<span style="color:#e6db74">&#34;devs&#34;</span>).
</span></span><span style="display:flex;"><span>				password(PasswordEncoderFactories.<span style="color:#a6e22e">createDelegatingPasswordEncoder</span>().<span style="color:#a6e22e">encode</span>(<span style="color:#e6db74">&#34;password&#34;</span>)).<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>		JdbcUserDetailsManager users <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JdbcUserDetailsManager(dataSource);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">setAuthoritiesByUsernameQuery</span>(<span style="color:#e6db74">&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span>);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">setUsersByUsernameQuery</span>(<span style="color:#e6db74">&#34;select user_name,user_role from user where user_name=?&#34;</span>);
</span></span><span style="display:flex;"><span>		users.<span style="color:#a6e22e">createUser</span>(user);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> users;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">protected</span> SecurityFilterChain <span style="color:#a6e22e">filterChain</span>(HttpSecurity http) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		http.<span style="color:#a6e22e">authorizeHttpRequests</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/home&#34;</span>).<span style="color:#a6e22e">permitAll</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>).<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/admin&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;ADMIN&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/emp&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;EMPLOYEE&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">requestMatchers</span>(<span style="color:#e6db74">&#34;/mgr&#34;</span>).<span style="color:#a6e22e">hasAuthority</span>(<span style="color:#e6db74">&#34;MANAGER&#34;</span>)
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">anyRequest</span>().<span style="color:#a6e22e">authenticated</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">formLogin</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">defaultSuccessUrl</span>(<span style="color:#e6db74">&#34;/welcome&#34;</span>,<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logout</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">logoutRequestMatcher</span>(<span style="color:#66d9ef">new</span> AntPathRequestMatcher(<span style="color:#e6db74">&#34;/logout&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">and</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">exceptionHandling</span>()
</span></span><span style="display:flex;"><span>		.<span style="color:#a6e22e">accessDeniedPage</span>(<span style="color:#e6db74">&#34;/accessDenied&#34;</span>)
</span></span><span style="display:flex;"><span>		;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> http.<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>注意：在上面的代码中，观察 Spring Security 6.0 中的 API 变化：antMatchers()被 requestMatchers()替换，authorizeRequests()被 authorizeHttpRequests()替换。</p>
<h2 id="如何测试启用安全的应用程序">如何测试启用安全的应用程序？</h2>
<p>同时完成大量理论和编码步骤之后，是时候测试“如何在 Spring Boot 项目中实现安全性？”了。请按照以下步骤操作。</p>
<ol>
<li>
<p>启动应用程序，然后右键单击该项目，然后选择“Run As”&raquo;“Spring Boot App”。</p>
</li>
<li>
<p>输入首页网址 http://localhost:8080/home，检查是否存在每个人都可以访问，甚至无需登录应用程序。</p>
</li>
<li>
<p>输入管理页面 URL http://localhost:8080/admin，然后它应该被重定向到内置登录页面（由 Spring Security 提供）</p>
</li>
<li>
<p>使用提供的管理员凭据登录，您将被重定向到欢迎页面。</p>
</li>
<li>
<p>输入 URL http://localhost:8080/admin，然后您就可以看到管理页面了。</p>
</li>
<li>
<p>当您使用管理员凭据登录时，您还可以通过点击其他页面 URL 来查看所有页面。</p>
</li>
</ol>
<p>随后对其他角色也重复上述步骤并检查用户是否可以根据授予的角色访问该页面。</p>
<h2 id="spring-boot-项目如何实现安全性-spring-boot-30-及以上">Spring Boot 项目如何实现安全性？ ：Spring Boot 3.0 及以上</h2>
<p>Spring Boot 3.0 在 Spring Security 模块中进行了重大 API 级别更改。因此，如果您使用 Spring Boot 3.0 或更高版本，则需要遵循以下指南以及使用 JDK 17。</p>
<ol>
<li>在 SecurityConfig.java 中：</li>
</ol>
<ul>
<li>
<p>使用 authorizeHttpRequests()代替 authorizeRequests()</p>
</li>
<li>
<p>使用 requestMatchers() 代替 antMatchers()</p>
</li>
<li>
<p>使用 RegexRequestMatchers() 代替 regexMatchers()</p>
</li>
</ul>
<ol start="2">
<li>在实体类中：</li>
</ol>
<ul>
<li>在 import 语句中，使用“jakarta”代替“javax”。例如：使用“jakarta.persistence.Entity;”代替“javax.persistence.Entity;”。</li>
</ul>
<h2 id="faq">FAQ</h2>
<h3 id="如何禁用应用程序的安全功能">如何禁用应用程序的安全功能？</h3>
<p>同样重要的是，有时我们需要禁用安全功能，特别是在开发和测试环境中，以避免再次输入凭据。为此，我们可以相应地在 pom.xml 文件中注释以下两个依赖项。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;dependency&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;/dependency&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;dependency&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;/dependency&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--&gt;</span>
</span></span></code></pre></div><h2 id="概括">概括</h2>
<p>随后，通过“如何在 Spring Boot 项目中实现安全性？”的所有理论和示例部分，最后，我们能够在 Spring Boot 项目中实现 Web 安全性。当然，在本文中我们介绍了两种实现安全功能的方法。此外，我们可以在<a href="https://javatechonline.com/how-to-implement-security-in-spring-boot-using-userdetailsservice/" target="_blank">另一篇文章</a>中了解 UserDetailsS​​ervice（实现安全性的第三种方式）。此外，有关 Spring Boot Security 的完整教程请访问<a href="https://javatechonline.com/spring-boot/#Spring_Boot_Security" target="_blank">此处</a>。后续如有更新，我们也会及时更新。也请随时在下面的评论部分提供您的意见。</p>
<p>原文链接：<a href="https://javatechonline.com/how-to-implement-security-in-spring-boot-project/" target="_blank">https://javatechonline.com/how-to-implement-security-in-spring-boot-project/</a></p>

		</div>


	</article>
</main>
<footer class="post__footer">
	

<div class="post-related">
	<h3>相关文章</h3>
	<ul class="post-related-list">
		
		<li class="post-related-item">
			<a href="/posts/2023/08/18/how-to-implement-jwt-authentication-in-spring-boot-project/" target="_blank" title="[译]Spring Boot项目如何实现JWT认证？">[译]Spring Boot项目如何实现JWT认证？</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2023/08/18/how-to-implement-security-in-spring-boot2-using-userdetailsservice/" target="_blank" title="[译]如何在Spring Boot2中使用UserDetailsService实现安全性？">[译]如何在Spring Boot2中使用UserDetailsService实现安全性？</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2023/08/18/how-to-implement-security-in-spring-boot3-using-userdetailsservice/" target="_blank" title="[译]如何在Spring Boot3中使用UserDetailsService实现安全性？">[译]如何在Spring Boot3中使用UserDetailsService实现安全性？</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/" target="_blank" title="[译]没有WebSecurityConfigurerAdapter的Spring Security.md">[译]没有WebSecurityConfigurerAdapter的Spring Security.md</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2023/08/16/spring-security-with-jwt/" target="_blank" title="[译]Spring Security - JWT">[译]Spring Security - JWT</a>
		</li>
		
		<li class="post-related-item">
			<a href="/posts/2023/08/16/spring-security-with-oauth2/" target="_blank" title="[译]Spring Security - OAuth2">[译]Spring Security - OAuth2</a>
		</li>
		
	</ul>
</div>

</footer>

<footer class="post__footer">
	<footer class="post__footer">
		
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/mysql/" rel="tag">mysql</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/java/" rel="tag">java</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/backend/" rel="tag">backend</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/security/" rel="tag">security</a>
		</li>
	</ul>
</div>
	</footer>
</footer>


<nav class="pagination flex">
	<div class="pagination__item pagination__item--prev">
		<a class="pagination__link" href="/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/" rel="prev">
			<p class="pagination__title">«&thinsp;上一篇: [译]没有WebSecurityConfigurerAdapter的Spring Security.md</p>
		</a>
	</div>
	<div class="pagination__item pagination__item--next">
		<a class="pagination__link" href="/posts/2023/08/18/how-to-implement-jwt-authentication-in-spring-boot-project/" rel="next">
			<p class="pagination__title">&thinsp;» 下一篇: [译]Spring Boot项目如何实现JWT认证？</p>
		</a>
	</div>
</nav>



<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="ChenSoul avatar" src="/avatar.jpg" class="avatar" height="60" width="60" loading="lazy">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">关于 ChenSoul</span>
	</div>
	<div class="authorbox__description">
		一个来自中国武汉的开发者，主要撰写软件开发和开源方面的文章。浏览我的<a href="%28/posts%29">博客文章</a>，订阅我的 <a href="/index.xml">RSS</a> 源，或了解更多<a href="/about/">关于我</a>的信息。
	</div>
</div>




	<p><h3>欢迎留言！</h3></p>
<div id="remark42"></div>
<script>
	var remark_config = {
		host: 'https:\/\/comment.chensoul.cc',
		site_id: 'remark',
		components: ['embed'],
		url: 'https:\/\/blog.chensoul.cc\/posts\/2023\/08\/18\/how-to-implement-security-in-spring-boot-project\/',
		locale: 'zh'
	};

	!function(e, n) {
		for (var o = 0; o < e.length; o++) {
			var r = n.createElement('script'),
			c = '.js',
			d = n.head || n.body;
			'noModule' in r ? (r.type = 'module', c = '.mjs') : r.async = !0, r.defer = !0, r.src = remark_config.host + '/web/' + e[o] + c, d.appendChild(r)
		}
	}(remark_config.components || ['embed'], document);

</script>





			</div>
			

<aside class="sidebar sidebar--right">
	<div class="post__toc toc">
		<div class="toc__title">目录</div>
		<div class="toc__menu">
			<nav id="TableOfContents">
  <ul>
    <li><a href="#您将从本文中学到什么">您将从本文中学到什么？</a></li>
    <li><a href="#为什么我们需要应用程序中的安全性">为什么我们需要应用程序中的安全性？</a></li>
    <li><a href="#spring-boot-应用程序内部安全性如何工作">Spring Boot 应用程序内部安全性如何工作？</a></li>
    <li><a href="#spring-boot-应用程序使用了多少种授权类型">Spring Boot 应用程序使用了多少种授权类型？</a>
      <ul>
        <li><a href="#1-permitall">1) permitAll</a></li>
        <li><a href="#2-authenticated">2) authenticated</a></li>
        <li><a href="#3-hasauthority">3) hasAuthority</a></li>
        <li><a href="#4-hasanyauthority">4) hasAnyAuthority</a></li>
      </ul>
    </li>
    <li><a href="#在-spring-boot-web-应用程序中实现安全性有哪些不同的方法">在 Spring Boot Web 应用程序中实现安全性有哪些不同的方法？</a>
      <ul>
        <li><a href="#in-memory-security">In-Memory Security</a></li>
        <li><a href="#使用数据库">使用数据库</a></li>
        <li><a href="#使用用户详细信息服务">使用用户详细信息服务</a></li>
      </ul>
    </li>
    <li><a href="#在-spring-boot-应用程序中实现-web-安全的步骤是什么">在 Spring Boot 应用程序中实现 Web 安全的步骤是什么？</a></li>
    <li><a href="#如何实现内存中身份验证安全性的示例">如何实现内存中身份验证安全性的示例</a>
      <ul>
        <li><a href="#softwaretechnologies-used-使用的软件技术">Software/Technologies Used 使用的软件/技术</a></li>
        <li><a href="#步骤1在-stsspring-tool-suite中创建一个-spring-boot-starter-项目">步骤#1：在 STS(Spring Tool Suite)中创建一个 Spring Boot Starter 项目</a></li>
        <li><a href="#步骤2编写控制器类">步骤#2：编写控制器类</a></li>
        <li><a href="#步骤3编写-ui-页面-thymeleaf">步骤#3：编写 UI 页面 (Thymeleaf)</a></li>
        <li><a href="#步骤4编写-securityconfig-类">步骤#4：编写 SecurityConfig 类</a></li>
      </ul>
    </li>
    <li><a href="#如何实现-jdbc-身份验证安全性示例">如何实现 JDBC 身份验证安全性示例</a>
      <ul>
        <li><a href="#使用的软件技术">使用的软件/技术</a></li>
        <li><a href="#步骤1在数据库中插入一些虚拟记录">步骤#1：在数据库中插入一些虚拟记录</a></li>
        <li><a href="#步骤2在-sts中创建一个-spring-boot-starter-项目">步骤#2：在 STS中创建一个 Spring Boot Starter 项目</a></li>
        <li><a href="#步骤3从上一个示例复制控制器类和-ui-页面">步骤#3：从上一个示例复制控制器类和 UI 页面</a></li>
        <li><a href="#步骤4创建-appconfigjava-以创建-bcryptpasswordencoder-对象">步骤#4：创建 AppConfig.java 以创建 BCryptPasswordEncoder 对象</a></li>
        <li><a href="#步骤5更新-applicationproperties-文件中的数据库属性">步骤#5：更新 application.properties 文件中的数据库属性</a></li>
        <li><a href="#步骤6更新-securityconfigjava">步骤#6：更新 SecurityConfig.java</a></li>
      </ul>
    </li>
    <li><a href="#如何测试启用安全的应用程序">如何测试启用安全的应用程序？</a></li>
    <li><a href="#spring-boot-项目如何实现安全性-spring-boot-30-及以上">Spring Boot 项目如何实现安全性？ ：Spring Boot 3.0 及以上</a></li>
    <li><a href="#faq">FAQ</a>
      <ul>
        <li><a href="#如何禁用应用程序的安全功能">如何禁用应用程序的安全功能？</a></li>
      </ul>
    </li>
    <li><a href="#概括">概括</a></li>
  </ul>
</nav>
		</div>
	</div>
</aside>

		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
<div class="footer__links">
	<a class="footer__link" href="/">首页</a> | <a class="footer__link" href="/categories/">分类</a> | <a class="footer__link" href="/tags/">标签</a> | <a class="footer__link" href="/index.xml">订阅</a> | <a class="footer__link" href="/about/">关于</a>
</div>
		<div class="footer__copyright">
			&copy; 2025 ChenSoul.
			<span class="footer__copyright-credits">基于 <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> 引擎和 <a href="https://github.com/chensoul/rose-hugo/" rel="nofollow noopener" target="_blank">Rose Hugo</a> 主题</span>
		</div>
	</div>

	






<style>
	.scroll-up a {
		display: block;
		height: 3.125rem;
		width: 3.125rem;
		text-align: center;
		line-height: 2.7;
		border-radius: 50px;
		font-size: 1.125rem;
		color: #fff;
		opacity: 1;
		transition: all 0.3s ease 0s;
		box-shadow: 0 0 10px rgb(0 0 0 / 20%);
	}
	.scroll-up a {
		background: #ee591f;
	}
	.scroll-up {
		position: fixed;
		display: none;
		bottom: 50px;
		z-index: 999;
	}
	.scroll-up.right {
		right: 60px;
	}
</style>

<div class="scroll-up custom right" style="display: block;"><a href="#top" id="top-link" accesskey="g"><i
	class="fa fa-arrow-up"></i></a></div>

<script>
	var mybutton = document.getElementById("top-link");
	window.onscroll = function () {
		if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
			mybutton.style.visibility = "visible";
			mybutton.style.opacity = "1";
		} else {
			mybutton.style.visibility = "hidden";
			mybutton.style.opacity = "0";
		}
	};
</script>


    <script defer src="https://umami.chensoul.cc/random-string.js" data-website-id="1e07d36d-bec3-4ba6-9459-876b1ac3bbe7"></script>
</footer>


	</div>

	<script>
		'use strict';
		(function iifeMenu(document, window, undefined) {
			var menuBtn = document.querySelector('.menu__btn');
			var	menu = document.querySelector('.menu__list');
			function toggleMenu() {
				menu.classList.toggle('menu__list--active');
				menu.classList.toggle('menu__list--transition');
				this.classList.toggle('menu__btn--active');
				this.setAttribute(
					'aria-expanded',
					this.getAttribute('aria-expanded') === 'true' ? 'false' : 'true'
				);
			}
			function removeMenuTransition() {
				this.classList.remove('menu__list--transition');
			}
			if (menuBtn && menu) {
				menuBtn.addEventListener('click', toggleMenu, false);
				menu.addEventListener('transitionend', removeMenuTransition, false);
			}
		}(document, window));
	</script>
</body>
</html>