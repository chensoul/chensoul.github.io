/* ========== 字体 ========== */
@import "@fontsource/noto-sans-sc/400.css";
@import "@fontsource/noto-sans-sc/700.css";
@import "@fontsource/noto-sans-sc/800.css";
@import "@fontsource/noto-sans/400.css";
@import "@fontsource/noto-sans/400-italic.css";
@import "@fontsource/noto-sans/700.css";
@import "@fontsource/roboto-mono/400.css";
@import "@fontsource/roboto-mono/400-italic.css";
@import "@fontsource/roboto-mono/600.css";
@font-face {
  font-family: "Fallback Sans";
  src:
    local("Microsoft YaHei"), local("PingFang SC"), local("Hiragino Sans GB"),
    local("Noto Sans CJK SC"), local("Source Han Sans SC"),
    local("WenQuanYi Micro Hei");
  size-adjust: 100%;
  ascent-override: 90%;
  descent-override: 22%;
  line-gap-override: 0%;
}

/* ========== 主题（Tailwind @theme + 组件覆盖） ========== */
@theme inline {
  --color-background: var(--background-secondary);
  --color-content-background: var(--background);
  --color-foreground: var(--text-primary);
  --color-accent: var(--accent);
  --color-muted: rgb(var(--gray-light));
  --color-text-muted: var(--text-secondary);
  --color-border: var(--border);
}

/* ========== 基础层 ========== */
@layer base {
  * {
    @apply border-border outline-accent/75;
    scrollbar-width: auto;
    scrollbar-color: color-mix(
        in srgb,
        var(--color-muted) 80%,
        var(--color-foreground) 20%
      )
      transparent;
  }
  html {
    @apply overflow-y-scroll scroll-smooth;
    background-color: var(--background-secondary);
    transition: background-color 0s;
    /* 与 Layout 内联的 visibility:hidden 配合：带主题的 CSS 加载后即显示，避免首屏闪白 */
    visibility: visible;
  }
  body {
    @apply flex min-h-svh flex-col font-sans text-foreground selection:bg-accent/75 selection:text-background;
    font-family: var(--font-sans), var(--font-emoji);
    background-color: var(--background-secondary);
    transition: background-color 0s;
  }
  #site-frame {
    background-color: var(--background);
    box-shadow: var(--shadow-frame);
  }
  a,
  button {
    @apply outline-offset-1 outline-accent focus-visible:no-underline focus-visible:outline-2;
  }
  button:not(:disabled),
  [role="button"]:not(:disabled) {
    cursor: pointer;
  }
}

.active-nav {
  color: var(--accent) !important;
  font-weight: 600;
}

@layer utilities {
  #sidebar {
    @apply fixed z-40 transform overflow-y-auto text-sm;
    background-color: var(--background);
  }

  @media (max-width: 1023px) {
    #sidebar {
      @apply fixed top-0 right-0 bottom-0 left-auto flex h-full max-h-none w-4/5 max-w-70 translate-x-full flex-col justify-end rounded-none p-6 pb-8;
    }

    #sidebar.mobile-open {
      @apply translate-x-0;
    }
  }

  @media (min-width: 1300px) {
    /* TOC 在 site-frame 外，固定于视口右侧，与主内容区同色 */
    #sidebar {
      position: fixed;
      top: 6rem;
      right: 4.5rem;
      background-color: var(--background);
      @apply z-40 m-0 max-h-[calc(100vh-8rem)] w-40 translate-x-0 rounded-lg p-4 shadow-none;
    }

    @media (min-width: 1280px) {
      #sidebar {
        @apply w-56;
      }
    }
  }

  #sidebar #back-to-top svg,
  #sidebar #back-to-top span {
    color: var(--text-primary);
  }
}

/* Source: https://piccalil.li/blog/a-more-modern-css-reset/ */
/* Anything that has been anchored to should have extra scroll margin */
:target {
  scroll-margin-block: 1rem;
}

/* TOC 覆盖样式已移至 Toc.astro variant="head" 内联，紧接 tocbot CSS 之后，避免 FOUC */