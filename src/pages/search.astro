---
/**
 * 搜索页
 *
 * @fileoverview 全站搜索功能，使用 Pagefind 实现
 *
 * 核心逻辑：
 * 1. 使用 Pagefind 提供全文搜索
 * 2. 搜索关键词存储在 URL 参数 `q` 中
 * 3. 从 URL 读取关键词并自动触发搜索
 * 4. 存储搜索 URL 到 sessionStorage（返回按钮使用）
 *
 * Pagefind 配置：
 * - showSubResults: true - 显示嵌套结果
 * - showImages: false - 不显示缩略图
 * - processResult: 移除 URL 中的 .html 后缀
 *
 * 开发模式提示：
 * - 开发环境需要先构建项目才能使用搜索
 * - 显示警告信息提示运行 pnpm run build
 *
 * 依赖关系：
 * - 被 /search 路径访问
 * - 使用 @pagefind/default-ui 包
 * - 需要运行 pnpm run build 生成搜索索引
 */

import "@pagefind/default-ui/css/ui.css";
import Main from "@/layouts/Main.astro";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { SITE } from "@/config";
import { _t } from "@/i18n/lang";
import searchStyles from "@/styles/search.css?raw";

// 返回 URL 配置
const backUrl = SITE.showBackButton ? `${Astro.url.pathname}` : "/";
---

<Layout title={`${_t.search.title} | ${SITE.title}`}>
  <Header />
  <Main pageTitle="" pageDesc={_t.search.desc}>
    <!-- Pagefind 搜索容器 -->
    <div id="pagefind-search" transition:persist data-backurl={backUrl}></div>
  </Main>
  <Footer />
</Layout>

<style is:global set:html={searchStyles} />

<script>
  import "@/scripts/initSearch";
</script>
