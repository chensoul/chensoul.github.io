---
/**
 * 年度进度条组件
 *
 * @fileoverview 显示当前年度已过时间的百分比进度条
 *
 * 核心逻辑：
 * 1. 计算当前时间在全年中的百分比
 * 2. 动画效果：仅首次访问/刷新时执行，页面切换时直接显示
 * 3. 交互功能：
 *    - 悬停显示百分比标签
 *    - 点击显示剩余天数提示
 * 4. 自动隐藏：动画结束后 2 秒隐藏标签
 *
 * 依赖关系：
 * - 被 Header.astro 导入，在导航栏下方显示
 * - 使用 CSS 变量 --accent 控制填充色
 */
---

<div
  id="year-progress"
  class="year-progress group relative mx-auto mb-5 w-full max-w-4xl sm:mb-0"
>
  <!-- 进度条背景（使用主题变量，随 data-theme 切换） -->
  <div class="year-progress-track h-[3px] w-full rounded" aria-hidden="true">
    <!-- 进度条填充（宽度由 JS 动态设置，颜色由 CSS 变量控制以适配主题） -->
    <div
      id="year-progress-fill"
      class="year-progress-fill h-[3px] w-0 rounded"
    >
    </div>
  </div>
  <!-- 标签遮罩（用于隐藏进度条） -->
  <span
    id="year-progress-cover"
    class="pointer-events-none absolute top-1/2 left-0 z-10 h-[3px] -translate-y-1/2 rounded bg-background opacity-0 transition-opacity duration-[1000ms] ease-out"
  ></span>
  <!-- 百分比标签 -->
  <span
    id="year-progress-label"
    class="pointer-events-none absolute top-1/2 left-0 z-20 -translate-y-1/2 text-xs whitespace-nowrap text-accent opacity-0 transition-opacity duration-[1000ms] ease-out"
  ></span>
  <!-- 点击弹窗（剩余天数） -->
  <div
    id="year-progress-popup"
    class="pointer-events-none absolute top-0 left-0 z-30 -translate-y-[calc(100%+8px)] rounded border border-border bg-background px-2 py-1 text-xs whitespace-nowrap text-foreground opacity-0 shadow transition-opacity duration-[1000ms] ease-out"
  >
  </div>
</div>

<style is:global>
  .year-progress-track {
    background-color: color-mix(in srgb, var(--color-border) 70%, transparent);
  }
  .year-progress-fill {
    background-color: var(--accent);
  }
</style>

<script>
  import "@/scripts/initYearProgress";
</script>
