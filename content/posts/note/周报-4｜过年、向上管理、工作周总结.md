---
title: "å‘¨æŠ¥-4ï½œè¿‡å¹´ã€å‘ä¸Šç®¡ç†ã€å·¥ä½œå‘¨æ€»ç»“"
date: 2023-01-30
type: post
slug: weekly_review_4
categories: [Review]
tags: [review]
---

## å‰è¨€

æœ¬ç¯‡æ˜¯å¯¹ `2023-01-23` åˆ° `2023-01-29` è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº [åšå®¢](https:/blog.chensoul.cc/)ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚

## è¿‡å¹´

è¿™å‘¨å¤„äºè¿‡å¹´åƒå–æ‹œå¹´æ¨¡å¼ï¼Œé™¤äº†è…ŠæœˆäºŒåä¹å’Œæ­£æœˆåˆä¸€ï¼Œå…¶ä»–æ—¶é—´éƒ½æ˜¯å’Œè€å©†åœ¨è·¯ä¸Šã€‚å› ä¸ºæ˜¯ç»“å©šç¬¬ä¸€ä¸ªæ–°å¹´ï¼Œéœ€è¦å¸¦ç€è€å©†å»å„ä¸ªäº²æˆšå®¶æ‹œå¹´ã€‚å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡åœ¨æ–°æˆ¿è¿‡å¹´ï¼Œå°±æŠŠè€çˆ¸ä»å†œæ‘æ¥è¿‡æ¥ä¸€èµ·è¿‡å¹´ã€‚å› ä¸ºå¹´å‰æ²¡æœ‰æ¥å¾—åŠä¹°è½¦ï¼Œå»å“ªé‡Œéƒ½ä¸æ–¹ä¾¿ï¼Œéƒ½è¦éœ€è¦æ»´æ»´æ‰“è½¦ã€‚ä¸ºæ­¤ï¼Œæ‰“è½¦èŠ±äº†ä¸å°‘é’±ï¼Œå½“ç„¶ï¼Œç»™çº¢åŒ…ä¹Ÿç»™äº†ä¸å°‘é’±ã€‚è¶åˆä¸€ä¸ç”¨æ‹œå¹´çš„ç¼éš™æ—¶é—´ï¼Œå¸¦è€å©†å’Œè€çˆ¸å»çœ‹äº†ä¸¤åœºç”µå½±ã€Šæ— åã€‹å’Œã€Šäº¤æ¢äººç”Ÿã€‹ã€‚è€çˆ¸å¾ˆå°‘å»çœ‹ç”µå½±é™¢çœ‹ç”µå½±ï¼Œå¬åˆ°è¦å»çœ‹ç”µå½±ï¼Œåƒä¸ªå°å­©ä¼¼çš„ï¼Œé¥­è¿˜åƒå®Œï¼Œå°±è·‘å»ç”µæ¢¯é—¨å£ç­‰ç”µæ¢¯ã€‚è¿™ä¸¤åœºç”µå½±ï¼Œçœ‹çš„æˆ‘çŒç¡æ¥äº†ï¼Œå€’æ˜¯åˆäºŒæ™šä¸Šçœ‹ã€Šæ»¡æ±Ÿçº¢ã€‹ç¡æ„å…¨æ— ã€‚

æ€»ç»“ä¸‹æ¥ï¼Œè¿™ä¸ªå¹´è¿‡çš„ä¸è½»æ¾ï¼Œèº«ä½“å¿™ç¢Œï¼Œå¿ƒé‡Œå¹¸ç¦ ğŸ¥°ã€‚

## å‘ä¸Šç®¡ç†

å¹´å‰ï¼Œéƒ¨é—¨é¢†å¯¼æ‰¾æˆ‘è°ˆ 2022 å¹´ç»©æ•ˆç»“æœæ—¶å€™ï¼Œæåˆ°æˆ‘å¯ä»¥ â€œå‘ä¸Šç®¡ç†â€ ä»–ã€‚æœ€è¿‘ä» [æœå±¹ä¸œ](https:/www.duyidong.com/) çš„åšå®¢ [è¿™ä¸€å¹´æˆ‘åœ¨é˜¿é‡Œå­¦åˆ°çš„](https:/www.duyidong.com/2020/01/01/2019-learn-from-alibaba/) ä¹Ÿçœ‹åˆ°äº†ä»–åœ¨é˜¿é‡Œå·¥ä½œä¸€å¹´åæ‚Ÿåˆ°å¯¹å‘ä¸Šç®¡ç†çš„ç†è§£ã€‚

- åŠæ—¶å’Œè€æ¿è¡¨è¾¾æƒ³æ³•
- è®©è€æ¿çŸ¥é“ä½ åœ¨å¿™ä»€ä¹ˆ
- ä¸»åŠ¨å¸®è€æ¿åšä¸€äº›è„æ´»ç´¯æ´»

å‰ä¸¤æ¡æ˜¯è€æ¿çŸ¥é“ä½ çš„æƒ³æ³•ï¼Œåé¢ä¸€æ¡æ˜¯å¸®è€æ¿è§£å†³é—®é¢˜ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥å¸®è€æ¿è§„é¿é£é™©ã€‚

## æœ¬å‘¨å·¥ä½œ

è¿™æ˜¯å¹´åçš„ç¬¬ä¸€å‘¨ï¼Œä¸»è¦æ˜¯å¤„ç†å¹´å‰æ²¡æœ‰å®Œæˆçš„é¡¹ç›®è¿­ä»£ã€‚

### Feign é›†æˆ Micometer

OpenFeign å®˜æ–¹æä¾›äº† feign-micrometer æ¥æ”¯æŒ feign é›†æˆ micrometerã€‚

```java
GitHub github = Feign.builder()
  .addCapability(new MicrometerCapability())
  .target(GitHub.class, "https:/api.github.com");
```

å…¶æœ¬è´¨æ˜¯å¯¹ feign æ‹¦æˆªå™¨ã€clientã€encoderã€decoder è¿›è¡Œå°è£…ï¼Œæµ‹è¯•è¿‡ç¨‹ä¸­åœ¨æ²¡æœ‰è·å–åˆ°æŒ‡æ ‡ã€‚æ•…ï¼Œæ”¹ä¸ºä½¿ç”¨ z è‡ªå®šä¹‰æ‹¦æˆªå™¨å’Œ ErrorCoder æ¥è®°å½•è¯·æ±‚æ¬¡æ•°å’Œå¤±è´¥æ¬¡æ•°ã€‚

```java
@Bean
public GitHub gihhub(MetricsInterceptor metricsInterceptor){
  GitHub github = Feign.builder()
  .requestInterceptor(metricsInterceptor)
  .errorDecoder(new MetricsErrorDecoder())
  .target(GitHub.class, "https:/api.github.com");
}
```

MetricsInterceptor ä»£ç å¦‚ä¸‹ï¼š

```java
public class MetricsInterceptor implements RequestInterceptor, MeterBinder {
    private static MeterRegistry meterRegistry;
    public static final String FEIGN_REQUEST = "feign.requests";
    public static final String FEIGN_REQUEST_ERROR = "feign.requests.error";

    public MetricsInterceptor() {
    }

    public void apply(RequestTemplate template) {
        Micrometers.async(() -> {
            String methodKey = template.methodMetadata().configKey();
            Counter counter = Counter.builder("feign.requests").tags(new String[]{"method", StringUtils.substringBefore(methodKey, "(")}).register(meterRegistry);
            counter.increment();
        });
    }

    public void bindTo(MeterRegistry registry) {
        meterRegistry = registry;
    }
}
```

MetricsErrorDecoder ä»£ç å¦‚ä¸‹ï¼š

```java
public class MetricsErrorDecoder implements ErrorDecoder {
    private static final Logger log = LoggerFactory.getLogger(MetricsErrorDecoder.class);
    private static MeterRegistry registry = new SimpleMeterRegistry();

    public MetricsErrorDecoder() {
    }

    protected void metrics(String methodKey) {
        Micrometers.async(() -> {
            Metrics.counter("feign.requests.error", new String[]{"method", StringUtils.substringBefore(methodKey, "(")}).increment();
        });
    }

    public Exception decode(String methodKey, Response response) {
        this.metrics(methodKey);
        FeignException exception = FeignException.errorStatus(methodKey, response);
        return exception;
    }

    static {
        Counter.builder("feign.requests.error").register(registry);
    }
}
```

### Sentry é›†æˆé£ä¹¦é€šçŸ¥

å‚è€ƒ [é€šè¿‡ Webhook å®ç° Sentry é”™è¯¯è‡ªåŠ¨åŒ–é£ä¹¦æœºå™¨äººæŠ¥è­¦](https:/www.ytjia.xyz/blog/2022/05/20/sentry-webhook.html) è¿™ç¯‡æ–‡ç« ï¼Œä½¿ç”¨ fastapi éƒ¨ç½²ä¸€ä¸ª http æœåŠ¡å°† sentry çš„å›è°ƒè½¬å‘åˆ°é£ä¹¦ç¾¤çš„æœºå™¨äººã€‚ç”±äºï¼Œfastapi éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… python3ï¼Œä¸ºäº†ä¸æ±¡æŸ“æˆ‘çš„ vpsï¼Œæˆ‘åˆ›å»ºä¸€ä¸ª docker é•œåƒ [sentry-feishu-hook](https:/github.com/chensoul/dockerfiles/tree/master/sentry-feishu-hook)ï¼Œä¿®æ”¹äº† python è„šæœ¬ä¸­çš„ç¼–è¯‘é”™è¯¯ï¼Œå¹¶åœ¨ vps ä¸Šé€šè¿‡ docker å¯åŠ¨è¯¥æœåŠ¡ã€‚

å…ˆç¼–è¯‘é•œåƒï¼Œå†è¿è¡Œï¼š

```bash
docker build -t sentry-feishu-hook .
docker run -d --name sentry-feishu-hook -p 3080:3080 sentry-feishu-hook
```

æ¥ä¸‹æ¥åœ¨ sentry é¡¹ç›®çš„ WebHooks é‡Œæ·»åŠ  http:/ip:3080/hook

![sentry-feishu-webhooks-test](../../../static/images/sentry-feishu-webhooks-test.webp)

ç‚¹å‡» Test Pluginï¼Œé£ä¹¦ç¾¤ç»„å¯ä»¥æ”¶åˆ°æ¶ˆæ¯ï¼š

![](../../../static/images/sentry-feishu-webhooks-test-message.webp)

## å¥½ç‰©åˆ†äº«

- https:/www.warp.dev/ï¼šä¸€ä¸ª Rust ç¼–å†™ï¼Œä½¿ç”¨ GPU æ¸²æŸ“çš„ç»ˆç«¯åº”ç”¨ã€‚ç›®æ ‡æ˜¯æå‡å¼€å‘è€…çš„æ•ˆç‡ã€‚
- [Restful API Mock å·¥å…·ï¼šJSONPlaceholder](https:/strrl.dev/post/before-2022/restful-api-mock-%E5%B7%A5%E5%85%B7-jsonplaceholder/)
- [NetNewsWire](https:/netnewswire.com/)ã€‚Inoreader æœ€è¿‘æ€»æ˜¯æŠ½é£ï¼Œå°±æ”¹ä¸ºä½¿ç”¨ NetNewsWire äº†ã€‚ä½¿ç”¨èµ·æ¥ï¼Œè¿˜æ˜¯æ¯”è¾ƒé¡ºæ»‘ï¼Œé—æ†¾çš„æ˜¯æ²¡æœ‰å®‰å“ Appã€‚
- [Cubox](https:/cubox.pro/)ã€‚æœ€è¿‘çœ‹åˆ°è¿™ä¸ªæ”¶è—å·¥å…·ï¼Œä¸‹è½½äº†ä½¿ç”¨èµ·æ¥ã€‚

![](../../../static/images/cubox-screen.webp)

ä»¥ä¸Šã€‚
