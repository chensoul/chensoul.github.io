---
title: "åŸºäº Spring AI æ„å»ºæ™ºèƒ½é¤å…æ¨èç³»ç»Ÿï¼šå¤šæ¨¡å‹é›†æˆçš„å®è·µæŒ‡å—"
date: 2025-09-25
slug: spring-ai-restaurant-showcase
categories: ["ai"]
tags: ['spring-ai', 'java', 'tutorial', 'multi-model']
---

æœ¬æ–‡å°†æ•™æ‚¨å¦‚ä½•ä½¿ç”¨ Spring AI é¡¹ç›®æ„å»ºåŸºäºä¸åŒèŠå¤©æ¨¡å‹çš„åº”ç”¨ç¨‹åºã€‚Spring AI èŠå¤©æ¨¡å‹æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„æ¥å£ï¼Œå…è®¸æˆ‘ä»¬ä¸è¿™äº›æ¨¡å‹è¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬çš„ Spring Boot ç¤ºä¾‹åº”ç”¨ç¨‹åºå°†åœ¨ OpenAIã€Mistral AI å’Œ Ollama æä¾›çš„ä¸‰ç§æµè¡ŒèŠå¤©æ¨¡å‹ä¹‹é—´åˆ‡æ¢ï¼Œå¹¶å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Spring AI æ¡†æ¶å®ç°å¤šè½®å¯¹è¯ã€ç»“æ„åŒ–è¾“å‡ºç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

<!--more-->

## æºä»£ç 

å¦‚æœæ‚¨æƒ³äº²è‡ªå°è¯•ï¼Œå¯ä»¥éšæ—¶æŸ¥çœ‹æˆ‘çš„æºä»£ç ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¿…é¡»å…‹éš†æˆ‘çš„ç¤ºä¾‹ [GitHub ä»“åº“](https://github.com/chensoul/spring-ai-restaurant-showcase)ã€‚ç„¶åï¼Œæ‚¨åªéœ€æŒ‰ç…§æˆ‘çš„è¯´æ˜è¿›è¡Œæ“ä½œå³å¯ã€‚

## é¡¹ç›®ç›®æ ‡

ä½¿ç”¨  Spring AI æ„å»ºä¸€ä¸ªæ™ºèƒ½é¤å…æ¨èç³»ç»Ÿï¼Œå®ç°ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- âœ… **æ™ºèƒ½æ¨è**ï¼šæ ¹æ®ç”¨æˆ·åå¥½æ¨èåˆé€‚çš„é¤å…
- âœ… **å¤šè½®å¯¹è¯**ï¼šæ”¯æŒä¸Šä¸‹æ–‡å¯¹è¯ï¼Œæä¾›è¿è´¯çš„ç”¨æˆ·ä½“éªŒ
- âœ… **ç»“æ„åŒ–è¾“å‡º**ï¼šè¿”å›æ ‡å‡†åŒ–çš„ JSON æ•°æ®æ ¼å¼
- âœ… **å¤šæ¨¡å‹æ”¯æŒ**ï¼šæ”¯æŒå¤šä¸ª AI æ¨¡å‹æä¾›å•†çš„æ— ç¼åˆ‡æ¢
- âœ… **ä¸­æ–‡æ”¯æŒ**ï¼šå®Œç¾æ”¯æŒä¸­æ–‡å‚æ•°å’Œå“åº”
- âœ… **ç”Ÿäº§å°±ç»ª**ï¼šåŒ…å«å®Œæ•´çš„é…ç½®ç®¡ç†å’Œé”™è¯¯å¤„ç†

## ç¯å¢ƒæ­å»º

### æŠ€æœ¯æ ˆ

- **Java 21**ï¼šä½¿ç”¨æœ€æ–°çš„ LTS ç‰ˆæœ¬
- **Spring Boot 3.5.6**ï¼šæä¾›ä¼ä¸šçº§åº”ç”¨æ¡†æ¶
- **Spring AI 1.1.0-M2**ï¼šAI é›†æˆæ¡†æ¶
- **Maven**ï¼šä¾èµ–ç®¡ç†å’Œæ„å»ºå·¥å…·
- **Lombok**ï¼šç®€åŒ– Java ä»£ç 

### ä¾èµ–é…ç½®

Spring AI é¡¹ç›®ä»åœ¨ç§¯æå¼€å‘ä¸­ï¼Œå½“å‰ä½¿ç”¨é‡Œç¨‹ç¢‘ç‰ˆæœ¬ `1.1.0-M2`ã€‚

```xml
<repositories>
    <repository>
        <id>central</id>
        <name>Central</name>
        <url>https://repo1.maven.org/maven2/</url>
    </repository>
    <repository>
        <id>spring-milestones</id>
        <name>Spring Milestones</name>
        <url>https://repo.spring.io/milestone</url>
        <snapshots>
            <enabled>false</enabled>
        </snapshots>
    </repository>
</repositories>
```

ç„¶åï¼Œæˆ‘ä»¬åº”è¯¥åŒ…å«æŒ‡å®šç‰ˆæœ¬çš„ Spring AI é¡¹ç›®çš„ Maven BOMã€‚

```xml
<properties>
    <java.version>21</java.version>
    <spring-ai.version>1.1.0-M2</spring-ai.version>
</properties>

<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.ai</groupId>
            <artifactId>spring-ai-bom</artifactId>
            <version>${spring-ai.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

ç”±äºæˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨æš´éœ²äº†ä¸€äº› REST ç«¯ç‚¹ï¼Œæˆ‘ä»¬åº”è¯¥åŒ…å« Spring Boot Web Starterã€‚æˆ‘ä»¬å¯ä»¥åŒ…å« Spring Boot Test Starter æ¥åˆ›å»ºä¸€äº› JUnit æµ‹è¯•ã€‚Spring AI æ¨¡å—åŒ…å«åœ¨ Maven `profiles` éƒ¨åˆ†ä¸­ã€‚æ¯ä¸ªèŠå¤©æ¨¡å‹æä¾›å•†éƒ½æœ‰ä¸‰ä¸ªä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„åº”ç”¨ä½¿ç”¨ OpenAIï¼Œå› æ­¤å®ƒæ¿€æ´»äº† `open-ai` é…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å« `spring-ai-starter-model-openai` åº“ã€‚æˆ‘ä»¬åº”è¯¥æ¿€æ´» `mistral-ai` é…ç½®æ–‡ä»¶æ¥åˆ‡æ¢åˆ° Mistral AIã€‚ç¬¬ä¸‰ä¸ªé€‰é¡¹æ˜¯ `ollama-ai` é…ç½®æ–‡ä»¶ï¼ŒåŒ…å« `spring-ai-starter-model-ollama` ä¾èµ–ã€‚è¿™å°†ä½¿åœ¨ä¸åŒèŠå¤©æ¨¡å‹ AI æä¾›å•†ä¹‹é—´åˆ‡æ¢å˜å¾—è½»è€Œæ˜“ä¸¾â€”â€”æˆ‘ä»¬åªéœ€è¦åœ¨ Maven è¿è¡Œå‘½ä»¤ä¸­è®¾ç½®é…ç½®æ–‡ä»¶å‚æ•°ã€‚

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
</dependencies>

<profiles>
    <profile>
        <id>open-ai</id>
        <activation>
            <activeByDefault>true</activeByDefault>
        </activation>
        <dependencies>
            <dependency>
                <groupId>org.springframework.ai</groupId>
                <artifactId>spring-ai-starter-model-openai</artifactId>
            </dependency>
        </dependencies>
    </profile>
    <profile>
        <id>mistral-ai</id>
        <dependencies>
            <dependency>
                <groupId>org.springframework.ai</groupId>
                <artifactId>spring-ai-starter-model-mistral-ai</artifactId>
            </dependency>
        </dependencies>
    </profile>
    <profile>
        <id>ollama-ai</id>
        <dependencies>
            <dependency>
                <groupId>org.springframework.ai</groupId>
                <artifactId>spring-ai-starter-model-ollama</artifactId>
            </dependency>
        </dependencies>
    </profile>
</profiles>
```

## é¡¹ç›®é…ç½®

### ç¯å¢ƒé…ç½®

åœ¨å¼€å§‹å¼€å‘ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é…ç½® AI æ¨¡å‹æä¾›å•†çš„ API å¯†é’¥ã€‚

#### é…ç½® OpenAI

æˆ‘ä»¬å¿…é¡»åœ¨ [OpenAI](https://platform.openai.com/) å¹³å°é—¨æˆ·ä¸Šæ‹¥æœ‰ä¸€ä¸ªè´¦æˆ·ã€‚ç™»å½•åï¼Œè®¿é—® [API å¯†é’¥](https://platform.openai.com/account/api-keys) é¡µé¢æ¥ç”Ÿæˆ API ä»¤ç‰Œã€‚

```bash
export OPENAI_API_KEY=<YOUR_TOKEN_VALUE>
```

#### é…ç½® Mistral AI

åœ¨ [Mistral AI](https://console.mistral.ai/) å¹³å°é—¨æˆ·ä¸Šåˆ›å»ºè´¦æˆ·ï¼Œè®¿é—® [API å¯†é’¥](https://console.mistral.ai/api-keys/) é¡µé¢ç”Ÿæˆä»¤ç‰Œã€‚

```bash
export MISTRAL_API_KEY=<YOUR_TOKEN_VALUE>
```

#### è¿è¡Œå’Œé…ç½® Ollama

Ollama å…è®¸åœ¨æœ¬åœ°è¿è¡Œå¤§å‹è¯­è¨€æ¨¡å‹ã€‚ä» [ä¸‹è½½é¡µé¢](https://ollama.com/download) ä¸‹è½½å¹¶å®‰è£… Ollamaï¼Œç„¶åè¿è¡Œæ¨¡å‹ï¼š

```bash
ollama run llama3.2
```

#### é…ç½®å…¼å®¹ OpenAI çš„æ¨¡å‹

1. Groq AI
- **æ¨¡å‹**: Llama 3.1 70B Versatile
- **ç‰¹ç‚¹**: æå¿«çš„æ¨ç†é€Ÿåº¦ï¼Œé«˜æ€§èƒ½
- **API**: https://api.groq.com/openai/v1
- **è·å– API Key**: https://console.groq.com/keys

2. Docker Model Runner (DMR)
- **æ¨¡å‹**: Llama 3.2
- **ç‰¹ç‚¹**: æœ¬åœ°è¿è¡Œï¼ŒDocker å®¹å™¨åŒ–éƒ¨ç½²
- **API**: [http://localhost:11434/v1](http://localhost:11434/v1)
- **å®‰è£…**: https://docs.docker.com/ai/model-runner/

3. OpenRouter AI
- **æ¨¡å‹**: Llama 3.1 8B Instruct (Free)
- **ç‰¹ç‚¹**: å¤šç§å¼€æºæ¨¡å‹é€‰æ‹©ï¼Œæˆæœ¬è¾ƒä½
- **API**: https://openrouter.ai/api/v1
- **è·å– API Key**: https://openrouter.ai/keys

4. DeepSeek AI
- **æ¨¡å‹**: DeepSeek Chat
- **ç‰¹ç‚¹**: å¼ºå¤§çš„ä¸­æ–‡ç†è§£èƒ½åŠ›
- **API**: https://api.deepseek.com/v1
- **è·å– API Key**: https://platform.deepseek.com/api_keys

5. Qwen AI
- **æ¨¡å‹**: Qwen Plus
- **ç‰¹ç‚¹**: é˜¿é‡Œå·´å·´å¼€å‘çš„ä¸­æ–‡å¤§æ¨¡å‹
- **API**: https://dashscope.aliyuncs.com/compatible-mode/v1
- **è·å– API Key**: https://dashscope.console.aliyun.com/apiKey

### Spring Boot é…ç½®

#### 1. é€šç”¨é…ç½® (application.yml)

```yaml
spring.ai.openai.api-key: ${OPENAI_API_KEY}
spring.ai.openai.chat.options.model: gpt-5
spring.ai.openai.chat.options.temperature: 1

spring.ai.mistralai.api-key: ${MISTRAL_API_KEY}
spring.ai.ollama.chat.options.model: llama3.2
```

#### 2. OpenAI å…¼å®¹æ¨¡å‹é…ç½®

Groq AI é…ç½® (application-groq.yml)

```yaml
spring.ai.openai.api-key: ${GROQ_API_KEY}
spring.ai.openai.base-url: https://api.groq.com
spring.ai.openai.chat.options.model: llama-3.1-70b-versatile
```

DeepSeek AI é…ç½® (application-deepseek.yml)

```yaml
spring.ai.openai.api-key: ${DEEPSEEK_API_KEY}
spring.ai.openai.base-url: https://api.deepseek.com
spring.ai.openai.chat.options.model: deepseek-chat
```

OpenRouter AI é…ç½® (application-openrouter.yml)

```yaml
spring.ai.openai.api-key: ${OPENROUTER_API_KEY}
spring.ai.openai.base-url: https://openrouter.ai
spring.ai.openai.chat.completions-path: /api/v1/chat/completions
spring.ai.openai.chat.options.model: qwen/qwen3-coder:free
```

Qwen AI é…ç½® (application-qwen.yml)

```yaml
spring.ai.openai.api-key: ${QWEN_API_KEY}
spring.ai.openai.base-url: https://dashscope.aliyuncs.com/compatible-mode/v1
spring.ai.openai.chat.options.model: qwen-plus
```

Docker Model Runner é…ç½® (application-dmr.yml)

```yaml
spring.ai.openai.base-url: http://localhost:12434/engines/
spring.ai.openai.api-key: dummy-key
spring.ai.openai.chat.options.model: llama3.2
```

#### 3. ç¯å¢ƒå˜é‡è®¾ç½®

```bash
# é€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ¨¡å‹è®¾ç½®å¯¹åº”çš„ç¯å¢ƒå˜é‡
export OPENAI_API_KEY=your-openai-api-key
export MISTRAL_API_KEY=your-mistral-api-key
export GROQ_API_KEY=your-groq-api-key
export DEEPSEEK_API_KEY=your-deepseek-api-key
export OPENROUTER_API_KEY=your-openrouter-api-key
export QWEN_API_KEY=your-qwen-api-key
```

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. æ•°æ®æ¨¡å‹è®¾è®¡

é¦–å…ˆå®šä¹‰æˆ‘ä»¬çš„æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼Œä½¿ç”¨ Lombok ç®€åŒ–ä»£ç ï¼š

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Restaurant {
    private Long id;
    private String name;
    private String cuisine;
    private String location;
    private Double rating;
    private String description;
    private String priceRange;
    private String[] features;
}

@Data
@NoArgsConstructor
@AllArgsConstructor
public class Dish {
    private Long id;
    private String name;
    private String description;
    private String cuisine;
    private Double price;
    private String category;
    private List<String> ingredients;
    private String dietaryInfo;
    private Integer calories;
    private String preparationTime;
    private String difficulty;
}
```

### 2. REST API è®¾è®¡

è®¾è®¡ RESTful API æ¥å£ï¼Œæ”¯æŒä¸­æ–‡å‚æ•°å’Œ JSON æ•°æ®äº¤æ¢ï¼š

```java
@PostMapping("/dishes/generate")
public ResponseEntity<List<Dish>> generateDishes(@RequestBody Map<String, Object> request) {
    String cuisine = (String) request.get("cuisine");
    Integer countObj = (Integer) request.get("count");
    int count = countObj != null ? countObj : 5;

    // é™åˆ¶èœå“æ•°é‡åœ¨åˆç†èŒƒå›´å†…
    int validCount = Math.max(1, Math.min(count, 10));

    PromptTemplate template = new PromptTemplate("""
            ä¸º{cuisine}èœç³»ç”Ÿæˆ{count}é“ç‰¹è‰²èœå“ï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
            - èœå“åç§°
            - è¯¦ç»†æè¿°
            - ä¸»è¦é£Ÿæ
            - ä»·æ ¼èŒƒå›´
            - èœå“åˆ†ç±»ï¼ˆå¼€èƒƒèœ/ä¸»èœ/ç”œç‚¹ç­‰ï¼‰
            - é¥®é£Ÿä¿¡æ¯ï¼ˆç´ é£Ÿ/æ— éº¸è´¨/ä½å¡ç­‰ï¼‰
            - å¡è·¯é‡Œ
            - åˆ¶ä½œæ—¶é—´
            - éš¾åº¦ç­‰çº§
            
            è¯·è¿”å›JSONæ ¼å¼çš„èœå“æ•°æ®ï¼Œä¸è¦åŒ…å«è§£é‡Šæ€§æ–‡å­—ã€‚
            """);

    Prompt prompt = template.create(Map.of(
            "cuisine", cuisine,
            "count", validCount
    ));

    List<Dish> dishes = chatClient.prompt(prompt)
            .call()
            .entity(new ParameterizedTypeReference<List<Dish>>() {
            });

    return ResponseEntity.ok(dishes);
}
```

`@RestController` ç±»æ³¨å…¥è‡ªåŠ¨é…ç½®çš„ `ChatClient.Builder` æ¥åˆ›å»º `ChatClient` å®ä¾‹ã€‚`RestaurantRecommendationController` å®ç°äº†ä» `POST /api/restaurants/recommend` ç«¯ç‚¹è¿”å›é¤å…åˆ—è¡¨çš„æ–¹æ³•ã€‚ä¸»è¦ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å« 5 ä¸ªå¯¹è±¡çš„åˆ—è¡¨ï¼Œè¿™äº›å¯¹è±¡å…·æœ‰åœ¨ `Restaurant` ç±»ä¸­å®šä¹‰çš„å­—æ®µã€‚

```java
@RequiredArgsConstructor
@RestController
@RequestMapping("/api/restaurants")
public class RestaurantRecommendationController {

    private final ChatClient chatClient;

    @PostMapping("/recommend")
    public ResponseEntity<List<Restaurant>> recommendRestaurants(@RequestBody RecommendationRequest request) {
        PromptTemplate template = new PromptTemplate("""
                æ ¹æ®ä»¥ä¸‹ç”¨æˆ·åå¥½æ¨è5å®¶åˆé€‚çš„é¤å…ï¼š
                ä½ç½®: {location}
                èœç³»: {cuisine}
                ä»·æ ¼èŒƒå›´: {priceRange}
                é¥®é£Ÿé™åˆ¶: {dietaryRestrictions}
                åœºåˆ: {occasion}
                äººæ•°: {groupSize}
                ç”¨é¤æ—¶é—´: {timeOfDay}
                å…¶ä»–åå¥½: {preferences}
                
                è¯·è¿”å›é¤å…åˆ—è¡¨ï¼ŒåŒ…å«é¤å…åç§°ã€èœç³»ã€ä½ç½®ã€è¯„åˆ†ã€æè¿°ã€ä»·æ ¼èŒƒå›´å’Œç‰¹è‰²ã€‚
                ä¸è¦åŒ…å«ä»»ä½•è§£é‡Šæ€§æ–‡å­—ï¼Œåªè¿”å›JSONæ ¼å¼çš„é¤å…æ•°æ®ã€‚
                """);

        Prompt prompt = template.create(Map.of(
                "location", request.getLocation() != null ? request.getLocation() : "åŒ—äº¬å¸‚",
                "cuisine", request.getCuisine() != null ? request.getCuisine() : "ä¸é™",
                "priceRange", request.getPriceRange() != null ? request.getPriceRange() : "ä¸é™",
                "dietaryRestrictions", request.getDietaryRestrictions() != null ?
                        String.join(", ", request.getDietaryRestrictions()) : "æ— ",
                "occasion", request.getOccasion() != null ? request.getOccasion() : "æ—¥å¸¸ç”¨é¤",
                "groupSize", request.getGroupSize() != null ? request.getGroupSize().toString() : "1-2äºº",
                "timeOfDay", request.getTimeOfDay() != null ? request.getTimeOfDay() : "åˆé¤",
                "preferences", request.getPreferences() != null ?
                        String.join(", ", request.getPreferences()) : "æ— "
        ));

        List<Restaurant> restaurants = chatClient.prompt(prompt)
                .call()
                .entity(new ParameterizedTypeReference<List<Restaurant>>() {});

        return ResponseEntity.ok(restaurants);
    }
}
```

ç»“æœå¹¶ä¸ä»¤äººæƒŠè®¶â€”â€”ç³»ç»Ÿä¼šè¿”å›ç¬¦åˆç”¨æˆ·åå¥½çš„é¤å…åˆ—è¡¨ã€‚ç„¶è€Œï¼Œç¬¬äºŒæ¬¡è°ƒç”¨åŒä¸€ä¸ªç«¯ç‚¹æ—¶ï¼Œåˆ—è¡¨ä¼šç•¥æœ‰ä¸åŒã€‚æ ¹æ®æˆ‘ä»¬çš„æç¤ºï¼ŒèŠå¤©å®¢æˆ·ç«¯åº”è¯¥"è¿”å›å½“å‰é¤å…åˆ—è¡¨"ã€‚æ‰€ä»¥ï¼Œæˆ‘æœŸæœ›å¾—åˆ°ä¸ä¹‹å‰ç›¸åŒçš„åˆ—è¡¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé—®é¢˜æ˜¯èŠå¤©å®¢æˆ·ç«¯ä¸è®°å¾—ä¹‹å‰çš„å¯¹è¯ã€‚

## è¿è¡Œåº”ç”¨

```bash
# ä½¿ç”¨ OpenAI GPT-4oï¼ˆæ¨èï¼‰
mvn spring-boot:run

# ä½¿ç”¨ OpenAIï¼ˆé»˜è®¤é…ç½®ï¼‰
mvn spring-boot:run

# ä½¿ç”¨ Mistral AI
mvn spring-boot:run -Pmistral-ai

# ä½¿ç”¨ Ollama
mvn spring-boot:run -Pollama-ai

# ä½¿ç”¨ Groq AI
mvn spring-boot:run -Dspring-boot.run.arguments="--spring.profiles.active=groq"

# ä½¿ç”¨ DeepSeek AI
mvn spring-boot:run -Dspring-boot.run.arguments="--spring.profiles.active=deepseek"

# ä½¿ç”¨ Qwen AI
mvn spring-boot:run -Dspring-boot.run.arguments="--spring.profiles.active=qwen"

# ä½¿ç”¨ OpenRouter AI
mvn spring-boot:run -Dspring-boot.run.arguments="--spring.profiles.active=openrouter"

# ä½¿ç”¨ DMR AI
mvn spring-boot:run -Dspring-boot.run.arguments="--spring.profiles.active=dmr"
```

## æµ‹è¯• API

```bash
# æ¨èé¤å…
curl -X POST http://localhost:8080/api/restaurants/recommend \
  -H "Content-Type: application/json" \
  -d '{
    "location": "åŒ—äº¬å¸‚",
    "cuisine": "ä¸­é¤",
    "priceRange": "ä¸­ç­‰ä»·ä½",
    "dietaryRestrictions": ["ç´ é£Ÿ"],
    "occasion": "å•†åŠ¡èšé¤",
    "groupSize": 4,
    "timeOfDay": "æ™šé¤"
  }'

# ç”Ÿæˆèœå“
curl -X POST "http://localhost:8080/api/restaurants/dishes/generate" \
  -H "Content-Type: application/json" \
  -d '{"cuisine": "ä¸­é¤", "count": 3}'

# è·å–å»ºè®®
curl -X POST "http://localhost:8080/api/restaurants/advice" \
  -H "Content-Type: application/json" \
  -d '{"query": "é€‚åˆæƒ…ä¾£çº¦ä¼šçš„é¤å…"}'

# å¤šè¯­è¨€èŠå¤©
curl -X POST "http://localhost:8080/api/restaurants/chat" \
  -H "Content-Type: application/json" \
  -d '{"message": "æ¨èä¸€å®¶å¥½åƒçš„å·èœé¦†", "language": "zh"}'
```

## æ ¸å¿ƒæŠ€æœ¯ç‰¹æ€§

### 1. å¤šè½®å¯¹è¯æ”¯æŒ

å¤šè½®å¯¹è¯æ˜¯æ™ºèƒ½åº”ç”¨çš„æ ¸å¿ƒç‰¹æ€§ï¼ŒSpring AI æä¾›äº†å¼€ç®±å³ç”¨çš„è§£å†³æ–¹æ¡ˆï¼š

```java
@Configuration
public class ChatConfig {

    /**
     * é…ç½®èŠå¤©è®°å¿†
     */
    @Bean
    public ChatMemory chatMemory() {
        return MessageWindowChatMemory.builder()
                .chatMemoryRepository(new InMemoryChatMemoryRepository())
                .build();
    }

    /**
     * é…ç½® ChatClient
     * åŒ…å«è®°å¿†åŠŸèƒ½å’Œæ—¥å¿—è®°å½•
     */
    @Bean
    public ChatClient chatClient(ChatClient.Builder chatClientBuilder, ChatMemory chatMemory) {
        return chatClientBuilder
                .defaultSystem("ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é¤å…æ¨èåŠ©æ‰‹ã€‚è¯·ç”¨ä¸­æ–‡å›ç­”ï¼Œæä¾›å‡†ç¡®ã€æœ‰ç”¨çš„é¤å…å’Œèœå“æ¨èã€‚")
                .defaultAdvisors(
                        MessageChatMemoryAdvisor.builder(chatMemory).build(),
                        new SimpleLoggerAdvisor())
                .build();
    }
}
```

```java
@SpringBootApplication
public class RestaurantApplication {

    public static void main(String[] args) {
        SpringApplication.run(RestaurantApplication.class, args);
    }
}
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›è¡Œæœ€ç»ˆæµ‹è¯•ã€‚åº”ç”¨é‡å¯åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ç”Ÿæˆé¤å…åˆ—è¡¨çš„ç«¯ç‚¹ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è°ƒç”¨ `GET /api/restaurants/{id}/details` ç«¯ç‚¹æ¥ä»…æ˜¾ç¤ºå…·æœ‰æŒ‡å®š ID çš„å•ä¸ªé¤å…ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤è°ƒç”¨ `POST /api/restaurants/recommend` ç«¯ç‚¹æ¥éªŒè¯å®ƒæ˜¯å¦è¿”å›ç›¸åŒçš„åˆ—è¡¨ã€‚

#### å¤šè½®å¯¹è¯æµ‹è¯•

è®©æˆ‘ä»¬æµ‹è¯•å¤šè½®å¯¹è¯åŠŸèƒ½ï¼š

```bash
# ç¬¬ä¸€è½®å¯¹è¯ï¼šè¯¢é—®å·èœé¦†æ¨è
curl -X POST http://localhost:8080/api/restaurants/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "æˆ‘æƒ³åœ¨åŒ—äº¬æ‰¾ä¸€å®¶å·èœé¦†", "language": "zh"}'

# ç¬¬äºŒè½®å¯¹è¯ï¼šè¯¢é—®ä»·æ ¼ï¼ˆAI èƒ½è®°ä½ä¹‹å‰çš„æ¨èï¼‰
curl -X POST http://localhost:8080/api/restaurants/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "åˆšæ‰æ¨èçš„é¤å…ä¸­ï¼Œå“ªå®¶æœ€ä¾¿å®œï¼Ÿ", "language": "zh"}'
```

**æµ‹è¯•ç»“æœ**ï¼šAI èƒ½å¤Ÿè®°ä½ä¹‹å‰çš„å¯¹è¯å†…å®¹ï¼Œæä¾›è¿è´¯çš„å›å¤ï¼Œå‡†ç¡®å›ç­”å…³äºä¹‹å‰æ¨èé¤å…çš„é—®é¢˜ã€‚

#### å¤šè½®å¯¹è¯å®ç°åŸç†

1. **è‡ªåŠ¨è®°å¿†ç®¡ç†**ï¼š`MessageChatMemoryAdvisor` è‡ªåŠ¨ç®¡ç†å¯¹è¯å†å²
2. **å†…å­˜å­˜å‚¨**ï¼šä½¿ç”¨ `MessageWindowChatMemory` + `InMemoryChatMemoryRepository`
3. **é€æ˜é›†æˆ**ï¼šé€šè¿‡ `ChatClient` çš„ `defaultAdvisors` é…ç½®
4. **ä¸Šä¸‹æ–‡ä¿æŒ**ï¼šæ¯æ¬¡å¯¹è¯éƒ½ä¼šåŒ…å«å®Œæ•´çš„å¯¹è¯å†å²

### 2. ç»“æ„åŒ–è¾“å‡ºæ”¯æŒ

Spring AI æä¾›äº†å¤šç§ç»“æ„åŒ–è¾“å‡ºæ–¹å¼ï¼Œæ»¡è¶³ä¸åŒçš„å¼€å‘éœ€æ±‚ï¼š

#### 1. ç›´æ¥ .entity() æ–¹æ³•ï¼ˆæœ€ç®€å•ï¼‰

```java
@PostMapping("/restaurant/direct-entity")
public ResponseEntity<Restaurant> getRestaurantDirectEntity(@RequestBody Map<String, Object> request) {
    String cuisine = (String) request.get("cuisine");
    
    PromptTemplate template = new PromptTemplate("""
            æ¨è1å®¶{cuisine}é¤å…ï¼Œè¿”å›JSONæ ¼å¼çš„é¤å…ä¿¡æ¯ã€‚
            åŒ…å«ï¼šname, cuisine, location, rating, description, priceRange, features
            """);
    
    Prompt prompt = template.create(Map.of("cuisine", cuisine));
    
    // ç›´æ¥ä½¿ç”¨ .entity() æ–¹æ³•
    Restaurant restaurant = chatClient.prompt(prompt)
            .call()
            .entity(Restaurant.class);
    
    return ResponseEntity.ok(restaurant);
}
```

#### 2. ParameterizedTypeReferenceï¼ˆå½“å‰é¡¹ç›®ä½¿ç”¨ï¼‰

```java
@PostMapping("/restaurants/type-ref")
public ResponseEntity<List<Restaurant>> getRestaurantsWithTypeRef(@RequestBody Map<String, Object> request) {
    String cuisine = (String) request.get("cuisine");
    
    PromptTemplate template = new PromptTemplate("""
            æ¨è3å®¶{cuisine}é¤å…ï¼Œè¿”å›JSONæ ¼å¼çš„é¤å…åˆ—è¡¨ã€‚
            æ¯ä¸ªé¤å…åŒ…å«ï¼šname, cuisine, location, rating, description, priceRange, features
            """);
    
    Prompt prompt = template.create(Map.of("cuisine", cuisine));
    
    // ä½¿ç”¨ ParameterizedTypeReference
    List<Restaurant> restaurants = chatClient.prompt(prompt)
            .call()
            .entity(new ParameterizedTypeReference<List<Restaurant>>() {});
    
    return ResponseEntity.ok(restaurants);
}
```

#### 3. BeanOutputConverter

```java
@PostMapping("/restaurant/bean-converter")
public ResponseEntity<Restaurant> getRestaurantWithBeanConverter(@RequestBody Map<String, Object> request) {
    String cuisine = (String) request.get("cuisine");
    
    PromptTemplate template = new PromptTemplate("""
            æ¨è1å®¶{cuisine}é¤å…ï¼Œè¿”å›JSONæ ¼å¼çš„é¤å…ä¿¡æ¯ã€‚
            åŒ…å«ï¼šname, cuisine, location, rating, description, priceRange, features
            """);
    
    Prompt prompt = template.create(Map.of("cuisine", cuisine));
    
    // ä½¿ç”¨ BeanOutputConverter
    BeanOutputConverter<Restaurant> converter = new BeanOutputConverter<>(Restaurant.class);
    
    String response = chatClient.prompt(prompt)
            .call()
            .content();
    
    Restaurant restaurant = converter.convert(response);
    
    return ResponseEntity.ok(restaurant);
}
```

#### 4. MapOutputConverter

```java
@PostMapping("/restaurant/map-converter")
public ResponseEntity<Map<String, Object>> getRestaurantWithMapConverter(@RequestBody Map<String, Object> request) {
    String cuisine = (String) request.get("cuisine");
    
    PromptTemplate template = new PromptTemplate("""
            æ¨è1å®¶{cuisine}é¤å…ï¼Œè¿”å›JSONæ ¼å¼çš„é¤å…ä¿¡æ¯ã€‚
            åŒ…å«ï¼šname, cuisine, location, rating, description, priceRange, features
            """);
    
    Prompt prompt = template.create(Map.of("cuisine", cuisine));
    
    // ä½¿ç”¨ MapOutputConverter
    MapOutputConverter converter = new MapOutputConverter();
    
    String response = chatClient.prompt(prompt)
            .call()
            .content();
    
    @SuppressWarnings("unchecked")
    Map<String, Object> restaurant = (Map<String, Object>) converter.convert(response);
    
    return ResponseEntity.ok(restaurant);
}
```

#### 5. ListOutputConverter

```java
@PostMapping("/restaurants/list-converter")
public ResponseEntity<List<Map<String, String>>> getRestaurantsWithListConverter(@RequestBody Map<String, Object> request) {
    String cuisine = (String) request.get("cuisine");
    
    PromptTemplate template = new PromptTemplate("""
            æ¨è3å®¶{cuisine}é¤å…ï¼Œè¿”å›JSONæ ¼å¼çš„é¤å…åˆ—è¡¨ã€‚
            æ¯ä¸ªé¤å…åŒ…å«ï¼šname, cuisine, location, rating, description, priceRange, features
            """);
    
    Prompt prompt = template.create(Map.of("cuisine", cuisine));
    
    // ä½¿ç”¨ ListOutputConverter
    ListOutputConverter converter = new ListOutputConverter();
    
    String response = chatClient.prompt(prompt)
            .call()
            .content();
    
    @SuppressWarnings("unchecked")
    List<String> restaurantStrings = (List<String>) converter.convert(response);
    
    // å°†å­—ç¬¦ä¸²åˆ—è¡¨è½¬æ¢ä¸º Map åˆ—è¡¨ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
    List<Map<String, String>> restaurants = restaurantStrings.stream()
            .map(str -> Map.of("name", str, "cuisine", cuisine))
            .toList();
    
    return ResponseEntity.ok(restaurants);
}
```

#### ç»“æ„åŒ–è¾“å‡ºæ–¹å¼å¯¹æ¯”

| è¾“å‡ºæ–¹å¼ | ä»£ç ç®€æ´åº¦ | ç±»å‹å®‰å…¨ | çµæ´»æ€§ | æ¨èåœºæ™¯ |
|---------|-----------|---------|--------|----------|
| `.entity()` | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | ç®€å•å¯¹è±¡ |
| `ParameterizedTypeReference` | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | å¤æ‚æ³›å‹ |
| `BeanOutputConverter` | â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | è‡ªå®šä¹‰è½¬æ¢ |
| `MapOutputConverter` | â­â­â­ | â­â­ | â­â­â­â­â­ | åŠ¨æ€ç»“æ„ |
| `ListOutputConverter` | â­â­â­ | â­â­ | â­â­â­â­ | ç®€å•åˆ—è¡¨ |
#### ç»“æ„åŒ–è¾“å‡ºæµ‹è¯•

```bash
# æµ‹è¯•ç›´æ¥ .entity() æ–¹æ³•
curl -X POST http://localhost:8080/api/structured/restaurant/direct-entity \
  -H "Content-Type: application/json" \
  -d '{"cuisine": "å·èœ"}'

# æµ‹è¯• ParameterizedTypeReference
curl -X POST http://localhost:8080/api/structured/restaurants/type-ref \
  -H "Content-Type: application/json" \
  -d '{"cuisine": "å·èœ"}'

# æµ‹è¯• BeanOutputConverter
curl -X POST http://localhost:8080/api/structured/restaurant/bean-converter \
  -H "Content-Type: application/json" \
  -d '{"cuisine": "å·èœ"}'
```

**æµ‹è¯•ç»“æœ**ï¼šæ‰€æœ‰ç»“æ„åŒ–è¾“å‡ºæ–¹å¼éƒ½èƒ½æ­£ç¡®å·¥ä½œï¼Œè¿”å›ç¬¦åˆé¢„æœŸæ ¼å¼çš„æ•°æ®ã€‚

## åŠŸèƒ½æ‰©å±•

åŸºäºå¯¹å½“å‰é¡¹ç›®çš„åˆ†æï¼Œä»¥ä¸‹æ˜¯æœ¬é¡¹ç›®**æœªæ¶‰åŠ**ä½† Spring AI æ¡†æ¶æ”¯æŒçš„å¼ºå¤§åŠŸèƒ½ï¼š

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½æ‰©å±•

#### 1. **æµå¼å“åº” (Streaming)**
```java
// å½“å‰é¡¹ç›®ï¼šåŒæ­¥è°ƒç”¨
List<Restaurant> restaurants = chatClient.prompt()
    .user("æ¨èé¤å…")
    .call()
    .entity(new ParameterizedTypeReference<List<Restaurant>>() {});

// æœªå®ç°ï¼šæµå¼å“åº”
Flux<String> stream = chatClient.prompt()
    .user("æ¨èé¤å…")
    .stream()
    .content();
```

#### 2. **å‡½æ•°è°ƒç”¨ (Function Calling)**
```java
// æœªå®ç°ï¼šå·¥å…·è°ƒç”¨
@Bean
public Function<WeatherRequest, WeatherResponse> weatherFunction() {
    return request -> {
        // è°ƒç”¨å¤©æ°” API
        return weatherService.getWeather(request.getLocation());
    };
}

// åœ¨ ChatClient ä¸­ä½¿ç”¨
chatClient.prompt()
    .user("åŒ—äº¬ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ")
    .functions("weatherFunction")
    .call();
```

#### 3. **å‘é‡æ•°æ®åº“é›†æˆ (RAG)**
```java
// æœªå®ç°ï¼šæ£€ç´¢å¢å¼ºç”Ÿæˆ
@Bean
public VectorStore vectorStore() {
    return new PineconeVectorStore(pineconeApiKey, "restaurant-index");
}

// RAG æŸ¥è¯¢
chatClient.prompt()
    .user("æ¨èé€‚åˆå•†åŠ¡èšé¤çš„é¤å…")
    .advisors(RetrievalAugmentationAdvisor.builder(vectorStore).build())
    .call();
```

### ğŸ¨ å¤šæ¨¡æ€æ”¯æŒ

#### 4. **å›¾åƒè¯†åˆ«å’Œå¤„ç†**
```java
// æœªå®ç°ï¼šå›¾åƒè¾“å…¥
@PostMapping("/analyze-image")
public ResponseEntity<String> analyzeImage(@RequestParam MultipartFile image) {
    return chatClient.prompt()
        .user("åˆ†æè¿™å¼ é¤å…å›¾ç‰‡")
        .media(image)
        .call()
        .content();
}
```

#### 5. **è¯­éŸ³è½¬æ–‡å­—å’Œæ–‡å­—è½¬è¯­éŸ³**
```java
// æœªå®ç°ï¼šè¯­éŸ³å¤„ç†
@PostMapping("/voice-chat")
public ResponseEntity<byte[]> voiceChat(@RequestParam MultipartFile audio) {
    // è¯­éŸ³è½¬æ–‡å­—
    String text = speechToTextService.transcribe(audio);
    
    // AI å¤„ç†
    String response = chatClient.prompt()
        .user(text)
        .call()
        .content();
    
    // æ–‡å­—è½¬è¯­éŸ³
    return textToSpeechService.synthesize(response);
}
```

### âš¡ æ€§èƒ½ä¼˜åŒ–åŠŸèƒ½

#### 6. **å¼‚æ­¥å¤„ç†**
```java
// æœªå®ç°ï¼šå¼‚æ­¥è°ƒç”¨
@Async
public CompletableFuture<List<Restaurant>> recommendRestaurantsAsync(RecommendationRequest request) {
    return chatClient.prompt()
        .user("æ¨èé¤å…")
        .call()
        .entity(new ParameterizedTypeReference<List<Restaurant>>() {})
        .toFuture();
}
```

#### 7. **ç¼“å­˜æœºåˆ¶**
```java
// æœªå®ç°ï¼šå“åº”ç¼“å­˜
@Cacheable("restaurant-recommendations")
public List<Restaurant> getCachedRecommendations(RecommendationRequest request) {
    return chatClient.prompt()
        .user("æ¨èé¤å…")
        .call()
        .entity(new ParameterizedTypeReference<List<Restaurant>>() {});
}
```

#### 8. **æ‰¹é‡å¤„ç†**
```java
// æœªå®ç°ï¼šæ‰¹é‡å¤„ç†
public List<List<Restaurant>> batchRecommend(List<RecommendationRequest> requests) {
    return chatClient.batch()
        .prompt("æ¨èé¤å…")
        .call()
        .entity(new ParameterizedTypeReference<List<Restaurant>>() {});
}
```

### ğŸ”§ é«˜çº§ç®¡ç†åŠŸèƒ½

#### 9. **æ¨¡å‹è·¯ç”±å’Œè´Ÿè½½å‡è¡¡**
```java
// æœªå®ç°ï¼šæ™ºèƒ½è·¯ç”±
@Bean
public ModelRouter modelRouter() {
    return ModelRouter.builder()
        .addRoute("restaurant", "gpt-4o")
        .addRoute("dish", "claude-3")
        .addRoute("chat", "llama-3")
        .build();
}
```

#### 10. **æç¤ºè¯æ¨¡æ¿ç®¡ç†**
```java
// æœªå®ç°ï¼šå¤æ‚æ¨¡æ¿
@Bean
public PromptTemplate restaurantTemplate() {
    return new PromptTemplate("""
        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é¤å…æ¨èåŠ©æ‰‹ã€‚
        ç”¨æˆ·åå¥½ï¼š{preferences}
        ä½ç½®ï¼š{location}
        é¢„ç®—ï¼š{budget}
        
        {% if occasion == "å•†åŠ¡èšé¤" %}
        è¯·æ¨èç¯å¢ƒä¼˜é›…ã€æœåŠ¡ä¸“ä¸šçš„é¤å…ã€‚
        {% elif occasion == "æœ‹å‹èšä¼š" %}
        è¯·æ¨èæ°›å›´è½»æ¾ã€èœå“ä¸°å¯Œçš„é¤å…ã€‚
        {% endif %}
        """);
}
```

### ğŸ  ä¼ä¸šçº§åŠŸèƒ½

#### 11. **å¤šç§Ÿæˆ·æ”¯æŒ**
```java
// æœªå®ç°ï¼šå¤šç§Ÿæˆ·éš”ç¦»
@Bean
public TenantAwareChatClient tenantAwareChatClient() {
    return TenantAwareChatClient.builder()
        .tenantResolver(tenantResolver)
        .modelProvider(tenantModelProvider)
        .build();
}
```

#### 12. **å®‰å…¨æ€§å’Œå†…å®¹è¿‡æ»¤**
```java
// æœªå®ç°ï¼šå†…å®¹å®‰å…¨
@Bean
public ContentFilterAdvisor contentFilterAdvisor() {
    return ContentFilterAdvisor.builder()
        .contentFilter(contentFilter)
        .build();
}
```

#### 13. **ç›‘æ§å’ŒæŒ‡æ ‡**
```java
// æœªå®ç°ï¼šæ€§èƒ½ç›‘æ§
@Bean
public MetricsAdvisor metricsAdvisor() {
    return MetricsAdvisor.builder()
        .meterRegistry(meterRegistry)
        .build();
}
```

### ğŸ’° æˆæœ¬ä¼˜åŒ–åŠŸèƒ½

#### 14. **æˆæœ¬æ§åˆ¶**
```java
// æœªå®ç°ï¼šæˆæœ¬æ§åˆ¶
@Bean
public CostOptimizationAdvisor costOptimizationAdvisor() {
    return CostOptimizationAdvisor.builder()
        .maxCostPerRequest(0.01)
        .fallbackModel("gpt-3.5-turbo")
        .build();
}
```

#### 15. **æ¨¡å‹çƒ­æ›´æ–°**
```java
// æœªå®ç°ï¼šåŠ¨æ€åˆ‡æ¢
@PostMapping("/switch-model")
public ResponseEntity<String> switchModel(@RequestParam String modelName) {
    modelManager.switchModel(modelName);
    return ResponseEntity.ok("æ¨¡å‹å·²åˆ‡æ¢");
}
```

## æ€»ç»“

Spring AI ä½œä¸º Spring ç”Ÿæ€ç³»ç»Ÿçš„æ–°æˆå‘˜ï¼Œä¸º Java å¼€å‘è€…æä¾›äº†æ„å»ºæ™ºèƒ½åŒ–åº”ç”¨çš„å¼ºå¤§å·¥å…·ã€‚éšç€ AI æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œæˆ‘ä»¬å¯ä»¥æœŸå¾…ï¼š

- **æ›´å¤šæ¨¡å‹æ”¯æŒ**ï¼šé›†æˆæ›´å¤š AI æ¨¡å‹æä¾›å•†
- **åŠŸèƒ½å¢å¼º**ï¼šæ›´ä¸°å¯Œçš„ AI åŠŸèƒ½ç‰¹æ€§
- **å¼€å‘å·¥å…·**ï¼šæ›´å®Œå–„çš„å¼€å‘å·¥å…·å’Œè°ƒè¯•æ”¯æŒ
- **ä¼ä¸šçº§åŠŸèƒ½**ï¼šæ›´å¼ºå¤§çš„ä¼ä¸šçº§ç‰¹æ€§å’Œç›‘æ§æ”¯æŒ

## å‚è€ƒèµ„æº

- [Spring AI å®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-ai/reference/)
- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs)
- [Mistral AI æ–‡æ¡£](https://docs.mistral.ai/)
- [Ollama æ–‡æ¡£](https://ollama.ai/docs)

---

*æœ¬æ–‡åŸºäº Spring AI 1.1.0-M2 ç‰ˆæœ¬ç¼–å†™ï¼Œéšç€æ¡†æ¶çš„ä¸æ–­å‘å±•ï¼Œéƒ¨åˆ† API å¯èƒ½ä¼šæœ‰å˜åŒ–ã€‚å»ºè®®å‚è€ƒå®˜æ–¹æ–‡æ¡£è·å–æœ€æ–°ä¿¡æ¯ã€‚*

