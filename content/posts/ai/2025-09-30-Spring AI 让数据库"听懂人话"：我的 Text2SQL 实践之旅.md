---
title: "Spring AI è®©æ•°æ®åº“å¬æ‡‚äººè¯ï¼šText2SQL è‡ªç„¶è¯­è¨€æŸ¥è¯¢å®è·µæŒ‡å—"
slug: spring-ai-text2sql-showcase
description: "æ·±å…¥æ¢ç´¢ Spring AI + DeepSeek å®ç° Text2SQL è‡ªç„¶è¯­è¨€æ•°æ®åº“æŸ¥è¯¢ï¼ŒåŒ…å«ç›´æ¥æ¨¡å¼ã€MCPå·¥å…·é›†æˆã€åˆ†æ­¥éª¤æŸ¥è¯¢ä¸‰ç§å®ç°æ–¹æ¡ˆï¼Œé™„å®Œæ•´æºç å’Œè¸©å‘ç»éªŒ"
keywords: "Spring AI, Text2SQL, è‡ªç„¶è¯­è¨€æŸ¥è¯¢, NL2SQL, Spring Boot, DeepSeek, MCPå·¥å…·, æ•°æ®åº“æŸ¥è¯¢, AIç¼–ç¨‹, æœºå™¨å­¦ä¹ , SQLç”Ÿæˆ, æ™ºèƒ½æŸ¥è¯¢, è‡ªç„¶è¯­è¨€å¤„ç†, äººå·¥æ™ºèƒ½, æ•°æ®åº“äº¤äº’, æ™ºèƒ½SQL, ä¸­æ–‡æŸ¥è¯¢, ä¸šåŠ¡è§„åˆ™æ¨ç†, å®‰å…¨é˜²æŠ¤, æç¤ºè¯å·¥ç¨‹"
tags: ['spring-ai', 'text2sql']
categories: ["ai"]
date: 2025-09-30
---

"èƒ½ä¸èƒ½è®©æ•°æ®åº“ç›´æ¥å¬æ‡‚ä¸­æ–‡é—®é¢˜ï¼Œç„¶åè‡ªåŠ¨ç”Ÿæˆ SQLï¼Ÿ" è¿™ä¸ªæƒ³æ³•åœ¨æˆ‘è„‘æµ·ä¸­ç›˜æ—‹äº†å¾ˆä¹…ã€‚æœ€è¿‘ç»ˆäºç”¨ **Spring AI** å®ç°äº†è¿™ä¸ªåŠŸèƒ½ï¼Œä»æœ€åˆçš„ç®€å•å®ç°åˆ°åæ¥çš„ **MCP å·¥å…·é›†æˆ**ï¼Œå†åˆ°**åˆ†æ­¥éª¤æŸ¥è¯¢æ¨¡å¼**ï¼Œæ•´ä¸ªè¿‡ç¨‹å……æ»¡äº†æƒŠå–œå’Œè¸©å‘ã€‚ä»Šå¤©å°±æ¥åˆ†äº«ä¸€ä¸‹æˆ‘çš„ **Text2SQL** å®è·µå¿ƒå¾—ã€‚

<!--more-->

## æºä»£ç 

å¦‚æœæ‚¨æƒ³äº²è‡ªå°è¯•ï¼Œå¯ä»¥éšæ—¶æŸ¥çœ‹æˆ‘çš„æºä»£ç ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¿…é¡»å…‹éš†æˆ‘çš„ç¤ºä¾‹ [GitHub ä»“åº“](https://github.com/chensoul/spring-ai-text2sql-showcase)ã€‚ç„¶åï¼Œæ‚¨åªéœ€æŒ‰ç…§æˆ‘çš„è¯´æ˜è¿›è¡Œæ“ä½œå³å¯ã€‚

## ä¸ºä»€ä¹ˆé€‰æ‹© Text2SQL

æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„åœºæ™¯ï¼šäº§å“ç»ç†é—®"ä¸Šä¸ªæœˆæŠ€æœ¯éƒ¨çš„å¹³å‡å·¥èµ„æ˜¯å¤šå°‘ï¼Ÿ"ï¼Œä½ ä¸éœ€è¦å†™å¤æ‚çš„ **SQL æŸ¥è¯¢è¯­å¥**ï¼Œåªéœ€è¦ç”¨**è‡ªç„¶è¯­è¨€æè¿°**ï¼Œç³»ç»Ÿå°±èƒ½è‡ªåŠ¨ç”Ÿæˆå¹¶æ‰§è¡ŒæŸ¥è¯¢ã€‚è¿™å°±æ˜¯ **Text2SQL**ï¼ˆä¹Ÿç§° **NL2SQL**ï¼‰çš„é­…åŠ›æ‰€åœ¨ã€‚

æˆ‘é€‰æ‹© **Spring AI** ä½œä¸º**è‡ªç„¶è¯­è¨€å¤„ç†**æ¡†æ¶ï¼Œä¸»è¦çœ‹ä¸­äº†å®ƒçš„ï¼š

- **ç®€å•æ˜“ç”¨**ï¼šå‡ è¡Œé…ç½®å°±èƒ½æ¥å…¥å„ç§ **LLM å¤§è¯­è¨€æ¨¡å‹**ï¼ˆOpenAIã€DeepSeekã€é€šä¹‰åƒé—®ç­‰ï¼‰
- **å·¥å…·é›†æˆ**ï¼šæ”¯æŒ **MCPï¼ˆModel Context Protocolï¼‰**å·¥å…·è°ƒç”¨ï¼Œå®ç°**å‡½æ•°è°ƒç”¨**èƒ½åŠ›
- **Spring ç”Ÿæ€**ï¼šä¸ç°æœ‰ **Spring Boot** é¡¹ç›®æ— ç¼é›†æˆï¼Œæ”¯æŒ**ä¾èµ–æ³¨å…¥**å’Œ**è‡ªåŠ¨é…ç½®**

**æ ¸å¿ƒæŠ€æœ¯æ ˆ** ï¼š
- **Spring Boot 3.5.7** + **Spring AI 1.1.0**ï¼ˆä¼ä¸šçº§ Java æ¡†æ¶ï¼‰
- **MySQL 9** (Dockerå®¹å™¨åŒ–éƒ¨ç½²)
- **DeepSeek Chat API**ï¼ˆå›½äº§å¤§è¯­è¨€æ¨¡å‹ï¼‰
- **Bootstrap 5** + **Thymeleaf**ï¼ˆå“åº”å¼å‰ç«¯æ¡†æ¶ï¼‰
- **Maven** æ„å»ºå·¥å…·

**å…³é”®ç‰¹æ€§**ï¼š
- æ”¯æŒä¸‰ç§**æ™ºèƒ½æŸ¥è¯¢æ¨¡å¼**ï¼šç›´æ¥æ¨¡å¼ã€**MCPå·¥å…·æ¨¡å¼**ã€**åˆ†æ­¥éª¤æ¨¡å¼**
- å†…ç½®**SQLæ³¨å…¥é˜²æŠ¤**ï¼ˆä»…å…è®¸SELECTæŸ¥è¯¢ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²ï¼‰
- **ç°ä»£åŒ–Webç•Œé¢**ï¼ˆæ”¯æŒç§»åŠ¨ç«¯é€‚é…ï¼‰
- **æ•°æ®åº“ç»“æ„è‡ªåŠ¨è·å–**ï¼ˆæ”¯æŒå¤šè¡¨å…³è”æŸ¥è¯¢ï¼‰

## 10 åˆ†é’Ÿå¿«é€Ÿä½“éªŒ

è®©æˆ‘ä»¬å…ˆå¿«é€Ÿè·‘èµ·æ¥ï¼Œçœ‹çœ‹**è‡ªç„¶è¯­è¨€æ•°æ®åº“æŸ¥è¯¢**çš„æ•ˆæœå¦‚ä½•ï¼š

**ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡**
```bash
# è®¾ç½® DeepSeek API Keyï¼ˆæ”¯æŒ OpenAIã€Claudeã€é€šä¹‰åƒé—®ç­‰å¤šç§ LLMï¼‰
export DEEPSEEK_API_KEY="your-deepseek-api-key-here"

# å¯åŠ¨ MySQL æ•°æ®åº“å®¹å™¨ï¼ˆDocker å®¹å™¨åŒ–éƒ¨ç½²ï¼‰
docker-compose up -d

# Maven ç¼–è¯‘å¹¶è¿è¡Œ Spring Boot åº”ç”¨
mvn clean spring-boot:run
```

**ç¬¬äºŒæ­¥ï¼šä½“éªŒæ™ºèƒ½æŸ¥è¯¢**

- **ç›´æ¥æŸ¥è¯¢æ¨¡å¼**ï¼šhttp://localhost:8080 ï¼ˆå•æ­¥ SQL ç”Ÿæˆï¼‰
- **åˆ†æ­¥éª¤æ¨¡å¼**ï¼šhttp://localhost:8080/step ï¼ˆå¤šæ­¥æ¨ç†æŸ¥è¯¢ï¼‰

> ğŸ’¡ **å°è´´å£«**ï¼šé¦–æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨æ‰§è¡Œ**æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬**ï¼ŒåŠ è½½å‘˜å·¥ã€éƒ¨é—¨ã€é¡¹ç›®ç¤ºä¾‹æ•°æ®ã€‚

## ç¬¬ä¸€ç‰ˆï¼šç®€å•ç²—æš´çš„ç›´æ¥æ¨¡å¼

æœ€å¼€å§‹ï¼Œæˆ‘é‡‡ç”¨äº†æœ€ç®€å•ç›´æ¥çš„æ–¹å¼ï¼šæŠŠ**æ•°æ®åº“ Schema** ä½œä¸º**ä¸Šä¸‹æ–‡ä¿¡æ¯**æ³¨å…¥åˆ°**æç¤ºè¯å·¥ç¨‹**ä¸­ï¼Œè®© **LLM å¤§è¯­è¨€æ¨¡å‹**ç›´æ¥ç”Ÿæˆ SQLã€‚è¿™ç§**é›¶æ ·æœ¬å­¦ä¹ **æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†æ•ˆæœå‡ºå¥‡åœ°å¥½ã€‚

**æ ¸å¿ƒæ€è·¯**ï¼š**æ•°æ®åº“ç»“æ„** + **ç”¨æˆ·é—®é¢˜** â†’ **AI æ¨¡å‹æ¨ç†** â†’ **SQL è¯­å¥** â†’ **å®‰å…¨æ ¡éªŒ** â†’ **æ‰§è¡ŒæŸ¥è¯¢**

### ç³»ç»Ÿæ¶æ„å›¾
```mermaid
flowchart LR
User[Browser UI] --> Controller[REST Controller]
Controller --> Service[DirectText2SqlService]
Service --> ChatClient[Spring AI ChatClient]
Service --> DatabaseTool[JdbcTemplate Tool]
ChatClient --> DeepSeek[DeepSeek Chat API]
DatabaseTool --> MySQL[MySQL Database]
```

### æ ¸å¿ƒä»£ç å®ç°

è®©æˆ‘æ¥å±•ç¤ºä¸€ä¸‹æœ€æ ¸å¿ƒçš„ `DirectText2SqlService` ç±»ï¼š

```java
@Slf4j
@RequiredArgsConstructor
public class DirectText2SqlService implements Text2SqlService {
    private final ChatClient chatClient;
    private final DatabaseTool databaseTool;

    // SQL ç”Ÿæˆæç¤ºæ¨¡æ¿
    private static final String SQL_GENERATION_PROMPT = """
            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ SQL ç”ŸæˆåŠ©æ‰‹ã€‚åŸºäºä»¥ä¸‹æ•°æ®åº“ç»“æ„ä¿¡æ¯ï¼Œå°†ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢è½¬æ¢ä¸º SQL è¯­å¥ã€‚
            
            æ•°æ®åº“ç»“æ„ä¿¡æ¯ï¼š
            {schema}
            
            è¯·éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š
            1. åªç”Ÿæˆ SELECT æŸ¥è¯¢è¯­å¥
            2. ä½¿ç”¨æ­£ç¡®çš„è¡¨åå’Œå­—æ®µå
            3. æ·»åŠ é€‚å½“çš„ WHERE æ¡ä»¶
            4. ä½¿ç”¨ LIMIT é™åˆ¶ç»“æœæ•°é‡ï¼ˆæœ€å¤š 1000 æ¡ï¼‰
            5. ç¡®ä¿ SQL è¯­æ³•æ­£ç¡®
            6. å¦‚æœæŸ¥è¯¢æ¶‰åŠå¤šè¡¨ï¼Œè¯·ä½¿ç”¨é€‚å½“çš„ JOIN
            7. åªè¿”å› SQL è¯­å¥ï¼Œä¸è¦åŒ…å«å…¶ä»–è§£é‡Š
            
            ç”¨æˆ·æŸ¥è¯¢ï¼š{userQuery}
            """;

    /**
     * å°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸º SQL å¹¶æ‰§è¡ŒæŸ¥è¯¢
     *
     * @param userQuery ç”¨æˆ·è‡ªç„¶è¯­è¨€æŸ¥è¯¢
     * @return æŸ¥è¯¢ç»“æœ
     */
    @Override
    public Text2SqlResult processQuery(String userQuery) {
        try {
            // 1. éªŒè¯è¾“å…¥
            if (userQuery == null || userQuery.trim().isEmpty()) {
                return Text2SqlResult.error("æŸ¥è¯¢å†…å®¹ä¸èƒ½ä¸ºç©º");
            }

            // 2. ç”Ÿæˆ SQL
            String sql = generateSql(userQuery);
            if (sql == null || sql.trim().isEmpty()) {
                return Text2SqlResult.error("æ— æ³•ç”Ÿæˆæœ‰æ•ˆçš„SQLæŸ¥è¯¢ï¼Œè¯·æ£€æŸ¥æ‚¨çš„æŸ¥è¯¢æè¿°");
            }

            // 3. éªŒè¯ SQL å®‰å…¨æ€§
            if (!SqlUtils.isSqlSafe(sql)) {
                return Text2SqlResult.error("ç”Ÿæˆçš„ SQL åŒ…å«ä¸å®‰å…¨çš„æ“ä½œï¼Œè¯·é‡æ–°æè¿°æ‚¨çš„æŸ¥è¯¢éœ€æ±‚");
            }

            log.info("sql: {}", sql);

            // 4. æ‰§è¡Œ SQL æŸ¥è¯¢
            List<Map<String, Object>> results = databaseTool.executeQuery(sql);

            return Text2SqlResult.success(sql, results);

        } catch (Exception e) {
            log.error("å¤„ç†æŸ¥è¯¢æ—¶å‘ç”Ÿé”™è¯¯: {}", e.getMessage(), e);
            return Text2SqlResult.error("å¤„ç†æŸ¥è¯¢æ—¶å‘ç”Ÿé”™è¯¯: " + e.getMessage());
        }
    }

    /**
     * ç”Ÿæˆ SQL æŸ¥è¯¢è¯­å¥
     */
    private String generateSql(String userQuery) {
        // è·å–æ•°æ®åº“ç»“æ„ä¿¡æ¯
        String schema = databaseTool.getDatabaseSchema();

        // åˆ›å»ºæç¤ºæ¨¡æ¿
        PromptTemplate promptTemplate = new PromptTemplate(SQL_GENERATION_PROMPT);

        // æ„å»ºæç¤º
        Prompt prompt = promptTemplate.create(Map.of(
                "schema", schema,
                "userQuery", userQuery
        ));

        // è°ƒç”¨ AI ç”Ÿæˆ SQL
        ChatResponse response = chatClient.prompt(prompt).call().chatResponse();
        String sql = response.getResult().getOutput().getText();

        // æ¸…ç† SQL è¯­å¥ï¼ˆç§»é™¤å¯èƒ½çš„ä»£ç å—æ ‡è®°ï¼‰
        sql = sql.replaceAll("```sql", "").replaceAll("```", "").trim();

        return sql;
    }
}
```


### æ ¸å¿ƒé…ç½®

è®©æˆ‘æ¥å±•ç¤ºä¸€ä¸‹å…³é”®çš„é…ç½®æ–‡ä»¶ã€‚é¦–å…ˆæ˜¯ `application.yml`ï¼š
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/text2sql_db?useUnicode=true&characterEncoding=UTF-8
    username: root
    password: root123
  ai:
    openai:
      base-url: https://api.deepseek.com
      api-key: ${DEEPSEEK_API_KEY}
      chat:
        options:
          model: deepseek-chat
          temperature: 0.1
```

ç„¶åæ˜¯ `docker-compose.yml` çš„æ•°æ®åº“é…ç½®ï¼š
```yaml
services:
  mysql:
    image: mysql:8
    container_name: text2sql-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: text2sql_db
    ports:
      - "3306:3306"
    volumes:
      - ./mysql.cnf:/etc/mysql/conf.d/mysql.cnf
      - ./src/main/resources/schema.sql:/docker-entrypoint-initdb.d/01-schema.sql
      - ./src/main/resources/data.sql:/docker-entrypoint-initdb.d/02-data.sql
```

### Spring AI é…ç½®ç±»

```java
@Configuration
public class AppConfig {
    @Bean
    public ChatClient chatClient(OpenAiChatModel chatModel) {
        return ChatClient.builder(chatModel)
                .defaultAdvisors(new SimpleLoggerAdvisor())
                .build();
    }
}
```

è¿™ä¸ªé…ç½®ç±»åšäº†ä¸€ä»¶äº‹ï¼š
1. **åŸºç¡€ ChatClient**ï¼šç”¨äºç›´æ¥æ¨¡å¼çš„ SQL ç”Ÿæˆ

### API æ¥å£è®¾è®¡

æˆ‘è®¾è®¡äº†ä¸¤ä¸ªæ ¸å¿ƒæ¥å£ï¼š

- **æŸ¥è¯¢æ¥å£**ï¼š`POST /api/query` - æ¥æ”¶è‡ªç„¶è¯­è¨€é—®é¢˜ï¼Œè¿”å› SQL å’ŒæŸ¥è¯¢ç»“æœ
- **ç»“æ„æ¥å£**ï¼š`GET /api/schema` - è·å–æ•°æ®åº“ç»“æ„ä¿¡æ¯

### REST Controller å®ç°

```java
@Controller
@RequiredArgsConstructor
public class Text2SqlController {
    private final Text2SqlService text2SqlService;
    private final DatabaseTool databaseTool;

    /**
     * å¤„ç†è‡ªç„¶è¯­è¨€æŸ¥è¯¢çš„ API æ¥å£
     */
    @PostMapping("/api/query")
    @ResponseBody
    public ResponseEntity<Map<String, Object>> processQuery(@RequestBody Map<String, String> request) {
        String query = request.get("query");

        if (query == null || query.trim().isEmpty()) {
            Map<String, Object> response = new HashMap<>();
            response.put("success", false);
            response.put("error", "æŸ¥è¯¢å†…å®¹ä¸èƒ½ä¸ºç©º");
            return ResponseEntity.badRequest().body(response);
        }

        // å¤„ç†æŸ¥è¯¢
        Text2SqlResult result = text2SqlService.processQuery(query);

        Map<String, Object> response = new HashMap<>();
        response.put("success", result.isSuccess());

        if (result.isSuccess()) {
            response.put("sql", result.getSql());
            response.put("data", result.getData());
            response.put("count", result.getData().size());
        } else {
            response.put("error", result.getError());
        }

        return ResponseEntity.ok(response);
    }

    /**
     * è·å–æ•°æ®åº“ç»“æ„ä¿¡æ¯çš„ API
     */
    @GetMapping("/api/schema")
    @ResponseBody
    public ResponseEntity<Map<String, String>> getSchema() {
        Map<String, String> response = new HashMap<>();
        response.put("schema", databaseTool.getDatabaseSchema());
        return ResponseEntity.ok(response);
    }
}
```

è®©æˆ‘ä»¬çœ‹çœ‹å®é™…çš„ä½¿ç”¨æ•ˆæœï¼š

```bash
curl -X POST http://localhost:8080/api/query \
  -H "Content-Type: application/json" \
  -d '{"query": "ç»Ÿè®¡æ¯ä¸ªéƒ¨é—¨çš„å‘˜å·¥æ•°é‡"}'
```

**è¿”å›ç»“æœ**ï¼š
```json
{
  "success": true,
  "sql": "SELECT department, COUNT(*) as count FROM employees GROUP BY department",
  "data": [ { "department": "æŠ€æœ¯éƒ¨", "count": 3 } ],
  "count": 1
}
```

çœ‹åˆ°æ²¡ï¼ŸAI ä¸ä»…ç”Ÿæˆäº†æ­£ç¡®çš„ SQLï¼Œè¿˜ç›´æ¥è¿”å›äº†æŸ¥è¯¢ç»“æœï¼è¿™å°±æ˜¯ Text2SQL çš„é­…åŠ›ã€‚

### å‰ç«¯ç•Œé¢å±•ç¤º

æˆ‘è®¾è®¡äº†ä¸€ä¸ªç®€æ´ç¾è§‚çš„ Web ç•Œé¢ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿç›´è§‚åœ°ä½“éªŒ Text2SQL åŠŸèƒ½ï¼š

![Spring AI Text2SQL ç›´æ¥æ¨¡å¼ç•Œé¢å±•ç¤º - è‡ªç„¶è¯­è¨€æ•°æ®åº“æŸ¥è¯¢ç³»ç»Ÿå‰ç«¯ç•Œé¢ï¼ŒåŒ…å«ä¸­æ–‡æŸ¥è¯¢è¾“å…¥æ¡†ã€ç¤ºä¾‹æŸ¥è¯¢æ¨¡æ¿ã€SQLç”Ÿæˆç»“æœå±•ç¤ºå’Œæ•°æ®åº“ç»“æ„æŸ¥çœ‹åŠŸèƒ½](https://csmos.oss-cn-beijing.aliyuncs.com/spring-ai-text2sql-showcase-01.png)

**ä¸»è¦åŠŸèƒ½**ï¼š
- **è‡ªç„¶è¯­è¨€è¾“å…¥**ï¼šç”¨æˆ·å¯ä»¥ç›´æ¥ç”¨ä¸­æ–‡æè¿°æŸ¥è¯¢éœ€æ±‚
- **ç¤ºä¾‹æŸ¥è¯¢**ï¼šæä¾›å¸¸ç”¨çš„æŸ¥è¯¢æ¨¡æ¿ï¼Œç‚¹å‡»å³å¯ä½¿ç”¨
- **å®æ—¶ç»“æœå±•ç¤º**ï¼šæ˜¾ç¤ºç”Ÿæˆçš„ SQL å’ŒæŸ¥è¯¢ç»“æœ
- **æ•°æ®åº“ç»“æ„æŸ¥çœ‹**ï¼šå¯ä»¥æŸ¥çœ‹å®Œæ•´çš„æ•°æ®åº“ç»“æ„ä¿¡æ¯

**ç•Œé¢ç‰¹è‰²**ï¼š
- ä½¿ç”¨ Bootstrap 5 æ„å»ºï¼Œå“åº”å¼è®¾è®¡
- æ¸å˜è‰²èƒŒæ™¯ï¼Œè§†è§‰æ•ˆæœç°ä»£
- ä»£ç é«˜äº®æ˜¾ç¤ºï¼ŒSQL è¯­å¥æ¸…æ™°å¯è¯»
- è¡¨æ ¼ç»“æœå±•ç¤ºï¼Œæ•°æ®ä¸€ç›®äº†ç„¶

**ç¤ºä¾‹æ•°æ®è¡¨ç»“æ„**ï¼š

```sql
-- å‘˜å·¥è¡¨æ•°æ®
INSERT IGNORE INTO employees (name, department, position, salary, hire_date, email) VALUES
('å¼ ä¸‰', 'æŠ€æœ¯éƒ¨', 'é«˜çº§å·¥ç¨‹å¸ˆ', 15000, '2022-01-15', 'zhangsan@company.com'),
('æå››', 'æŠ€æœ¯éƒ¨', 'å·¥ç¨‹å¸ˆ', 12000, '2022-03-20', 'lisi@company.com'),
('ç‹äº”', 'é”€å”®éƒ¨', 'é”€å”®ç»ç†', 18000, '2021-11-10', 'wangwu@company.com'),
('èµµå…­', 'é”€å”®éƒ¨', 'é”€å”®ä»£è¡¨', 10000, '2023-02-01', 'zhaoliu@company.com'),
('é’±ä¸ƒ', 'äººäº‹éƒ¨', 'äººäº‹ç»ç†', 16000, '2021-08-05', 'qianqi@company.com'),
('å­™å…«', 'è´¢åŠ¡éƒ¨', 'ä¼šè®¡å¸ˆ', 14000, '2022-06-15', 'sunba@company.com'),
('å‘¨ä¹', 'æŠ€æœ¯éƒ¨', 'æ¶æ„å¸ˆ', 25000, '2020-12-01', 'zhoujiu@company.com'),
('å´å', 'å¸‚åœºéƒ¨', 'å¸‚åœºä¸“å‘˜', 11000, '2023-01-10', 'wushi@company.com');

-- é¡¹ç›®è¡¨æ•°æ®
INSERT IGNORE INTO projects (name, description, start_date, end_date, status, budget) VALUES
('ç”µå•†å¹³å°é‡æ„', 'é‡æ„ç°æœ‰ç”µå•†å¹³å°ï¼Œæå‡æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ', '2023-01-01', '2023-06-30', 'è¿›è¡Œä¸­', 500000),
('ç§»åŠ¨ç«¯åº”ç”¨å¼€å‘', 'å¼€å‘å…¬å¸ç§»åŠ¨ç«¯åº”ç”¨', '2023-03-01', '2023-08-31', 'è¿›è¡Œä¸­', 300000),
('æ•°æ®åˆ†æç³»ç»Ÿ', 'æ„å»ºä¼ä¸šæ•°æ®åˆ†æå¹³å°', '2022-10-01', '2023-02-28', 'å·²å®Œæˆ', 200000),
('å®¢æˆ·ç®¡ç†ç³»ç»Ÿ', 'å‡çº§å®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿ', '2023-02-15', '2023-07-15', 'è¿›è¡Œä¸­', 150000),
('è´¢åŠ¡ç³»ç»Ÿä¼˜åŒ–', 'ä¼˜åŒ–è´¢åŠ¡ç³»ç»Ÿæ€§èƒ½', '2022-12-01', '2023-01-31', 'å·²å®Œæˆ', 80000);

-- é¡¹ç›®æˆå‘˜å…³ç³»è¡¨æ•°æ®
INSERT IGNORE INTO project_members (project_id, employee_id, role, join_date) VALUES
(1, 1, 'å¼€å‘è´Ÿè´£äºº', '2023-01-01'),
(1, 2, 'å¼€å‘å·¥ç¨‹å¸ˆ', '2023-01-01'),
(1, 7, 'æŠ€æœ¯æ¶æ„å¸ˆ', '2023-01-01'),
(2, 1, 'é¡¹ç›®ç»ç†', '2023-03-01'),
(2, 2, 'å¼€å‘å·¥ç¨‹å¸ˆ', '2023-03-01'),
(3, 7, 'æŠ€æœ¯è´Ÿè´£äºº', '2022-10-01'),
(3, 6, 'æ•°æ®åˆ†æå¸ˆ', '2022-10-01'),
(4, 3, 'é¡¹ç›®ç»ç†', '2023-02-15'),
(4, 4, 'ä¸šåŠ¡åˆ†æå¸ˆ', '2023-02-15'),
(5, 6, 'é¡¹ç›®ç»ç†', '2022-12-01');

-- éƒ¨é—¨è¡¨æ•°æ®
INSERT IGNORE INTO departments (name, manager_id, budget, location) VALUES
('æŠ€æœ¯éƒ¨', 7, 2000000, 'åŒ—äº¬'),
('é”€å”®éƒ¨', 3, 1500000, 'ä¸Šæµ·'),
('äººäº‹éƒ¨', 5, 800000, 'åŒ—äº¬'),
('è´¢åŠ¡éƒ¨', 6, 600000, 'åŒ—äº¬'),
('å¸‚åœºéƒ¨', 8, 1000000, 'ä¸Šæµ·');
```

## ç¬¬äºŒç‰ˆï¼šMCP å·¥å…·é›†æˆæ¨¡å¼ - è®© AI æ›´èªæ˜

ç›´æ¥æ¨¡å¼è™½ç„¶ç®€å•ï¼Œä½†é‡åˆ°**å¤æ‚æ•°æ®åº“æŸ¥è¯¢**æ—¶å°±å¼€å§‹åŠ›ä¸ä»å¿ƒäº†ã€‚æ¯”å¦‚**å¤šè¡¨å…³è”æŸ¥è¯¢**ã€**å­—æ®µè¯­ä¹‰ç†è§£**ç­‰æƒ…å†µï¼ŒAI å®¹æ˜“äº§ç”Ÿ**å¹»è§‰é—®é¢˜**ã€‚

è¿™æ—¶å€™ï¼Œæˆ‘å¼•å…¥äº† **MCPï¼ˆModel Context Protocolï¼‰å·¥å…·é›†æˆ**ï¼Œè®© **LLM å¤§è¯­è¨€æ¨¡å‹**èƒ½å¤Ÿï¼š
1. **å…ˆè®¤çŸ¥**ï¼šé€šè¿‡**å‡½æ•°è°ƒç”¨**è·å–çœŸå®çš„**æ•°æ®åº“ Schema**
2. **å†ç”Ÿæˆ**ï¼šåŸºäºçœŸå®ç»“æ„ç”Ÿæˆ**ç²¾å‡† SQL**
3. **åéªŒè¯**ï¼šæ‰§è¡Œå‰å…ˆåš**è¯­æ³•æ ¡éªŒ**å’Œ**å®‰å…¨æ£€æŸ¥**

### ä¸ºä»€ä¹ˆéœ€è¦ MCP å·¥å…·è°ƒç”¨ï¼Ÿ

æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„æ•°æ®åº“æœ‰ 50 å¼ è¡¨ï¼Œæ¯å¼ è¡¨éƒ½æœ‰å¤æ‚çš„**å¤–é”®å…³è”**ã€‚å¦‚æœæŠŠè¿™äº›ä¿¡æ¯éƒ½å¡è¿›**æç¤ºè¯ä¸Šä¸‹æ–‡**ï¼Œä¸ä»…ä¼šè¶…å‡º**æ¨¡å‹ä¸Šä¸‹æ–‡çª—å£**é™åˆ¶ï¼Œè¿˜å®¹æ˜“è®© AI äº§ç”Ÿ**æ•°æ®å¹»è§‰**ã€‚

**MCP å·¥å…·æ¨¡å¼**çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š

- **åŠ¨æ€è·å–**ï¼šå®æ—¶ä»æ•°æ®åº“è·å–**å…ƒæ•°æ®ä¿¡æ¯**ï¼Œé¿å…è¿‡æ—¶æ•°æ®
- **å®‰å…¨éªŒè¯**ï¼šç”Ÿæˆ SQL åå…ˆåš**è¯­æ³•æ£€æŸ¥**ï¼Œç¡®ä¿æŸ¥è¯¢æ­£ç¡®
- **æ™ºèƒ½çº é”™**ï¼šå¦‚æœ SQL æœ‰é—®é¢˜ï¼ŒAI å¯ä»¥æ ¹æ®**é”™è¯¯ä¿¡æ¯**è‡ªåŠ¨ä¿®æ­£

**é€‚ç”¨åœºæ™¯**ï¼š

- **å¤æ‚å¤šè¡¨å…³è”æŸ¥è¯¢**ï¼ˆJOINã€å­æŸ¥è¯¢ï¼‰
- å¯¹**å­—æ®µè¯­ä¹‰**æ•æ„Ÿçš„æŸ¥è¯¢
- éœ€è¦**é«˜å‡†ç¡®æ€§**çš„ç”Ÿäº§ç¯å¢ƒ

### MCP å·¥å…·è°ƒç”¨æµç¨‹å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Controller as REST Controller
    participant Service as MCP Text2SQL Service
    participant AI as AI æ¨¡å‹
    participant Tool as æ•°æ®åº“å·¥å…·
    participant DB as MySQL æ•°æ®åº“

    User->>Controller: å‘é€è‡ªç„¶è¯­è¨€æŸ¥è¯¢
    Controller->>Service: å¤„ç†æŸ¥è¯¢è¯·æ±‚
    Service->>AI: è¯·æ±‚è·å–æ•°æ®åº“ç»“æ„
    AI->>Tool: è°ƒç”¨ getDatabaseSchema å·¥å…·
    Tool->>DB: æŸ¥è¯¢ INFORMATION_SCHEMA
    DB-->>Tool: è¿”å›è¡¨ç»“æ„ä¿¡æ¯
    Tool-->>AI: è¿”å›ç»“æ„æ•°æ®
    AI-->>Service: è¿”å›ç»“æ„ä¿¡æ¯
    Service->>AI: åŸºäºç»“æ„ç”Ÿæˆ SQL
    AI-->>Service: è¿”å›ç”Ÿæˆçš„ SQL
    Service->>AI: è¯·æ±‚éªŒè¯ SQLï¼ˆå°èŒƒå›´æµ‹è¯•ï¼‰
    AI->>Tool: è°ƒç”¨ executeQuery å·¥å…·ï¼ˆLIMIT 1ï¼‰
    Tool->>DB: æ‰§è¡Œæµ‹è¯•æŸ¥è¯¢
    DB-->>Tool: è¿”å›æµ‹è¯•ç»“æœ
    Tool-->>AI: è¿”å›éªŒè¯ç»“æœ
    AI-->>Service: è¿”å›éªŒè¯é€šè¿‡/å¤±è´¥ä¿¡æ¯
    
    alt SQL éªŒè¯é€šè¿‡
        Service->>Tool: æ‰§è¡Œå®Œæ•´æŸ¥è¯¢
        Tool->>DB: æ‰§è¡Œå®Œæ•´ SQL
        DB-->>Tool: è¿”å›å®Œæ•´ç»“æœ
        Tool-->>Service: è¿”å›æŸ¥è¯¢ç»“æœ
        Service-->>Controller: è¿”å›æˆåŠŸç»“æœ
        Controller-->>User: è¿”å› SQL å’ŒæŸ¥è¯¢ç»“æœ
    else SQL éªŒè¯å¤±è´¥
        Service->>AI: è¯·æ±‚ä¿®æ­£ SQL
        AI-->>Service: è¿”å›ä¿®æ­£åçš„ SQL
        Service->>AI: å†æ¬¡éªŒè¯ä¿®æ­£åçš„ SQL
        AI-->>Service: è¿”å›éªŒè¯ç»“æœ
        Service-->>Controller: è¿”å›é”™è¯¯æˆ–ä¿®æ­£åçš„ç»“æœ
        Controller-->>User: è¿”å›é”™è¯¯ä¿¡æ¯æˆ–ä¿®æ­£åçš„ç»“æœ
    end
```

### Spring AI é…ç½®ç±»

```java
@Configuration
public class AppConfig {
    @Bean
    public ChatClient chatClient(OpenAiChatModel chatModel) {
        return ChatClient.builder(chatModel).defaultAdvisors(new SimpleLoggerAdvisor()).build();
    }

    @Bean("mcpChatClient")
    public ChatClient mcpChatClient(ChatClient.Builder chatClientBuilder, DatabaseTool databaseTool) {
        return chatClientBuilder
                .defaultTools(databaseTool)
                .build();
    }
}
```

mcpChatClient è®¾ç½®äº†é»˜è®¤çš„å·¥å…· databaseToolï¼ŒDatabaseTool çš„æ–¹æ³•éœ€è¦æ·»åŠ  MCP çš„ @Tool æ³¨è§£ï¼š

```java
@Slf4j
@Service
@RequiredArgsConstructor
public class DatabaseTool {
    private final JdbcTemplate jdbcTemplate;

    @Tool(name = "getTableNames", description = "è·å–æ•°æ®åº“ä¸­æ‰€æœ‰è¡¨çš„åç§°åˆ—è¡¨")
    public List<String> getTableNames() {
        try {
            String sql = """
                    SELECT TABLE_NAME 
                    FROM INFORMATION_SCHEMA.TABLES 
                    WHERE TABLE_SCHEMA = DATABASE()
                    AND TABLE_TYPE = 'BASE TABLE'
                    ORDER BY TABLE_NAME
                    """;

            return jdbcTemplate.queryForList(sql, String.class);
        } catch (Exception e) {
            log.error("è·å–è¡¨åˆ—è¡¨å¤±è´¥", e);
            return List.of();
        }
    }
    //...
}
```

### McpText2SqlService

```java
@Slf4j
@Service
@RequiredArgsConstructor
public class McpText2SqlService implements Text2SqlService {

    @Qualifier("mcpChatClient")
    private final ChatClient mcpChatClient;

    // SQL ç”Ÿæˆæç¤ºæ¨¡æ¿ï¼ˆMCPç‰ˆæœ¬ï¼‰
    private static final String SQL_GENERATION_PROMPT = """
            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ SQL ç”ŸæˆåŠ©æ‰‹ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·æ¥è·å–æ•°æ®åº“ç»“æ„ä¿¡æ¯ï¼š
            
            å¯ç”¨å·¥å…·ï¼š
            - getTableNames(): è·å–æ‰€æœ‰è¡¨å
            - getTableSchema(tableName): è·å–æŒ‡å®šè¡¨çš„å®Œæ•´ç»“æ„
            - getDatabaseSchema(): è·å–æ‰€æœ‰è¡¨çš„å®Œæ•´ç»“æ„
            - getTableColumns(tableName): è·å–æŒ‡å®šè¡¨çš„åˆ—ä¿¡æ¯
            - executeQuery(sql): æ‰§è¡Œ SQL æŸ¥è¯¢éªŒè¯ç»“æœ
            
            è¯·éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š
            1. é¦–å…ˆä½¿ç”¨ getTableNames() äº†è§£æ•°æ®åº“ä¸­æœ‰å“ªäº›è¡¨
            2. æ ¹æ®ç”¨æˆ·æŸ¥è¯¢éœ€æ±‚ï¼Œä½¿ç”¨ getTableSchema() è·å–ç›¸å…³è¡¨çš„ç»“æ„ä¿¡æ¯
            3. åªç”Ÿæˆ SELECT æŸ¥è¯¢è¯­å¥
            4. ä½¿ç”¨æ­£ç¡®çš„è¡¨åå’Œå­—æ®µå
            5. æ·»åŠ é€‚å½“çš„ WHERE æ¡ä»¶
            6. ä½¿ç”¨ LIMIT é™åˆ¶ç»“æœæ•°é‡ï¼ˆæœ€å¤š 1000 æ¡ï¼‰
            7. ç¡®ä¿ SQL è¯­æ³•æ­£ç¡®
            8. å¦‚æœæŸ¥è¯¢æ¶‰åŠå¤šè¡¨ï¼Œè¯·ä½¿ç”¨é€‚å½“çš„ JOIN
            9. ç”Ÿæˆ SQL åï¼Œå¯ä»¥ä½¿ç”¨ executeQuery() éªŒè¯ç»“æœ
            10. åªè¿”å› SQL è¯­å¥ï¼Œä¸è¦åŒ…å«å…¶ä»–è§£é‡Š
            
            ç”¨æˆ·æŸ¥è¯¢ï¼š{userQuery}
            """;

    /**
     * å°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸º SQL å¹¶æ‰§è¡ŒæŸ¥è¯¢ï¼ˆMCPç‰ˆæœ¬ï¼‰
     */
    @Override
    public Text2SqlResult processQuery(String userQuery) {
        try {
            // 1. éªŒè¯è¾“å…¥
            if (userQuery == null || userQuery.trim().isEmpty()) {
                return Text2SqlResult.error("æŸ¥è¯¢ä¸èƒ½ä¸ºç©º");
            }

            // 2. ä½¿ç”¨ MCP å·¥å…·ç”Ÿæˆ SQL
            String sql = generateSqlWithMcpTools(userQuery);
            if (sql == null || sql.trim().isEmpty()) {
                return Text2SqlResult.error("æ— æ³•ç”Ÿæˆæœ‰æ•ˆçš„ SQL æŸ¥è¯¢");
            }

            // 3. éªŒè¯ SQL å®‰å…¨æ€§
            if (!SqlUtils.isSqlSafe(sql)) {
                return Text2SqlResult.error("ç”Ÿæˆçš„ SQL ä¸å®‰å…¨ï¼ŒåŒ…å«å±é™©æ“ä½œ");
            }

            // 4. æ‰§è¡ŒæŸ¥è¯¢
            List<Map<String, Object>> results = executeQuery(sql);
            return Text2SqlResult.success(sql, results);

        } catch (Exception e) {
            log.error("MCP Text2SQL å¤„ç†å¤±è´¥", e);
            return Text2SqlResult.error("å¤„ç†æŸ¥è¯¢æ—¶å‘ç”Ÿé”™è¯¯: " + e.getMessage());
        }
    }

    private String generateSqlWithMcpTools(String userQuery) {
        try {
            PromptTemplate promptTemplate = new PromptTemplate(SQL_GENERATION_PROMPT);
            Prompt prompt = promptTemplate.create(Map.of("userQuery", userQuery));

            ChatResponse response = mcpChatClient.prompt(prompt).call().chatResponse();
            String sql = response.getResult().getOutput().getText();

            // æ¸…ç† SQL è¯­å¥ï¼Œç§»é™¤å¯èƒ½çš„è§£é‡Šæ–‡æœ¬
            sql = SqlUtils.cleanSql(sql);

            log.info("MCP å·¥å…·ç”Ÿæˆçš„ SQL: {}", sql);
            return sql;

        } catch (Exception e) {
            log.error("ä½¿ç”¨ MCP å·¥å…·ç”Ÿæˆ SQL å¤±è´¥", e);
            return null;
        }
    }

    private List<Map<String, Object>> executeQuery(String sql) {
        log.info("ä½¿ç”¨ MCP å·¥å…·æ‰§è¡ŒæŸ¥è¯¢: {}", sql);

        List<Map<String, Object>> result = mcpChatClient.prompt()
                .user("è¯·ä½¿ç”¨ executeQuery å·¥å…·æ‰§è¡Œä»¥ä¸‹ SQL æŸ¥è¯¢: " + sql)
                .call()
                .entity(new ParameterizedTypeReference<List<Map<String, Object>>>() {
                });

        log.info("MCP å·¥å…·æ‰§è¡ŒæŸ¥è¯¢å®Œæˆï¼Œè¿”å› {} æ¡è®°å½•", result.size());
        return result;
    }
}
```

## ç¬¬ä¸‰ç‰ˆï¼šåˆ†æ­¥éª¤æŸ¥è¯¢æ¨¡å¼ - è®© AI æ¨ç†è¿‡ç¨‹é€æ˜åŒ– 

æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ä»…æƒ³è¦ç»“æœï¼Œè¿˜æƒ³çŸ¥é“ **AI å¤§è¯­è¨€æ¨¡å‹**æ˜¯æ€ä¹ˆ**é€»è¾‘æ¨ç†**çš„ã€‚ç‰¹åˆ«æ˜¯åœ¨**æ•™å­¦æ¼”ç¤º**ã€**è°ƒè¯•å¤æ‚æŸ¥è¯¢**æˆ–è€…**ç”Ÿäº§ç¯å¢ƒç›‘æ§**æ—¶ï¼Œ**åˆ†æ­¥éª¤å±•ç¤º**å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚

å‚è€ƒé˜¿é‡Œçš„**æè¨€äº§å“**ï¼ŒæŠŠæ•´ä¸ª **Text2SQL è‡ªç„¶è¯­è¨€å¤„ç†**è¿‡ç¨‹æ‹†è§£æˆäº† 5 ä¸ªæ¸…æ™°çš„**æ¨ç†æ­¥éª¤**ï¼š

```mermaid
flowchart TD
Q[Step 1 é—®é¢˜æ”¹å†™] --> T[Step 2 æ•°æ®è¡¨é€‰å–]
T --> I[Step 3 ä¿¡æ¯æ¨ç†]
I --> G[Step 4 SQLç”Ÿæˆ]
G --> E[Step 5 SQLæ‰§è¡Œ]
```

### æ¯ä¸€æ­¥éƒ½åœ¨åšä»€ä¹ˆï¼Ÿ

ä»¥æ‰§è¡Œ "æ‰¾å‡ºå·¥èµ„æœ€é«˜çš„å‘˜å·¥" ä¸ºä¾‹ï¼Œå±•ç¤º**å¤šæ­¥æ¨ç†**è¿‡ç¨‹ï¼š

**æ­¥éª¤ 1ï¼šè‡ªç„¶è¯­è¨€é—®é¢˜æ”¹å†™**
```bash
é—®é¢˜æ”¹å†™ï¼Œæ”¹å†™ä¸ºï¼šæŸ¥è¯¢å·¥èµ„æœ€é«˜çš„å‘˜å·¥ä¿¡æ¯
```

**æ­¥éª¤ 2ï¼šæ•°æ®è¡¨æ™ºèƒ½é€‰å–**
```bash
æ•°æ®è¡¨é€‰å–ï¼Œé€‰æ‹©è¡¨ä¸ºï¼šemployees
```

**æ­¥éª¤ 3ï¼šä¸šåŠ¡é€»è¾‘ä¿¡æ¯æ¨ç†**
```markdown
ä¿¡æ¯æ¨ç†ï¼Œæœ¬æ¬¡æ¨ç†å‚è€ƒä¸šåŠ¡ä¿¡æ¯æ˜¯ï¼š

- éœ€è¦æŸ¥è¯¢çš„å­—æ®µï¼šid, name, department, position, salary, hire_date, email
- ç­›é€‰æ¡ä»¶ï¼šæ— ç‰¹å®šç­›é€‰æ¡ä»¶
- è¡¨å…³è”å…³ç³»ï¼šå•è¡¨æŸ¥è¯¢ï¼Œæ— éœ€è¡¨å…³è”
- æ’åºè§„åˆ™ï¼šæŒ‰salaryå­—æ®µé™åºæ’åˆ—ï¼Œä»¥æ‰¾åˆ°å·¥èµ„æœ€é«˜çš„å‘˜å·¥
- åˆ†ç»„ç»Ÿè®¡ï¼šæ— éœ€åˆ†ç»„ç»Ÿè®¡
- ç»“æœé™åˆ¶ï¼šä½¿ç”¨LIMIT 1é™åˆ¶ç»“æœæ•°é‡ï¼Œç¡®ä¿åªè¿”å›å·¥èµ„æœ€é«˜çš„å‘˜å·¥ä¿¡æ¯
- ä¸šåŠ¡å«ä¹‰ï¼šç”¨äºè¯†åˆ«å…¬å¸ä¸­è–ªé…¬æœ€é«˜çš„å‘˜å·¥ï¼Œä¾¿äºäººåŠ›èµ„æºç®¡ç†å’Œè–ªé…¬ç»“æ„åˆ†æ
```

**æ­¥éª¤ 4ï¼šSQL è¯­å¥æ™ºèƒ½ç”Ÿæˆ**
```markdown
æŸ¥è¯¢SQLç”Ÿæˆï¼Œç”ŸæˆSQLæŸ¥è¯¢è¯­å¥ä¸ºï¼š

SELECT 
    id,
    name,
    department,
    position,
    salary,
    hire_date,
    email
FROM employees
ORDER BY salary DESC
LIMIT 1

**SQLæ™ºèƒ½æ³¨é‡Š**
> 1. **æŸ¥è¯¢ç›®çš„**: æŸ¥è¯¢å…¬å¸ä¸­å·¥èµ„æœ€é«˜çš„å‘˜å·¥ä¿¡æ¯ï¼Œç”¨äºè¯†åˆ«è–ªé…¬æœ€é«˜çš„å‘˜å·¥
> 2. **å­—æ®µè¯´æ˜**:
>    - id: å‘˜å·¥å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºç²¾ç¡®è¯†åˆ«å‘˜å·¥
>    - name: å‘˜å·¥å§“åï¼Œä¾¿äºäººåŠ›èµ„æºè¯†åˆ«å…·ä½“äººå‘˜
>    - department: æ‰€å±éƒ¨é—¨ï¼Œåˆ†æé«˜è–ªå‘˜å·¥åˆ†å¸ƒæƒ…å†µ
>    - position: èŒä½ä¿¡æ¯ï¼Œäº†è§£é«˜è–ªå¯¹åº”çš„å²—ä½çº§åˆ«
>    - salary: å·¥èµ„æ•°é¢ï¼Œæ ¸å¿ƒæŸ¥è¯¢å­—æ®µ
>    - hire_date: å…¥èŒæ—¥æœŸï¼Œåˆ†æé«˜è–ªä¸å…¥èŒæ—¶é—´çš„å…³ç³»
>    - email: è”ç³»æ–¹å¼ï¼Œä¾¿äºåç»­æ²Ÿé€š
> 3. **è¡¨å…³è”**: å•è¡¨æŸ¥è¯¢ï¼Œç›´æ¥ä»employeesè¡¨ä¸­è·å–æ•°æ®ï¼Œæ— éœ€è¡¨å…³è”
> 4. **æ¡ä»¶ç­›é€‰**: æ— ç‰¹å®šç­›é€‰æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨å…¬å¸æ‰€æœ‰å‘˜å·¥
> 5. **åˆ†ç»„èšåˆ**: æ— éœ€åˆ†ç»„ç»Ÿè®¡ï¼Œç›´æ¥æŸ¥è¯¢å•ä¸ªæœ€é«˜è–ªå‘˜å·¥
> 6. **æ’åºé€»è¾‘**: æŒ‰salaryå­—æ®µé™åºæ’åˆ—(DESC)ï¼Œç¡®ä¿å·¥èµ„æœ€é«˜çš„å‘˜å·¥æ’åœ¨ç¬¬ä¸€ä½
> 7. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨LIMIT 1é™åˆ¶ç»“æœæ•°é‡ï¼Œé¿å…è¿”å›ä¸å¿…è¦çš„æ•°æ®ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡
> 8. **ä¸šåŠ¡ä»·å€¼**: è¯¥æŸ¥è¯¢ç»“æœæœ‰åŠ©äºäººåŠ›èµ„æºéƒ¨é—¨äº†è§£å…¬å¸è–ªé…¬ç»“æ„ï¼Œè¯†åˆ«å…³é”®äººæ‰ï¼Œä¸ºè–ªé…¬è°ƒæ•´å’Œäººæ‰ä¿ç•™ç­–ç•¥æä¾›æ•°æ®æ”¯æŒ
```

**æ­¥éª¤ 5ï¼šSQLæ‰§è¡Œ**

```markdown
æ‰§è¡ŒæˆåŠŸï¼Œæ‰¾åˆ° 1 æ¡è®°å½•

| id | name | department | position | salary | hire_date | email |
|----|------|------------|----------|--------|-----------|-------|
| 7 | å‘¨ä¹ | æŠ€æœ¯éƒ¨ | æ¶æ„å¸ˆ | 25000.00 | 1606752000000 | zhoujiu@company.com |
```

### åˆ†æ­¥éª¤æŸ¥è¯¢çš„æç¤ºè¯è®¾è®¡

ä¸ºäº†å®ç°è¿™ç§åˆ†æ­¥éª¤å±•ç¤ºï¼Œä¸ºæ¯ä¸ªæ­¥éª¤è®¾è®¡äº†ä¸“é—¨çš„æç¤ºè¯æ¨¡æ¿ï¼š

æ¯”å¦‚ä»¥ä¸‹æ˜¯æ­¥éª¤ 1 çš„æç¤ºè¯æ¨¡æ¿ï¼Œä¸ºäº†è¯†åˆ«å‡ºä¸æ˜¯æ•°æ®åº“æŸ¥è¯¢çš„è¾“å…¥ï¼Œå¯¹æç¤ºè¯åšäº†ä¸€äº›ä¿®æ”¹ã€‚

```java
    // æ­¥éª¤1: é—®é¢˜æ”¹å†™æç¤ºæ¨¡æ¿
    private static final String STEP1_PROMPT = """
            è¯·å°†ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢æ”¹å†™ä¸ºæ›´æ¸…æ™°ã€æ›´å…·ä½“çš„æŸ¥è¯¢æè¿°ã€‚
            
            ç”¨æˆ·æŸ¥è¯¢ï¼š{userQuery}
            
            åˆ¤æ–­è§„åˆ™ï¼š
            1. æ•°æ®åº“æŸ¥è¯¢ç‰¹å¾è¯ï¼šæŸ¥è¯¢ã€ç»Ÿè®¡ã€æŸ¥æ‰¾ã€è·å–ã€æ˜¾ç¤ºã€åˆ—å‡ºã€è®¡ç®—ã€æ±‡æ€»ã€åˆ†æã€ç­›é€‰ã€æ’åºã€åˆ†ç»„ã€è¿æ¥ã€å…³è”
            2. éæ•°æ®åº“æŸ¥è¯¢ç‰¹å¾ï¼šé—®å€™è¯­ã€è‡ªæˆ‘ä»‹ç»ã€èŠå¤©ã€å¤©æ°”ã€æ–°é—»ã€å¨±ä¹ã€æŠ€æœ¯é—®é¢˜ã€ç¼–ç¨‹é—®é¢˜ã€ç³»ç»Ÿé—®é¢˜
            
            è¯·ä½¿ç”¨ getDatabaseSchema MCPå·¥å…·æŸ¥è¯¢æ•°æ®åº“è¡¨ç»“æ„
            
            åˆ¤æ–­æµç¨‹ï¼š
            1. æ£€æŸ¥æ˜¯å¦åŒ…å«æ•°æ®åº“æŸ¥è¯¢ç‰¹å¾è¯
            2. æ£€æŸ¥æ˜¯å¦æ¶‰åŠæ•°æ®åº“é‡Œé¢çš„ä¸šåŠ¡å®ä½“
            3. æ£€æŸ¥æ˜¯å¦åŒ…å«æ•°æ®æ“ä½œæ„å›¾
            4. æ’é™¤æ˜æ˜¾çš„éæ•°æ®åº“æŸ¥è¯¢å†…å®¹
            5. ä½¿ç”¨MCPå·¥å…·æŸ¥è¯¢å®é™…è¡¨ç»“æ„ï¼Œåˆ¤æ–­æŸ¥è¯¢æ˜¯å¦å¯è¡Œ
            
            è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¿”å›ï¼Œä¸è¦åŒ…å«ä»»ä½•å…¶ä»–å†…å®¹ï¼š
            
            å¦‚æœæ˜¯æ•°æ®åº“æŸ¥è¯¢ä¸”ä¸ç°æœ‰è¡¨ç›¸å…³ï¼š
            é—®é¢˜æ”¹å†™ï¼Œæ”¹å†™ä¸ºï¼š[æ”¹å†™åçš„æŸ¥è¯¢æè¿°]
            
            å¦‚æœä¸æ˜¯æ•°æ®åº“æŸ¥è¯¢ï¼š
            æç¤ºï¼šè¯·è¾“å…¥ä¸æ•°æ®åº“æŸ¥è¯¢ç›¸å…³çš„é—®é¢˜ï¼Œä¾‹å¦‚"æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯"ã€"ç»Ÿè®¡é”€å”®æ•°æ®"ç­‰
            
            å¦‚æœæ˜¯æ•°æ®åº“æŸ¥è¯¢ä½†ä¸ç°æœ‰è¡¨æ— å…³ï¼š
            æç¤ºï¼šå½“å‰æ•°æ®åº“ä¸­æ²¡æœ‰ç›¸å…³çš„ä¸šåŠ¡è¡¨ï¼Œè¯·æŸ¥è¯¢å‘˜å·¥ã€éƒ¨é—¨ã€é¡¹ç›®ç­‰ç›¸å…³ä¿¡æ¯
            
            è¦æ±‚ï¼š
            1. å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¿”å›
            2. å¯¹äºæ•°æ®åº“æŸ¥è¯¢ï¼Œæ”¹å†™åçš„æè¿°è¦ç®€æ´æ˜äº†ï¼Œçªå‡ºæŸ¥è¯¢çš„æ ¸å¿ƒéœ€æ±‚
            3. ä½¿ç”¨æ ‡å‡†çš„æ•°æ®åº“æŸ¥è¯¢æœ¯è¯­
            4. ä¸è¦åŒ…å«ä»»ä½•åˆ†æè¿‡ç¨‹æˆ–é¢å¤–è¯´æ˜
            5. å¿…é¡»ä½¿ç”¨MCPå·¥å…·æŸ¥è¯¢æ•°æ®åº“ç»“æ„åå†åšåˆ¤æ–­
            """;
```

**è¿™ç§æ–¹å¼çš„ä¼˜åŠ¿**ï¼š

- **æ•™å­¦å‹å¥½**ï¼šæ¯ä¸€æ­¥éƒ½å¯ä»¥å•ç‹¬è§‚å¯Ÿå’Œè°ƒæ•´
- **è°ƒè¯•ä¾¿åˆ©**ï¼šå‡ºé—®é¢˜æ—¶èƒ½å¿«é€Ÿå®šä½åˆ°å…·ä½“æ­¥éª¤
- **å¯å¹²é¢„**ï¼šå¯ä»¥åœ¨ä»»æ„æ­¥éª¤æ’å…¥äººå·¥æ£€æŸ¥æˆ–è§„åˆ™ä¿®æ­£
- **ç»“æœæ¸…æ™°**ï¼šä½¿ç”¨ Markdown è¡¨æ ¼è®©æŸ¥è¯¢ç»“æœæ›´åŠ ç›´è§‚æ˜“è¯»

### åˆ†æ­¥éª¤æŸ¥è¯¢çš„å‰ç«¯ç•Œé¢

å¯åŠ¨åº”ç”¨ä¹‹åï¼Œè®¿é—® http://localhost:8080/step å³å¯è®¿é—®åˆ†æ­¥éª¤æŸ¥è¯¢çš„å‰ç«¯ç•Œé¢ï¼š 

![Spring AI Text2SQL åˆ†æ­¥éª¤æŸ¥è¯¢æ¨¡å¼ç•Œé¢ - å¤šæ­¥æ¨ç†è¿‡ç¨‹å±•ç¤ºç•Œé¢ï¼ŒåŒ…å«é—®é¢˜æ”¹å†™ã€æ•°æ®è¡¨é€‰å–ã€ä¿¡æ¯æ¨ç†ã€SQLç”Ÿæˆå’Œæ‰§è¡Œç»“æœçš„å®Œæ•´AIæ¨ç†é“¾è·¯](https://csmos.oss-cn-beijing.aliyuncs.com/spring-ai-text2sql-showcase-02.png)

## ç¬¬å››ç‰ˆï¼šæ™ºèƒ½ä¸šåŠ¡è§„åˆ™æ¨ç†ï¼Œè®©AIæ›´æ‡‚ä¸šåŠ¡

åœ¨å‰é¢çš„ç‰ˆæœ¬ä¸­ï¼ŒAI è™½ç„¶èƒ½å¤Ÿç”Ÿæˆ SQLï¼Œä½†åœ¨ç†è§£ä¸šåŠ¡å«ä¹‰å’Œæ¨ç†é€»è¾‘æ–¹é¢è¿˜æœ‰æå‡ç©ºé—´ã€‚ç¬¬å››ç‰ˆå¼•å…¥äº†**æ™ºèƒ½ä¸šåŠ¡è§„åˆ™æ¨ç†**ï¼Œè®© AI ä¸ä»…ä¼šå†™ SQLï¼Œæ›´èƒ½ç†è§£ä¸šåŠ¡é€»è¾‘ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦ä¸šåŠ¡è§„åˆ™æ¨ç†ï¼Ÿ

æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„åœºæ™¯ï¼š
- ç”¨æˆ·é—®ï¼š"è¿‘ä¸¤å¹´å…¥èŒçš„å‘˜å·¥å¹³å‡è–ªæ°´æ˜¯å¤šå°‘ï¼Ÿ"
- ç”¨æˆ·é—®ï¼š"æŠ€æœ¯éƒ¨å·¥èµ„æœ€é«˜çš„å‰3åå‘˜å·¥"
- ç”¨æˆ·é—®ï¼š"æ¯ä¸ªéƒ¨é—¨çš„äººæ•°ç»Ÿè®¡"

è¿™äº›æŸ¥è¯¢ä¸ä»…éœ€è¦æ­£ç¡®çš„ SQL è¯­æ³•ï¼Œæ›´éœ€è¦ç†è§£ï¼š
- **æ—¶é—´æ¨ç†**ï¼šä»€ä¹ˆæ˜¯"è¿‘ä¸¤å¹´"ï¼Ÿå¦‚ä½•è½¬æ¢ä¸ºå…·ä½“çš„æ—¥æœŸèŒƒå›´ï¼Ÿ
- **ä¸šåŠ¡æœ¯è¯­**ï¼šä»€ä¹ˆæ˜¯"å¹³å‡è–ªæ°´"ï¼Ÿåº”è¯¥ç”¨å“ªä¸ªå­—æ®µï¼Ÿ
- **æ’åºé€»è¾‘**ï¼šå¦‚ä½•æ‰¾åˆ°"æœ€é«˜"çš„å‘˜å·¥ï¼Ÿ
- **åˆ†ç»„ç»Ÿè®¡**ï¼šå¦‚ä½•æŒ‰éƒ¨é—¨åˆ†ç»„ï¼Ÿ

### ä¸šåŠ¡è§„åˆ™æ¨ç†çš„æ ¸å¿ƒç»„ä»¶

ç¬¬å››ç‰ˆå¼•å…¥äº† `BusinessRuleService`ï¼Œæä¾›äº”å¤§æ ¸å¿ƒæ¨ç†èƒ½åŠ›ï¼š

#### 1. ä¸šåŠ¡æœ¯è¯­è§£é‡Š
```java
// ä¸šåŠ¡æœ¯è¯­æ˜ å°„
BUSINESS_TERMS.put("å‘˜å·¥", "employeesè¡¨ä¸­çš„å‘˜å·¥è®°å½•");
BUSINESS_TERMS.put("å·¥èµ„", "salaryå­—æ®µï¼Œä½¿ç”¨decimal(10,2)ç±»å‹å­˜å‚¨");
BUSINESS_TERMS.put("éƒ¨é—¨", "departmentå­—æ®µï¼Œè¡¨ç¤ºå‘˜å·¥æ‰€å±éƒ¨é—¨");

// åŒä¹‰è¯å¤„ç†
SYNONYMS.put("è–ªæ°´", "å·¥èµ„");
SYNONYMS.put("è–ªèµ„", "å·¥èµ„");
SYNONYMS.put("æ”¶å…¥", "å·¥èµ„");
```

#### 2. æ—¶é—´æ¨ç†å¼•æ“

```java
// æ”¯æŒå¤šç§æ—¶é—´è¡¨è¾¾å¼
"è¿‘ä¸¤å¹´" â†’ "æ—¶é—´èŒƒå›´: 2022-01-01 è‡³ 2024-12-31"
"è¿‡å»6ä¸ªæœˆ" â†’ "æ—¶é—´èŒƒå›´: 2024-06-01 è‡³ 2024-12-31"
"ä»Šå¹´" â†’ "æ—¶é—´èŒƒå›´: 2024-01-01 è‡³ 2024-12-31"
```

#### 3. èšåˆè§„åˆ™æ¨ç†

```java
// æ ¹æ®æŒ‡æ ‡ç±»å‹æ¨èèšåˆå‡½æ•°
"å·¥èµ„æ€»æ•°" â†’ "å»ºè®®ä½¿ç”¨SUMèšåˆå‡½æ•°"
"å‘˜å·¥äººæ•°" â†’ "å»ºè®®ä½¿ç”¨COUNTèšåˆå‡½æ•°"
"å¹³å‡å·¥èµ„" â†’ "å»ºè®®ä½¿ç”¨AVGèšåˆå‡½æ•°"
```

#### 4. è¡¨å…³è”è§„åˆ™

```java
// æ™ºèƒ½è¯†åˆ«è¡¨å…³è”å…³ç³»
employees + project_members â†’ "é€šè¿‡employee_idå­—æ®µå…³è”"
projects + project_members â†’ "é€šè¿‡project_idå­—æ®µå…³è”"
```

#### 5. å­—æ®µéœ€æ±‚æ¨ç†

```java
// æ ¹æ®æŸ¥è¯¢å†…å®¹æ¨æ–­éœ€è¦çš„å­—æ®µ
"æŸ¥è¯¢å‘˜å·¥å§“å" â†’ "éœ€è¦nameå­—æ®µ"
"æŒ‰éƒ¨é—¨ç»Ÿè®¡" â†’ "éœ€è¦departmentå­—æ®µ"
"å·¥èµ„æ’åº" â†’ "éœ€è¦salaryå­—æ®µ"
```

### æ­¥éª¤3ï¼šä¿¡æ¯æ¨ç†çš„æ™ºèƒ½åŒ–å‡çº§

åœ¨åˆ†æ­¥éª¤æŸ¥è¯¢æ¨¡å¼ä¸­ï¼Œæ­¥éª¤3"ä¿¡æ¯æ¨ç†"å¾—åˆ°äº†æ˜¾è‘—å¢å¼ºï¼š

#### åŸå§‹æ­¥éª¤3ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰

```markdown
ä¿¡æ¯æ¨ç†ï¼Œæœ¬æ¬¡æ¨ç†å‚è€ƒä¸šåŠ¡ä¿¡æ¯æ˜¯ï¼š

- éœ€è¦æŸ¥è¯¢çš„å­—æ®µï¼šid, name, department, position, salary, hire_date, email
- ç­›é€‰æ¡ä»¶ï¼šæ— ç‰¹å®šç­›é€‰æ¡ä»¶
- è¡¨å…³è”å…³ç³»ï¼šå•è¡¨æŸ¥è¯¢ï¼Œæ— éœ€è¡¨å…³è”
- æ’åºè§„åˆ™ï¼šæŒ‰salaryå­—æ®µé™åºæ’åˆ—ï¼Œä»¥æ‰¾åˆ°å·¥èµ„æœ€é«˜çš„å‘˜å·¥
- åˆ†ç»„ç»Ÿè®¡ï¼šæ— éœ€åˆ†ç»„ç»Ÿè®¡
- ç»“æœé™åˆ¶ï¼šä½¿ç”¨LIMIT 1é™åˆ¶ç»“æœæ•°é‡ï¼Œç¡®ä¿åªè¿”å›å·¥èµ„æœ€é«˜çš„å‘˜å·¥ä¿¡æ¯
- ä¸šåŠ¡å«ä¹‰ï¼šç”¨äºè¯†åˆ«å…¬å¸ä¸­è–ªé…¬æœ€é«˜çš„å‘˜å·¥ï¼Œä¾¿äºäººåŠ›èµ„æºç®¡ç†å’Œè–ªé…¬ç»“æ„åˆ†æ
```

#### å¢å¼ºç‰ˆæ­¥éª¤3ï¼ˆç¬¬å››ç‰ˆï¼‰

```markdown
ä¿¡æ¯æ¨ç†ï¼Œæœ¬æ¬¡æ¨ç†å‚è€ƒä¸šåŠ¡ä¿¡æ¯æ˜¯ï¼š

- éœ€è¦æŸ¥è¯¢çš„å­—æ®µï¼šid, name, department, position, salary, hire_date, email
- ç­›é€‰æ¡ä»¶ï¼šæ— ç‰¹å®šç­›é€‰æ¡ä»¶
- è¡¨å…³è”å…³ç³»ï¼šå•è¡¨æŸ¥è¯¢ï¼Œæ— éœ€è¡¨å…³è”
- æ’åºè§„åˆ™ï¼šæŒ‰salaryå­—æ®µé™åºæ’åˆ—ï¼Œä»¥æ‰¾åˆ°å·¥èµ„æœ€é«˜çš„å‘˜å·¥
- åˆ†ç»„ç»Ÿè®¡ï¼šæ— éœ€åˆ†ç»„ç»Ÿè®¡
- ç»“æœé™åˆ¶ï¼šä½¿ç”¨LIMIT 1é™åˆ¶ç»“æœæ•°é‡ï¼Œç¡®ä¿åªè¿”å›å·¥èµ„æœ€é«˜çš„å‘˜å·¥ä¿¡æ¯
- ä¸šåŠ¡å«ä¹‰ï¼šç”¨äºè¯†åˆ«å…¬å¸ä¸­è–ªé…¬æœ€é«˜çš„å‘˜å·¥ï¼Œä¾¿äºäººåŠ›èµ„æºç®¡ç†å’Œè–ªé…¬ç»“æ„åˆ†æ

**ä¸šåŠ¡è§„åˆ™å‚è€ƒ**ï¼š
- æ—¶é—´èŒƒå›´: æ— ç‰¹å®šæ—¶é—´é™åˆ¶
- ä¸šåŠ¡è§„åˆ™: éœ€è¦æ·»åŠ ORDER BYå­å¥è¿›è¡Œæ’åº; éœ€è¦æ·»åŠ LIMITå­å¥é™åˆ¶è¿”å›ç»“æœæ•°é‡
- å…³é”®å­—æ®µ: salary, name, department, position
- èšåˆå»ºè®®: æ— éœ€èšåˆï¼Œç›´æ¥æŸ¥è¯¢å•ä¸ªè®°å½•
- åŒä¹‰è¯æ˜ å°„: å·¥èµ„ â†’ salaryå­—æ®µ
```

### ä¸šåŠ¡è§„åˆ™æ¨ç†çš„å®é™…æ•ˆæœ

è®©æˆ‘ä»¬çœ‹çœ‹å‡ ä¸ªå…·ä½“çš„ä¾‹å­ï¼š

#### ä¾‹å­1ï¼šæ—¶é—´æ¨ç†
**ç”¨æˆ·æŸ¥è¯¢**ï¼š"è¿‘ä¸€å¹´å…¥èŒçš„å‘˜å·¥ä¿¡æ¯"

**ä¸šåŠ¡è§„åˆ™æ¨ç†**ï¼š
- æ—¶é—´èŒƒå›´: 2023-12-01 è‡³ 2024-12-31
- ç­›é€‰æ¡ä»¶: hire_date >= '2023-12-01'
- ä¸šåŠ¡è§„åˆ™: éœ€è¦æ·»åŠ WHEREæ¡ä»¶è¿›è¡Œæ—¶é—´ç­›é€‰

**ç”Ÿæˆçš„SQL**ï¼š
```sql
SELECT * FROM employees 
WHERE hire_date >= '2023-12-01' 
ORDER BY hire_date DESC
```

#### ä¾‹å­2ï¼šèšåˆæ¨ç†
**ç”¨æˆ·æŸ¥è¯¢**ï¼š"æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„"

**ä¸šåŠ¡è§„åˆ™æ¨ç†**ï¼š
- åˆ†ç»„ç»Ÿè®¡: æŒ‰departmentå­—æ®µåˆ†ç»„
- èšåˆå»ºè®®: ä½¿ç”¨AVGèšåˆå‡½æ•°è®¡ç®—å¹³å‡å·¥èµ„
- å…³é”®å­—æ®µ: department, salary
- ä¸šåŠ¡è§„åˆ™: éœ€è¦æ·»åŠ GROUP BYå­å¥è¿›è¡Œåˆ†ç»„ç»Ÿè®¡

**ç”Ÿæˆçš„SQL**ï¼š
```sql
SELECT department, AVG(salary) as avg_salary 
FROM employees 
GROUP BY department 
ORDER BY avg_salary DESC
```

#### ä¾‹å­3ï¼šæ’åºæ¨ç†
**ç”¨æˆ·æŸ¥è¯¢**ï¼š"æŠ€æœ¯éƒ¨å·¥èµ„æœ€é«˜çš„å‰3åå‘˜å·¥"

**ä¸šåŠ¡è§„åˆ™æ¨ç†**ï¼š
- ç­›é€‰æ¡ä»¶: department = 'æŠ€æœ¯éƒ¨'
- æ’åºè§„åˆ™: æŒ‰salaryå­—æ®µé™åºæ’åˆ—
- ç»“æœé™åˆ¶: ä½¿ç”¨LIMIT 3é™åˆ¶ç»“æœæ•°é‡
- å…³é”®å­—æ®µ: name, salary, department, position

**ç”Ÿæˆçš„SQL**ï¼š
```sql
SELECT name, salary, position 
FROM employees 
WHERE department = 'æŠ€æœ¯éƒ¨' 
ORDER BY salary DESC 
LIMIT 3
```

### æŠ€æœ¯å®ç°ç»†èŠ‚

#### BusinessRuleService æ ¸å¿ƒæ–¹æ³•

```java
@Service
public class BusinessRuleService {
    
    /**
     * æ—¶é—´æ¨ç† - è§£æç›¸å¯¹æ—¶é—´è¡¨è¾¾å¼
     */
    public String parseTimeExpression(String timeExpression) {
        // æ”¯æŒ"è¿‘Xå¹´"ã€"è¿‡å»Xä¸ªæœˆ"ã€"ä»Šå¹´"ã€"å»å¹´"ç­‰è¡¨è¾¾å¼
        // è‡ªåŠ¨è½¬æ¢ä¸ºå…·ä½“çš„æ—¥æœŸèŒƒå›´
    }
    
    /**
     * èšåˆè§„åˆ™æ¨ç†
     */
    public String getAggregationRule(String metric, String dimension) {
        // æ ¹æ®æŒ‡æ ‡ç±»å‹æ¨èåˆé€‚çš„èšåˆå‡½æ•°
        // SUMã€COUNTã€AVGã€MAXã€MINç­‰
    }
    
    /**
     * è¡¨å…³è”è§„åˆ™æ¨ç†
     */
    public String getTableJoinRule(String table1, String table2) {
        // æ™ºèƒ½è¯†åˆ«è¡¨ä¹‹é—´çš„å…³è”å­—æ®µ
        // æ”¯æŒå¤–é”®å…³è”ã€ä¸šåŠ¡å­—æ®µå…³è”ç­‰
    }
    
    /**
     * ä¸šåŠ¡é€»è¾‘æ¨ç†
     */
    public String getBusinessLogic(String query, String selectedTables) {
        // ç»¼åˆæ¨ç†æŸ¥è¯¢çš„ä¸šåŠ¡é€»è¾‘
        // åŒ…æ‹¬æ—¶é—´ã€çŠ¶æ€ã€æ’åºã€åˆ†ç»„ã€é™åˆ¶ç­‰
    }
    
    /**
     * å­—æ®µéœ€æ±‚æ¨ç†
     */
    public String getFieldRequirements(String query, String tableName) {
        // æ ¹æ®æŸ¥è¯¢å†…å®¹æ¨æ–­éœ€è¦çš„å­—æ®µ
        // æ”¯æŒåŒä¹‰è¯æ˜ å°„å’Œä¸šåŠ¡æœ¯è¯­è§£é‡Š
    }
}
```

#### æ­¥éª¤3çš„æç¤ºè¯æ¨¡æ¿

```java
private static final String STEP3_PROMPT = """
        åŸºäºé€‰ä¸­çš„è¡¨å’ŒæŸ¥è¯¢éœ€æ±‚ï¼Œè¿›è¡Œæ™ºèƒ½ä¿¡æ¯æ¨ç†ã€‚
        
        æŸ¥è¯¢éœ€æ±‚ï¼š{rewrittenQuery}
        é€‰ä¸­è¡¨ï¼š{selectedTables}
        ä¸šåŠ¡è§„åˆ™å‚è€ƒï¼š{businessRules}
        
        è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¿”å›ï¼Œä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–å†…å®¹ï¼š
        
        ä¿¡æ¯æ¨ç†ï¼Œæœ¬æ¬¡æ¨ç†å‚è€ƒä¸šåŠ¡ä¿¡æ¯æ˜¯ï¼š
        
        - éœ€è¦æŸ¥è¯¢çš„å­—æ®µï¼š[å…·ä½“åˆ—å‡ºéœ€è¦æŸ¥è¯¢çš„å­—æ®µå]
        - ç­›é€‰æ¡ä»¶ï¼š[è¯´æ˜WHEREæ¡ä»¶ï¼Œå¦‚æ— ç‰¹å®šæ¡ä»¶åˆ™è¯´æ˜"æ— ç‰¹å®šç­›é€‰æ¡ä»¶"]
        - è¡¨å…³è”å…³ç³»ï¼š[è¯´æ˜è¡¨å…³è”æƒ…å†µï¼Œå¦‚å•è¡¨æŸ¥è¯¢åˆ™è¯´æ˜"å•è¡¨æŸ¥è¯¢ï¼Œæ— éœ€è¡¨å…³è”"]
        - æ’åºè§„åˆ™ï¼š[è¯´æ˜ORDER BYçš„æ’åºé€»è¾‘å’Œç›®çš„]
        - åˆ†ç»„ç»Ÿè®¡ï¼š[è¯´æ˜æ˜¯å¦éœ€è¦GROUP BYï¼Œå¦‚ä¸éœ€è¦åˆ™è¯´æ˜"æ— éœ€åˆ†ç»„ç»Ÿè®¡"]
        - ç»“æœé™åˆ¶ï¼š[è¯´æ˜LIMITé™åˆ¶æ•°é‡å’Œç›®çš„]
        - ä¸šåŠ¡å«ä¹‰ï¼š[è§£é‡ŠæŸ¥è¯¢çš„ä¸šåŠ¡ä»·å€¼å’Œå®é™…åº”ç”¨åœºæ™¯]
        
        è¦æ±‚ï¼š
        1. ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å‡ºï¼Œæ¯è¡Œä¸€ä¸ªè¦ç‚¹
        2. åŸºäºä¸šåŠ¡è§„åˆ™å‚è€ƒä¿¡æ¯è¿›è¡Œæ¨ç†
        3. æ¨ç†ç»“æœè¦å…·ä½“ã€å‡†ç¡®ã€æœ‰ä¸šåŠ¡ä»·å€¼
        4. ä¸è¦åŒ…å«SQLè¯­å¥ï¼Œåªåšé€»è¾‘æ¨ç†
        """;
```

### ä¸šåŠ¡è§„åˆ™æ¨ç†çš„ä¼˜åŠ¿

1. **æ™ºèƒ½åŒ–ç¨‹åº¦æ›´é«˜**ï¼šAI ä¸ä»…ä¼šå†™ SQLï¼Œæ›´èƒ½ç†è§£ä¸šåŠ¡å«ä¹‰
2. **å‡†ç¡®æ€§æ˜¾è‘—æå‡**ï¼šé€šè¿‡ä¸šåŠ¡è§„åˆ™çº¦æŸï¼Œå‡å°‘ SQL ç”Ÿæˆé”™è¯¯
3. **ç”¨æˆ·ä½“éªŒæ›´å¥½**ï¼šæ”¯æŒè‡ªç„¶è¯­è¨€è¡¨è¾¾ï¼Œæ— éœ€å­¦ä¹  SQL è¯­æ³•
4. **å¯æ‰©å±•æ€§å¼º**ï¼šä¸šåŠ¡è§„åˆ™å¯ä»¥æŒç»­ä¼˜åŒ–å’Œæ‰©å±•
5. **æ•™å­¦ä»·å€¼é«˜**ï¼šåˆ†æ­¥éª¤å±•ç¤ºè®©ç”¨æˆ·ç†è§£ AI çš„æ€è€ƒè¿‡ç¨‹

é€šè¿‡å¼•å…¥æ™ºèƒ½ä¸šåŠ¡è§„åˆ™æ¨ç†ï¼Œç¬¬å››ç‰ˆè®© Text2SQL ç³»ç»ŸçœŸæ­£å…·å¤‡äº†"ç†è§£ä¸šåŠ¡"çš„èƒ½åŠ›ï¼Œä¸ä»…èƒ½å¤Ÿç”Ÿæˆæ­£ç¡®çš„ SQLï¼Œæ›´èƒ½ç†è§£ç”¨æˆ·çš„çœŸå®æ„å›¾ï¼Œæä¾›æ›´æœ‰ä»·å€¼çš„ä¸šåŠ¡æ´å¯Ÿã€‚

### å®é™…åº”ç”¨åœºæ™¯

**äººåŠ›èµ„æºåœºæ™¯**ï¼š
- "è¿‘åŠå¹´å…¥èŒçš„å‘˜å·¥å¹³å‡å·¥èµ„"
- "å„éƒ¨é—¨å·¥èµ„åˆ†å¸ƒæƒ…å†µ"
- "æŠ€æœ¯éƒ¨è–ªèµ„æœ€é«˜çš„å‰5å"

**é¡¹ç›®ç®¡ç†åœºæ™¯**ï¼š
- "è¿›è¡Œä¸­çš„é¡¹ç›®é¢„ç®—ç»Ÿè®¡"
- "æ¯ä¸ªé¡¹ç›®çš„å‚ä¸äººæ•°"
- "é¡¹ç›®å®Œæˆç‡åˆ†æ"

**è´¢åŠ¡åˆ†æåœºæ™¯**ï¼š
- "å„éƒ¨é—¨å¹´åº¦é¢„ç®—ä½¿ç”¨æƒ…å†µ"
- "é¡¹ç›®æˆæœ¬æ•ˆç›Šåˆ†æ"
- "å‘˜å·¥è–ªé…¬ç»“æ„åˆ†æ"

### ç‰ˆæœ¬æ¼”è¿›å¯¹æ¯”

| ç‰¹æ€§ | ç¬¬ä¸€ç‰ˆ | ç¬¬äºŒç‰ˆ | ç¬¬ä¸‰ç‰ˆ | ç¬¬å››ç‰ˆ |
|------|--------|--------|--------|--------|
| **å®ç°æ–¹å¼** | ç›´æ¥æ¨¡å¼ | MCPå·¥å…· | åˆ†æ­¥éª¤æŸ¥è¯¢ | æ™ºèƒ½ä¸šåŠ¡è§„åˆ™ |
| **å‡†ç¡®æ€§** | â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ |
| **å¯è§£é‡Šæ€§** | â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **ä¸šåŠ¡ç†è§£** | â­â­ | â­â­â­ | â­â­â­ | â­â­â­â­â­ |
| **æ•™å­¦ä»·å€¼** | â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **é€‚ç”¨åœºæ™¯** | ç®€å•æŸ¥è¯¢ | å¤æ‚æŸ¥è¯¢ | æ•™å­¦æ¼”ç¤º | ç”Ÿäº§ç¯å¢ƒ |

## å®‰å…¨ç¬¬ä¸€ï¼šSQL æ³¨å…¥é˜²æŠ¤ä¸æ•°æ®å®‰å…¨ç­–ç•¥

**Text2SQL è‡ªç„¶è¯­è¨€æŸ¥è¯¢**è™½ç„¶æ–¹ä¾¿ï¼Œä½†**æ•°æ®åº“å®‰å…¨**é—®é¢˜ç»å¯¹ä¸èƒ½å¿½è§†ã€‚æˆ‘åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ€»ç»“äº†å‡ æ¡**å®‰å…¨é˜²æŠ¤**é“å¾‹ï¼š

### æ ¸å¿ƒå®‰å…¨é˜²æŠ¤ç­–ç•¥

**1. åªè¯»æƒé™ç­–ç•¥**

- ä¸¥æ ¼é™åˆ¶åªèƒ½æ‰§è¡Œ `SELECT` æŸ¥è¯¢è¯­å¥
- æ‹’ç»æ‰€æœ‰ `DROP`ã€`DELETE`ã€`UPDATE`ã€`INSERT` ç­‰**å±é™©æ“ä½œ**
- åœ¨**ä»£ç å±‚é¢**å’Œ**æ•°æ®åº“å±‚é¢**åšåŒé‡æ£€æŸ¥

**2. ç³»ç»Ÿè¡¨ä¿æŠ¤**

- æ‹¦æˆªè®¿é—® `INFORMATION_SCHEMA` çš„æŸ¥è¯¢
- ç¦æ­¢è®¿é—®**ç³»ç»Ÿæ•°æ®åº“**å’Œ**æ•æ„Ÿè¡¨**
- é™åˆ¶æŸ¥è¯¢èŒƒå›´ï¼Œé¿å…**æ•°æ®æ³„éœ²**

**3. è¾“å‡ºå†…å®¹æ§åˆ¶**

- æ¸…ç† **AI æ¨¡å‹è¾“å‡º**ä¸­çš„ä»£ç å—åŒ…è£¹
- è‡ªåŠ¨æ·»åŠ  `LIMIT` é™åˆ¶ï¼Œé˜²æ­¢**å¤§æ•°æ®é‡æŸ¥è¯¢**
- å¯¹**æ•æ„Ÿå­—æ®µ**è¿›è¡Œè„±æ•å¤„ç†

**4. æ™ºèƒ½å®‰å…¨æ ¡éªŒ**

- **MCP æ¨¡å¼**ä¸‹å…ˆåšå°èŒƒå›´æµ‹è¯•
- å¤±è´¥æ—¶æä¾›å…·ä½“çš„**é”™è¯¯ä¿¡æ¯**å’Œä¿®æ­£å»ºè®®
- å»ºç«‹æŸ¥è¯¢**ç™½åå•**å’Œ**é»‘åå•**æœºåˆ¶

### SQL æ³¨å…¥é˜²æŠ¤ä»£ç ç¤ºä¾‹

```java
public class SqlUtils {

    // å±é™©æ“ä½œé»‘åå•
    private static final Set<String> DANGEROUS_KEYWORDS = Set.of(
        "DROP", "DELETE", "UPDATE", "INSERT", "ALTER", "CREATE", 
        "TRUNCATE", "EXEC", "EXECUTE", "CALL", "MERGE", "REPLACE",
        "UNION", "INFORMATION_SCHEMA"
    );
    
    // ç³»ç»Ÿè¡¨é»‘åå•
    private static final Set<String> SYSTEM_TABLES = Set.of(
        "information_schema", "mysql", "performance_schema", 
        "sys", "test", "tmp"
    );

    /**
     * æ¸…ç† SQL è¯­å¥
     */
    public static String cleanSql(String sql) {
        if (sql == null) return "";

        // ç§»é™¤å¯èƒ½çš„ä»£ç å—æ ‡è®°
        sql = sql.replaceAll("```sql\\s*", "").replaceAll("```\\s*", "");

        // æŸ¥æ‰¾ç¬¬ä¸€ä¸ª SELECT è¯­å¥
        Pattern pattern = Pattern.compile("(SELECT.*?)(?=\\n\\n|$)", Pattern.DOTALL | Pattern.CASE_INSENSITIVE);
        Matcher matcher = pattern.matcher(sql);

        if (matcher.find()) {
            return matcher.group(1).trim();
        }

        return sql.trim();
    }

    /**
     * éªŒè¯ SQL å®‰å…¨æ€§
     */
    public static boolean isSqlSafe(String sql) {
        if (sql == null || sql.trim().isEmpty()) {
            return false;
        }
        
        String upperSql = sql.toUpperCase().trim();
        
        // 1. æ£€æŸ¥æ˜¯å¦åªåŒ…å«SELECTè¯­å¥
        if (!upperSql.startsWith("SELECT")) {
            return false;
        }
        
        // 2. æ£€æŸ¥å±é™©å…³é”®è¯
        for (String keyword : DANGEROUS_KEYWORDS) {
            if (upperSql.contains(keyword)) {
                return false;
            }
        }
        
        // 3. æ£€æŸ¥ç³»ç»Ÿè¡¨è®¿é—®
        for (String systemTable : SYSTEM_TABLES) {
            if (upperSql.contains(systemTable)) {
                return false;
            }
        }
        
        // 4. æ£€æŸ¥SQLæ³¨å…¥æ¨¡å¼
        if (containsSqlInjection(sql)) {
            return false;
        }
        
        return true;
    }
    
    /**
     * æ£€æµ‹SQLæ³¨å…¥æ”»å‡»
     */
    private static boolean containsSqlInjection(String sql) {
        // æ£€æµ‹å¸¸è§çš„SQLæ³¨å…¥æ¨¡å¼
        String[] injectionPatterns = {
            "'.*--", "'.*;", "'.*UNION", "'.*OR.*=", 
            "'.*AND.*=", "'.*OR.*1=1", "'.*AND.*1=1"
        };
        
        for (String pattern : injectionPatterns) {
            if (sql.matches(".*" + pattern + ".*")) {
                return true;
            }
        }
        
        return false;
    }
    
    /**
     * æ¸…ç†å’Œæ ‡å‡†åŒ–SQL
     */
    public static String sanitizeSql(String sql) {
        if (sql == null) return "";
        
        // ç§»é™¤ä»£ç å—æ ‡è®°
        sql = cleanSql(sql);
        
        // ç¡®ä¿æœ‰LIMITé™åˆ¶
        if (!sql.toUpperCase().contains("LIMIT")) {
            sql += " LIMIT 1000";
        }
        
        return sql;
    }
    
    /**
     * è·å–SQLå®‰å…¨éªŒè¯çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
     */
    public static String getSecurityError(String sql) {
        if (sql == null || sql.trim().isEmpty()) {
            return "SQLè¯­å¥ä¸èƒ½ä¸ºç©º";
        }
        
        String upperSql = sql.toUpperCase().trim();
        
        if (!upperSql.startsWith("SELECT")) {
            return "åªå…è®¸æ‰§è¡ŒSELECTæŸ¥è¯¢è¯­å¥";
        }
        
        for (String keyword : DANGEROUS_KEYWORDS) {
            if (upperSql.contains(keyword)) {
                return "æ£€æµ‹åˆ°å±é™©æ“ä½œ: " + keyword;
            }
        }
        
        for (String systemTable : SYSTEM_TABLES) {
            if (upperSql.contains(systemTable)) {
                return "ç¦æ­¢è®¿é—®ç³»ç»Ÿè¡¨: " + systemTable;
            }
        }
        
        if (containsSqlInjection(sql)) {
            return "æ£€æµ‹åˆ°SQLæ³¨å…¥æ”»å‡»æ¨¡å¼";
        }
        
        return "SQLè¯­å¥å®‰å…¨";
    }
}
```

## å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—ä¸æ•…éšœè¯Šæ–­

å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜å¾ˆæ­£å¸¸ï¼Œè¿™é‡Œæ˜¯æˆ‘æ€»ç»“çš„**Text2SQL ç³»ç»Ÿ**å¸¸è§é—®é¢˜åŠ**æ•…éšœæ’æŸ¥**è§£å†³æ–¹æ¡ˆï¼š

### ç¯å¢ƒé…ç½®é—®é¢˜

**API Key é…ç½®é—®é¢˜**

- ç¡®ä¿ `DEEPSEEK_API_KEY` **ç¯å¢ƒå˜é‡**å·²æ­£ç¡®è®¾ç½®
- æ£€æŸ¥**ç½‘ç»œè¿æ¥**ï¼Œç¡®ä¿èƒ½è®¿é—® **DeepSeek API æœåŠ¡**

**æ•°æ®åº“è¿æ¥é—®é¢˜**

- **ç«¯å£å†²çª**ï¼š3306 è¢«å ç”¨æ—¶ï¼Œä¿®æ”¹ `docker-compose.yml` ä¸­çš„**ç«¯å£æ˜ å°„**
- **å­—ç¬¦é›†é—®é¢˜**ï¼šç¡®ä¿ `mysql.cnf` æ­£ç¡®æŒ‚è½½ï¼Œå­—ç¬¦é›†ç»Ÿä¸€ä¸º `utf8mb4`

### åŠŸèƒ½æ€§é—®é¢˜

**AI è‡ªç„¶è¯­è¨€ç†è§£ä¸å‡†ç¡®**

- æä¾›æ›´å…·ä½“çš„**ä¸Šä¸‹æ–‡ä¿¡æ¯**ï¼ˆè¡¨åã€å­—æ®µå«ä¹‰ã€ä¸šåŠ¡è§„åˆ™ï¼‰
- åœ¨**æç¤ºè¯æ¨¡æ¿**ä¸­åŠ å…¥æ›´å¤šç¤ºä¾‹
- è€ƒè™‘ä½¿ç”¨ **MCP æ¨¡å¼**è·å–çœŸå®**æ•°æ®åº“ Schema ç»“æ„**

**SQL è¯­æ³•é”™è¯¯**

- å¯ç”¨ MCP æ¨¡å¼ï¼Œå…ˆåšå°èŒƒå›´æµ‹è¯•
- æ ¹æ®é”™è¯¯ä¿¡æ¯è°ƒæ•´æç¤ºè¯
- å»ºç«‹ SQL è¯­æ³•æ£€æŸ¥æœºåˆ¶

### æ€§èƒ½é—®é¢˜

**æŸ¥è¯¢é€Ÿåº¦æ…¢**

- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- é™åˆ¶æŸ¥è¯¢ç»“æœæ•°é‡
- è€ƒè™‘æ·»åŠ æŸ¥è¯¢ç¼“å­˜æœºåˆ¶

### æœ€ä½³å®è·µå»ºè®®

**1. æç¤ºè¯ä¼˜åŒ–**

- ä½¿ç”¨å…·ä½“çš„ä¸šåŠ¡åœºæ™¯æè¿°
- æä¾›è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- å®šæœŸæ›´æ–°å’Œæµ‹è¯•æç¤ºè¯

**2. é”™è¯¯å¤„ç†**

- å®ç°å®Œå–„çš„å¼‚å¸¸æ•è·æœºåˆ¶
- æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ç”¨äºè°ƒè¯•

**3. æ€§èƒ½ç›‘æ§**

- ç›‘æ§SQLæ‰§è¡Œæ—¶é—´
- è®°å½•AIæ¨¡å‹è°ƒç”¨æ¬¡æ•°å’Œæˆæœ¬
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´

**4. ç”¨æˆ·ä½“éªŒ**

- æä¾›æŸ¥è¯¢è¿›åº¦æŒ‡ç¤º
- æ”¯æŒæŸ¥è¯¢å†å²è®°å½•
- å®ç°æŸ¥è¯¢ç»“æœå¯¼å‡ºåŠŸèƒ½

## é¡¹ç›®æ€»ç»“ä¸æŠ€æœ¯å±•æœ›

ä»æœ€åˆçš„ä¸€ä¸ªæƒ³æ³•ï¼Œåˆ°ç°åœ¨çš„å®Œæ•´å®ç°ï¼Œè¿™ä¸ªè¿‡ç¨‹è®©æˆ‘æ·±åˆ»ä½“ä¼šåˆ°äº† **AI æŠ€æœ¯**çš„é­…åŠ›ã€‚**Text2SQL è‡ªç„¶è¯­è¨€æŸ¥è¯¢**ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯åŠŸèƒ½ï¼Œå®ƒçœŸæ­£æ”¹å˜äº†æˆ‘ä»¬ä¸**æ•°æ®åº“**äº¤äº’çš„æ–¹å¼ã€‚

### æŠ€æœ¯æ”¶è·ä¸æˆé•¿

1. **AI æŠ€æœ¯æˆé•¿**ï¼šä»ç®€å•çš„**æç¤ºè¯å·¥ç¨‹**åˆ°å¤æ‚çš„ **MCP å·¥å…·é›†æˆ**ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯å­¦ä¹ 
2. **é—®é¢˜è§£å†³èƒ½åŠ›**ï¼š**ä¸­æ–‡ä¹±ç **ã€**å®‰å…¨é˜²æŠ¤**ã€**æ€§èƒ½ä¼˜åŒ–**ï¼Œæ¯ä¸ªå‘éƒ½è®©æˆ‘æ›´å¼ºå¤§
3. **äº§å“æ€ç»´**ï¼šä»**æŠ€æœ¯å®ç°**åˆ°**ç”¨æˆ·ä½“éªŒ**ï¼Œè€ƒè™‘ç”¨æˆ·çœŸæ­£éœ€è¦ä»€ä¹ˆ

### æœªæ¥æŠ€æœ¯è§„åˆ’

è¿™ä¸ª **Spring AI Text2SQL** é¡¹ç›®è¿˜æœ‰å¾ˆå¤šå¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼š

**çŸ­æœŸæŠ€æœ¯ç›®æ ‡**ï¼š

- æ”¯æŒ**å¤šæ¨¡å‹åˆ‡æ¢**ï¼ˆOpenAIã€Geminiã€Claude ç­‰ï¼‰
- æ·»åŠ **æŸ¥è¯¢å†å²**å’Œ**å¤šè½®å¯¹è¯**åŠŸèƒ½
- ä¼˜åŒ–**æç¤ºè¯æ¨¡æ¿**ï¼Œæé«˜ **SQL ç”Ÿæˆå‡†ç¡®ç‡**

**é•¿æœŸæŠ€æœ¯æ„¿æ™¯**ï¼š

- **æ™ºèƒ½æŸ¥è¯¢ä¼˜åŒ–**å»ºè®®
- **æ•°æ®å¯è§†åŒ–æŠ¥è¡¨**ç”Ÿæˆ
- æ›´ä¸¥æ ¼çš„**æƒé™æ§åˆ¶**å’Œ**å®¡è®¡æœºåˆ¶**
- æ”¯æŒæ›´å¤š**æ•°æ®åº“ç±»å‹**ï¼ˆPostgreSQLã€Oracleã€MongoDBï¼‰

### ç»™å¼€å‘è€…çš„å»ºè®®

å¦‚æœä½ ä¹Ÿæƒ³å°è¯• **Text2SQL å¼€å‘**ï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼š

1. **ä»ç®€å•å¼€å§‹**ï¼šå…ˆç”¨**ç›´æ¥æ¨¡å¼**å¿«é€ŸéªŒè¯æƒ³æ³•
2. **é€æ­¥ä¼˜åŒ–**ï¼šæ ¹æ®å®é™…éœ€æ±‚å¼•å…¥ **MCP** å’Œ**åˆ†æ­¥éª¤æ¨¡å¼**
3. **å®‰å…¨ç¬¬ä¸€**ï¼šä»ä¸€å¼€å§‹å°±è€ƒè™‘**å®‰å…¨é—®é¢˜**ï¼Œä¸è¦äº‹åè¡¥æ•‘
4. **æŒç»­å­¦ä¹ **ï¼š**AI æŠ€æœ¯**å‘å±•å¾ˆå¿«ï¼Œä¿æŒå­¦ä¹ çš„å¿ƒæ€

### æŠ€æœ¯é€‰å‹ä¸æ¶æ„å»ºè®®

**AI å¤§è¯­è¨€æ¨¡å‹é€‰æ‹©**ï¼š
- **DeepSeek**ï¼šæ€§ä»·æ¯”é«˜ï¼Œ**ä¸­æ–‡ç†è§£**å¥½ï¼Œé€‚åˆä¸ªäººé¡¹ç›®
- **OpenAI GPT-4**ï¼šå‡†ç¡®ç‡é«˜ï¼Œä½†æˆæœ¬è¾ƒé«˜
- **Claude**ï¼š**æ¨ç†èƒ½åŠ›**å¼ºï¼Œé€‚åˆå¤æ‚æŸ¥è¯¢
- **æœ¬åœ°æ¨¡å‹**ï¼šæ•°æ®å®‰å…¨ï¼Œä½†éœ€è¦å¼ºå¤§çš„ç¡¬ä»¶æ”¯æŒ

**æ•°æ®åº“æ”¯æŒ**ï¼š
- **MySQL**ï¼šæœ€å¸¸ç”¨ï¼Œç”Ÿæ€å®Œå–„
- **PostgreSQL**ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢
- **SQLite**ï¼šè½»é‡çº§ï¼Œé€‚åˆåŸå‹å¼€å‘
- **ClickHouse**ï¼šé€‚åˆå¤§æ•°æ®åˆ†æåœºæ™¯

### é¡¹ç›®æ‰©å±•æ–¹å‘

**çŸ­æœŸæ‰©å±•**ï¼š
- æ”¯æŒæ›´å¤šæ•°æ®åº“ç±»å‹
- æ·»åŠ æŸ¥è¯¢å†å²å’Œç®¡ç†åŠŸèƒ½
- å®ç°æŸ¥è¯¢ç»“æœå¯è§†åŒ–
- æ”¯æŒå¤šè¯­è¨€æŸ¥è¯¢

**é•¿æœŸè§„åˆ’**ï¼š
- é›†æˆå‘é‡æ•°æ®åº“ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢
- å®ç°æ™ºèƒ½æŸ¥è¯¢ä¼˜åŒ–å»ºè®®
- æ·»åŠ æ•°æ®è¡€ç¼˜åˆ†æåŠŸèƒ½
- æ”¯æŒè‡ªç„¶è¯­è¨€åˆ°å¤æ‚æŠ¥è¡¨çš„ç”Ÿæˆ

## å­¦ä¹ èµ„æºæ¨è

**å®˜æ–¹æ–‡æ¡£**ï¼š
- [Spring AI å®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-ai/reference/) - Spring AI æ¡†æ¶å®Œæ•´æŒ‡å—
- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs) - GPT æ¨¡å‹ API ä½¿ç”¨æ–‡æ¡£
- [MySQL å®˜æ–¹æ–‡æ¡£](https://dev.mysql.com/doc/) - MySQL æ•°æ®åº“å®Œæ•´æ–‡æ¡£
- [DeepSeek API æ–‡æ¡£](https://platform.deepseek.com/api-docs) - DeepSeek å¤§è¯­è¨€æ¨¡å‹ API

**ç›¸å…³æŠ€æœ¯æ¡†æ¶**ï¼š
- [LangChain](https://python.langchain.com/) - Python ç”Ÿæ€çš„ AI åº”ç”¨å¼€å‘æ¡†æ¶
- [LlamaIndex](https://www.llamaindex.ai/) - æ•°æ®ç´¢å¼•å’Œæ£€ç´¢æ¡†æ¶
- [MCP åè®®](https://modelcontextprotocol.io/) - æ¨¡å‹ä¸Šä¸‹æ–‡åè®®æ ‡å‡†
- [Spring Boot](https://spring.io/projects/spring-boot) - Java ä¼ä¸šçº§åº”ç”¨å¼€å‘æ¡†æ¶

**Text2SQL ç›¸å…³èµ„æº**ï¼š
- [Text2SQL è®ºæ–‡é›†åˆ](https://github.com/eosphoros-ai/awesome-text2sql) - Text2SQL å­¦æœ¯ç ”ç©¶èµ„æº
- [SQL æ³¨å…¥é˜²æŠ¤æŒ‡å—](https://owasp.org/www-community/attacks/SQL_Injection) - OWASP SQL æ³¨å…¥é˜²æŠ¤
- [æ•°æ®åº“è®¾è®¡æœ€ä½³å®è·µ](https://www.sqlstyle.guide/) - SQL ç¼–ç è§„èŒƒæŒ‡å—

å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¯¹ä½ æœ‰å¸®åŠ©ã€‚å¦‚æœä½ åœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œæ¬¢è¿äº¤æµè®¨è®ºï¼

## è‡´è°¢

æ„Ÿè°¢ [Spring AI å›¢é˜Ÿ](https://spring.io/projects/spring-ai) æä¾›çš„ä¼˜ç§€æ¡†æ¶ï¼Œæ„Ÿè°¢ [DeepSeek](https://www.deepseek.com/) æä¾›çš„ AI æœåŠ¡æ”¯æŒï¼Œæ„Ÿè°¢æ‰€æœ‰ [å¼€æºç¤¾åŒº](https://github.com/) çš„è´¡çŒ®è€…ä»¬ã€‚æ­£æ˜¯æœ‰äº†è¿™äº›ä¼˜ç§€çš„å·¥å…·å’Œç¤¾åŒºï¼Œæˆ‘ä»¬æ‰èƒ½å¿«é€Ÿæ„å»ºå‡ºå¦‚æ­¤å¼ºå¤§çš„ **Text2SQL è‡ªç„¶è¯­è¨€æŸ¥è¯¢ç³»ç»Ÿ**ã€‚

---

*æœ¬æ–‡åŸºäº Spring AI 1.1.0 ç‰ˆæœ¬ç¼–å†™ï¼Œ[é¡¹ç›®ä»£ç å·²å¼€æº](https://github.com/chensoul/spring-ai-text2sql-showcase)ï¼Œæ¬¢è¿ Star å’Œ Forkï¼*

