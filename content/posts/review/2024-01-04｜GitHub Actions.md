---
title: "2024-01-04ï½œGitHub Actions"
date: 2024-01-04T18:00:00+08:00
slug: til
categories: ["Review"]
tags: ["vps"]
---

ä»Šå¤©åšäº†ä»€ä¹ˆï¼š

- ä¿®æ”¹ä¸ªäººè”ç³»æ–¹å¼
- æ³¨é”€äºšé©¬é€Šè´¦å·
- åˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases
- åˆ©ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºé¡¹ç›®çš„dockeré•œåƒå¹¶å‘å¸ƒåˆ°DockerHub



## ä¿®æ”¹ä¸ªäººè”ç³»æ–¹å¼

ä½¿ç”¨ ichensoul æ³¨å†Œäº†æ–°çš„ Gmailã€163 é‚®ç®±ï¼Œå¹¶å°†å„ç§ç½‘ç«™ç»‘å®šçš„é‚®ç®±ä¿®æ”¹åˆ°æ–°çš„ gmail é‚®ç®±ã€‚è‡ªæ­¤ï¼Œgmailã€githubã€æ¨ç‰¹ã€å¾®ä¿¡ã€163 çš„è´¦å·éƒ½ä¿æŒä¸ºä¸€è‡´ï¼Œéƒ½æ˜¯ ichensoulã€‚



ä»¥ä¸‹æ˜¯ [github](https://github.com/chensoul) ä¸Šæˆ‘çš„ä¸ªäººè”ç³»æ–¹å¼ã€‚

> å¥åº·ï¼Œçˆ±æƒ…å’Œä½¿å‘½ï¼ŒæŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå…¶å®ƒçš„éƒ½ä¸é‡è¦ã€‚ ------ çº³ç“¦å°”

æˆ‘æ˜¯ ChenSoulï¼Œä¸€ä¸ª Java è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆï¼Œç›®å‰å·¥ä½œåœ¨æ­¦æ±‰ã€‚

çƒ­çˆ±ç¼–ç¨‹ï¼Œå–œæ¬¢è·‘æ­¥ã€‚è¯»ä¹¦ã€å¥èº«ã€å®šæŠ•ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œåšä¸€ä¸ªé•¿æœŸä¸»ä¹‰è€…ã€‚

### ç½‘ç«™

- åšå®¢ï¼š[https://blog.chensoul.cc/](https://blog.chensoul.cc/)
- è·‘æ­¥ï¼š[https://run.chensoul.cc/](https://run.chensoul.cc/)
- Memosï¼š[https://memos.chensoul.cc/](https://memos.chensoul.cc/)

### æ‰¾åˆ°æˆ‘

- å¾®ä¿¡ï¼š@ichensoul
- é‚®ç®±ï¼š[ichensoul@gmail.com](mailto:ichensoul@gmail.com)
- Githubï¼š[https://github.com/chensoul](https://github.com/chensoul)ã€[https://github.com/ichensoul](https://github.com/ichensoul)
- Twitterï¼š[https://twitter.com/ichensoul](https://twitter.com/ichensoul)
- Telegramé¢‘é“ï¼š[https://t.me/chensouls](https://t.me/chensouls)



## æ³¨é”€äºšé©¬é€Šè´¦å·

ç¼˜ç”±æ˜¯ï¼Œä¹‹å‰æ€»æ˜¯æ”¶åˆ°äºšé©¬é€Šçš„ä»˜æ¬¾è´¦å•ï¼ˆæ¯ä¸ªæœˆ 0.5 ç¾å…ƒï¼Œæœ‰æ—¶å€™1 ç¾å…ƒï¼‰ï¼Œæ•…å…ƒæ—¦æ”¾å‡çš„æ—¶å€™ç™»é™†äº†äºšé©¬é€Šè´¦å·æŸ¥æ‰¾ä»˜è´¹åŸå› ã€‚æ‰¾äº†åŠå¤©æ²¡æœ‰æ‰¾åˆ°æ˜¯å“ªé‡Œäº§ç”Ÿçš„è´¹ç”¨ï¼Œå°±ä¸€æ€’ä¹‹ä¸‹æŠŠåœ¨äºšé©¬é€Šæ³¨å†Œçš„åŸŸåï¼ˆchensoul.comï¼Œä¸€å¹´ 12 ç¾å…ƒï¼Œä¸€æ¬¡æ€§ä»˜è´¹äº† 5 å¹´ï¼‰åˆ é™¤äº†ã€‚



è¿™å‡ å¤©å‘ç°æœ¬åšå®¢æ— æ³•è®¿é—®ï¼Œäºæ˜¯æå·¥å•è¯¢é—®æ˜¯å¦å¯ä»¥æ¢å¤åŸŸåã€‚å¾—åˆ°çš„å›å¤æ˜¯å¿…é¡»æ”¯ä»˜ 66 ç¾å…ƒï¼Œæ‰èƒ½æ¢å¤ä¸€å¹´ã€‚å¯¹æ­¤ï¼Œæˆ‘è‚¯å®šæ— æ³•æ¥å—ã€‚äºæ˜¯ï¼Œå†³å®šæ³¨é”€äºšé©¬é€Šï¼Œåœ¨å…¶ä»–å¹³å°é‡æ–°æ³¨å†Œä¸€ä¸ªåŸŸåã€‚



ä»Šå¤©åœ¨ CF ä¸Šæ³¨å†Œäº†ä¸€ä¸ªæ–°çš„åŸŸå chensoul.ccï¼Œä¸€å¹´ 8 ç¾å…ƒï¼Œä¸€æ¬¡æ€§ä»˜è´¹ 5 å¹´ã€‚åœ¨é‡æ–°è®¾ç½® DNSï¼Œä¿®æ”¹ VPS ä¸Šçš„ç›¸å…³æœåŠ¡çš„åŸŸåä¸ºæ–°åŸŸåä¹‹åï¼Œåšå®¢æ¢å¤æ­£å¸¸ã€‚



# åˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases

å‚è€ƒ [åˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases](https://wiki.eryajf.net/pages/f3e878) ä¸º github ä¸Šçš„é¡¹ç›® [https://github.com/chensoul/chensoul-parent](https://github.com/chensoul/chensoul-parent) æ·»åŠ ä¸€ä¸ªæœºå™¨äººå­—æ®µæ„å»º Releaseã€‚



ä½¿ç”¨æ–¹æ³•ï¼š

1ã€å‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://github.com/release-drafter/release-drafter?tab=readme-ov-file#usage)ï¼Œåœ¨ä»“åº“é‡Œé¢é…ç½®ä¸€ä¸ª [GitHub Action](https://github.com/marketplace/actions/release-drafter) ï¼Œä¾‹å¦‚ï¼š.github/workflows/release-drafter.yml

```yaml
name: Release Drafter

on:
  push:
    # branches to consider in the event; optional, defaults to all
    branches:
      - main
  # pull_request event is required only for autolabeler
  pull_request:
    # Only following types are handled by the action, but one can default to all as well
    types: [opened, reopened, synchronize]
  # pull_request_target event is required for autolabeler to support PRs from forks
  # pull_request_target:
  #   types: [opened, reopened, synchronize]

permissions:
  contents: read

jobs:
  update_release_draft:
    permissions:
      # write permission is required to create a github release
      contents: write
      # write permission is required for autolabeler
      # otherwise, read permission is required at least
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
      # (Optional) GitHub Enterprise requires GHE_HOST variable set
      #- name: Set GHE_HOST
      #  run: |
      #    echo "GHE_HOST=${GITHUB_SERVER_URL##https:\/\/}" >> $GITHUB_ENV

      # Drafts your next Release notes as Pull Requests are merged into "master"
      - uses: release-drafter/release-drafter@v5
        # (Optional) specify config name to use, relative to .github/. Default: release-drafter.yml
        # with:
        #   config-name: my-config.yml
        #   disable-autolabeler: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

è¯´æ˜ï¼š

- è¯¥ action åªå¯¹ main åˆ†æ”¯èµ·ä½œç”¨
- è¯¥ action åªå¯¹ opened, reopened, synchronize ç±»å‹çš„ pull_request èµ·ä½œç”¨



2ã€æ·»åŠ  .github/release-drafter.yml é…ç½®ç”Ÿæˆçš„ Release å†…å®¹

```yaml
# Configuration for Release Drafter: https://github.com/toolmantim/release-drafter
name-template: 'v$NEXT_PATCH_VERSION'
tag-template: 'v$NEXT_PATCH_VERSION'
version-template: $MAJOR.$MINOR.$PATCH
# Emoji reference: https://gitmoji.carloscuesta.me/
categories:
  - title: 'â­ New Features'
    labels:
      - 'feature'
      - 'enhancement'
      - 'kind/feature'
  - title: 'ğŸ Bug Fixes'
    labels:
      - 'fix'
      - 'bugfix'
      - 'bug'
      - 'regression'
      - 'kind/bug'
  - title: 'ğŸ“ Documentation'
    labels:
      - documentation
      - 'kind/doc'
  - title: 'ğŸ§° Dependency Upgrades'
    labels:
      - chore
      - dependencies
      - 'kind/chore'
      - 'kind/dep'
  - title: 'ğŸš¦ Tests'
    labels:
      - test
      - tests
exclude-labels:
  - reverted
  - no-changelog
  - skip-changelog
  - invalid
change-template: '* $TITLE (#$NUMBER) @$AUTHOR'
template: |
  ## Whatâ€™s Changed
  $CHANGES
```

æ¨¡æ¿çš„å«ä¹‰æ˜¯å½“æäº¤çš„ PR ç¬¦åˆå…¶ä¸­çš„ labels æ—¶ï¼Œå¯¹åº”æäº¤çš„æ ‡é¢˜ä¼šä½œä¸ºå½“æ¬¡æäº¤çš„è¯´æ˜ä¿¡æ¯ï¼Œç”Ÿæˆåœ¨ release çš„è‰ç¨¿ä¸­ã€‚

æœ‰äº†è¿™äº›å†…å®¹ï¼Œåœ¨æ¯æ¬¡ push æˆ–è€… pr çš„æ—¶å€™ï¼ŒActions éƒ½ä¼šè‡ªåŠ¨å°†å½“æ¬¡çš„å†…å®¹å†™å…¥åˆ° release çš„è‰ç¨¿ä¸­ï¼Œä¸‹æ¬¡å†æœ‰ pr åˆ™å†…å®¹å°†ä¼šæ˜¯è¿½åŠ ï¼Œå¹¶ä¸ä¼šè¦†ç›–ä¸€å¼€å§‹çš„è‰ç¨¿ã€‚



3ã€é€šå¸¸æ™®é€šåä½œè€…åœ¨æäº¤ pr çš„æ—¶å€™ï¼Œå¤§æ¦‚éƒ½å¾ˆå°‘ä¼šæœ‰ä¸»åŠ¨ç»™ pr æ·»åŠ  labels çš„ï¼Œæ¯æ¬¡è¿˜éœ€è¦é¡¹ç›®è´Ÿè´£äººè‡ªå·±æ·»åŠ ï¼Œä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™ä¸ªåŠŸèƒ½åˆæ˜¯ä¾èµ– pr çš„ labels çš„ï¼Œå› æ­¤å¯ä»¥å†åŠ ä¸€ä¸ªé…ç½® `.github/PULL_REQUEST_TEMPLATE.md`ï¼Œè¯¥æ–‡ä»¶é…ç½®å¯ä»¥ä»“åº“ [GitHub pull request template](https://axolo.co/blog/p/part-3-github-pull-request-template)ã€‚

[spring-boot](https://raw.githubusercontent.com/spring-projects/spring-boot/main/.github/PULL_REQUEST_TEMPLATE.md) é¡¹ç›®ä¸­çš„ `.github/PULL_REQUEST_TEMPLATE.md` å†…å®¹å¦‚ä¸‹ï¼š

```markdown
<!--
Thanks for contributing to Spring Boot. Please review the following notes before
submitting a pull request.

Please submit only genuine pull-requests. Do not use this repository as a GitHub
playground.

Security Vulnerabilities

STOP! If your contribution fixes a security vulnerability, please do not submit it.
Instead, please head over to https://spring.io/security-policy to learn how to disclose a
vulnerability responsibly.

Dependency Upgrades

Please do not open a pull request for a straightforward dependency upgrade (one that
only updates the version property). We have a semi-automated process for such upgrades
that we prefer to use. However, if the upgrade is more involved (such as requiring
changes for removed or deprecated API) your pull request is most welcome.

Describing Your Changes

If, having reviewed the notes above, you're ready to submit your pull request, please
provide a brief description of the proposed changes. If they fix a bug, please
describe the broken behaviour and how the changes fix it. If they make an enhancement,
please describe the new functionality and why you believe it's useful. If your pull
request relates to any existing issues, please reference them by using the issue number
prefixed with #.
-->
```

ç»¼åˆä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘çš„  `.github/PULL_REQUEST_TEMPLATE.md` å†…å®¹å¦‚ä¸‹ï¼š

```markdown
<!--
Thanks for contributing to this project. Please review the following notes before
submitting a pull request.

Please submit only genuine pull-requests. Do not use this repository as a GitHub
playground.

Dependency Upgrades

Please do not open a pull request for a straightforward dependency upgrade (one that
only updates the version property). We have a semi-automated process for such upgrades
that we prefer to use. However, if the upgrade is more involved (such as requiring
changes for removed or deprecated API) your pull request is most welcome.

Describing Your Changes

If, having reviewed the notes above, you're ready to submit your pull request, please
provide a brief description of the proposed changes. If they fix a bug, please
describe the broken behaviour and how the changes fix it. If they make an enhancement,
please describe the new functionality and why you believe it's useful. If your pull
request relates to any existing issues, please reference them by using the issue number
prefixed with #.
-->

## Describing Your Changes

## Checklist before requesting a review
- [ ] I have performed a self-review of my code
- [ ] If it is a core feature, I have added thorough tests.
- [ ] Do we need to implement analytics?
- [ ] Will this be part of a product update? If yes, please write one phrase about this update.
```



è¿™æ ·åä½œè€…æäº¤ pr çš„æ—¶å€™å°±ä¼šä¸»åŠ¨æç¤ºåä½œè€…å°½é‡ç»™å½“æ¬¡ pr æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªåˆé€‚çš„ labelsã€‚

æœ€åæ¥çœ‹ä¸‹ç”Ÿæˆçš„ release drafterï¼š

![day-review-20240104-02](https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/day-review-20240104-02.png)

## åˆ©ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºé¡¹ç›®çš„dockeré•œåƒå¹¶å‘å¸ƒåˆ°DockerHub

å‚è€ƒ [åˆ©ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºé¡¹ç›®çš„dockeré•œåƒå¹¶å‘å¸ƒåˆ°DockerHub](https://wiki.eryajf.net/pages/5baf0a) ï¼Œç»™ [https://github.com/chensoul/maven-hello-world](https://github.com/chensoul/maven-hello-world) æ·»åŠ äº†ä¸€ä¸ª docker actionï¼š `.github/workflows/docker-image.yml `

```yaml
name: build_docker

on:
  release:
    types: [created] # è¡¨ç¤ºåœ¨åˆ›å»ºæ­£å¼çš„ Release æ—¶è§¦å‘

jobs:
  build_docker:
    name: Build docker
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      # åˆ©ç”¨github-slug-actionæš´æ¼Github Actionä¸Šä¸‹æ–‡ä¸­çš„å…³é”®å˜é‡ https://wiki.eryajf.net/pages/77e2fe  
      - name: Inject slug/short variables
        uses: rlespinasse/github-slug-action@v4
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v2
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2
      - name: Login to DockerHub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
      - name: Build And Push
        uses: docker/build-push-action@v3
        with:
          context: .
          platforms: linux/amd64,linux/arm64
          push: ${{ github.event_name != 'pull_request' }}
          tags: |
            ${{ secrets.DOCKERHUB_USERNAME }}/${{ env.GITHUB_REPOSITORY_NAME_PART }}:${{ env.GITHUB_REF_NAME }}
            ${{ secrets.DOCKERHUB_USERNAME }}/${{ env.GITHUB_REPOSITORY_NAME_PART }}:latest
```

å…³é”®ç‚¹ï¼šä½¿ç”¨ rlespinasse/github-slug-action@v4  æš´æ¼Github Actionä¸Šä¸‹æ–‡ä¸­çš„å…³é”®å˜é‡ã€‚è¯·å‚è€ƒï¼š[åˆ©ç”¨github-slug-actionæš´æ¼Github Actionä¸Šä¸‹æ–‡ä¸­çš„å…³é”®å˜é‡ ](https://wiki.eryajf.net/pages/77e2fe) ã€‚

## Wakatime ç¼–ç ç»Ÿè®¡

Wakatimeè®°å½•çš„ä»Šæ—¥ç¼–ç æ—¶é—´ç»Ÿè®¡ï¼š

![day-review-20240104-01](https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/day-review-20240104-01.png)

## å‚è€ƒæ–‡ç« 

- [åˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases](https://wiki.eryajf.net/pages/f3e878)
- [åˆ©ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºé¡¹ç›®çš„dockeré•œåƒå¹¶å‘å¸ƒåˆ°DockerHub](https://wiki.eryajf.net/pages/5baf0a)
- [åˆ©ç”¨github-slug-actionæš´æ¼Github Actionä¸Šä¸‹æ–‡ä¸­çš„å…³é”®å˜é‡ ](https://wiki.eryajf.net/pages/77e2fe)
