---
title: "2023-12-12ï½œRMIã€Javaæ¼æ´å®‰å…¨ã€Semgrepæ¼æ´æ£€æµ‹"
date: 2023-12-12
slug: til
categories: ["Review"]
tags: [rmi,semgrep]
---

Today I Learned. ä»Šå¤©æˆ‘å­¦äº†ï¼šRMIã€Javaæ¼æ´å®‰å…¨ã€Semgrepæ¼æ´æ£€æµ‹ã€‚

## RMI

### ä»‹ç»

RMIï¼ˆRemote Method Invocationï¼‰æ˜¯Javaè¯­è¨€æä¾›çš„ä¸€ç§è¿œç¨‹è°ƒç”¨æœºåˆ¶ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°å¯¹è±¡ä¹‹é—´çš„è¿œç¨‹é€šä¿¡ã€‚

é€šè¿‡Java RMIï¼Œå¼€å‘äººå‘˜å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚RMIéšè—äº†åº•å±‚ç½‘ç»œé€šä¿¡çš„å¤æ‚æ€§ï¼Œä½¿å¾—è¿œç¨‹æ–¹æ³•è°ƒç”¨è¿‡ç¨‹å¯¹äºå¼€å‘äººå‘˜æ¥è¯´æ›´åŠ ç®€å•å’Œé€æ˜ã€‚

### å‘å±•å†å²

RMIï¼ˆRemote Method Invocationï¼‰æ˜¯Javaè¯­è¨€æä¾›çš„ä¸€ç§è¿œç¨‹è°ƒç”¨æœºåˆ¶ï¼Œå®ƒçš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ°ä¸Šä¸ªä¸–çºª90å¹´ä»£ã€‚

ä»¥ä¸‹æ˜¯RMIçš„ä¸»è¦å‘å±•å†ç¨‹ï¼š

1. åˆæœŸç‰ˆæœ¬ï¼ˆJava 1.1ï¼‰ï¼šRMIæœ€æ—©å‡ºç°åœ¨Java 1.1ç‰ˆæœ¬ä¸­ï¼Œå®ƒæä¾›äº†åŸºæœ¬çš„è¿œç¨‹è°ƒç”¨åŠŸèƒ½ï¼Œå…è®¸å¼€å‘äººå‘˜åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½¿ç”¨Javaå¯¹è±¡è¿›è¡Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚è¿™ä¸ªç‰ˆæœ¬çš„RMIè¿˜æ¯”è¾ƒç®€å•ï¼ŒåŠŸèƒ½ç›¸å¯¹æœ‰é™ã€‚
2. RMI-IIOPï¼ˆJava 1.2ï¼‰ï¼šéšç€Java 1.2ç‰ˆæœ¬çš„å‘å¸ƒï¼ŒSun Microsystemsï¼ˆç°åœ¨çš„Oracleï¼‰å¼•å…¥äº†RMI-IIOPï¼ˆRMI over IIOPï¼‰çš„æ¦‚å¿µï¼Œå°†RMIä¸CORBAï¼ˆCommon Object Request Broker Architectureï¼‰è¿›è¡Œäº†æ•´åˆã€‚RMI-IIOPä½¿ç”¨IIOPï¼ˆInternet Inter-ORB Protocolï¼‰ä½œä¸ºåº•å±‚çš„é€šä¿¡åè®®ï¼Œä½¿å¾—Javaå¯¹è±¡èƒ½å¤Ÿä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚
3. JDK 1.3å’Œ1.4çš„æ”¹è¿›ï¼šåœ¨JDK 1.3å’Œ1.4ç‰ˆæœ¬ä¸­ï¼ŒRMIå¾—åˆ°äº†è¿›ä¸€æ­¥æ”¹è¿›å’Œå¢å¼ºã€‚å…¶ä¸­åŒ…æ‹¬å¯¹Javaåºåˆ—åŒ–æœºåˆ¶çš„æ”¹è¿›ï¼Œæä¾›äº†æ›´å¥½çš„å…¼å®¹æ€§å’Œæ€§èƒ½ã€‚æ­¤å¤–ï¼Œè¿˜å¼•å…¥äº†Java Activation Frameworkï¼ˆJAFï¼‰ï¼Œç”¨äºå¤„ç†ä¼ è¾“çš„æ•°æ®ç±»å‹ã€‚
4. Java 5çš„å¢å¼ºï¼šJava 5å¼•å…¥äº†ä¸€äº›é‡è¦çš„å¢å¼ºåŠŸèƒ½ï¼Œå¦‚æ³¨è§£ï¼ˆAnnotationsï¼‰å’Œæ³›å‹ï¼ˆGenericsï¼‰ã€‚è¿™äº›åŠŸèƒ½ä½¿å¾—RMIçš„ä½¿ç”¨æ›´åŠ ä¾¿æ·å’Œçµæ´»ã€‚
5. Java 8å’Œåç»­ç‰ˆæœ¬ï¼šåœ¨Java 8åŠå…¶åç»­ç‰ˆæœ¬ä¸­ï¼ŒRMIå¹¶æ²¡æœ‰è¿›è¡Œå¤§è§„æ¨¡çš„æ”¹åŠ¨ã€‚ç„¶è€Œï¼Œéšç€Javaå¹³å°çš„ä¸æ–­å‘å±•å’Œæ”¹è¿›ï¼ŒRMIä»ç„¶æ˜¯Javaåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸ç”¨çš„è¿œç¨‹è°ƒç”¨æœºåˆ¶ä¹‹ä¸€ã€‚

### æ¶æ„

![img](https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/rmi-architecture-01.png)

RMIæ¶æ„åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š

1. è¿œç¨‹æ¥å£ï¼ˆRemote Interfaceï¼‰ï¼šè¿œç¨‹æ¥å£å®šä¹‰äº†è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¯¥æ¥å£è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚è¿œç¨‹æ¥å£å¿…é¡»ç»§æ‰¿`java.rmi.Remote`æ¥å£ï¼Œå¹¶å£°æ˜å¯ä»¥è¢«è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ã€‚
2. è¿œç¨‹å¯¹è±¡ï¼ˆRemote Objectï¼‰ï¼šè¿œç¨‹å¯¹è±¡æ˜¯å®ç°äº†è¿œç¨‹æ¥å£çš„Javaå¯¹è±¡ã€‚è¿™äº›å¯¹è±¡çš„æ–¹æ³•å¯ä»¥é€šè¿‡RMIè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚è¿œç¨‹å¯¹è±¡å¿…é¡»ç»§æ‰¿`java.rmi.server.UnicastRemoteObject`ç±»ï¼Œå¹¶å®ç°å¯¹åº”çš„è¿œç¨‹æ¥å£ã€‚
3. è¿œç¨‹æ³¨å†Œè¡¨ï¼ˆRemote Registryï¼‰ï¼šè¿œç¨‹æ³¨å†Œè¡¨æ˜¯ä¸€ä¸ªä¸­å¤®æ³¨å†Œè¡¨ï¼Œç”¨äºå­˜å‚¨è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚å®¢æˆ·ç«¯å¯ä»¥æŸ¥è¯¢è¿œç¨‹æ³¨å†Œè¡¨ä»¥è·å–è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶é€šè¿‡å¼•ç”¨è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚è¿œç¨‹æ³¨å†Œè¡¨ä½¿ç”¨RMIæ³¨å†Œè¡¨æœåŠ¡ï¼ˆ`rmiregistry`ï¼‰æ¥å®ç°ã€‚
4. Stubï¼ˆå­˜æ ¹ï¼‰å’ŒSkeletonï¼ˆéª¨æ¶ï¼‰ï¼šStubå’ŒSkeletonæ˜¯RMIçš„å…³é”®ç»„ä»¶ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚Stubæ˜¯å®¢æˆ·ç«¯çš„ä»£ç†ï¼Œå®ƒè´Ÿè´£å°†å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨è½¬å‘åˆ°è¿œç¨‹å¯¹è±¡ã€‚Skeletonæ˜¯æœåŠ¡å™¨ç«¯çš„ä»£ç†ï¼Œå®ƒè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨å¹¶å°†å…¶è½¬å‘ç»™å®é™…çš„è¿œç¨‹å¯¹è±¡ã€‚
5. RMIåè®®ï¼ˆRMI Protocolï¼‰ï¼šRMIåè®®å®šä¹‰äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡åè®®ï¼ŒåŒ…æ‹¬è¯·æ±‚ã€å“åº”ã€å‚æ•°ä¼ é€’å’Œåºåˆ—åŒ–ç­‰ç»†èŠ‚ã€‚RMIåè®®ä½¿ç”¨Javaåºåˆ—åŒ–æ¥å¯¹å¯¹è±¡è¿›è¡Œç¼–ç å’Œè§£ç ï¼Œä»¥å®ç°å¯¹è±¡åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“ã€‚

![img](https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/rmi-architecture-02.png)

RMIæ¶æ„çš„åŸºæœ¬å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

1. æœåŠ¡å™¨ç«¯å°†è¿œç¨‹å¯¹è±¡æ³¨å†Œåˆ°è¿œç¨‹æ³¨å†Œè¡¨ä¸­ã€‚
2. å®¢æˆ·ç«¯ä»è¿œç¨‹æ³¨å†Œè¡¨ä¸­è·å–è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚
3. å®¢æˆ·ç«¯é€šè¿‡å¼•ç”¨è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚
4. å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨è¢«è½¬å‘åˆ°æœåŠ¡å™¨ç«¯çš„è¿œç¨‹å¯¹è±¡ã€‚
5. æœåŠ¡å™¨ç«¯çš„è¿œç¨‹å¯¹è±¡æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚
6. å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ–¹æ³•çš„è¿”å›å€¼ã€‚

> åœ¨JDK 1.2ç‰ˆæœ¬ï¼ˆ1998ï¼‰ä¹‹åï¼Œéª¨æ¶skeletonä¸å†è¢«éœ€è¦, ç”±Javaçš„UnicastServerRef#dispatchæ›¿ä»£ï¼›åœ¨JDK 5 ï¼ˆå¤§å®¶å¸¸è¯´çš„1.5ï¼‰ä¹‹åï¼Œä¸å†éœ€è¦æ‰‹åŠ¨åˆ©ç”¨rmicå‘½ä»¤ç”Ÿæˆé™æ€Stubï¼Œè€Œæ˜¯ä¼šç”±Javaè‡ªåŠ¨åœ°åŠ¨æ€ç”Ÿæˆã€‚è¿™ä¸ªåŠ¨æ€ç”Ÿæˆä¹Ÿæ˜¯æˆ‘ä»¬åé¢JNDIæ³¨å…¥çš„å…³é”®ã€‚

### RMIæ¼æ´

RMIï¼ˆRemote Method Invocationï¼‰åœ¨è¿‡å»çš„ä¸€æ®µæ—¶é—´ä¸­æ›¾å‘ç°ä¸€äº›å®‰å…¨æ¼æ´ï¼Œè¿™äº›æ¼æ´å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£é™©ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„RMIæ¼æ´ï¼š

1. ååºåˆ—åŒ–æ¼æ´ï¼šRMIä½¿ç”¨Javaåºåˆ—åŒ–æœºåˆ¶æ¥åœ¨ç½‘ç»œä¸Šä¼ è¾“å¯¹è±¡ã€‚ç„¶è€Œï¼Œå¦‚æœä¸æ­£ç¡®åœ°å¤„ç†ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®æ¥æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¿™ç§æ¼æ´è¢«å¹¿æ³›ç§°ä¸º"Javaååºåˆ—åŒ–æ¼æ´"æˆ–"Javaååºåˆ—åŒ–æ”»å‡»"ï¼Œå¹¶ä¸”ä¸ä»…ä»…å½±å“RMIï¼Œè¿˜å¯èƒ½å½±å“å…¶ä»–ä½¿ç”¨Javaåºåˆ—åŒ–çš„æŠ€æœ¯ã€‚
2. æœªæˆæƒè®¿é—®æ¼æ´ï¼šRMIæœåŠ¡é»˜è®¤æƒ…å†µä¸‹å¯èƒ½æ²¡æœ‰è¿›è¡Œé€‚å½“çš„èº«ä»½éªŒè¯å’Œæˆæƒæ£€æŸ¥ã€‚è¿™å¯èƒ½å¯¼è‡´æ”»å‡»è€…èƒ½å¤Ÿæœªç»æˆæƒåœ°è®¿é—®è¿œç¨‹å¯¹è±¡å’Œè°ƒç”¨æ–¹æ³•ï¼Œä»è€Œé€ æˆå®‰å…¨é£é™©ã€‚
3. æ³¨å†Œè¡¨ç»•è¿‡æ¼æ´ï¼šRMIä½¿ç”¨æ³¨å†Œè¡¨ï¼ˆRegistryï¼‰æ¥å­˜å‚¨è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡ç»•è¿‡æ³¨å†Œè¡¨æˆ–ç¯¡æ”¹æ³¨å†Œè¡¨ä¸­çš„å¼•ç”¨ï¼Œæ¥æ‰§è¡Œæ¶æ„æ“ä½œæˆ–æ›¿æ¢åŸå§‹å¯¹è±¡ã€‚
4. æœªåŠ å¯†çš„é€šä¿¡æ¼æ´ï¼šå¦‚æœRMIçš„é€šä¿¡è¿‡ç¨‹æ²¡æœ‰é€‚å½“åœ°åŠ å¯†å’Œä¿æŠ¤ï¼Œæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿçªƒå¬ã€ç¯¡æ”¹æˆ–é‡æ”¾ç½‘ç»œé€šä¿¡ï¼Œä»è€Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œä¸­é—´äººæ”»å‡»ã€‚

ä¸ºäº†ç¼“è§£è¿™äº›æ¼æ´çš„é£é™©ï¼Œå»ºè®®é‡‡å–ä»¥ä¸‹å®‰å…¨æªæ–½ï¼š

- åŠæ—¶æ›´æ–°å’Œå‡çº§ä½¿ç”¨çš„Javaè¿è¡Œæ—¶ç¯å¢ƒï¼Œä»¥è·å–æœ€æ–°çš„å®‰å…¨ä¿®å¤ç¨‹åºã€‚JDK 8u121å¼•å…¥äº†å¯¹RMIæ¼æ´çš„ä¿®å¤ã€‚
- åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­è°¨æ…å¤„ç†è¾“å…¥æ•°æ®ï¼Œé¿å…æ¥å—æœªå—ä¿¡ä»»çš„åºåˆ—åŒ–æ•°æ®ã€‚
- å®æ–½é€‚å½“çš„èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶ï¼Œç¡®ä¿åªæœ‰ç»è¿‡æˆæƒçš„ç”¨æˆ·å¯ä»¥è®¿é—®å’Œè°ƒç”¨è¿œç¨‹å¯¹è±¡ã€‚
- ä½¿ç”¨å®‰å…¨åè®®ï¼ˆå¦‚SSL/TLSï¼‰å¯¹RMIé€šä¿¡è¿›è¡ŒåŠ å¯†å’Œä¿æŠ¤ã€‚
- é…ç½®å’Œé™åˆ¶RMIçš„ç½‘ç»œè®¿é—®ï¼Œä»…å…è®¸å—ä¿¡ä»»çš„ä¸»æœºå’Œç«¯å£è¿›è¡Œé€šä¿¡ã€‚
- å¯¹RMIæ³¨å†Œè¡¨è¿›è¡Œå®‰å…¨é…ç½®ï¼Œé™åˆ¶å¯¹æ³¨å†Œè¡¨çš„è®¿é—®æƒé™ã€‚

### RMIç”¨åˆ°çš„æŠ€æœ¯

1. Javaåºåˆ—åŒ–ï¼ˆSerializationï¼‰ï¼šRMIä½¿ç”¨Javaåºåˆ—åŒ–æ¥å®ç°å¯¹è±¡åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“ã€‚Javaåºåˆ—åŒ–æœºåˆ¶å…è®¸å°†Javaå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµè¡¨ç¤ºï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“ã€‚RMIä½¿ç”¨Javaåºåˆ—åŒ–å°†æ–¹æ³•è°ƒç”¨å’Œå‚æ•°ç¼–ç ä¸ºå­—èŠ‚æµï¼Œå¹¶åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œä¼ è¾“ã€‚
2. Javaç½‘ç»œé€šä¿¡ï¼ˆNetwork Communicationï¼‰ï¼šRMIä½¿ç”¨Javaçš„ç½‘ç»œé€šä¿¡æœºåˆ¶æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œè¿œç¨‹è°ƒç”¨çš„ä¼ è¾“ã€‚RMIæ”¯æŒå¤šç§åº•å±‚ä¼ è¾“åè®®ï¼Œå¦‚JRMPï¼ˆJava Remote Method Protocolï¼‰å’ŒIIOPï¼ˆInternet Inter-ORB Protocolï¼‰ã€‚è¿™äº›åè®®è´Ÿè´£å°†ç¼–ç çš„æ–¹æ³•è°ƒç”¨å’Œå‚æ•°ä¼ è¾“åˆ°è¿œç¨‹å¯¹è±¡ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚
3. ä»£ç†ã€‚Stubå’ŒSkeletonæ˜¯RMIä¸­çš„ä»£ç†ç»„ä»¶ã€‚Stubæ˜¯å®¢æˆ·ç«¯çš„ä»£ç†ï¼ŒSkeletonæ˜¯æœåŠ¡å™¨ç«¯çš„ä»£ç†ã€‚Stubè´Ÿè´£å°†å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨è½¬å‘åˆ°è¿œç¨‹å¯¹è±¡ï¼Œè€ŒSkeletonæ¥æ”¶å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨å¹¶å°†å…¶è½¬å‘ç»™å®é™…çš„è¿œç¨‹å¯¹è±¡ã€‚Stubå’ŒSkeletonå¤„ç†äº†ç½‘ç»œé€šä¿¡ã€å‚æ•°ç¼–ç»„å’Œè§£ç»„ç­‰ç»†èŠ‚ï¼Œä½¿å¾—è¿œç¨‹è°ƒç”¨è¿‡ç¨‹å¯¹å¼€å‘äººå‘˜é€æ˜ã€‚

## Javaæ¼æ´

### æ–‡ç« 

- [å…³äºJavaä¸­RMIçš„ä¸ªäººæ‹™è§](https://chenlvtang.top/2021/07/09/%E5%85%B3%E4%BA%8EJava%E4%B8%ADRMI%E7%9A%84%E4%B8%AA%E4%BA%BA%E6%8B%99%E8%A7%81/)

- [Java JNDIå…¶å®ƒæ³¨å…¥ç‚¹åˆ†æ](http://nekopunch.cn/?p=1470) 
- [Java JNDIæ³¨å…¥æºç åˆ†æ](http://nekopunch.cn/?p=1417) 
- [Java RMIååºåˆ—åŒ–&JNDIæ³¨å…¥](http://nekopunch.cn/?p=769) 
- [JNDI æ³¨å…¥æ¼æ´çš„å‰ä¸–ä»Šç”Ÿ](https://evilpan.com/2021/12/13/jndi-injection/)
- [æ”»å‡»Javaä¸­çš„JNDIã€RMIã€LDAP\(ä¸€\)](https://y4er.com/posts/attack-java-jndi-rmi-ldap-1) 
- [æ”»å‡»Javaä¸­çš„JNDIã€RMIã€LDAP\(äºŒ\)](https://y4er.com/posts/attack-java-jndi-rmi-ldap-2) 
- [æ”»å‡»Javaä¸­çš„JNDIã€RMIã€LDAP\(ä¸‰\)](https://y4er.com/posts/attack-java-jndi-rmi-ldap-3) 
- [æ”»å‡»Java Webåº”ç”¨-[Java Webå®‰å…¨]](https://javasec.org/)

### è§†é¢‘

- [Bç«™æœ€å…¨çš„Javaå®‰å…¨å­¦ä¹ è·¯çº¿](https://www.bilibili.com/video/BV1Sv4y1i7jf/)
- [Javaååºåˆ—åŒ–RMIä¸“é¢˜-æ²¡æœ‰äººæ¯”æˆ‘æ›´æ‡‚RMI](https://www.bilibili.com/video/BV1L3411a7ax/)

### åšå®¢

- https://paper.seebug.org/

- https://su18.org/
- https://www.03sec.com/
- https://y4er.com/
- https://evilpan.com/
- http://nekopunch.cn/
- https://4ra1n.github.io/
- https://chenlvtang.top/
- https://www.yulegeyu.com/

### ç¤¾åŒº

- https://xz.aliyun.com/
- https://web.sqlsec.com/

## Semgrep

semgrep æ˜¯ä¸€æ¬¾ç”±Facebookå¼€æºçš„ç™½ç›’ä»£ç æ‰«æå·¥å…·ï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/returntocorp/semgrepï¼Œå…¶è§„åˆ™ç¼–å†™ç®€å•ï¼Œæ˜“ç”¨ï¼Œæ‰«æé€Ÿåº¦å¿«ã€‚ç›¸è¾ƒäºCodeQL è€Œè¨€ï¼Œå…¥é—¨é—¨æ§›è¾ƒä½ï¼Œç¼–å†™è§„åˆ™ç®€å•ï¼Œä¸”éå¸¸æ–¹ä¾¿åœ°æ¥å…¥åˆ°CIæµç¨‹ä¸­ã€‚

### å®‰è£…æ­¥éª¤

æ–¹å¼ä¸€ã€macæœºå™¨ä¸Šå¯ä½¿ç”¨ homebrew å®‰è£…ï¼š

```bash
brew install semgrep
```

æ–¹å¼äºŒã€Ubuntu / Windows via WSL / Linux / macOS ä¹Ÿå¯ä»¥ä½¿ç”¨pipè¿›è¡Œå®‰è£…ï¼š

```bash
python3 -m pip install semgrep
```

æ–¹å¼ä¸‰ã€Dockeréƒ¨ç½²:

```bash
docker pull returntocorp/semgrep:latest
```

semgrep æœ‰ Pro ç‰ˆæœ¬ä¸ç¤¾åŒºç‰ˆæœ¬ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯ä»¥ç™»é™† Pro ç‰ˆæœ¬ï¼š

```bash
semgrep login
```

æ ¹æ®è¾“å‡ºè®¿é—®å¯¹åº”çš„é“¾æ¥è¿›è¡Œç™»é™†ã€‚

ç»ˆç«¯è·å¾— token ä¹‹åï¼Œå°±å¯ä»¥å®‰è£… pro å¼•æ“äº†ã€‚

```bash
semgrep install-semgrep-pro
```

å®‰è£…å®Œåå¯ä»¥ä½¿ç”¨ `--pro` å‚æ•°è°ƒç”¨ pro å¼•æ“ã€‚

```bash
semgrep --pro --config "p/default"
```

### ä½¿ç”¨

```bash
git clone https://github.com/WebGoat/WebGoat
semgrep -c p/sql-injection WebGoat -o WebGoat.json --json
```

è¯´æ˜ï¼š

- `-o`ï¼šè¾“å‡ºæ‰«æç»“æœåˆ°æ–‡ä»¶
- `--json`ï¼šæŒ‡å®šè¾“å‡º json æ ¼å¼æ–‡ä»¶ã€‚å¯ä»¥è¾“å‡ºjsonæ ¼å¼/xml/sarif ç­‰æ ¼å¼

- `--config`ï¼šé…ç½®æ‰«æè§„åˆ™æ–‡ä»¶ å®˜æ–¹ä¹Ÿæä¾›äº†ä¸€äº›è§„åˆ™æ–‡ä»¶ï¼Œåœ¨ https://semgrep.dev/r é‡Œå¯ä»¥æŸ¥çœ‹å„ç§åˆ†ç±»çš„è§„åˆ™é›†ã€‚

è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

```bash

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Status â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Scanning 1048 files (only git-tracked) with 103 Code rules:

  CODE RULES

  Language   Rules   Files          Origin      Rules
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  java          16     279          Pro rules      55
  js            10      82          Community      48


  SUPPLY CHAIN RULES

  ğŸ’ Run `semgrep ci` to find dependency
     vulnerabilities and advanced cross-file findings.


  PROGRESS

  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100% 0:00:03


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scan Summary â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Some files were skipped or only partially analyzed.
  Scan was limited to files tracked by git.
  Scan skipped: 87 files matching .semgrepignore patterns
  For a full list of skipped files, run semgrep with the --verbose flag.

Ran 26 rules on 361 files: 13 findings.
âœ  IdeaProjects semgrep install-semgrep-pro

Semgrep Pro Engine will be installed in /opt/homebrew/Cellar/semgrep/1.52.0/libexec/lib/python3.11/site-packages/semgrep/bin/semgrep-core-proprietary
Downloading... â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 159.6/159.6 MB 7.6 MB/s 0:00:00

Successfully installed Semgrep Pro Engine (version 3e84760)!
```

### æ³¨æ„éšç§ç­–ç•¥

æ ¹æ®å®˜æ–¹çš„éšç§ç­–ç•¥ [Semgrep Privacy Policy - Semgrep](https://semgrep.dev/docs/metrics/) çš„ç›¸å…³æè¿°ã€‚

```bash
$ semgrep --config=myrule.yaml  # â†’ no metrics (loading rules from local file)
$ semgrep --config=p/python     # â†’ metrics enabled (fetching Registry)
$ semgrep login && semgrep ci   # â†’ metrics enabled (logged in to semgrep.dev)
```

1. å½“ä»…ä½¿ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶æˆ–å‘½ä»¤è¡Œæœç´¢æ¨¡å¼è¿è¡Œæ—¶ï¼Œå®˜æ–¹ä¸ä¼šæ”¶é›†ç›¸å…³ä¿¡æ¯ã€‚
2. å½“ä½¿ç”¨ Registry ä¸­çš„è§„åˆ™æ—¶ï¼Œå®˜æ–¹ä¼šæ”¶é›†æ‰€éœ€æ•°æ®ä»¥å¸®åŠ©ç»´æŠ¤äººå‘˜å®Œå–„è§„åˆ™ã€‚
3. å½“ä½¿ç”¨äº‘å¹³å°æ—¶ï¼Œå®˜æ–¹ä¹Ÿä¼šæ”¶é›†è¿™äº›æ•°æ®ï¼Œå¹¶ä¸”å°†ç»“æœå­˜æ”¾åœ¨äº‘å¹³å°ä¸­ã€‚

æ”¶é›†æ•°æ®çš„å…·ä½“å†…å®¹å¯è§ï¼š[Data collected as metrics](https://semgrep.dev/docs/metrics/#data-collected-as-metrics)

ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š `--metrics` é€‰é¡¹æ¥æ§åˆ¶æ•°æ®çš„å‘é€ã€‚

```bash
--metrics autoï¼šï¼ˆé»˜è®¤ï¼‰æ¯å½“ä» Semgrep æ³¨å†Œè¡¨ä¸­æå–è§„åˆ™æ—¶éƒ½ä¼šå‘é€
--metrics onï¼šæ¯æ¬¡ Semgrep è¿è¡Œæ—¶éƒ½ä¼šå‘é€
--metrics offï¼šæ°¸è¿œä¸ä¼šå‘é€
```

å¦‚æœæœ‰éšç§è€ƒè™‘çš„è¯ï¼Œå»ºè®®ç¦»çº¿ä½¿ç”¨è§„åˆ™åº“ï¼Œå¹¶æ·»åŠ  `--metrics off` å‚æ•°ã€‚

### å‚è€ƒ

- [è½»é‡çº§ä»£ç å®¡è®¡å·¥å…·: Semgrep](https://xz.aliyun.com/t/12696)
- [https://github.com/chenlvtang/CodeReview-Java](https://github.com/chenlvtang/CodeReview-Java) ä½¿ç”¨ Semgrep è§„åˆ™æ£€æµ‹å¼€æº CMS ç³»ç»Ÿçš„æ¼æ´



-- EOF
