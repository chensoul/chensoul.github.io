<!doctype html><html class=no-js lang=zh-cn><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>基于 Spring AI 构建智能餐厅推荐系统：多模型集成的实践指南 - Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="基于 Spring AI 构建智能餐厅推荐系统：多模型集成的实践指南"><meta property="og:description" content="Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2025/09/25/spring-ai-restaurant-showcase/"><meta property="og:site_name" content="ChenSoul Blog"><meta property="og:image" content><meta itemprop=name content="基于 Spring AI 构建智能餐厅推荐系统：多模型集成的实践指南"><meta itemprop=description content="本文将教您如何使用 Spring AI 项目构建基于不同聊天模型的应用程序。Spring AI 聊天模型是一个简单易用的接口，允许我们与这些模型进行交互。我们的 Spring Boot 示例应用程序将在 OpenAI、Mistral AI 和 Ollama 提供的三种流行聊天模型之间切换，并展示如何使用 Spring AI 框架实现多轮对话、结构化输出等核心功能。"><meta itemprop=datePublished content="2025-09-25T00:00:00+00:00"><meta itemprop=dateModified content="2025-09-25T00:00:00+00:00"><meta itemprop=wordCount content="1695"><meta itemprop=keywords content="Spring-Ai"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="基于 Spring AI 构建智能餐厅推荐系统：多模型集成的实践指南"><meta name=twitter:description content="Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps"><meta name=twitter:image content><link rel=preconnect href=//fonts.loli.net crossorigin><link rel=dns-prefetch href=//fonts.loli.net><link rel=stylesheet href="https://fonts.loli.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class="logo logo--mixed"><a class=logo__link href=/ title="ChenSoul Blog" rel=home><div class="logo__item logo__imagebox"><img class=logo__img src=/logo.svg loading=lazy alt="Site logo" width=60 height=60></div><div class="logo__item logo__text"><div class=logo__title>ChenSoul Blog</div><div class=logo__tagline>Java、Spring、Spring Boot、MicroServices、Architecture、Kubernetes、DevOps</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>分类</span></a></li><li class=menu__item><a class=menu__link href=/tags/><span class=menu__text>标签</span></a></li><li class=menu__item><a class=menu__link href=/index.xml><span class=menu__text>订阅</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>关于</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>基于 Spring AI 构建智能餐厅推荐系统：多模型集成的实践指南</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 110 28 1 1 0 010-28m0 3a3 3 0 100 22 3 3 0 000-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class=meta__text datetime=2025-09-25>2025-09-25</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/ai/ rel=category>Ai</a></span></div><div class="meta__item-tags meta__item"><svg class="meta__icon icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><span class=meta__text><a class=meta__link href=/tags/spring-ai/ rel=tag>Spring-Ai</a></span></div></div></header><div class="content post__content clearfix"><p>本文将教您如何使用 Spring AI 项目构建基于不同聊天模型的应用程序。Spring AI 聊天模型是一个简单易用的接口，允许我们与这些模型进行交互。我们的 Spring Boot 示例应用程序将在 OpenAI、Mistral AI 和 Ollama 提供的三种流行聊天模型之间切换，并展示如何使用 Spring AI 框架实现多轮对话、结构化输出等核心功能。</p><h2 id=源代码>源代码</h2><p>如果您想亲自尝试，可以随时查看我的源代码。为此，您必须克隆我的示例 <a href=https://github.com/chensoul/spring-ai-restaurant-showcase target=_blank>GitHub 仓库</a>。然后，您只需按照我的说明进行操作即可。</p><h2 id=项目目标>项目目标</h2><p>使用 Spring AI 构建一个智能餐厅推荐系统，实现以下核心功能：</p><ul><li>✅ <strong>智能推荐</strong>：根据用户偏好推荐合适的餐厅</li><li>✅ <strong>多轮对话</strong>：支持上下文对话，提供连贯的用户体验</li><li>✅ <strong>结构化输出</strong>：返回标准化的 JSON 数据格式</li><li>✅ <strong>多模型支持</strong>：支持多个 AI 模型提供商的无缝切换</li><li>✅ <strong>中文支持</strong>：完美支持中文参数和响应</li><li>✅ <strong>生产就绪</strong>：包含完整的配置管理和错误处理</li></ul><h2 id=环境搭建>环境搭建</h2><h3 id=技术栈>技术栈</h3><ul><li><strong>Java 21</strong>：使用最新的 LTS 版本</li><li><strong>Spring Boot 3.5.6</strong>：提供企业级应用框架</li><li><strong>Spring AI 1.1.0-M2</strong>：AI 集成框架</li><li><strong>Maven</strong>：依赖管理和构建工具</li><li><strong>Lombok</strong>：简化 Java 代码</li></ul><h3 id=依赖配置>依赖配置</h3><p>Spring AI 项目仍在积极开发中，当前使用里程碑版本 <code>1.1.0-M2</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;repositories&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;repository&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>central<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;name&gt;</span>Central<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;url&gt;</span>https://repo1.maven.org/maven2/<span style=color:#f92672>&lt;/url&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/repository&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;repository&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>spring-milestones<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;name&gt;</span>Spring Milestones<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;url&gt;</span>https://repo.spring.io/milestone<span style=color:#f92672>&lt;/url&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;snapshots&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;enabled&gt;</span>false<span style=color:#f92672>&lt;/enabled&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/snapshots&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/repository&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/repositories&gt;</span>
</span></span></code></pre></div><p>然后，我们应该包含指定版本的 Spring AI 项目的 Maven BOM。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;properties&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;java.version&gt;</span>21<span style=color:#f92672>&lt;/java.version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;spring-ai.version&gt;</span>1.1.0-M2<span style=color:#f92672>&lt;/spring-ai.version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/properties&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependencyManagement&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.ai<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;artifactId&gt;</span>spring-ai-bom<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;version&gt;</span>${spring-ai.version}<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;type&gt;</span>pom<span style=color:#f92672>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;scope&gt;</span>import<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependencyManagement&gt;</span>
</span></span></code></pre></div><p>由于我们的示例应用暴露了一些 REST 端点，我们应该包含 Spring Boot Web Starter。我们可以包含 Spring Boot Test Starter 来创建一些 JUnit 测试。Spring AI 模块包含在 Maven <code>profiles</code> 部分中。每个聊天模型提供商都有三个不同的配置文件。默认情况下，我们的应用使用 OpenAI，因此它激活了 <code>open-ai</code> 配置文件，该文件包含 <code>spring-ai-starter-model-openai</code> 库。我们应该激活 <code>mistral-ai</code> 配置文件来切换到 Mistral AI。第三个选项是 <code>ollama-ai</code> 配置文件，包含 <code>spring-ai-starter-model-ollama</code> 依赖。这将使在不同聊天模型 AI 提供商之间切换变得轻而易举——我们只需要在 Maven 运行命令中设置配置文件参数。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-test<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;scope&gt;</span>test<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.projectlombok<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>lombok<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;optional&gt;</span>true<span style=color:#f92672>&lt;/optional&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;profiles&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;profile&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>open-ai<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;activation&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;activeByDefault&gt;</span>true<span style=color:#f92672>&lt;/activeByDefault&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/activation&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.ai<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;artifactId&gt;</span>spring-ai-starter-model-openai<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/profile&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;profile&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>mistral-ai<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.ai<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;artifactId&gt;</span>spring-ai-starter-model-mistral-ai<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/profile&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;profile&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>ollama-ai<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.ai<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;artifactId&gt;</span>spring-ai-starter-model-ollama<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/profile&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/profiles&gt;</span>
</span></span></code></pre></div><h2 id=项目配置>项目配置</h2><h3 id=环境配置>环境配置</h3><p>在开始开发之前，我们需要配置 AI 模型提供商的 API 密钥。</p><h4 id=配置-openai>配置 OpenAI</h4><p>我们必须在 <a href=https://platform.openai.com/ target=_blank>OpenAI</a> 平台门户上拥有一个账户。登录后，访问 <a href=https://platform.openai.com/account/api-keys target=_blank>API 密钥</a> 页面来生成 API 令牌。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export OPENAI_API_KEY<span style=color:#f92672>=</span>&lt;YOUR_TOKEN_VALUE&gt;
</span></span></code></pre></div><h4 id=配置-mistral-ai>配置 Mistral AI</h4><p>在 <a href=https://console.mistral.ai/ target=_blank>Mistral AI</a> 平台门户上创建账户，访问 <a href=https://console.mistral.ai/api-keys/ target=_blank>API 密钥</a> 页面生成令牌。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export MISTRAL_API_KEY<span style=color:#f92672>=</span>&lt;YOUR_TOKEN_VALUE&gt;
</span></span></code></pre></div><h4 id=运行和配置-ollama>运行和配置 Ollama</h4><p>Ollama 允许在本地运行大型语言模型。从 <a href=https://ollama.com/download target=_blank>下载页面</a> 下载并安装 Ollama，然后运行模型：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ollama run llama3.2
</span></span></code></pre></div><h4 id=配置兼容-openai-的模型>配置兼容 OpenAI 的模型</h4><ol><li>Groq AI</li></ol><ul><li><strong>模型</strong>: Llama 3.1 70B Versatile</li><li><strong>特点</strong>: 极快的推理速度，高性能</li><li><strong>API</strong>: <a href=https://api.groq.com/openai/v1 target=_blank>https://api.groq.com/openai/v1</a></li><li><strong>获取 API Key</strong>: <a href=https://console.groq.com/keys target=_blank>https://console.groq.com/keys</a></li></ul><ol start=2><li>Docker Model Runner (DMR)</li></ol><ul><li><strong>模型</strong>: Llama 3.2</li><li><strong>特点</strong>: 本地运行，Docker 容器化部署</li><li><strong>API</strong>: <a href=http://localhost:11434/v1 target=_blank>http://localhost:11434/v1</a></li><li><strong>安装</strong>: <a href=https://docs.docker.com/ai/model-runner/ target=_blank>https://docs.docker.com/ai/model-runner/</a></li></ul><ol start=3><li>OpenRouter AI</li></ol><ul><li><strong>模型</strong>: Llama 3.1 8B Instruct (Free)</li><li><strong>特点</strong>: 多种开源模型选择，成本较低</li><li><strong>API</strong>: <a href=https://openrouter.ai/api/v1 target=_blank>https://openrouter.ai/api/v1</a></li><li><strong>获取 API Key</strong>: <a href=https://openrouter.ai/keys target=_blank>https://openrouter.ai/keys</a></li></ul><ol start=4><li>DeepSeek AI</li></ol><ul><li><strong>模型</strong>: DeepSeek Chat</li><li><strong>特点</strong>: 强大的中文理解能力</li><li><strong>API</strong>: <a href=https://api.deepseek.com/v1 target=_blank>https://api.deepseek.com/v1</a></li><li><strong>获取 API Key</strong>: <a href=https://platform.deepseek.com/api_keys target=_blank>https://platform.deepseek.com/api_keys</a></li></ul><ol start=5><li>Qwen AI</li></ol><ul><li><strong>模型</strong>: Qwen Plus</li><li><strong>特点</strong>: 阿里巴巴开发的中文大模型</li><li><strong>API</strong>: <a href=https://dashscope.aliyuncs.com/compatible-mode/v1 target=_blank>https://dashscope.aliyuncs.com/compatible-mode/v1</a></li><li><strong>获取 API Key</strong>: <a href=https://dashscope.console.aliyun.com/apiKey target=_blank>https://dashscope.console.aliyun.com/apiKey</a></li></ul><h3 id=spring-boot-配置>Spring Boot 配置</h3><h4 id=1-通用配置-applicationyml>1. 通用配置 (application.yml)</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.api-key</span>: <span style=color:#ae81ff>${OPENAI_API_KEY}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.chat.options.model</span>: <span style=color:#ae81ff>gpt-5</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.chat.options.temperature</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.mistralai.api-key</span>: <span style=color:#ae81ff>${MISTRAL_API_KEY}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.ollama.chat.options.model</span>: <span style=color:#ae81ff>llama3.2</span>
</span></span></code></pre></div><h4 id=2-openai-兼容模型配置>2. OpenAI 兼容模型配置</h4><p>Groq AI 配置 (application-groq.yml)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.api-key</span>: <span style=color:#ae81ff>${GROQ_API_KEY}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.base-url</span>: <span style=color:#ae81ff>https://api.groq.com</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.chat.options.model</span>: <span style=color:#ae81ff>llama-3.1-70b-versatile</span>
</span></span></code></pre></div><p>DeepSeek AI 配置 (application-deepseek.yml)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.api-key</span>: <span style=color:#ae81ff>${DEEPSEEK_API_KEY}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.base-url</span>: <span style=color:#ae81ff>https://api.deepseek.com</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.chat.options.model</span>: <span style=color:#ae81ff>deepseek-chat</span>
</span></span></code></pre></div><p>OpenRouter AI 配置 (application-openrouter.yml)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.api-key</span>: <span style=color:#ae81ff>${OPENROUTER_API_KEY}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.base-url</span>: <span style=color:#ae81ff>https://openrouter.ai</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.chat.completions-path</span>: <span style=color:#ae81ff>/api/v1/chat/completions</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.chat.options.model</span>: <span style=color:#ae81ff>qwen/qwen3-coder:free</span>
</span></span></code></pre></div><p>Qwen AI 配置 (application-qwen.yml)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.api-key</span>: <span style=color:#ae81ff>${QWEN_API_KEY}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.base-url</span>: <span style=color:#ae81ff>https://dashscope.aliyuncs.com/compatible-mode/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.chat.options.model</span>: <span style=color:#ae81ff>qwen-plus</span>
</span></span></code></pre></div><p>Docker Model Runner 配置 (application-dmr.yml)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.base-url</span>: <span style=color:#ae81ff>http://localhost:12434/engines/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.api-key</span>: <span style=color:#ae81ff>dummy-key</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spring.ai.openai.chat.options.model</span>: <span style=color:#ae81ff>llama3.2</span>
</span></span></code></pre></div><h4 id=3-环境变量设置>3. 环境变量设置</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 选择其中一个模型设置对应的环境变量</span>
</span></span><span style=display:flex><span>export OPENAI_API_KEY<span style=color:#f92672>=</span>your-openai-api-key
</span></span><span style=display:flex><span>export MISTRAL_API_KEY<span style=color:#f92672>=</span>your-mistral-api-key
</span></span><span style=display:flex><span>export GROQ_API_KEY<span style=color:#f92672>=</span>your-groq-api-key
</span></span><span style=display:flex><span>export DEEPSEEK_API_KEY<span style=color:#f92672>=</span>your-deepseek-api-key
</span></span><span style=display:flex><span>export OPENROUTER_API_KEY<span style=color:#f92672>=</span>your-openrouter-api-key
</span></span><span style=display:flex><span>export QWEN_API_KEY<span style=color:#f92672>=</span>your-qwen-api-key
</span></span></code></pre></div><h2 id=核心功能实现>核心功能实现</h2><h3 id=1-数据模型设计>1. 数据模型设计</h3><p>首先定义我们的核心数据模型，使用 Lombok 简化代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@NoArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Restaurant</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long id;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String cuisine;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String location;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Double rating;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String description;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String priceRange;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String<span style=color:#f92672>[]</span> features;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Data</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@NoArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AllArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dish</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long id;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String description;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String cuisine;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Double price;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String category;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> ingredients;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String dietaryInfo;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Integer calories;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String preparationTime;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String difficulty;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-rest-api-设计>2. REST API 设计</h3><p>设计 RESTful API 接口，支持中文参数和 JSON 数据交换：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/dishes/generate&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Dish<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>generateDishes</span>(<span style=color:#a6e22e>@RequestBody</span> Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> request) {
</span></span><span style=display:flex><span>    String cuisine <span style=color:#f92672>=</span> (String) request.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>);
</span></span><span style=display:flex><span>    Integer countObj <span style=color:#f92672>=</span> (Integer) request.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;count&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> count <span style=color:#f92672>=</span> countObj <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> countObj : 5;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 限制菜品数量在合理范围内</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> validCount <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(1, Math.<span style=color:#a6e22e>min</span>(count, 10));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    PromptTemplate template <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PromptTemplate(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            为{cuisine}菜系生成{count}道特色菜品，包含以下信息：
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - 菜品名称
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - 详细描述
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - 主要食材
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - 价格范围
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - 菜品分类（开胃菜/主菜/甜点等）
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - 饮食信息（素食/无麸质/低卡等）
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - 卡路里
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - 制作时间
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            - 难度等级
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            请返回JSON格式的菜品数据，不要包含解释性文字。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;&#34;&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Prompt prompt <span style=color:#f92672>=</span> template.<span style=color:#a6e22e>create</span>(Map.<span style=color:#a6e22e>of</span>(
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;cuisine&#34;</span>, cuisine,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;count&#34;</span>, validCount
</span></span><span style=display:flex><span>    ));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Dish<span style=color:#f92672>&gt;</span> dishes <span style=color:#f92672>=</span> chatClient.<span style=color:#a6e22e>prompt</span>(prompt)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>entity</span>(<span style=color:#66d9ef>new</span> ParameterizedTypeReference<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Dish<span style=color:#f92672>&gt;&gt;</span>() {
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(dishes);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>@RestController</code> 类注入自动配置的 <code>ChatClient.Builder</code> 来创建 <code>ChatClient</code> 实例。<code>RestaurantRecommendationController</code> 实现了从 <code>POST /api/restaurants/recommend</code> 端点返回餐厅列表的方法。主要目标是生成一个包含 5 个对象的列表，这些对象具有在 <code>Restaurant</code> 类中定义的字段。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RequiredArgsConstructor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/api/restaurants&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RestaurantRecommendationController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> ChatClient chatClient;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/recommend&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>recommendRestaurants</span>(<span style=color:#a6e22e>@RequestBody</span> RecommendationRequest request) {
</span></span><span style=display:flex><span>        PromptTemplate template <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PromptTemplate(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                根据以下用户偏好推荐5家合适的餐厅：
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                位置: {location}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                菜系: {cuisine}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                价格范围: {priceRange}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                饮食限制: {dietaryRestrictions}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                场合: {occasion}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                人数: {groupSize}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                用餐时间: {timeOfDay}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                其他偏好: {preferences}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                请返回餐厅列表，包含餐厅名称、菜系、位置、评分、描述、价格范围和特色。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                不要包含任何解释性文字，只返回JSON格式的餐厅数据。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;&#34;&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Prompt prompt <span style=color:#f92672>=</span> template.<span style=color:#a6e22e>create</span>(Map.<span style=color:#a6e22e>of</span>(
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;location&#34;</span>, request.<span style=color:#a6e22e>getLocation</span>() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> request.<span style=color:#a6e22e>getLocation</span>() : <span style=color:#e6db74>&#34;北京市&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;cuisine&#34;</span>, request.<span style=color:#a6e22e>getCuisine</span>() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> request.<span style=color:#a6e22e>getCuisine</span>() : <span style=color:#e6db74>&#34;不限&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;priceRange&#34;</span>, request.<span style=color:#a6e22e>getPriceRange</span>() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> request.<span style=color:#a6e22e>getPriceRange</span>() : <span style=color:#e6db74>&#34;不限&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;dietaryRestrictions&#34;</span>, request.<span style=color:#a6e22e>getDietaryRestrictions</span>() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>                        String.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34;, &#34;</span>, request.<span style=color:#a6e22e>getDietaryRestrictions</span>()) : <span style=color:#e6db74>&#34;无&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;occasion&#34;</span>, request.<span style=color:#a6e22e>getOccasion</span>() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> request.<span style=color:#a6e22e>getOccasion</span>() : <span style=color:#e6db74>&#34;日常用餐&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;groupSize&#34;</span>, request.<span style=color:#a6e22e>getGroupSize</span>() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> request.<span style=color:#a6e22e>getGroupSize</span>().<span style=color:#a6e22e>toString</span>() : <span style=color:#e6db74>&#34;1-2人&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;timeOfDay&#34;</span>, request.<span style=color:#a6e22e>getTimeOfDay</span>() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> request.<span style=color:#a6e22e>getTimeOfDay</span>() : <span style=color:#e6db74>&#34;午餐&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;preferences&#34;</span>, request.<span style=color:#a6e22e>getPreferences</span>() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>                        String.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34;, &#34;</span>, request.<span style=color:#a6e22e>getPreferences</span>()) : <span style=color:#e6db74>&#34;无&#34;</span>
</span></span><span style=display:flex><span>        ));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;</span> restaurants <span style=color:#f92672>=</span> chatClient.<span style=color:#a6e22e>prompt</span>(prompt)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>entity</span>(<span style=color:#66d9ef>new</span> ParameterizedTypeReference<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;&gt;</span>() {});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(restaurants);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>结果并不令人惊讶——系统会返回符合用户偏好的餐厅列表。然而，第二次调用同一个端点时，列表会略有不同。根据我们的提示，聊天客户端应该"返回当前餐厅列表"。所以，我期望得到与之前相同的列表。在这种情况下，问题是聊天客户端不记得之前的对话。</p><h2 id=运行应用>运行应用</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 使用 OpenAI GPT-4o（推荐）</span>
</span></span><span style=display:flex><span>mvn spring-boot:run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 OpenAI（默认配置）</span>
</span></span><span style=display:flex><span>mvn spring-boot:run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 Mistral AI</span>
</span></span><span style=display:flex><span>mvn spring-boot:run -Pmistral-ai
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 Ollama</span>
</span></span><span style=display:flex><span>mvn spring-boot:run -Pollama-ai
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 Groq AI</span>
</span></span><span style=display:flex><span>mvn spring-boot:run -Dspring-boot.run.arguments<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--spring.profiles.active=groq&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 DeepSeek AI</span>
</span></span><span style=display:flex><span>mvn spring-boot:run -Dspring-boot.run.arguments<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--spring.profiles.active=deepseek&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 Qwen AI</span>
</span></span><span style=display:flex><span>mvn spring-boot:run -Dspring-boot.run.arguments<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--spring.profiles.active=qwen&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 OpenRouter AI</span>
</span></span><span style=display:flex><span>mvn spring-boot:run -Dspring-boot.run.arguments<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--spring.profiles.active=openrouter&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用 DMR AI</span>
</span></span><span style=display:flex><span>mvn spring-boot:run -Dspring-boot.run.arguments<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;--spring.profiles.active=dmr&#34;</span>
</span></span></code></pre></div><h2 id=测试-api>测试 API</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 推荐餐厅</span>
</span></span><span style=display:flex><span>curl -X POST http://localhost:8080/api/restaurants/recommend <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;location&#34;: &#34;北京市&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;cuisine&#34;: &#34;中餐&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;priceRange&#34;: &#34;中等价位&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;dietaryRestrictions&#34;: [&#34;素食&#34;],
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;occasion&#34;: &#34;商务聚餐&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;groupSize&#34;: 4,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;timeOfDay&#34;: &#34;晚餐&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  }&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 生成菜品</span>
</span></span><span style=display:flex><span>curl -X POST <span style=color:#e6db74>&#34;http://localhost:8080/api/restaurants/dishes/generate&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;{&#34;cuisine&#34;: &#34;中餐&#34;, &#34;count&#34;: 3}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 获取建议</span>
</span></span><span style=display:flex><span>curl -X POST <span style=color:#e6db74>&#34;http://localhost:8080/api/restaurants/advice&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;{&#34;query&#34;: &#34;适合情侣约会的餐厅&#34;}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 多语言聊天</span>
</span></span><span style=display:flex><span>curl -X POST <span style=color:#e6db74>&#34;http://localhost:8080/api/restaurants/chat&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;{&#34;message&#34;: &#34;推荐一家好吃的川菜馆&#34;, &#34;language&#34;: &#34;zh&#34;}&#39;</span>
</span></span></code></pre></div><h2 id=核心技术特性>核心技术特性</h2><h3 id=1-多轮对话支持>1. 多轮对话支持</h3><p>多轮对话是智能应用的核心特性，Spring AI 提供了开箱即用的解决方案：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ChatConfig</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 配置聊天记忆
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ChatMemory <span style=color:#a6e22e>chatMemory</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> MessageWindowChatMemory.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>chatMemoryRepository</span>(<span style=color:#66d9ef>new</span> InMemoryChatMemoryRepository())
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 配置 ChatClient
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 包含记忆功能和日志记录
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ChatClient <span style=color:#a6e22e>chatClient</span>(ChatClient.<span style=color:#a6e22e>Builder</span> chatClientBuilder, ChatMemory chatMemory) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> chatClientBuilder
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>defaultSystem</span>(<span style=color:#e6db74>&#34;你是一个专业的餐厅推荐助手。请用中文回答，提供准确、有用的餐厅和菜品推荐。&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>defaultAdvisors</span>(
</span></span><span style=display:flex><span>                        MessageChatMemoryAdvisor.<span style=color:#a6e22e>builder</span>(chatMemory).<span style=color:#a6e22e>build</span>(),
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>new</span> SimpleLoggerAdvisor())
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RestaurantApplication</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(RestaurantApplication.<span style=color:#a6e22e>class</span>, args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>现在，让我们进行最终测试。应用重启后，我们可以调用生成餐厅列表的端点。然后，我们将调用 <code>GET /api/restaurants/{id}/details</code> 端点来仅显示具有指定 ID 的单个餐厅。最后，我们可以重复调用 <code>POST /api/restaurants/recommend</code> 端点来验证它是否返回相同的列表。</p><h4 id=多轮对话测试>多轮对话测试</h4><p>让我们测试多轮对话功能：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 第一轮对话：询问川菜馆推荐</span>
</span></span><span style=display:flex><span>curl -X POST http://localhost:8080/api/restaurants/chat <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;{&#34;message&#34;: &#34;我想在北京找一家川菜馆&#34;, &#34;language&#34;: &#34;zh&#34;}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 第二轮对话：询问价格（AI 能记住之前的推荐）</span>
</span></span><span style=display:flex><span>curl -X POST http://localhost:8080/api/restaurants/chat <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;{&#34;message&#34;: &#34;刚才推荐的餐厅中，哪家最便宜？&#34;, &#34;language&#34;: &#34;zh&#34;}&#39;</span>
</span></span></code></pre></div><p><strong>测试结果</strong>：AI 能够记住之前的对话内容，提供连贯的回复，准确回答关于之前推荐餐厅的问题。</p><h4 id=多轮对话实现原理>多轮对话实现原理</h4><ol><li><strong>自动记忆管理</strong>：<code>MessageChatMemoryAdvisor</code> 自动管理对话历史</li><li><strong>内存存储</strong>：使用 <code>MessageWindowChatMemory</code> + <code>InMemoryChatMemoryRepository</code></li><li><strong>透明集成</strong>：通过 <code>ChatClient</code> 的 <code>defaultAdvisors</code> 配置</li><li><strong>上下文保持</strong>：每次对话都会包含完整的对话历史</li></ol><h3 id=2-结构化输出支持>2. 结构化输出支持</h3><p>Spring AI 提供了多种结构化输出方式，满足不同的开发需求：</p><h4 id=1-直接-entity-方法最简单>1. 直接 .entity() 方法（最简单）</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/restaurant/direct-entity&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getRestaurantDirectEntity</span>(<span style=color:#a6e22e>@RequestBody</span> Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> request) {
</span></span><span style=display:flex><span>    String cuisine <span style=color:#f92672>=</span> (String) request.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    PromptTemplate template <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PromptTemplate(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            推荐1家{cuisine}餐厅，返回JSON格式的餐厅信息。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            包含：name, cuisine, location, rating, description, priceRange, features
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;&#34;&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    Prompt prompt <span style=color:#f92672>=</span> template.<span style=color:#a6e22e>create</span>(Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>, cuisine));
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 直接使用 .entity() 方法</span>
</span></span><span style=display:flex><span>    Restaurant restaurant <span style=color:#f92672>=</span> chatClient.<span style=color:#a6e22e>prompt</span>(prompt)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>entity</span>(Restaurant.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(restaurant);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=2-parameterizedtypereference当前项目使用>2. ParameterizedTypeReference（当前项目使用）</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/restaurants/type-ref&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>getRestaurantsWithTypeRef</span>(<span style=color:#a6e22e>@RequestBody</span> Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> request) {
</span></span><span style=display:flex><span>    String cuisine <span style=color:#f92672>=</span> (String) request.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    PromptTemplate template <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PromptTemplate(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            推荐3家{cuisine}餐厅，返回JSON格式的餐厅列表。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            每个餐厅包含：name, cuisine, location, rating, description, priceRange, features
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;&#34;&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    Prompt prompt <span style=color:#f92672>=</span> template.<span style=color:#a6e22e>create</span>(Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>, cuisine));
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 使用 ParameterizedTypeReference</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;</span> restaurants <span style=color:#f92672>=</span> chatClient.<span style=color:#a6e22e>prompt</span>(prompt)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>entity</span>(<span style=color:#66d9ef>new</span> ParameterizedTypeReference<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;&gt;</span>() {});
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(restaurants);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=3-beanoutputconverter>3. BeanOutputConverter</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/restaurant/bean-converter&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getRestaurantWithBeanConverter</span>(<span style=color:#a6e22e>@RequestBody</span> Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> request) {
</span></span><span style=display:flex><span>    String cuisine <span style=color:#f92672>=</span> (String) request.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    PromptTemplate template <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PromptTemplate(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            推荐1家{cuisine}餐厅，返回JSON格式的餐厅信息。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            包含：name, cuisine, location, rating, description, priceRange, features
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;&#34;&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    Prompt prompt <span style=color:#f92672>=</span> template.<span style=color:#a6e22e>create</span>(Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>, cuisine));
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 使用 BeanOutputConverter</span>
</span></span><span style=display:flex><span>    BeanOutputConverter<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;</span> converter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> BeanOutputConverter<span style=color:#f92672>&lt;&gt;</span>(Restaurant.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    String response <span style=color:#f92672>=</span> chatClient.<span style=color:#a6e22e>prompt</span>(prompt)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>content</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    Restaurant restaurant <span style=color:#f92672>=</span> converter.<span style=color:#a6e22e>convert</span>(response);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(restaurant);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=4-mapoutputconverter>4. MapOutputConverter</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/restaurant/map-converter&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>getRestaurantWithMapConverter</span>(<span style=color:#a6e22e>@RequestBody</span> Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> request) {
</span></span><span style=display:flex><span>    String cuisine <span style=color:#f92672>=</span> (String) request.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    PromptTemplate template <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PromptTemplate(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            推荐1家{cuisine}餐厅，返回JSON格式的餐厅信息。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            包含：name, cuisine, location, rating, description, priceRange, features
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;&#34;&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    Prompt prompt <span style=color:#f92672>=</span> template.<span style=color:#a6e22e>create</span>(Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>, cuisine));
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 使用 MapOutputConverter</span>
</span></span><span style=display:flex><span>    MapOutputConverter converter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MapOutputConverter();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    String response <span style=color:#f92672>=</span> chatClient.<span style=color:#a6e22e>prompt</span>(prompt)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>content</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unchecked&#34;</span>)
</span></span><span style=display:flex><span>    Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> restaurant <span style=color:#f92672>=</span> (Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span>) converter.<span style=color:#a6e22e>convert</span>(response);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(restaurant);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=5-listoutputconverter>5. ListOutputConverter</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/restaurants/list-converter&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#a6e22e>getRestaurantsWithListConverter</span>(<span style=color:#a6e22e>@RequestBody</span> Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> request) {
</span></span><span style=display:flex><span>    String cuisine <span style=color:#f92672>=</span> (String) request.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    PromptTemplate template <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> PromptTemplate(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            推荐3家{cuisine}餐厅，返回JSON格式的餐厅列表。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            每个餐厅包含：name, cuisine, location, rating, description, priceRange, features
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;&#34;&#34;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    Prompt prompt <span style=color:#f92672>=</span> template.<span style=color:#a6e22e>create</span>(Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;cuisine&#34;</span>, cuisine));
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 使用 ListOutputConverter</span>
</span></span><span style=display:flex><span>    ListOutputConverter converter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ListOutputConverter();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    String response <span style=color:#f92672>=</span> chatClient.<span style=color:#a6e22e>prompt</span>(prompt)
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>content</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unchecked&#34;</span>)
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> restaurantStrings <span style=color:#f92672>=</span> (List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>) converter.<span style=color:#a6e22e>convert</span>(response);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 将字符串列表转换为 Map 列表（这里简化处理）</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;&gt;</span> restaurants <span style=color:#f92672>=</span> restaurantStrings.<span style=color:#a6e22e>stream</span>()
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>map</span>(str <span style=color:#f92672>-&gt;</span> Map.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;name&#34;</span>, str, <span style=color:#e6db74>&#34;cuisine&#34;</span>, cuisine))
</span></span><span style=display:flex><span>            .<span style=color:#a6e22e>toList</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(restaurants);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=结构化输出方式对比>结构化输出方式对比</h4><table><thead><tr><th>输出方式</th><th>代码简洁度</th><th>类型安全</th><th>灵活性</th><th>推荐场景</th></tr></thead><tbody><tr><td><code>.entity()</code></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>简单对象</td></tr><tr><td><code>ParameterizedTypeReference</code></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>复杂泛型</td></tr><tr><td><code>BeanOutputConverter</code></td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>自定义转换</td></tr><tr><td><code>MapOutputConverter</code></td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>动态结构</td></tr><tr><td><code>ListOutputConverter</code></td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐</td><td>简单列表</td></tr></tbody></table><h4 id=结构化输出测试>结构化输出测试</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 测试直接 .entity() 方法</span>
</span></span><span style=display:flex><span>curl -X POST http://localhost:8080/api/structured/restaurant/direct-entity <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;{&#34;cuisine&#34;: &#34;川菜&#34;}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 测试 ParameterizedTypeReference</span>
</span></span><span style=display:flex><span>curl -X POST http://localhost:8080/api/structured/restaurants/type-ref <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;{&#34;cuisine&#34;: &#34;川菜&#34;}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 测试 BeanOutputConverter</span>
</span></span><span style=display:flex><span>curl -X POST http://localhost:8080/api/structured/restaurant/bean-converter <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;{&#34;cuisine&#34;: &#34;川菜&#34;}&#39;</span>
</span></span></code></pre></div><p><strong>测试结果</strong>：所有结构化输出方式都能正确工作，返回符合预期格式的数据。</p><h2 id=功能扩展>功能扩展</h2><p>基于对当前项目的分析，以下是本项目<strong>未涉及</strong>但 Spring AI 框架支持的强大功能：</p><h3 id=-核心功能扩展>🚀 核心功能扩展</h3><h4 id=1-流式响应-streaming>1. <strong>流式响应 (Streaming)</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 当前项目：同步调用</span>
</span></span><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;</span> restaurants <span style=color:#f92672>=</span> chatClient.<span style=color:#a6e22e>prompt</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>user</span>(<span style=color:#e6db74>&#34;推荐餐厅&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>entity</span>(<span style=color:#66d9ef>new</span> ParameterizedTypeReference<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;&gt;</span>() {});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 未实现：流式响应</span>
</span></span><span style=display:flex><span>Flux<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> stream <span style=color:#f92672>=</span> chatClient.<span style=color:#a6e22e>prompt</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>user</span>(<span style=color:#e6db74>&#34;推荐餐厅&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>stream</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>content</span>();
</span></span></code></pre></div><h4 id=2-函数调用-function-calling>2. <strong>函数调用 (Function Calling)</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：工具调用</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Function<span style=color:#f92672>&lt;</span>WeatherRequest, WeatherResponse<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>weatherFunction</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> request <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 调用天气 API</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> weatherService.<span style=color:#a6e22e>getWeather</span>(request.<span style=color:#a6e22e>getLocation</span>());
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 在 ChatClient 中使用</span>
</span></span><span style=display:flex><span>chatClient.<span style=color:#a6e22e>prompt</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>user</span>(<span style=color:#e6db74>&#34;北京今天天气如何？&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>functions</span>(<span style=color:#e6db74>&#34;weatherFunction&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>call</span>();
</span></span></code></pre></div><h4 id=3-向量数据库集成-rag>3. <strong>向量数据库集成 (RAG)</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：检索增强生成</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> VectorStore <span style=color:#a6e22e>vectorStore</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> PineconeVectorStore(pineconeApiKey, <span style=color:#e6db74>&#34;restaurant-index&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// RAG 查询</span>
</span></span><span style=display:flex><span>chatClient.<span style=color:#a6e22e>prompt</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>user</span>(<span style=color:#e6db74>&#34;推荐适合商务聚餐的餐厅&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>advisors</span>(RetrievalAugmentationAdvisor.<span style=color:#a6e22e>builder</span>(vectorStore).<span style=color:#a6e22e>build</span>())
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>call</span>();
</span></span></code></pre></div><h3 id=-多模态支持>🎨 多模态支持</h3><h4 id=4-图像识别和处理>4. <strong>图像识别和处理</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：图像输入</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/analyze-image&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>analyzeImage</span>(<span style=color:#a6e22e>@RequestParam</span> MultipartFile image) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> chatClient.<span style=color:#a6e22e>prompt</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>user</span>(<span style=color:#e6db74>&#34;分析这张餐厅图片&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>media</span>(image)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>content</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=5-语音转文字和文字转语音>5. <strong>语音转文字和文字转语音</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：语音处理</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/voice-chat&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[]&gt;</span> <span style=color:#a6e22e>voiceChat</span>(<span style=color:#a6e22e>@RequestParam</span> MultipartFile audio) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 语音转文字</span>
</span></span><span style=display:flex><span>    String text <span style=color:#f92672>=</span> speechToTextService.<span style=color:#a6e22e>transcribe</span>(audio);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// AI 处理</span>
</span></span><span style=display:flex><span>    String response <span style=color:#f92672>=</span> chatClient.<span style=color:#a6e22e>prompt</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>user</span>(text)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>content</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 文字转语音</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> textToSpeechService.<span style=color:#a6e22e>synthesize</span>(response);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=-性能优化功能>⚡ 性能优化功能</h3><h4 id=6-异步处理>6. <strong>异步处理</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：异步调用</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Async</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> CompletableFuture<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>recommendRestaurantsAsync</span>(RecommendationRequest request) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> chatClient.<span style=color:#a6e22e>prompt</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>user</span>(<span style=color:#e6db74>&#34;推荐餐厅&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>entity</span>(<span style=color:#66d9ef>new</span> ParameterizedTypeReference<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;&gt;</span>() {})
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>toFuture</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=7-缓存机制>7. <strong>缓存机制</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：响应缓存</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Cacheable</span>(<span style=color:#e6db74>&#34;restaurant-recommendations&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getCachedRecommendations</span>(RecommendationRequest request) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> chatClient.<span style=color:#a6e22e>prompt</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>user</span>(<span style=color:#e6db74>&#34;推荐餐厅&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>entity</span>(<span style=color:#66d9ef>new</span> ParameterizedTypeReference<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;&gt;</span>() {});
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=8-批量处理>8. <strong>批量处理</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：批量处理</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>batchRecommend</span>(List<span style=color:#f92672>&lt;</span>RecommendationRequest<span style=color:#f92672>&gt;</span> requests) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> chatClient.<span style=color:#a6e22e>batch</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>prompt</span>(<span style=color:#e6db74>&#34;推荐餐厅&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>call</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>entity</span>(<span style=color:#66d9ef>new</span> ParameterizedTypeReference<span style=color:#f92672>&lt;</span>List<span style=color:#f92672>&lt;</span>Restaurant<span style=color:#f92672>&gt;&gt;</span>() {});
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=-高级管理功能>🔧 高级管理功能</h3><h4 id=9-模型路由和负载均衡>9. <strong>模型路由和负载均衡</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：智能路由</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ModelRouter <span style=color:#a6e22e>modelRouter</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ModelRouter.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>addRoute</span>(<span style=color:#e6db74>&#34;restaurant&#34;</span>, <span style=color:#e6db74>&#34;gpt-4o&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>addRoute</span>(<span style=color:#e6db74>&#34;dish&#34;</span>, <span style=color:#e6db74>&#34;claude-3&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>addRoute</span>(<span style=color:#e6db74>&#34;chat&#34;</span>, <span style=color:#e6db74>&#34;llama-3&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=10-提示词模板管理>10. <strong>提示词模板管理</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：复杂模板</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> PromptTemplate <span style=color:#a6e22e>restaurantTemplate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> PromptTemplate(<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        你是一个专业的餐厅推荐助手。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        用户偏好：{preferences}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        位置：{location}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        预算：{budget}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {% if occasion == &#34;商务聚餐&#34; %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        请推荐环境优雅、服务专业的餐厅。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {% elif occasion == &#34;朋友聚会&#34; %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        请推荐氛围轻松、菜品丰富的餐厅。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {% endif %}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;&#34;&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=-企业级功能>🏠 企业级功能</h3><h4 id=11-多租户支持>11. <strong>多租户支持</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：多租户隔离</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> TenantAwareChatClient <span style=color:#a6e22e>tenantAwareChatClient</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> TenantAwareChatClient.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>tenantResolver</span>(tenantResolver)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>modelProvider</span>(tenantModelProvider)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=12-安全性和内容过滤>12. <strong>安全性和内容过滤</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：内容安全</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ContentFilterAdvisor <span style=color:#a6e22e>contentFilterAdvisor</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ContentFilterAdvisor.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>contentFilter</span>(contentFilter)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=13-监控和指标>13. <strong>监控和指标</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：性能监控</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> MetricsAdvisor <span style=color:#a6e22e>metricsAdvisor</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> MetricsAdvisor.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>meterRegistry</span>(meterRegistry)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=-成本优化功能>💰 成本优化功能</h3><h4 id=14-成本控制>14. <strong>成本控制</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：成本控制</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> CostOptimizationAdvisor <span style=color:#a6e22e>costOptimizationAdvisor</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> CostOptimizationAdvisor.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>maxCostPerRequest</span>(0.<span style=color:#a6e22e>01</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>fallbackModel</span>(<span style=color:#e6db74>&#34;gpt-3.5-turbo&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=15-模型热更新>15. <strong>模型热更新</strong></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 未实现：动态切换</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/switch-model&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>switchModel</span>(<span style=color:#a6e22e>@RequestParam</span> String modelName) {
</span></span><span style=display:flex><span>    modelManager.<span style=color:#a6e22e>switchModel</span>(modelName);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(<span style=color:#e6db74>&#34;模型已切换&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=总结>总结</h2><p>Spring AI 作为 Spring 生态系统的新成员，为 Java 开发者提供了构建智能化应用的强大工具。随着 AI 技术的不断发展，我们可以期待：</p><ul><li><strong>更多模型支持</strong>：集成更多 AI 模型提供商</li><li><strong>功能增强</strong>：更丰富的 AI 功能特性</li><li><strong>开发工具</strong>：更完善的开发工具和调试支持</li><li><strong>企业级功能</strong>：更强大的企业级特性和监控支持</li></ul><h2 id=参考资源>参考资源</h2><ul><li><a href=https://docs.spring.io/spring-ai/reference/ target=_blank>Spring AI 官方文档</a></li><li><a href=https://platform.openai.com/docs target=_blank>OpenAI API 文档</a></li><li><a href=https://docs.mistral.ai/ target=_blank>Mistral AI 文档</a></li><li><a href=https://ollama.ai/docs target=_blank>Ollama 文档</a></li></ul><hr><p><em>本文基于 Spring AI 1.1.0-M2 版本编写，随着框架的不断发展，部分 API 可能会有变化。建议参考官方文档获取最新信息。</em></p></div></article></main><footer class=post__footer><div class=post-related><h3>相关文章</h3><ul class=post-related-list><li class=post-related-item><a href=/posts/2025/09/22/openai-api-with-spring-ai/ target=_blank title="OpenAI API 接口与 Spring AI 对应关系">OpenAI API 接口与 Spring AI 对应关系</a></li><li class=post-related-item><a href=/posts/2025/09/19/spring-ai-chat-client-api/ target=_blank title="Spring AI ChatClient API 介绍">Spring AI ChatClient API 介绍</a></li><li class=post-related-item><a href=/posts/2025/09/18/spring-ai/ target=_blank title="Spring AI 介绍">Spring AI 介绍</a></li><li class=post-related-item><a href=/posts/2025/07/15/ruoyi-ai/ target=_blank title="RuoYi AI 源码分析">RuoYi AI 源码分析</a></li></ul></div></footer><footer class=post__footer><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/spring-ai/ rel=tag>spring-ai</a></li></ul></div></footer></footer><nav class="pagination flex"><div class="pagination__item pagination__item--prev"><a class=pagination__link href=/posts/2025/09/22/openai-api-with-spring-ai/ rel=prev><p class=pagination__title>«&#8201;上一篇: OpenAI API 接口与 Spring AI 对应关系</p></a></div><div class="pagination__item pagination__item--next"><a class=pagination__link href=/posts/2025/09/26/spring-ai-restaurant-showcase-rag/ rel=next><p class=pagination__title>&#8201;» 下一篇: 基于 Spring AI 构建智能餐厅推荐系统：RAG 技术实战</p></a></div></nav><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="ChenSoul avatar" src=/avatar.jpg class=avatar height=60 width=60 loading=lazy></figure><div class=authorbox__header><span class=authorbox__name>关于 ChenSoul</span></div><div class=authorbox__description>一个来自中国武汉的开发者，主要撰写软件开发和开源方面的文章。浏览我的<a href=%28/posts%29>博客文章</a>，订阅我的 <a href=/index.xml>RSS</a> 源，或了解更多<a href=/about/>关于我</a>的信息。</div></div><p><h3>欢迎留言！</h3></p><div id=remark42></div><script>var remark_config={host:"https://comment.chensoul.cc",site_id:"remark",components:["embed"],url:"https://blog.chensoul.cc/posts/2025/09/25/spring-ai-restaurant-showcase/",locale:"zh"};!function(e,t){for(s=0;s<e.length;s++){var s,n=t.createElement("script"),o=".js",i=t.head||t.body;"noModule"in n?(n.type="module",o=".mjs"):n.async=!0,n.defer=!0,n.src=remark_config.host+"/web/"+e[s]+o,i.appendChild(n)}}(remark_config.components||["embed"],document)</script></div><aside class="sidebar sidebar--right"><div class="post__toc toc"><div class=toc__title>目录</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#源代码>源代码</a></li><li><a href=#项目目标>项目目标</a></li><li><a href=#环境搭建>环境搭建</a><ul><li><a href=#技术栈>技术栈</a></li><li><a href=#依赖配置>依赖配置</a></li></ul></li><li><a href=#项目配置>项目配置</a><ul><li><a href=#环境配置>环境配置</a></li><li><a href=#spring-boot-配置>Spring Boot 配置</a></li></ul></li><li><a href=#核心功能实现>核心功能实现</a><ul><li><a href=#1-数据模型设计>1. 数据模型设计</a></li><li><a href=#2-rest-api-设计>2. REST API 设计</a></li></ul></li><li><a href=#运行应用>运行应用</a></li><li><a href=#测试-api>测试 API</a></li><li><a href=#核心技术特性>核心技术特性</a><ul><li><a href=#1-多轮对话支持>1. 多轮对话支持</a></li><li><a href=#2-结构化输出支持>2. 结构化输出支持</a></li></ul></li><li><a href=#功能扩展>功能扩展</a><ul><li><a href=#-核心功能扩展>🚀 核心功能扩展</a></li><li><a href=#-多模态支持>🎨 多模态支持</a></li><li><a href=#-性能优化功能>⚡ 性能优化功能</a></li><li><a href=#-高级管理功能>🔧 高级管理功能</a></li><li><a href=#-企业级功能>🏠 企业级功能</a></li><li><a href=#-成本优化功能>💰 成本优化功能</a></li></ul></li><li><a href=#总结>总结</a></li><li><a href=#参考资源>参考资源</a></li></ul></nav></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/>首页</a> | <a class=footer__link href=/categories/>分类</a> | <a class=footer__link href=/tags/>标签</a> | <a class=footer__link href=/index.xml>订阅</a> | <a class=footer__link href=/about/>关于</a></div><div class=footer__copyright>&copy; 2025 ChenSoul.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/chensoul/rose-hugo/ rel="nofollow noopener" target=_blank>Rose Hugo</a> 主题</span></div></div><style>.scroll-up a{display:block;height:3.125rem;width:3.125rem;text-align:center;line-height:2.7;border-radius:50px;font-size:1.125rem;color:#fff;opacity:1;transition:all .3s ease 0s;box-shadow:0 0 10px rgb(0 0 0/.2)}.scroll-up a{background:#ee591f}.scroll-up{position:fixed;display:none;bottom:50px;z-index:999}.scroll-up.right{right:60px}</style><div class="scroll-up custom right" style=display:block><a href=#top id=top-link accesskey=g><i class="fa fa-arrow-up"></i></a></div><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script defer src=https://umami.chensoul.cc/random-string.js data-website-id=1e07d36d-bec3-4ba6-9459-876b1ac3bbe7></script></footer></div><script>"use strict";(function(t){var i=t.querySelector(".menu__btn"),o=t.querySelector(".menu__list");function a(){o.classList.toggle("menu__list--active"),o.classList.toggle("menu__list--transition"),this.classList.toggle("menu__btn--active"),this.setAttribute("aria-expanded",this.getAttribute("aria-expanded")==="true"?"false":"true")}function r(){this.classList.remove("menu__list--transition")}i&&o&&(i.addEventListener("click",a,!1),o.addEventListener("transitionend",r,!1))})(document,window)</script></body></html>