<!doctype html><html class=no-js lang=zh-cn><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>[译]Spring Security - JWT -</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=//fonts.loli.net crossorigin><link rel=dns-prefetch href=//fonts.loli.net><link rel=stylesheet href="https://fonts.loli.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.min.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="ChenSoul Blog" rel=home><div class="logo__item logo__text"><div class=logo__title>ChenSoul Blog</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>分类</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>关于</span></a></li><li class=menu__item><a class=menu__link href=/index.xml><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>[译]Spring Security - JWT</h1></header><div class="content post__content clearfix"><h3 id=简介和概述>简介和概述</h3><p>JSON Web Token 或 JWT（更常见的名称）是一种开放的互联网标准 (RFC 7519)，用于以紧凑的方式在各方之间安全地传输可信信息。令牌包含编码为 JSON 对象的声明，并使用私有密钥或公钥/私钥对进行数字签名。它们是独立且可验证的，因为它们经过数字签名。 JWT 可以进行签名和/或加密。</p><p>签名的令牌验证令牌中包含的声明的完整性，而加密的令牌则向其他方隐藏声明。</p><p>JWT 也可用于信息交换，尽管它们更常用于授权，因为它们比使用内存中随机令牌的会话管理具有很多优势。其中最重要的是允许将身份验证逻辑委托给第三方服务器，例如 AuthO 等。</p><p>JWT 令牌分为 3 部分，即标头、有效负载和签名，格式为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>Header<span style=color:#f92672>]</span>.<span style=color:#f92672>[</span>Payload<span style=color:#f92672>]</span>.<span style=color:#f92672>[</span>Signature<span style=color:#f92672>]</span>
</span></span></code></pre></div><ul><li><strong>Header</strong> − JWT 令牌的标头包含应用于 JWT 的加密操作列表。这可以是签名技术、有关内容类型的元数据信息等。标头以 JSON 对象的形式呈现，该对象被编码为 base64URL。有效 JWT 标头的示例是</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{ <span style=color:#f92672>&#34;alg&#34;</span>: <span style=color:#e6db74>&#34;HS256&#34;</span>, <span style=color:#f92672>&#34;typ&#34;</span>: <span style=color:#e6db74>&#34;JWT&#34;</span> }
</span></span></code></pre></div><p>这里，“alg”为我们提供了有关所用算法类型的信息，“typ”为我们提供了信息的类型。</p><ul><li><strong>Payload</strong> − JWT 的有效负载部分包含使用令牌传输的实际数据。这部分也称为 JWT 令牌的“声明”部分。索赔可以分为三种类型：注册索赔、公开索赔和私人索赔。</li><li>注册的声明是推荐的但不是强制的声明，例如 iss(发行者)、sub(主题)、aud(受众) 等。</li><li>公共声明是那些使用 JWT 的人定义的声明。</li><li>私人声明或自定义声明是为了在相关方之间共享信息而创建的用户定义的声明。</li></ul><p>有效负载对象的示例可以是。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{ <span style=color:#f92672>&#34;sub&#34;</span>: <span style=color:#e6db74>&#34;12345&#34;</span>, <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Johnny Hill&#34;</span>, <span style=color:#f92672>&#34;admin&#34;</span>: <span style=color:#66d9ef>false</span> }
</span></span></code></pre></div><p>有效负载对象与标头对象一样，也采用 base64Url 编码，并且该字符串构成 JWT 的第二部分。</p><ul><li><strong>Signature</strong>− JWT 的签名部分用于验证消息在此过程中没有更改。如果令牌是用私钥签名的，它还会验证发送者的身份。它是使用编码的标头、编码的有效负载、秘密和标头中指定的算法创建的。签名的一个例子是。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>HMACSHA256</span>(<span style=color:#a6e22e>base64UrlEncode</span>(<span style=color:#a6e22e>header</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>base64UrlEncode</span>(<span style=color:#a6e22e>payload</span>), <span style=color:#a6e22e>secret</span>);
</span></span></code></pre></div><p>如果我们输入标头、有效负载和签名，我们会得到一个令牌，如下所示。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-basic data-lang=basic><span style=display:flex><span>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9<span style=color:#f92672>.</span>eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6I
</span></span><span style=display:flex><span>kpvaG4gRG9lIiwiYWRtaW4iOmZhbHNlfQ<span style=color:#f92672>.</span>gWDlJdpCTIHVYKkJSfAVNUn0ZkAjMxskDDm<span style=color:#ae81ff>-5</span>Fhe
</span></span><span style=display:flex><span>WJ7xXgW8k5CllcGk4C9qPrfa1GdqfBrbX_1x1E39JY8BYLobAfAg1fs_Ky8Z7U1oCl6HL63yJq_
</span></span><span style=display:flex><span>wVNBHp49hWzg3<span style=color:#f92672>-</span>ERxkqiuTv0tIuDOasIdZ5FtBdtIP5LM9Oc1tsuMXQXCGR8GqGf1Hl2qv8MCyn
</span></span><span style=display:flex><span>NZJuVdJKO_L3WGBJouaTpK1u2SEleVFGI2HFvrX_jS2ySzDxoO9KjbydK0LNv_zOI7kWv<span style=color:#f92672>-</span>gAmA
</span></span><span style=display:flex><span>j<span style=color:#f92672>-</span>v0mHdJrLbxD7LcZJEGRScCSyITzo6Z59_jG_97oNLFgBKJbh12nvvPibHpUYWmZuHkoGvuy5RLUA
</span></span></code></pre></div><p>现在，可以使用承载模式在授权标头中使用此令牌。</p><p><strong>Authorization − Bearer</strong> 授权 - 持有者</p><p>使用 JWT 令牌进行授权是其最常见的应用。令牌通常在服务器中生成并发送到客户端，并存储在会话存储或本地存储中。要访问受保护的资源，客户端将在标头中发送 JWT，如上所述。我们将在下面的部分中看到 Spring Security 中的 JWT 实现。</p><h3 id=使用-jwt-开始使用-spring-security>使用 JWT 开始使用 Spring Security</h3><p>我们要开发的应用程序将使用 JWT 处理基本的用户身份验证和授权。让我们开始访问 start.spring.io，我们将在其中创建一个具有以下依赖项的 Maven 应用程序。</p><ul><li>Spring Web</li><li>Spring Security</li></ul><p><img src=https://www.tutorialspoint.com/spring_security/images/maven_project_java.webp alt="Maven Project Java"></p><p>我们生成项目，下载后将其解压到我们选择的文件夹中。然后我们可以使用我们选择的任何 IDE。我将使用 Spring Tools Suite 4，因为它针对 Spring 应用程序进行了最优化。</p><p>除了上述依赖项之外，我们还将包含来自 Maven 中央存储库的 io.jsonwebtoken 的 jwt 依赖项，因为它不包含在 spring 初始化程序中。这种依赖关系负责涉及 JWT 的所有操作，包括构建令牌、解析令牌以获取声明等。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;artifactId&gt;</span>jjwt<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;version&gt;</span>0.9.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>我们的 pom.xml 文件现在应该与此类似。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;project</span> <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>xmlns:xsi=</span><span style=color:#e6db74>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>xsi:schemaLocation=</span><span style=color:#e6db74>&#34;http://maven.apache.org/POM/4.0.0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>   https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;modelVersion&gt;</span>4.0.0<span style=color:#f92672>&lt;/modelVersion&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;parent&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-parent<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;version&gt;</span>2.3.1.RELEASE<span style=color:#f92672>&lt;version&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;relativePath</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>&lt;!-- lookup parent from repository --&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;/parent&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;groupId&gt;</span>com.spring.security<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;artifactId&gt;</span>jwtbasic<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;version&gt;</span>0.0.1-SNAPSHOT<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;name&gt;</span>jwtbasic<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;description&gt;</span>Demo project for Spring Boot<span style=color:#f92672>&lt;/description&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;properties&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;java.version&gt;</span>1.8<span style=color:#f92672>&lt;/java.version&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;/properties&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;dependencies&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-security<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-web<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;groupId&gt;</span>io.jsonwebtoken<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;artifactId&gt;</span>jjwt<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;version&gt;</span>0.9.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;groupId&gt;</span>javax.xml.bind<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;artifactId&gt;</span>jaxb-api<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-starter-test<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;scope&gt;</span>test<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;exclusions&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;exclusion&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;groupId&gt;</span>org.junit.vintage<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;artifactId&gt;</span>junit-vintage-engine<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;/exclusion&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/exclusions&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.security<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;artifactId&gt;</span>spring-security-test<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;scope&gt;</span>test<span style=color:#f92672>&lt;scope&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;/dependencies&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;build&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;plugins&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;groupId&gt;</span>org.springframework.boot<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/plugins&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>&lt;/build&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/project&gt;</span>
</span></span></code></pre></div><p>现在我们的项目已经设置完毕，我们将创建控制器类 Hello Controller，它公开一个 Get 端点。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.spring.security.jwtbasic.controllers;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HelloController</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/hello&#34;</span>)
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>hello</span>() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;hello&#34;</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>现在我们将创建一个名为 config 的包，在其中添加扩展 Spring Security 的 WebSecurityConfigurerAdapter 类的配置类。这将为我们提供项目配置和应用程序安全性所需的所有功能和定义。现在，我们通过实现生成相同实例的方法来提供 BcryptPasswordEncoder 实例。我们用 @Bean 注释该方法以添加到 Spring 上下文中。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.spring.security.jwtbasic.config;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Bean;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Configuration;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.authentication.AuthenticationManager;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.http.SessionCreationPolicy;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UserDetailsService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.crypto.password.PasswordEncoder;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.spring.security.jwtbasic.jwtutils.JwtAuthenticationEntryPoint;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.spring.security.jwtbasic.jwtutils.JwtFilter;
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WebSecurityConfig</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> PasswordEncoder <span style=color:#a6e22e>passwordEncoder</span>() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder();
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The JWT includes a secret which we will define in our application.properties file as given below.
JWT 包含一个秘密，我们将在 application.properties 文件中定义该秘密，如下所示。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#a6e22e>secret</span><span style=color:#f92672>=</span><span style=color:#e6db74>somerandomsecret</span>
</span></span></code></pre></div><p>现在让我们创建一个名为 jwtutils 的包。该包将包含与 JWT 操作相关的所有类和接口，其中包括。</p><ul><li>生成令牌</li><li>验证令牌</li><li>检查签名</li><li>验证声明和权限</li></ul><p>在此包中，我们创建第一个类，称为令牌管理器。此类将负责使用 io.jsonwebtoken.Jwts 创建和验证令牌。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.spring.security.jwtbasic.jwtutils;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.Serializable;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Base64;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Date;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.HashMap;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Map;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Value;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UserDetails;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Component;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io.jsonwebtoken.Claims; <span style=color:#f92672>import</span> io.jsonwebtoken.Jwts;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io.jsonwebtoken.SignatureAlgorithm;
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TokenManager</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>   <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> serialVersionUID <span style=color:#f92672>=</span> 7008375124389347049L; <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> TOKEN_VALIDITY <span style=color:#f92672>=</span> 10 <span style=color:#f92672>*</span> 60 <span style=color:#f92672>*</span> 60; <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${secret}&#34;</span>)
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> String jwtSecret;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>generateJwtToken</span>(UserDetails userDetails) {
</span></span><span style=display:flex><span>      Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> claims <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> Jwts.<span style=color:#a6e22e>builder</span>().<span style=color:#a6e22e>setClaims</span>(claims).<span style=color:#a6e22e>setSubject</span>(userDetails.<span style=color:#a6e22e>getUsername</span>())
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>setIssuedAt</span>(<span style=color:#66d9ef>new</span> Date(System.<span style=color:#a6e22e>currentTimeMillis</span>()))
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>setExpiration</span>(<span style=color:#66d9ef>new</span> Date(System.<span style=color:#a6e22e>currentTimeMillis</span>() <span style=color:#f92672>+</span> TOKEN_VALIDITY <span style=color:#f92672>*</span> 1000))
</span></span><span style=display:flex><span>         .<span style=color:#a6e22e>signWith</span>(SignatureAlgorithm.<span style=color:#a6e22e>HS512</span>, jwtSecret).<span style=color:#a6e22e>compact</span>();
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> Boolean <span style=color:#a6e22e>validateJwtToken</span>(String token, UserDetails userDetails) {
</span></span><span style=display:flex><span>      String username <span style=color:#f92672>=</span> getUsernameFromToken(token);
</span></span><span style=display:flex><span>      Claims claims <span style=color:#f92672>=</span> Jwts.<span style=color:#a6e22e>parser</span>().<span style=color:#a6e22e>setSigningKey</span>(jwtSecret).<span style=color:#a6e22e>parseClaimsJws</span>(token).<span style=color:#a6e22e>getBody</span>();
</span></span><span style=display:flex><span>      Boolean isTokenExpired <span style=color:#f92672>=</span> claims.<span style=color:#a6e22e>getExpiration</span>().<span style=color:#a6e22e>before</span>(<span style=color:#66d9ef>new</span> Date());
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> (username.<span style=color:#a6e22e>equals</span>(userDetails.<span style=color:#a6e22e>getUsername</span>()) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>isTokenExpired);
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getUsernameFromToken</span>(String token) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>final</span> Claims claims <span style=color:#f92672>=</span> Jwts.<span style=color:#a6e22e>parser</span>().<span style=color:#a6e22e>setSigningKey</span>(jwtSecret).<span style=color:#a6e22e>parseClaimsJws</span>(token).<span style=color:#a6e22e>getBody</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> claims.<span style=color:#a6e22e>getSubject</span>();
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在这里，由于所有令牌都应该有一个到期日期，因此我们从令牌有效性常量开始。在这里，我们希望我们的令牌在生成后 10 分钟内有效。当我们生成令牌时，我们将使用这个值。然后，我们使用 @Value 注释将歌唱键的值从 application.properties 文件中提取到 jwtSecret 字段中。</p><p>我们这里有两种方法 -</p><ul><li><strong>generateJwtToken()</strong> − 此方法用于在用户成功进行身份验证时生成令牌。要在此处创建令牌，我们使用用户名、令牌发行日期和令牌到期日期。正如我们之前讨论的，这将形成令牌或声明的有效负载部分。为了生成令牌，我们使用 Jwts 的 builder() 方法。此方法返回一个新的 JwtBuilder 实例，可用于创建紧凑的 JWT 序列化字符串。</li></ul><p>为了设置声明，我们使用 setClaims() 方法，然后设置每个声明。对于这个令牌，我们有 setSubject(username)、发行日期和到期日期。我们还可以像上面讨论的那样提出自定义声明。这可以是我们想要的任何值，其中可能包括用户角色、用户权限等。</p><p>然后我们设置令牌的签名部分。这是使用 signWith() 方法完成的，我们设置我们喜欢使用的哈希算法和密钥。然后，我们使用 compact()方法构建 JWT，并根据 JWT 紧凑序列化规则将其序列化为紧凑的、URL 安全的字符串。</p><ul><li><strong>validateJwtToken()</strong> − 现在已经处理了令牌的生成，我们应该关注令牌作为请求的一部分时的验证过程。验证令牌意味着验证请求是否经过身份验证，并且令牌是生成并发送给用户的令牌。在这里，我们需要解析令牌以获取用户名、角色、权限、有效期等声明。</li></ul><p>为了验证令牌，我们需要首先解析它。这是使用 Jwts 的 parser() 方法完成的。然后，我们需要设置用于生成令牌的签名密钥，然后在令牌上使用 parseClaimsJws() 方法根据构建器的当前配置状态解析紧凑的序列化 JWS 字符串，并返回生成的 Claims JWS 实例。然后使用 getBody() 方法返回生成令牌时使用的声明实例。</p><p>从获得的声明实例中，我们提取主题和到期日期以验证令牌的有效性。用户名应该是用户的用户名，并且令牌不应过期。如果满足这两个条件，我们将返回 true，这表示令牌有效。</p><p>我们要创建的下一个类是 JwtUserDetailsS​​ervice。这个类将扩展 Spring security 的 UserDetailsS​​ervice，我们将实现 loadUserByUsername() 方法，如下所示 -</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.spring.security.jwtbasic.jwtutils;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.ArrayList;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.User;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UserDetails;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UserDetailsService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Service;
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JwtUserDetailsService</span> <span style=color:#66d9ef>implements</span> UserDetailsService {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> UserDetails <span style=color:#a6e22e>loadUserByUsername</span>(String username) <span style=color:#66d9ef>throws</span> UsernameNotFoundException {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>&#34;randomuser123&#34;</span>.<span style=color:#a6e22e>equals</span>(username)) {
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> User(<span style=color:#e6db74>&#34;randomuser123&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;$2a$10$slYQmyNdGzTn7ZLBXBChFOC9f6kFjAqPhccnP6DxlWXx2lPk1C3G6&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>());
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> UsernameNotFoundException(<span style=color:#e6db74>&#34;User not found with username: &#34;</span> <span style=color:#f92672>+</span> username);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在这里，由于这是一个基本应用程序，其唯一目的是演示 JWT 身份验证，因此我们使用了一组用户详细信息，而不是使用数据库。为了方便起见，我们将用户名指定为“randomuser123”，并将密码（即“密码”）编码为“$2a$10$slYQmyNdGzTn7ZLBXBChFOC9f6kFjAqPhccnP6DxlWXx2lPk1C3G6”。</p><p>接下来，我们为请求和响应模型创建类。这些模型决定了我们的请求和响应格式如何进行身份验证。下面给出的第一个快照是请求模型。正如我们所看到的，我们将在请求中接受两个属性——用户名和密码。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.spring.security.jwtbasic.jwtutils.models;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.Serializable;
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JwtRequestModel</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>   <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> serialVersionUID <span style=color:#f92672>=</span> 2636936156391265891L;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> String username;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> String password;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>JwtRequestModel</span>() {
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>JwtRequestModel</span>(String username, String password) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>super</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> username; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>password</span> <span style=color:#f92672>=</span> password;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getUsername</span>() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> username;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUsername</span>(String username) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> username;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getPassword</span>() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> password;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setPassword</span>(String password) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>password</span> <span style=color:#f92672>=</span> password;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>以下是身份验证成功后的响应模型的代码。正如我们所看到的，在身份验证成功后，我们将把令牌发送回用户。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.spring.security.jwtbasic.jwtutils.models;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.Serializable;
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JwtResponseModel</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>   <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> serialVersionUID <span style=color:#f92672>=</span> 1L;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String token;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>JwtResponseModel</span>(String token) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>token</span> <span style=color:#f92672>=</span> token;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getToken</span>() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> token;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>现在为了进行身份验证，让我们创建一个控制器，如下所示。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.spring.security.jwtbasic.jwtutils;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.http.ResponseEntity;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.authentication.AuthenticationManager;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.authentication.BadCredentialsException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.authentication.DisabledException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UserDetails;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.bind.annotation.CrossOrigin;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.bind.annotation.PostMapping;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.bind.annotation.RequestBody;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.spring.security.jwtbasic.jwtutils.models.JwtRequestModel;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.spring.security.jwtbasic.jwtutils.models.JwtResponseModel;
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@CrossOrigin</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JwtController</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> JwtUserDetailsService userDetailsService;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> AuthenticationManager authenticationManager;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> TokenManager tokenManager;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/login&#34;</span>)
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> ResponseEntity<span style=color:#f92672>&lt;&gt;</span> <span style=color:#a6e22e>createToken</span>(<span style=color:#a6e22e>@RequestBody</span> JwtRequestModel
</span></span><span style=display:flex><span>   request) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>         authenticationManager.<span style=color:#a6e22e>authenticate</span>(
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>new</span>
</span></span><span style=display:flex><span>            UsernamePasswordAuthenticationToken(request.<span style=color:#a6e22e>getUsername</span>(),
</span></span><span style=display:flex><span>            request.<span style=color:#a6e22e>getPassword</span>())
</span></span><span style=display:flex><span>         );
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>catch</span> (DisabledException e) {
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Exception(<span style=color:#e6db74>&#34;USER_DISABLED&#34;</span>, e);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>catch</span> (BadCredentialsException e) {
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Exception(<span style=color:#e6db74>&#34;INVALID_CREDENTIALS&#34;</span>, e);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>final</span> UserDetails userDetails <span style=color:#f92672>=</span> userDetailsService.<span style=color:#a6e22e>loadUserByUsername</span>(request.<span style=color:#a6e22e>getUsername</span>());
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>final</span> String jwtToken <span style=color:#f92672>=</span> tokenManager.<span style=color:#a6e22e>generateJwtToken</span>(userDetails);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> ResponseEntity.<span style=color:#a6e22e>ok</span>(<span style=color:#66d9ef>new</span> JwtResponseModel(jwtToken));
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>如果我们查看代码，我们可以看到，我们自动装配了三个依赖项，即 JwtUserDetailsS​​ervice、AuthenticationManager 和 TokenManager。虽然我们已经看到了上面 JwtUserDetailsS​​ervice 和 TokenManager 类的实现，但身份验证管理器 bean 是我们将在 WebSecurityConfig 类中创建的一个。</p><p>AuthenticationManager 类将负责我们的身份验证。我们将使用 UsernamePasswordAuthenticationToken 模型来验证请求。如果身份验证成功，我们将为用户生成一个 JWT，该 JWT 可以在后续请求的 Authorization 标头中发送以获取任何资源。</p><p>正如我们所看到的，我们正在使用 JwtUserDetailsS​​ervice 类的 loadUserByUsername() 方法和 TokenManager 类中的 generateJwtToken()。</p><p>如上所述，生成的 JWT 作为成功身份验证的响应发送给用户。</p><p>现在是我们创建过滤器的时候了。过滤器类将用于跟踪我们的请求并检测它们是否在标头中包含有效令牌。如果令牌有效，我们将继续请求，否则我们将发送 401 错误（未经授权）。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.spring.security.jwtbasic.jwtutils;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.IOException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.FilterChain;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.ServletException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletRequest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletResponse;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.context.SecurityContextHolder;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UserDetails;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Component;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.filter.OncePerRequestFilter;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> io.jsonwebtoken.ExpiredJwtException;
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JwtFilter</span> <span style=color:#66d9ef>extends</span> OncePerRequestFilter {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> JwtUserDetailsService userDetailsService;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> TokenManager tokenManager;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>doFilterInternal</span>(HttpServletRequest request,
</span></span><span style=display:flex><span>      HttpServletResponse response, FilterChain filterChain)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> ServletException, IOException {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      String tokenHeader <span style=color:#f92672>=</span> request.<span style=color:#a6e22e>getHeader</span>(<span style=color:#e6db74>&#34;Authorization&#34;</span>);
</span></span><span style=display:flex><span>      String username <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>      String token <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (tokenHeader <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> tokenHeader.<span style=color:#a6e22e>startsWith</span>(<span style=color:#e6db74>&#34;Bearer &#34;</span>)) {
</span></span><span style=display:flex><span>         token <span style=color:#f92672>=</span> tokenHeader.<span style=color:#a6e22e>substring</span>(7);
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            username <span style=color:#f92672>=</span> tokenManager.<span style=color:#a6e22e>getUsernameFromToken</span>(token);
</span></span><span style=display:flex><span>         } <span style=color:#66d9ef>catch</span> (IllegalArgumentException e) {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Unable to get JWT Token&#34;</span>);
</span></span><span style=display:flex><span>         } <span style=color:#66d9ef>catch</span> (ExpiredJwtException e) {
</span></span><span style=display:flex><span>            System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;JWT Token has expired&#34;</span>);
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>         System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Bearer String not found in token&#34;</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>null</span> <span style=color:#f92672>!=</span> username <span style=color:#f92672>&amp;&amp;</span>SecurityContextHolder.<span style=color:#a6e22e>getContext</span>().<span style=color:#a6e22e>getAuthentication</span>() <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>         UserDetails userDetails <span style=color:#f92672>=</span> userDetailsService.<span style=color:#a6e22e>loadUserByUsername</span>(username);
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>if</span> (tokenManager.<span style=color:#a6e22e>validateJwtToken</span>(token, userDetails)) {
</span></span><span style=display:flex><span>            UsernamePasswordAuthenticationToken
</span></span><span style=display:flex><span>            authenticationToken <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> UsernamePasswordAuthenticationToken(
</span></span><span style=display:flex><span>            userDetails, <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>            userDetails.<span style=color:#a6e22e>getAuthorities</span>());
</span></span><span style=display:flex><span>            authenticationToken.<span style=color:#a6e22e>setDetails</span>(<span style=color:#66d9ef>new</span>
</span></span><span style=display:flex><span>            WebAuthenticationDetailsSource().<span style=color:#a6e22e>buildDetails</span>(request));
</span></span><span style=display:flex><span>            SecurityContextHolder.<span style=color:#a6e22e>getContext</span>().<span style=color:#a6e22e>setAuthentication</span>(authenticationToken);
</span></span><span style=display:flex><span>         }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      filterChain.<span style=color:#a6e22e>doFilter</span>(request, response);
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>正如我们在上面看到的，我们也在这里自动装配了 JwtUserDetailsS​​ervice 和 TokenManager 类。我们扩展了 SpringSecurity 的 OncePerRequestFilter，确保过滤器针对每个请求运行。我们已经为 OncePerRequestFilter 类的重写方法 doFilterInternal() 提供了实现。</p><p>这里的方法从标头中提取令牌并借助 TokenManager 类的 validateJwtToken() 方法对其进行验证。在验证过程中，它会检查用户名和到期日期。如果两个值都有效，我们会将身份验证保存在 Spring Security 上下文中，并让代码继续执行过滤器链中的下一个过滤器。如果任何验证失败或令牌存在问题，或者未找到令牌，我们会抛出适当的异常并发回适当的响应，同时阻止请求继续进行。</p><p>为我们的请求创建过滤器后，我们现在创建 JwtAutheticationEntryPoint 类。该类扩展了 Spring 的 AuthenticationEntryPoint 类，并拒绝每个未经身份验证的请求，并向客户端发送错误代码 401。我们重写了 AuthenticationEntryPoint 类的 begin() 方法来做到这一点。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.spring.security.jwtbasic.jwtutils;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.IOException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.Serializable;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.ServletException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletRequest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.servlet.http.HttpServletResponse;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.AuthenticationException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.web.AuthenticationEntryPoint;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Component;
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JwtAuthenticationEntryPoint</span> <span style=color:#66d9ef>implements</span> AuthenticationEntryPoint,
</span></span><span style=display:flex><span>Serializable {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>commence</span>(HttpServletRequest request, HttpServletResponse
</span></span><span style=display:flex><span>   response,
</span></span><span style=display:flex><span>   AuthenticationException authException) <span style=color:#66d9ef>throws</span>
</span></span><span style=display:flex><span>   IOException, ServletException {
</span></span><span style=display:flex><span>      response.<span style=color:#a6e22e>sendError</span>(HttpServletResponse.<span style=color:#a6e22e>SC_UNAUTHORIZED</span>,
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#34;Unauthorized&#34;</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>现在，让我们回到 WebSecurityConfig 类并完成其余的配置。如果我们还记得的话，我们将需要我们的 Jwt 控制器类的 AuthenticationManager bean，并将我们刚刚创建的过滤器添加到我们的配置中。我们还将配置哪些请求需要进行身份验证，哪些请求不需要进行身份验证。我们还将 AuthenticationEntryPoint 添加到请求中以发回 401 错误响应。因为，我们在使用 jwt 时也不需要维护会话变量，我们可以使会话成为无状态的。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> com.spring.security.jwtbasic.config;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Bean;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Configuration;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.authentication.AuthenticationManager;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.config.http.SessionCreationPolicy;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.core.userdetails.UserDetailsService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.crypto.password.PasswordEncoder;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.spring.security.jwtbasic.jwtutils.JwtAuthenticationEntryPoint;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.spring.security.jwtbasic.jwtutils.JwtFilter;
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WebSecurityConfig</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> JwtAuthenticationEntryPoint authenticationEntryPoint;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> UserDetailsService userDetailsService;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>private</span> JwtFilter filter;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> PasswordEncoder <span style=color:#a6e22e>passwordEncoder</span>() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder();
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(AuthenticationManagerBuilder auth) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>      auth.<span style=color:#a6e22e>userDetailsService</span>(userDetailsService).<span style=color:#a6e22e>passwordEncoder</span>(passwordEncoder());
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>public</span> AuthenticationManager <span style=color:#a6e22e>authenticationManagerBean</span>() <span style=color:#66d9ef>throws</span>
</span></span><span style=display:flex><span>   Exception {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>authenticationManagerBean</span>();
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(HttpSecurity http) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>      http.<span style=color:#a6e22e>csrf</span>().<span style=color:#a6e22e>disable</span>()
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>authorizeRequests</span>().<span style=color:#a6e22e>antMatchers</span>(<span style=color:#e6db74>&#34;/login&#34;</span>).<span style=color:#a6e22e>permitAll</span>()
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>anyRequest</span>().<span style=color:#a6e22e>authenticated</span>()
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>and</span>()
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>exceptionHandling</span>().<span style=color:#a6e22e>authenticationEntryPoint</span>(authenticationEntryPoint)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>and</span>()
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>sessionManagement</span>().<span style=color:#a6e22e>sessionCreationPolicy</span>(SessionCreationPolicy.<span style=color:#a6e22e>STATELESS</span>);
</span></span><span style=display:flex><span>      http.<span style=color:#a6e22e>addFilterBefore</span>(filter, UsernamePasswordAuthenticationFilter.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>正如我们所看到的，我们已经完成了所有这些，现在我们的应用程序已准备就绪。让我们启动应用程序并使用邮递员来发出我们的请求。</p><p><img src=https://www.tutorialspoint.com/spring_security/images/postman_body.webp alt="Postman Body"></p><p>在这里，我们发出了第一个获取令牌的请求，正如我们所看到的，在提供正确的用户名/密码组合后，我们将取回令牌。</p><p>现在，在标头中使用该标记，让我们调用 /hello 端点。</p><p><img src=https://www.tutorialspoint.com/spring_security/images/postman_authorization_body.webp alt="Postman Authorization Body"></p><p>正如我们所看到的，由于请求已通过身份验证，我们得到了所需的响应。现在，如果我们篡改令牌或不发送 Authorization 标头，我们将收到应用程序中配置的 401 错误。这确保了使用 JWT 保护我们的请求。</p><p>原文链接：<a href=https://www.tutorialspoint.com/spring_security/spring_security_with_jwt.htm target=_blank>https://www.tutorialspoint.com/spring_security/spring_security_with_jwt.htm</a></p></div><footer class=post__footer><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/spring-security/ rel=tag>spring-security</a></li><li class=tags__item><a class="tags__link btn" href=/tags/jwt/ rel=tag>jwt</a></li></ul></div></footer></footer></article></main><nav class="pagination flex"><div class="pagination__item pagination__item--prev"><a class=pagination__link href=/posts/2023/08/16/spring-security-with-oauth2/ rel=prev><p class=pagination__title>«&#8201;上一篇: [译]Spring Security - OAuth2</p></a></div><div class="pagination__item pagination__item--next"><a class=pagination__link href=/posts/2023/08/18/how-to-implement-security-in-spring-boot3-using-userdetailsservice/ rel=next><p class=pagination__title>&#8201;» 下一篇: [译]如何在Spring Boot3中使用UserDetailsService实现安全性？</p></a></div></nav><footer class=post__footer><div class=post-related><h3>相关文章</h3><ul class=post-related-list><li class=post-related-item><a href=/posts/2023/08/16/spring-security-with-oauth2/ target=_blank title="[译]Spring Security - OAuth2">[译]Spring Security - OAuth2</a></li><li class=post-related-item><a href=/posts/2023/08/16/spring-security-form-login-with-database/ target=_blank title="[译]Spring Security - 使用数据库表单登录">[译]Spring Security - 使用数据库表单登录</a></li><li class=post-related-item><a href=/posts/2023/08/16/spring-security-form-login-remember-me-and-logout/ target=_blank title="[译]Spring Security - 表单登录、记住我和注销">[译]Spring Security - 表单登录、记住我和注销</a></li><li class=post-related-item><a href=/posts/2023/08/16/spring-security/ target=_blank title="[译]Spring Security 和 Spring Boot 入门">[译]Spring Security 和 Spring Boot 入门</a></li><li class=post-related-item><a href=/posts/2023/08/16/spring-security-authentication-and-authorization/ target=_blank title="[译]Spring Security：深入了解身份验证和授权">[译]Spring Security：深入了解身份验证和授权</a></li><li class=post-related-item><a href=/posts/2023/08/15/spring-security-oauth2-history/ target=_blank title="Spring Security和OAuth2发展过程">Spring Security和OAuth2发展过程</a></li></ul></div></footer><p><h3>欢迎留言！</h3></p><div id=remark42></div><script>var remark_config={host:"https://comment.chensoul.cc",site_id:"remark",components:["embed"],url:"https://blog.chensoul.cc/posts/2023/08/16/spring-security-with-jwt/",locale:"zh"};!function(e,t){for(s=0;s<e.length;s++){var s,n=t.createElement("script"),o=".js",i=t.head||t.body;"noModule"in n?(n.type="module",o=".mjs"):n.async=!0,n.defer=!0,n.src=remark_config.host+"/web/"+e[s]+o,i.appendChild(n)}}(remark_config.components||["embed"],document)</script></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/>首页</a> | <a class=footer__link href=/categories/>分类</a> | <a class=footer__link href=/about/>关于</a> | <a class=footer__link href=/index.xml>RSS</a></div><div class=footer__copyright>&copy; 2025 ChenSoul.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/chensoul/rose-hugo/ rel="nofollow noopener" target=_blank>Rose Hugo</a> 主题</span></div></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></footer></div><script>"use strict";(function(t){var i=t.querySelector(".menu__btn"),o=t.querySelector(".menu__list");function a(){o.classList.toggle("menu__list--active"),o.classList.toggle("menu__list--transition"),this.classList.toggle("menu__btn--active"),this.setAttribute("aria-expanded",this.getAttribute("aria-expanded")==="true"?"false":"true")}function r(){this.classList.remove("menu__list--transition")}i&&o&&(i.addEventListener("click",a,!1),o.addEventListener("transitionend",r,!1))})(document,window)</script></body></html>