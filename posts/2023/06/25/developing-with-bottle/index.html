<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>[译]用 Bottle 开发 - ChenSoul Blog</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/06/25/developing-with-bottle/"><meta property="og:site_name" content="ChenSoul Blog"><meta property="og:title" content="[译]用 Bottle 开发"><meta property="og:description" content="我喜欢 bottle。它是一个简单、快速且功能强大的 Python 微框架，非常适合小型 Web 应用程序和快速原型设计。对于那些刚刚开始 Web 开发的人来说，它也是一个出色的学习工具。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-25T00:00:00+00:00"><meta property="article:modified_time" content="2023-06-25T00:00:00+00:00"><meta property="article:tag" content="Python"><meta itemprop=name content="[译]用 Bottle 开发"><meta itemprop=description content="我喜欢 bottle。它是一个简单、快速且功能强大的 Python 微框架，非常适合小型 Web 应用程序和快速原型设计。对于那些刚刚开始 Web 开发的人来说，它也是一个出色的学习工具。"><meta itemprop=datePublished content="2023-06-25T00:00:00+00:00"><meta itemprop=dateModified content="2023-06-25T00:00:00+00:00"><meta itemprop=wordCount content="1099"><meta itemprop=keywords content="Python"><meta name=twitter:card content="summary"><meta name=twitter:title content="[译]用 Bottle 开发"><meta name=twitter:description content="我喜欢 bottle。它是一个简单、快速且功能强大的 Python 微框架，非常适合小型 Web 应用程序和快速原型设计。对于那些刚刚开始 Web 开发的人来说，它也是一个出色的学习工具。"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="ChenSoul Blog" rel=home><div class="logo__item logo__text"><div class=logo__title>ChenSoul Blog</div><div class=logo__tagline>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/tools/><span class=menu__text>Tools</span></a></li><li class=menu__item><a class=menu__link href=/tutorials/><span class=menu__text>Tutorials</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>[译]用 Bottle 开发</h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 16 16"><path d="M8 1c2 0 3.5 2 3.5 4.5S10 9 10 9c3 1 4 2 4 6H2c0-4 1-5 4-6 0 0-1.5-1-1.5-3.5S6 1 8 1"/></svg><span class=meta__text>ChenSoul</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 110 28 1 1 0 010-28m0 3a3 3 0 100 22 3 3 0 000-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class=meta__text datetime=2023-06-25T00:00:00Z>2023-06-25</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/python/ rel=category>Python</a></span></div></div></header><div class="content post__content clearfix"><p><img src=/images/bottle-logo.webp alt="Bottle logo"></p><p>我喜欢 <a href=http://bottlepy.org/docs/stable/ target=_blank>bottle</a>。它是一个简单、快速且功能强大的 Python 微框架，非常适合小型 Web 应用程序和快速原型设计。对于那些刚刚开始 Web 开发的人来说，它也是一个出色的学习工具。</p><p>让我们看一个简单的例子。</p><blockquote><p>注意：本教程假设您正在运行基于 Unix 的环境 - 例如 Mac OS X、Linux 版本或通过虚拟机支持的 Linux 版本。</p></blockquote><p><strong>06/13/2015 更新</strong>：更新了代码示例和解释。</p><h2 id=启动>启动</h2><p>首先，让我们创建一个工作目录：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ mkdir bottle <span style=color:#f92672>&amp;&amp;</span> cd bottle
</span></span></code></pre></div><p>接下来，您需要安装 <a href=https://realpython.com/what-is-pip/ target=_blank>pip</a>、virtualenv 和 git。</p><p><a href=https://pypi.python.org/pypi/virtualenv target=_blank>virtualenv</a> 是一个 Python 工具，可以<a href=https://realpython.com/python-virtual-environments-a-primer/ target=_blank>轻松管理特定项目所需的 Python 包</a>；它可以防止一个项目中的包与其他项目中的包发生冲突。同时，pip 是一个包管理器，用于管理 Python <a href=https://realpython.com/python-modules-packages/ target=_blank>包的安装</a>。</p><p>如需在 Unix 环境中安装 pip（及其依赖项）的帮助，请按照 <a href=https://gist.github.com/mjhea0/5692708 target=_blank>此 Gist</a> 中的说明进行操作。如果您使用的是 Windows 环境，请观看此视频以获取帮助。</p><p>安装 <a href=https://realpython.com/courses/what-is-pip/ target=_blank>pip</a> 后，运行以下命令来安装 virtualenv：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ pip install virtualenv<span style=color:#f92672>==</span>12.0.7
</span></span></code></pre></div><p>现在我们可以轻松设置本地环境：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ virtualenv venv
</span></span><span style=display:flex><span>$ source venv/bin/activate
</span></span></code></pre></div><p>安装 bottle：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ pip install bottle<span style=color:#f92672>==</span>0.12.8
</span></span><span style=display:flex><span>$ pip freeze &gt; requirements.txt
</span></span></code></pre></div><p>最后，让我们使用 Git 将我们的应用程序置于版本控制之下。有关 Git 的更多信息，请 <a href=https://realpython.com/python-git-github-intro/ target=_blank>查看本文</a>，其中还包括安装说明。</p><h2 id=编写你的应用程序>编写你的应用程序</h2><p>我们准备好编写我们的瓶子应用程序了。打开 Sublime Text 3 或您选择的文本编辑器。创建您的应用程序文件 app.py，它将保存我们第一个应用程序的全部内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bottle <span style=color:#f92672>import</span> route, run, template
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>index_html <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;&#39;My first web app! By &lt;strong&gt;{{ author }}&lt;/strong&gt;.&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@route</span>(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> template(index_html, author<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Real Python&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@route</span>(<span style=color:#e6db74>&#39;/name/&lt;name&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>name</span>(name):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> template(index_html, author<span style=color:#f92672>=</span>name)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    port <span style=color:#f92672>=</span> int(os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;PORT&#39;</span>, <span style=color:#ae81ff>8080</span>))
</span></span><span style=display:flex><span>    run(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>, port<span style=color:#f92672>=</span>port, debug<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></div><p>保存文件。</p><p>现在您可以在本地运行您的应用程序：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ python app.py
</span></span></code></pre></div><p>您应该能够连接到 <a href=http://localhost:8080/ target=_blank>http://localhost:8080/</a> 并看到您的应用程序正在运行！</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>My first web app! By RealPython.
</span></span></code></pre></div><p>因此， <code>@route</code> <a href=https://realpython.com/primer-on-python-decorators/ target=_blank>装饰器</a>将一个函数绑定到路由。在第一个路由 <code>/</code> 中， <code>index()</code> 函数绑定到该路由，该路由渲染 <code>index_html</code> 模板并传入<a href=https://realpython.com/python-variables/ target=_blank>变量</a> <code>author</code> 作为关键字参数。然后可以在模板中访问该变量。</p><p>现在导航到下一条路由，确保在路由末尾添加您的名字 - 即 http://localhost:8080/name/Michael。您应该看到类似以下内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>My first web app! By Michael.
</span></span></code></pre></div><p><strong>这是怎么回事？</strong></p><ul><li><p>同样， <code>@route</code> 装饰器将一个函数绑定到路由。在本例中，我们使用包含通配符 <code>&lt;name></code> 的动态路由。</p></li><li><p>然后，该通配符作为参数传递给视图函数 - <code>def name(name)</code> 。</p></li><li><p>然后我们将其作为关键字参数传递给模板 - <code>author=name</code></p></li><li><p>然后模板渲染作者变量 - <code>{{ author }}</code> 。</p></li></ul><h2 id=shell-脚本>Shell 脚本</h2><p>想快速入门吗？使用此 Shell 脚本在几秒钟内生成入门应用程序。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir bottle
</span></span><span style=display:flex><span>cd bottle
</span></span><span style=display:flex><span>pip install virtualenv<span style=color:#f92672>==</span>12.0.7
</span></span><span style=display:flex><span>virtualenv venv
</span></span><span style=display:flex><span>source venv/bin/activate
</span></span><span style=display:flex><span>pip install bottle<span style=color:#f92672>==</span>0.12.8
</span></span><span style=display:flex><span>pip freeze &gt; requirements.txt
</span></span><span style=display:flex><span>git init
</span></span><span style=display:flex><span>git add .
</span></span><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#34;initial commit&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat &gt;app.py <span style=color:#e6db74>&lt;&lt;EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>import os
</span></span></span><span style=display:flex><span><span style=color:#e6db74>from bottle import route, run, template
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>index_html = &#39;&#39;&#39;My first web app! By &lt;strong&gt;{{ author }}&lt;/strong&gt;.&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>@route(&#39;/&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>def index():
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    return template(index_html, author=&#39;Real Python&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>@route(&#39;/name/&lt;name&gt;&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>def name(name):
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    return template(index_html, author=name)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>if __name__ == &#39;__main__&#39;:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    port = int(os.environ.get(&#39;PORT&#39;, 8080))
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    run(host=&#39;0.0.0.0&#39;, port=port, debug=True)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chmod a+x app.py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>git init
</span></span><span style=display:flex><span>git add .
</span></span><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#34;Updated&#34;</span>
</span></span></code></pre></div><p>从<a href=https://gist.github.com/mjhea0/5784132 target=_blank>此要点</a>下载此脚本，然后使用以下命令运行它：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ bash bottle.sh
</span></span></code></pre></div><h2 id=下一步>下一步</h2><p>从这一点来看，创建新页面就像添加新的 <code>@route</code> 装饰函数一样简单。</p><p>创建 HTML 很简单：在上面的应用程序中，我们只是将 HTML 内联到文件本身中。修改它以从文件加载模板很容易。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@route</span>(<span style=color:#e6db74>&#39;/main&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>(name):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> template(<span style=color:#e6db74>&#39;main_template&#39;</span>)
</span></span></code></pre></div><p>这将加载模板文件 <code>main_template.tpl</code> ，该文件必须放置在项目结构中的 <code>views</code> 文件夹中，并将其呈现给最终用户。</p><p>有关详细信息，请参阅 bottle <a href=http://bottlepy.org/docs/dev/ target=_blank>文档</a>。</p><h2 id=基本设置>基本设置</h2><p>首先从第 1 部分下载此 <a href=https://gist.github.com/mjhea0/5784132 target=_blank>Gist</a>，然后使用以下命令运行它：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ bash bottle.sh
</span></span></code></pre></div><p>这将创建一个基本的项目结构：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>├── app.py
</span></span><span style=display:flex><span>├── requirements.txt
</span></span><span style=display:flex><span>└── testenv
</span></span></code></pre></div><p>激活虚拟环境：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ cd bottle
</span></span><span style=display:flex><span>$ source testenv/bin/activate
</span></span></code></pre></div><p>安装要求：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ pip install -r requirements.txt
</span></span></code></pre></div><p>导航到 <a href=https://www.plot.ly/api target=_blank>https://www.plot.ly/api</a>，注册一个新帐户，登录，然后创建一个新的 API 密钥：</p><p><img src=/images/plotly-api-credentials.webp alt="Plotly API credentials"></p><p>复制该密钥。</p><p>安装 plot.ly：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ pip install plotly<span style=color:#f92672>==</span>1.2.6
</span></span></code></pre></div><p>接下来更新 app.py 中的代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bottle <span style=color:#f92672>import</span> run, template, get, post, request
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> plotly.plotly <span style=color:#66d9ef>as</span> py
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> plotly.graph_objs <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># add your username and api key</span>
</span></span><span style=display:flex><span>py<span style=color:#f92672>.</span>sign_in(<span style=color:#e6db74>&#34;realpython&#34;</span>, <span style=color:#e6db74>&#34;lijlflx93&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@get</span>(<span style=color:#e6db74>&#39;/plot&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>form</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;&#39;&lt;h2&gt;Graph via Plot.ly&lt;/h2&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              &lt;form method=&#34;POST&#34; action=&#34;/plot&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                Name: &lt;input name=&#34;name1&#34; type=&#34;text&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                Age: &lt;input name=&#34;age1&#34; type=&#34;text&#34; /&gt;&lt;br/&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                Name: &lt;input name=&#34;name2&#34; type=&#34;text&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                Age: &lt;input name=&#34;age2&#34; type=&#34;text&#34; /&gt;&lt;br/&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                Name: &lt;input name=&#34;name3&#34; type=&#34;text&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                Age: &lt;input name=&#34;age3&#34; type=&#34;text&#34; /&gt;&lt;br/&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &lt;input type=&#34;submit&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              &lt;/form&gt;&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@post</span>(<span style=color:#e6db74>&#39;/plot&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>submit</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># grab data from form</span>
</span></span><span style=display:flex><span>    name1 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;name1&#39;</span>)
</span></span><span style=display:flex><span>    age1 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;age1&#39;</span>)
</span></span><span style=display:flex><span>    name2 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;name2&#39;</span>)
</span></span><span style=display:flex><span>    age2 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;age2&#39;</span>)
</span></span><span style=display:flex><span>    name3 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;name3&#39;</span>)
</span></span><span style=display:flex><span>    age3 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;age3&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> Data([
</span></span><span style=display:flex><span>        Bar(
</span></span><span style=display:flex><span>            x<span style=color:#f92672>=</span>[name1, name2, name3],
</span></span><span style=display:flex><span>            y<span style=color:#f92672>=</span>[age1, age2, age3]
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    ])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># make api call</span>
</span></span><span style=display:flex><span>    response <span style=color:#f92672>=</span> py<span style=color:#f92672>.</span>plot(data, filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;basic-bar&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> response:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> template(<span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;h1&gt;Congrats!&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              View your graph here: &lt;a href=&#34;{{response}}&#34;&lt;/a&gt;{{response}}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#39;&#39;&#39;</span>,
</span></span><span style=display:flex><span>            response<span style=color:#f92672>=</span>response
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    port <span style=color:#f92672>=</span> int(os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;PORT&#39;</span>, <span style=color:#ae81ff>8080</span>))
</span></span><span style=display:flex><span>    run(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>, port<span style=color:#f92672>=</span>port, debug<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></div><p>这里发生了什么？</p><ul><li>第一个函数 <code>form()</code> 创建一个 HTML 表单，用于捕获制作简单条形图所需的数据。</li><li>与此同时，第二个函数 <code>submit()</code> 抓取表单输入，将它们分配给变量，然后调用 plot.ly API，传递我们的凭据和数据，以生成新图表。确保将我的用户名和 API 密钥替换为您自己的凭据。不要使用我的。不起作用。</li></ul><h3 id=测试>测试</h3><p>在本地运行您的应用程序， <code>python app.py</code> ，并将浏览器指向 <a href=http://localhost:8080/plot target=_blank>http://localhost:8080/plot</a>。</p><p>输入三个人的姓名及其各自的年龄。按“提交”，如果一切顺利，您应该会看到一条祝贺消息和一个 URL。单击 URL 查看您的图表：</p><p><img src=/images/plotly-ages-barplot.webp alt="Plotly ages bar plot"></p><p>如果您收到此消息的 500 错误 - <code>Aw, snap! Looks like you supplied the wrong API key. Want to try again? You can always view your key at https://plot.ly/api/key. When you display your key at https://plot.ly/api/key, make sure that you're logged in as realpython.</code> - 您需要更新您的 API 密钥。</p><blockquote><p>另外，如果这是一个真正的、面向客户端的应用程序，您会希望比这更优雅地处理错误。仅供参考。</p></blockquote><h2 id=群组分析>群组分析</h2><p>接下来，让我们看一个更复杂的示例，为以下队列分析统计数据创建图表：</p><table><thead><tr><th>Cohort</th><th>2011</th><th>2012</th><th>2013</th><th>2014</th></tr></thead><tbody><tr><td>0</td><td>310</td><td>348</td><td>228</td><td>250</td></tr><tr><td>1</td><td>55</td><td>157</td><td>73</td><td>34</td></tr><tr><td>2</td><td>18</td><td>37</td><td>33</td><td>34</td></tr><tr><td>3</td><td>2</td><td>4</td><td>4</td><td>3</td></tr></tbody></table><p>我们将基于同一个应用程序 - app.py 进行构建，但创建一个新文件：打开 app.py，然后“另存为”cohort.py。</p><p>首先升级到<a href=http://bottlepy.org/docs/dev/stpl.html target=_blank>简单模板引擎</a>，这样我们就可以将样式和 Javascript 文件添加到我们的模板中。添加一个名为“views”的新文件夹，然后在该目录中创建一个名为 template.tpl 的新文件。将以下代码添加到该文件中：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;{{ title }}&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;viewport&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&#34;</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>media</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;screen&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>style</span>&gt;
</span></span><span style=display:flex><span>      <span style=color:#f92672>body</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>padding</span>: <span style=color:#ae81ff>60</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>style</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;container&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>h1</span>&gt;Graph via Plot.ly&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>role</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/plot&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>table</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>h3</span>&gt;2011&lt;/<span style=color:#f92672>h3</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-group&#34;</span> <span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#a6e22e>col-md-2</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y01&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 0&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y02&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 1&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y03&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 2&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y04&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 3&#34;</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>h3</span>&gt;2012&lt;/<span style=color:#f92672>h3</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-group&#34;</span> <span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#a6e22e>col-md-2</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y11&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 0&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y12&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 1&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y13&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 2&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y44&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 3&#34;</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>h3</span>&gt;2013&lt;/<span style=color:#f92672>h3</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-group&#34;</span> <span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#a6e22e>col-md-2</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y21&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 0&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y22&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 1&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y23&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 2&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y24&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 3&#34;</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>h3</span>&gt;2014&lt;/<span style=color:#f92672>h3</span>&gt;
</span></span><span style=display:flex><span>              &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-group&#34;</span> <span style=color:#960050;background-color:#1e0010>&#34;</span><span style=color:#a6e22e>col-md-2</span><span style=color:#960050;background-color:#1e0010>&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y31&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 0&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y32&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 1&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y33&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 2&#34;</span>&gt;
</span></span><span style=display:flex><span>                &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;number&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Y34&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-control&#34;</span> <span style=color:#a6e22e>placeholder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cohort 3&#34;</span>&gt;
</span></span><span style=display:flex><span>              &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>            &lt;/<span style=color:#f92672>td</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>tr</span>&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>table</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-default&#34;</span>&gt;Submit&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://code.jquery.com/jquery-1.10.2.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><p>您可能知道，这看起来就像一个 HTML 文件。不同之处在于我们可以使用语法 - <code>{{ python_variable }}</code> 将 Python 变量传递到文件。</p><p>创建 data.json 文件并添加您的 Plot.ly 用户名和 API 密钥。您可以在 <a href=https://github.com/mjhea0/bottle-plotly-python/blob/master/bottle/data_sample.json target=_blank>此处</a> 查看示例文件。</p><p>将以下代码添加到 cohort.py 中，以便在我们进行 API 调用时访问 data.json 以使用凭据：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bottle <span style=color:#f92672>import</span> run, template, get, post, request
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> plotly.plotly <span style=color:#66d9ef>as</span> py
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> plotly.graph_objs <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># grab username and key from config/data file</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;data.json&#39;</span>) <span style=color:#66d9ef>as</span> config_file:
</span></span><span style=display:flex><span>    config_data <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>load(config_file)
</span></span><span style=display:flex><span>username <span style=color:#f92672>=</span> config_data[<span style=color:#e6db74>&#34;user&#34;</span>]
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> config_data[<span style=color:#e6db74>&#34;key&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>py<span style=color:#f92672>.</span>sign_in(username, key)
</span></span></code></pre></div><p>现在我们不必将我们的密钥暴露给整个宇宙。只要确保使其不受版本控制即可。</p><p>接下来更新功能：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bottle <span style=color:#f92672>import</span> run, template, get, post, request
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> plotly.plotly <span style=color:#66d9ef>as</span> py
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> plotly.graph_objs <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># grab username and key from config/data file</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;data.json&#39;</span>) <span style=color:#66d9ef>as</span> config_file:
</span></span><span style=display:flex><span>    config_data <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>load(config_file)
</span></span><span style=display:flex><span>username <span style=color:#f92672>=</span> config_data[<span style=color:#e6db74>&#34;user&#34;</span>]
</span></span><span style=display:flex><span>key <span style=color:#f92672>=</span> config_data[<span style=color:#e6db74>&#34;key&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>py<span style=color:#f92672>.</span>sign_in(username, key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@get</span>(<span style=color:#e6db74>&#39;/plot&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>form</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> template(<span style=color:#e6db74>&#39;template&#39;</span>, title<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Plot.ly Graph&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@post</span>(<span style=color:#e6db74>&#39;/plot&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>submit</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># grab data from form</span>
</span></span><span style=display:flex><span>    Y01 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y01&#39;</span>)
</span></span><span style=display:flex><span>    Y02 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y02&#39;</span>)
</span></span><span style=display:flex><span>    Y03 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y03&#39;</span>)
</span></span><span style=display:flex><span>    Y04 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y04&#39;</span>)
</span></span><span style=display:flex><span>    Y11 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y11&#39;</span>)
</span></span><span style=display:flex><span>    Y12 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y12&#39;</span>)
</span></span><span style=display:flex><span>    Y13 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y13&#39;</span>)
</span></span><span style=display:flex><span>    Y14 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y14&#39;</span>)
</span></span><span style=display:flex><span>    Y21 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y21&#39;</span>)
</span></span><span style=display:flex><span>    Y22 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y22&#39;</span>)
</span></span><span style=display:flex><span>    Y23 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y23&#39;</span>)
</span></span><span style=display:flex><span>    Y24 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y24&#39;</span>)
</span></span><span style=display:flex><span>    Y31 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y31&#39;</span>)
</span></span><span style=display:flex><span>    Y32 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y32&#39;</span>)
</span></span><span style=display:flex><span>    Y33 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y33&#39;</span>)
</span></span><span style=display:flex><span>    Y34 <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>forms<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;Y34&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    trace1 <span style=color:#f92672>=</span> Scatter(
</span></span><span style=display:flex><span>        x<span style=color:#f92672>=</span>[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>],
</span></span><span style=display:flex><span>        y<span style=color:#f92672>=</span>[Y01, Y02, Y03, Y04]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    trace2 <span style=color:#f92672>=</span> Scatter(
</span></span><span style=display:flex><span>        x<span style=color:#f92672>=</span>[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>],
</span></span><span style=display:flex><span>        y<span style=color:#f92672>=</span>[Y11, Y12, Y13, Y14]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    trace3 <span style=color:#f92672>=</span> Scatter(
</span></span><span style=display:flex><span>        x<span style=color:#f92672>=</span>[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>],
</span></span><span style=display:flex><span>        y<span style=color:#f92672>=</span>[Y21, Y22, Y23, Y24]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    trace4 <span style=color:#f92672>=</span> Scatter(
</span></span><span style=display:flex><span>        x<span style=color:#f92672>=</span>[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>4</span>],
</span></span><span style=display:flex><span>        y<span style=color:#f92672>=</span>[Y31, Y32, Y33, Y34]
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> Data([trace1, trace2, trace3, trace4])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># api call</span>
</span></span><span style=display:flex><span>    plot_url <span style=color:#f92672>=</span> py<span style=color:#f92672>.</span>plot(data, filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;basic-line&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> template(<span style=color:#e6db74>&#39;template2&#39;</span>, title<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Plot.ly Graph&#39;</span>, plot_url<span style=color:#f92672>=</span>str(plot_url))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    port <span style=color:#f92672>=</span> int(os<span style=color:#f92672>.</span>environ<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;PORT&#39;</span>, <span style=color:#ae81ff>8080</span>))
</span></span><span style=display:flex><span>    run(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>, port<span style=color:#f92672>=</span>port, debug<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></div><p>请注意 <code>return</code> 声明。我们传入模板的名称以及任何变量。让我们创建一个名为 template2.tpl 的新模板：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;{{ title }}&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;viewport&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>media</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;screen&#34;</span>
</span></span><span style=display:flex><span>    /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>style</span>&gt;
</span></span><span style=display:flex><span>      <span style=color:#f92672>body</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>padding</span>: <span style=color:#ae81ff>60</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>0</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>style</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;container&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>h1</span>&gt;Graph via Plot.ly&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>br</span> /&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/plot&#34;</span>&gt;&lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-default&#34;</span>&gt;Back&lt;/<span style=color:#f92672>button</span>&gt;&lt;/<span style=color:#f92672>a</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>br</span> /&gt;&lt;<span style=color:#f92672>br</span> /&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>iframe</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;igraph&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{{plot_url}}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>width</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;900&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>height</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;450&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>seamless</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;seamless&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>scrolling</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;no&#34;</span>
</span></span><span style=display:flex><span>      &gt;&lt;/<span style=color:#f92672>iframe</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://code.jquery.com/jquery-1.10.2.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><p>因此，iframe 允许我们更新表单，然后显示实际内容/图表以及更新后的更改。换句话说，我们不必离开站点即可查看图表。</p><p>运行。将值添加到表单中。然后提交。您的图表现在应如下所示：</p><p><img src=/images/plotly-final-graph.webp alt="Plotly example final graph"></p><h2 id=结论>结论</h2><p>您可以从此<a href=https://github.com/mjhea0/bottle-plotly-python target=_blank>存储库</a>中获取所有文件。</p><p>下次见！</p><p>原文链接：</p><ul><li><a href=https://realpython.com/developing-with-bottle-part-1/ target=_blank>https://realpython.com/developing-with-bottle-part-1/</a></li><li><a href=https://realpython.com/developing-with-bottle-part-2-plot-ly-api target=_blank>https://realpython.com/developing-with-bottle-part-2-plot-ly-api</a></li></ul></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/python/ rel=tag>python</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="ChenSoul avatar" src=/images/favicon.webp class=avatar height=60 width=60></figure><div class=authorbox__header><span class=authorbox__name>About ChenSoul</span></div><div class=authorbox__description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/posts/2023/06/25/python-function/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>Python学习5：函数</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/posts/2023/06/25/python-modules-packages/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>[译]Python模块和包-简介</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/tools/>Tools</a> | <a class=footer__link href=/tutorials/>Tutorials</a> | <a class=footer__link href=/about/>About</a></div><div class=footer__copyright>&copy; 2025 ChenSoul.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>