<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>[译]测试 Spring Boot 应用程序：最佳实践和框架 - ChenSoul Blog</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="[译]测试 Spring Boot 应用程序：最佳实践和框架"><meta property="og:description" content="Java, Spring Boot, JPA, Hibernate, SQL, REST API, Microservice, Architecture, CI/CD, Docker, Kubernetes, Cloud, and DevOps Tutorials"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2024/10/14/testing-spring-boot-applications-best-practices-and-frameworks/"><meta property="og:site_name" content="ChenSoul Blog"><meta property="og:image" content><meta itemprop=name content="[译]测试 Spring Boot 应用程序：最佳实践和框架"><meta itemprop=description content="测试是软件开发不可或缺的一部分。它可确保您的 Spring Boot 应用程序按预期运行，并在不断发展的过程中继续保持这种状态。在本文中，我们将探讨如何使用最佳实践和工具测试 Spring Boot 应用程序。"><meta itemprop=datePublished content="2024-10-14T00:00:00+00:00"><meta itemprop=dateModified content="2024-10-14T00:00:00+00:00"><meta itemprop=wordCount content="1208"><meta itemprop=keywords content="Spring-Boot"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="[译]测试 Spring Boot 应用程序：最佳实践和框架"><meta name=twitter:description content="Java, Spring Boot, JPA, Hibernate, SQL, REST API, Microservice, Architecture, CI/CD, Docker, Kubernetes, Cloud, and DevOps Tutorials"><meta name=twitter:image content><link rel=preconnect href=//fonts.loli.net crossorigin><link rel=dns-prefetch href=//fonts.loli.net><link rel=stylesheet href="https://fonts.loli.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="ChenSoul Blog" rel=home><div class="logo__item logo__text"><div class=logo__title>ChenSoul Blog</div><div class=logo__tagline>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/tools/><span class=menu__text>Tools</span></a></li><li class=menu__item><a class=menu__link href=/tutorials/><span class=menu__text>Tutorials</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>[译]测试 Spring Boot 应用程序：最佳实践和框架</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 110 28 1 1 0 010-28m0 3a3 3 0 100 22 3 3 0 000-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class=meta__text datetime=2024-10-14T00:00:00Z>2024-10-14</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/spring-boot/ rel=category>Spring-Boot</a></span></div></div></header><div class="content post__content clearfix"><p>测试是软件开发不可或缺的一部分。它可确保您的 Spring Boot 应用程序按预期运行，并在不断发展的过程中继续保持这种状态。在本文中，我们将探讨如何使用最佳实践和工具测试 Spring Boot 应用程序。</p><h1 id=为什么测试很重要>为什么测试很重要</h1><p>测试至关重要，原因如下：</p><ol><li>可靠性：它确保您的应用程序正确、可靠地运行。</li><li>错误检测：它有助于在开发早期识别和修复问题。</li><li>重构：它允许自信地重构代码，因此现有功能不会中断。</li><li>文档：编写良好的测试可以作为代码的活文档。</li></ol><h1 id=测试类型>测试类型</h1><p>Spring Boot 应用程序可以在各个级别进行测试，包括：</p><ol><li>单元测试：单独测试各个组件，例如类或方法。</li><li>集成测试：验证不同的组件或服务是否能正确地协同工作。</li><li>功能测试：从用户的角度测试应用程序的功能。</li><li>端到端测试：在类似生产的环境中测试整个应用程序，包括其外部依赖项。</li></ol><h1 id=测试-spring-boot-应用程序的最佳实践>测试 Spring Boot 应用程序的最佳实践</h1><h2 id=1保持测试隔离>1.保持测试隔离</h2><p>确保测试彼此独立。每个测试都应设置其所需的上下文、运行它并拆除它创建的任何资源。这可以防止一个测试影响另一个测试的结果。</p><h2 id=2使用-spring-boot-的测试注解>2.使用 Spring Boot 的测试注解</h2><p>Spring Boot 提供了诸如<code>@SpringBootTest</code>、<code>@DataJpaTest</code>和<code>@WebMvcTest</code>之类的测试注释，可简化应用程序特定部分的测试。使用它们可以仅加载应用程序上下文的必要部分，从而提高测试效率。以下是一些示例。</p><p><strong>a.使用 @SpringBootTest 加载整个Spring上下文。</strong></p><p><code>@SpringBootTest</code>是用于为测试加载整个 Spring 上下文的注释。这在同时测试应用程序中的多个组件时非常有用。使用注释<code>@Test</code>来标记测试方法。</p><p>下面是一个解释如何使用 Mockito 和 JUnit 的示例。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- Adding JUnit 5(jupiter) and mockito dependencies to our pom.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.junit.jupiter<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>junit-jupiter-engine<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>5.9.2<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;scope&gt;</span>test<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.mockito<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>mockito-core<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>5.3.1<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;scope&gt;</span>test<span style=color:#f92672>&lt;/scope&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/dependency&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.mockito.InjectMocks;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.mockito.Mock;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.mockito.Mockito;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.mockito.junit.jupiter.MockitoExtension;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.employee.service.EmployeeService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.employee.dao.EmployeeRepository;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.employee.dto.Employee;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Optional;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.assertEquals;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.assertNotNull;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ExtendWith</span>(MockitoExtension.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmployeeServiceTests</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>@InjectMocks</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>private</span> EmployeeService employeeService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>@Mock</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>private</span> EmployeeRepository employeeRepository;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGetEmployeeById</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Arrange</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>long</span> employeeId <span style=color:#f92672>=</span> 1L;
</span></span><span style=display:flex><span>  Employee mockEmployee <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Employee(employeeId, <span style=color:#e6db74>&#34;John Doe&#34;</span>, <span style=color:#e6db74>&#34;john.doe@example.com&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Mock the behavior of the repository to return the mock employee</span>
</span></span><span style=display:flex><span>  Mockito.<span style=color:#a6e22e>when</span>(employeeRepository.<span style=color:#a6e22e>findById</span>(employeeId)).<span style=color:#a6e22e>thenReturn</span>(Optional.<span style=color:#a6e22e>of</span>(mockEmployee));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Act</span>
</span></span><span style=display:flex><span>  Employee result <span style=color:#f92672>=</span> employeeService.<span style=color:#a6e22e>getEmployeeById</span>(employeeId);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Assert</span>
</span></span><span style=display:flex><span>  assertNotNull(result);
</span></span><span style=display:flex><span>  assertEquals(employeeId, result.<span style=color:#a6e22e>getId</span>());
</span></span><span style=display:flex><span>  assertEquals(<span style=color:#e6db74>&#34;John Doe&#34;</span>, result.<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span>  assertEquals(<span style=color:#e6db74>&#34;john.doe@example.com&#34;</span>, result.<span style=color:#a6e22e>getEmail</span>());
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>b. 使用 MockMvc 模拟 HTTP 请求并测试控制器的响应。使用 @AutoConfigureMockMvc 自动配置 MockMvc。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.test.web.servlet.MockMvc;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AutoConfigureMockMvc</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GreetingControllerTest</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> MockMvc mockMvc;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGreetEndpoint</span>() <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>    mockMvc.<span style=color:#a6e22e>perform</span>(MockMvcRequestBuilders.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/greet&#34;</span>))
</span></span><span style=display:flex><span>       .<span style=color:#a6e22e>andExpect</span>(MockMvcResultMatchers.<span style=color:#a6e22e>status</span>().<span style=color:#a6e22e>isOk</span>());
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>c. 使用 @MockBean 模拟实现来替换真实 bean。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.mock.mockito.MockBean;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.user.service.UserService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.user.dao.UserRepository;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.user.dto.User;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.mockito.Mockito.when;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.Assertions.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserServiceTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> UserService userService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@MockBean</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> UserRepository userRepository;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testFindUserByUsername</span>() {
</span></span><span style=display:flex><span>   <span style=color:#75715e>// Define a sample user</span>
</span></span><span style=display:flex><span>   User sampleUser <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> User();
</span></span><span style=display:flex><span>   sampleUser.<span style=color:#a6e22e>setId</span>(1L);
</span></span><span style=display:flex><span>   sampleUser.<span style=color:#a6e22e>setUsername</span>(<span style=color:#e6db74>&#34;john_doe&#34;</span>);
</span></span><span style=display:flex><span>   sampleUser.<span style=color:#a6e22e>setEmail</span>(<span style=color:#e6db74>&#34;john@example.com&#34;</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#75715e>// Mock the repository behavior</span>
</span></span><span style=display:flex><span>   when(userRepository.<span style=color:#a6e22e>findByUsername</span>(<span style=color:#e6db74>&#34;john_doe&#34;</span>)).<span style=color:#a6e22e>thenReturn</span>(sampleUser);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#75715e>// Perform the test</span>
</span></span><span style=display:flex><span>   User foundUser <span style=color:#f92672>=</span> userService.<span style=color:#a6e22e>findUserByUsername</span>(<span style=color:#e6db74>&#34;john_doe&#34;</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>   <span style=color:#75715e>// Assertions</span>
</span></span><span style=display:flex><span>   assertThat(foundUser).<span style=color:#a6e22e>isNotNull</span>();
</span></span><span style=display:flex><span>   assertThat(foundUser.<span style=color:#a6e22e>getUsername</span>()).<span style=color:#a6e22e>isEqualTo</span>(<span style=color:#e6db74>&#34;john_doe&#34;</span>);
</span></span><span style=display:flex><span>   assertThat(foundUser.<span style=color:#a6e22e>getEmail</span>()).<span style=color:#a6e22e>isEqualTo</span>(<span style=color:#e6db74>&#34;john@example.com&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>@Mock</code>用于在 Spring 上下文之外进行单元测试和模拟对象，而<code>@MockBean</code>用于 Spring Boot 集成测试，以在 Spring 应用程序上下文中用模拟或间谍版本替换真实 bean。</p><p><strong>d.使用 @DataJpaTest 测试具有嵌入式数据库的存储库。</strong></p><p>如果您在 Spring Boot 应用程序中使用 JPA，<code>@DataJpaTest</code>则仅加载与 JPA 测试相关的组件，例如实体类、存储库接口和必要的 Spring Data JPA 配置。</p><p>默认情况下，Spring Boot在使用时会为每一个测试方法创建一个事务<code>@DataJpaTest</code>，并在每个测试方法结束时回滚事务。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.user.dao.UserRepository;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.user.dto.User;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@DataJpaTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserRepositoryTest</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> UserRepository userRepository;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGetAllUsers</span>() {
</span></span><span style=display:flex><span>    User user <span style=color:#f92672>=</span> userRepository.<span style=color:#a6e22e>updateUserById</span>(1,<span style=color:#e6db74>&#34;Tom&#34;</span>);
</span></span><span style=display:flex><span>    assertNotNull(user);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>e.使用配置 @AutoConfigureTestDatabase 测试数据库。</strong></p><p>使用时<code>@DataJpaTest</code>，Spring Boot 将自动为您的测试配置内存中的 H2 数据库，让您无需单独的数据库实例即可轻松测试数据库查询。但是，如果您需要不同的数据库，则可以使用注释<code>@AutoConfigureTestDatabase</code>进行配置。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase.Replace;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.user.dao.UserRepository;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.user.dto.User;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@DataJpaTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AutoConfigureTestDatabase</span>(replace <span style=color:#f92672>=</span> Replace.<span style=color:#a6e22e>NONE</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserRepositoryTest</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> UserRepository userRepository;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGetUsersNotNull</span>() {
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>User<span style=color:#f92672>&gt;</span> userList <span style=color:#f92672>=</span> userRepository.<span style=color:#a6e22e>getUsers</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    assertNotNull(userList);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>@AutoConfigureTestDatabase(replace = Replace.NONE)</code>配置测试数据库行为。在本例中，它不替换任何内容，而是使用 application.properties 或 application.yml 中指定的默认数据库配置。</p><p><strong>f.使用 @BeforeEach 和 @AfterEach 设置和拆除测试夹具。</strong></p><p>这些注释允许您定义在每个测试方法之前和之后运行的方法。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.BeforeEach;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.AfterEach;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.employee.service.EmployeeService;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmployeeServiceTest</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> EmployeeService employeeService;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@BeforeEach</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUp</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize the EmployeeService or set up resources if needed</span>
</span></span><span style=display:flex><span>    employeeService <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> EmployeeService();    
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@AfterEach</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>tearDown</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Clean up resources or perform other cleanup tasks</span>
</span></span><span style=display:flex><span>    employeeService <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGenerateWelcomeMessage</span>() {
</span></span><span style=display:flex><span>    String name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;John&#34;</span>;
</span></span><span style=display:flex><span>    String welcomeMessage <span style=color:#f92672>=</span> employeeService.<span style=color:#a6e22e>generateWelcomeMessage</span>(name);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    assertEquals(<span style=color:#e6db74>&#34;Welcome, John!&#34;</span>, welcomeMessage);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=3-测试配置>3. 测试配置</h2><p>Spring Boot 允许您为不同的配置文件（例如<code>application.properties</code>，<code>application-test.properties</code>）配置不同的应用程序属性。它允许您创建自定义测试配置，而不会影响主应用程序上下文。</p><p><strong>a. 使用 @TestConfiguration 提供额外的 bean 以供测试。</strong></p><p><code>@SpringBootTest</code>将引导整个应用程序上下文，这意味着您可以将组件扫描拾取的任何 bean 自动装配到我们的测试中。您可能希望避免引导实际的应用程序上下文，而是使用特殊的测试配置。您可以使用<code>@TestConfiguration</code>注释来实现这一点。有两种使用注释的方法。</p><p><em>i. 在我们想要自动装配 bean 的同一个测试类中创建一个静态内部类。</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.employee.service.EmployeeService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmployeeServiceTest</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@TestConfiguration</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestEmployeeServiceConfig</span> {    
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>public</span> EmployeeService <span style=color:#a6e22e>employeeService</span>() {
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> EmployeeService();
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> EmployeeService employeeService;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testWelcomeMessage</span>() {
</span></span><span style=display:flex><span>    String message <span style=color:#f92672>=</span> employeeService.<span style=color:#a6e22e>getWelcomeMessage</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    assertEquals(<span style=color:#e6db74>&#34;Welcome&#34;</span>, message);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><em>ii. 创建一个单独的测试配置类并使用</em><code>@Import</code><em>注释导入它。</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.TestConfiguration;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Bean;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.employee.service.EmployeeService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@TestConfiguration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestEmployeeServiceConfig</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> EmployeeService <span style=color:#a6e22e>employeeService</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> EmployeeService();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.context.annotation.Import;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.employee.service.EmployeeService;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Import</span>(TestEmployeeServiceConfig.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmployeeServiceTest</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> EmployeeService employeeService;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testWelcomeMessage</span>() {
</span></span><span style=display:flex><span>    String message <span style=color:#f92672>=</span> employeeService.<span style=color:#a6e22e>getWelcomeMessage</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    assertEquals(<span style=color:#e6db74>&#34;Simform Welcomes You&#34;</span>, message);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>b.使用 @ConfigurationProperties 从配置文件注入属性。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.context.properties.ConfigurationProperties;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Component;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ConfigurationProperties</span>(prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;app&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ConfigurationPropertiesScan</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppProperties</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> String appName;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> String appVersion;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Getters and setters</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#75715e>#Add the configuration properties to your application&#39;s property file</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app.appName</span><span style=color:#f92672>=</span><span style=color:#e6db74>Keka</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app.appVersion</span><span style=color:#f92672>=</span><span style=color:#e6db74>5.0</span>
</span></span></code></pre></div><p>Spring 将自动将我们属性文件中定义的任何属性与前缀<em>app</em>绑定，并与 AppProperties 类中的字段之一同名。然后，您可以通过自动装配<code>AppProperties</code>bean 在测试 bean 中使用这些属性。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.app.service.ApplicationService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.app.properties.AppProperties;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.app.dto.Application;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ApplicationServiceTest</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> AppProperties properties;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> ApplicationService applicationService;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMyMethod</span>() {
</span></span><span style=display:flex><span>    Application app <span style=color:#f92672>=</span> applicationService.<span style=color:#a6e22e>getDetailsbyName</span>(properties.<span style=color:#a6e22e>getAppName</span>());
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    assertNotNull(app);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>c.@ActiveProfiles当您有多个配置文件时，使用激活特定配置文件进行测试。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.test.context.ActiveProfiles;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.employee.service.EmployeeService;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ActiveProfiles</span>({<span style=color:#e6db74>&#34;test&#34;</span>,<span style=color:#e6db74>&#34;dev&#34;</span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmployeeServiceTest</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> EmployeeService employeeService;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGetEmployeeCount</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> empCount <span style=color:#f92672>=</span> employeeService.<span style=color:#a6e22e>getEmployeeCount</span>();
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    assertTrue(empCount<span style=color:#f92672>&gt;</span>0);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>d .使用@DynamicPropertySource设置测试的动态配置属性。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.test.context.DynamicPropertyRegistry;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.test.context.DynamicPropertySource;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.user.service.UserService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.user.dto.User;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DynamicPropertyTest</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> UserService userService;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@DynamicPropertySource</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>properties</span>(DynamicPropertyRegistry registry) {
</span></span><span style=display:flex><span>    registry.<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;custom.name&#34;</span>, () <span style=color:#f92672>-&gt;</span> <span style=color:#e6db74>&#34;Jack&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Value</span>(<span style=color:#e6db74>&#34;${custom.name}&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> String customName;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGetUserByName</span>() {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    User user <span style=color:#f92672>=</span> userService.<span style=color:#a6e22e>getUserByName</span>(customName);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    assertNotNull(user);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>e. 使用 @DirtiesContext 在测试后重置 Spring 上下文。</strong></p><p>如果您有修改 Spring 上下文的测试，例如添加或修改 Bean，则可能需要在每次测试之后重置上下文，以确保后续测试从干净的上下文开始。<code>@DirtiesContext</code>在需要确保每个测试方法都在全新且隔离的应用程序上下文中运行的场景中很有用。</p><ol><li>用法：</li></ol><ul><li>您可以使用 注释单个测试方法或整个测试类<code>@DirtiesContext</code>。</li><li>当应用于测试方法时，只有该特定的测试方法才会触发上下文重置。</li><li>当应用于测试类时，它会影响该类中的所有测试方法，导致每次测试方法之后重置上下文。</li></ul><p>2.用例：</p><ul><li><code>@DirtiesContext</code>通常在测试方法对 Spring 应用程序上下文有副作用并且无法通过常规事务或回滚机制撤消时使用。</li><li>例如，如果测试方法以影响后续测试的方式修改了单例 bean 的状态，则可以使用<code>@DirtiesContext</code>重置上下文。</li></ul><p>3.影响：</p><ul><li>重置应用程序上下文在性能方面可能会相对昂贵，因此请谨慎使用。</li><li>它不应被用作所有测试的默认方法。相反，应考虑仅在必要时使用它来解决特定的测试挑战。</li></ul><p><strong>f.使用 RestTemplate 发出 HTTP 请求。</strong></p><p><code>RestTemplate</code>用于发出 HTTP 请求以与 RESTful Web 服务或 API 进行交互。</p><ul><li>通常用于生产代码。</li><li>支持向外部服务发出实际的 HTTP 请求。</li><li>通常用于与正在运行的应用程序中的实际服务交互。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.http.ResponseEntity;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.client.RestTemplate;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.http.HttpStatusCode;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ExternalServiceTest</span> {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testExampleApi</span>() {
</span></span><span style=display:flex><span>    RestTemplate restTemplate <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RestTemplate();
</span></span><span style=display:flex><span>    String url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://api.example.com/data&#34;</span>;
</span></span><span style=display:flex><span>    ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate.<span style=color:#a6e22e>getForEntity</span>(url, String.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    assertFalse(response.<span style=color:#a6e22e>getStatusCode</span>() <span style=color:#f92672>==</span> HttpStatusCode.<span style=color:#a6e22e>valueOf</span>(404))
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>g. 使用@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)在随机端口上启动服务器。使用TestRestTemplate发出 HTTP 请求并断言响应。</strong></p><p>如果您需要测试应用程序与外部系统（例如数据库或其他微服务）的集成，则可能必须在随机端口上启动服务器。</p><p><code>TestRestTemplate</code>是 的一个子类<code>RestTemplate</code>，专门用于 Springboot 应用程序的集成测试。它允许您像外部客户端一样向应用程序的 RESTful 端点发出 HTTP 请求。</p><ul><li>通常用于集成测试。</li><li>允许您测试应用程序的端点，而无需发出实际的外部请求。</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.web.server.LocalServerPort;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.web.client.TestRestTemplate;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.web.client.TestRestTemplate.HttpClientOption;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.http.HttpStatus;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.http.ResponseEntity;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.assertj.core.api.Assertions.assertThat;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>(webEnvironment <span style=color:#f92672>=</span> WebEnvironment.<span style=color:#a6e22e>RANDOM_PORT</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LocalEndpointTest</span> {
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@LocalServerPort</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> port;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> TestRestTemplate restTemplate;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGetBusinesses</span>(){
</span></span><span style=display:flex><span>    String url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://localhost:&#34;</span> <span style=color:#f92672>+</span> port <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/getBusinesses&#34;</span>;
</span></span><span style=display:flex><span>    ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate.<span style=color:#a6e22e>getForEntity</span>(url, String.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    assertThat(response.<span style=color:#a6e22e>getStatusCode</span>()).<span style=color:#a6e22e>isEqualTo</span>(HttpStatus.<span style=color:#a6e22e>OK</span>);
</span></span><span style=display:flex><span>    assertThat(response.<span style=color:#a6e22e>getBody</span>()).<span style=color:#a6e22e>isEqualTo</span>(<span style=color:#e6db74>&#34;Expected response body&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>h. 使用@Sql在测试之前和之后执行 SQL 脚本。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.test.context.jdbc.Sql;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>IntegrationTest</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Sql</span>(scripts <span style=color:#f92672>=</span> { <span style=color:#e6db74>&#34;/init-database.sql&#34;</span>, <span style=color:#e6db74>&#34;/populate-data.sql&#34;</span> }, executionPhase <span style=color:#f92672>=</span> Sql.<span style=color:#a6e22e>ExecutionPhase</span>.<span style=color:#a6e22e>BEFORE_TEST_METHOD</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testWithSqlScripts</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sql scripts get executed before the execution of this block</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Sql</span>(scripts <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/cleanup.sql&#34;</span>, executionPhase <span style=color:#f92672>=</span> Sql.<span style=color:#a6e22e>ExecutionPhase</span>.<span style=color:#a6e22e>AFTER_TEST_METHOD</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testWithCleanupSql</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sql scripts get executed after the execution of this block</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>i. 使用 @Disabled 暂时禁用测试。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Disabled;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.employee.service.EmployeeService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.employee.dto.Employee;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EmployeeServiceTest</span> {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> EmployeeService employeeService;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Disabled</span>(<span style=color:#e6db74>&#34;Temporarily disabled until bug XYZ is fixed&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGetEmployees</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Test will be skipped</span>
</span></span><span style=display:flex><span>    Employee employee <span style=color:#f92672>=</span> employeeService.<span style=color:#a6e22e>getEmployeeByName</span>(<span style=color:#e6db74>&#34;Harry&#34;</span>);
</span></span><span style=display:flex><span>    assertNotNull(employee);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGetEmployeeCount</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Test will be executed</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> empCount <span style=color:#f92672>=</span> employeeService.<span style=color:#a6e22e>getEmployeeCount</span>();
</span></span><span style=display:flex><span>    assertTrue(empCount<span style=color:#f92672>&gt;</span>0);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>整个类也可以注释为<code>@Disabled</code><em>。</em></p><p><strong>j. 使用@RepeatedTest重复测试指定的次数。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.RepeatedTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.RepetitionInfo;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.test.context.SpringBootTest;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.http.ResponseEntity;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.client.RestTemplate;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.user.service.UserService;
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> org.junit.Assert.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserServiceTest</span> {
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> UserService userService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@RepeatedTest</span>(5) <span style=color:#f92672>/</span>This test will run 5 times
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGetUserCount</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> count <span style=color:#f92672>=</span> userService.<span style=color:#a6e22e>getUserCount</span>();
</span></span><span style=display:flex><span>    assertTrue(count<span style=color:#f92672>&gt;</span>0);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@RepeatedTest</span>(3) <span style=color:#f92672>/</span>This test will run 3 times
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testGetLoggedInUsers</span>(RepetitionInfo repetitionInfo) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> currentRepetition <span style=color:#f92672>=</span> repetitionInfo.<span style=color:#a6e22e>getCurrentRepetition</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> totalRepetitions <span style=color:#f92672>=</span> repetitionInfo.<span style=color:#a6e22e>getTotalRepetitions</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Test logic, using currentRepetition and totalRepetitions</span>
</span></span><span style=display:flex><span>    RestTemplate restTemplate <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RestTemplate();
</span></span><span style=display:flex><span>    String url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://api.example.com/getLoggedInUsers&#34;</span>;
</span></span><span style=display:flex><span>    ResponseEntity<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> response <span style=color:#f92672>=</span> restTemplate.<span style=color:#a6e22e>getForEntity</span>(url, String.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(response.<span style=color:#a6e22e>getBody</span>() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>) {   
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;CurrentRepetition: &#34;</span> <span style=color:#f92672>+</span> currentRepetition);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=4测试覆盖率>4.测试覆盖率</h2><p>使用 SonarQube 或 Jacoco 等代码覆盖率工具来测量测试的覆盖率。以高代码覆盖率为目标，确保大多数代码都经过测试。</p><h1 id=测试框架>测试框架</h1><p>Spring Boot 应用程序中常用有几种测试工具，包括：</p><ol><li>JUnit：一种广泛使用的 Java 测试框架。</li><li>Mockito：用于在测试中创建模拟对象的模拟框架。</li><li>Testcontainers：提供用于测试的轻量级、一次性的常用数据库或服务实例。</li><li>Spring Boot 测试：提供用于测试 Spring Boot 应用程序的注释和实用程序。</li><li>RestAssured：一种用于简化 REST 服务测试的 Java DSL。</li><li>Selenium：用于Web应用程序测试，尤其是端到端测试。</li><li>Jacoco：一种代码覆盖率分析工具，可帮助您识别代码库中需要更多测试的区域。</li><li>WireMock：一种模拟 HTTP 服务的工具，可用于测试外部服务交互。</li></ol><h1 id=结论>结论</h1><p>通过遵循最佳实践并利用正确的测试工具，您可以确保测试可靠、可维护且能够有效地发现应用程序中的错误。持续的测试将提高代码质量、减少错误并提高用户满意度。</p><p><em>快乐学习！</em></p><blockquote><p><strong>请继续关注</strong><a href=https://medium.com/simform-engineering target=_blank><strong>Simform Engineering</strong></a><strong>博客，了解有关最新工具和技术的更多更新。</strong></p><p><strong>关注我们：</strong><a href=https://twitter.com/simform target=_blank><strong>Twitter</strong></a> <strong>|</strong> <a href=https://www.linkedin.com/company/simform/ target=_blank><strong>LinkedIn</strong></a></p></blockquote><p>原文链接：<a href=https://medium.com/simform-engineering/testing-spring-boot-applications-best-practices-and-frameworks-6294e1068516 target=_blank>https://medium.com/simform-engineering/testing-spring-boot-applications-best-practices-and-frameworks-6294e1068516</a></p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/spring-boot/ rel=tag>spring-boot</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="ChenSoul avatar" src=/images/favicon.webp class=avatar height=60 width=60 loading=lazy></figure><div class=authorbox__header><span class=authorbox__name>About ChenSoul</span></div><div class=authorbox__description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/posts/2024/08/27/activemq-source-code-broker-service/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>ActiveMQ源码-BrokerService和PersistenceAdapter</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/posts/2024/10/15/spring-security-jwt/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>[译]Spring Security 和 JWT 入门</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/tools/>Tools</a> | <a class=footer__link href=/tutorials/>Tutorials</a> | <a class=footer__link href=/about/>About</a></div><div class=footer__copyright>&copy; 2025 ChenSoul.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/chensoul/mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></footer></div><script>"use strict";(function(t){var i=t.querySelector(".menu__btn"),o=t.querySelector(".menu__list");function a(){o.classList.toggle("menu__list--active"),o.classList.toggle("menu__list--transition"),this.classList.toggle("menu__btn--active"),this.setAttribute("aria-expanded",this.getAttribute("aria-expanded")==="true"?"false":"true")}function r(){this.classList.remove("menu__list--transition")}i&&o&&(i.addEventListener("click",a,!1),o.addEventListener("transitionend",r,!1))})(document,window)</script><script defer src="https://cdn.bootcdn.net/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script><script defer src=https://umami.chensoul.cc/random-string.js data-website-id=1e07d36d-bec3-4ba6-9459-876b1ac3bbe7></script></body></html>