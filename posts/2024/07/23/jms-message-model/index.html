<!doctype html><html class=no-js lang=zh-cn><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>[译]JMS 消息模型 - Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="[译]JMS 消息模型"><meta property="og:description" content="Java, Spring Boot, JPA, Hibernate, SQL, REST API, Microservice, Architecture, CI/CD, Docker, Kubernetes, Cloud, and DevOps Tutorials"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2024/07/23/jms-message-model/"><meta property="og:site_name" content="ChenSoul Blog"><meta property="og:image" content><meta itemprop=name content="[译]JMS 消息模型"><meta itemprop=description content="消息是 JMS 的核心，无论是事件还是业务数据。消息由标头、自定义属性和正文组成。这是您将在 JMS 消息模型（JMS 消息剖析）中学习的内容。"><meta itemprop=datePublished content="2024-07-23T00:00:00+00:00"><meta itemprop=dateModified content="2024-07-23T00:00:00+00:00"><meta itemprop=wordCount content="966"><meta itemprop=keywords content="Jms"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="[译]JMS 消息模型"><meta name=twitter:description content="Java, Spring Boot, JPA, Hibernate, SQL, REST API, Microservice, Architecture, CI/CD, Docker, Kubernetes, Cloud, and DevOps Tutorials"><meta name=twitter:image content><link rel=preconnect href=//fonts.loli.net crossorigin><link rel=dns-prefetch href=//fonts.loli.net><link rel=stylesheet href="https://fonts.loli.net/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.min.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="ChenSoul Blog" rel=home><div class="logo__item logo__text"><div class=logo__title>ChenSoul Blog</div><div class=logo__tagline>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>首页</span></a></li><li class=menu__item><a class=menu__link href=/categories/><span class=menu__text>分类</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>关于</span></a></li><li class=menu__item><a class=menu__link href=/index.xml><span class=menu__text>RSS</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>[译]JMS 消息模型</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 110 28 1 1 0 010-28m0 3a3 3 0 100 22 3 3 0 000-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class=meta__text datetime=2024-07-23>2024-07-23</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/java/ rel=category>Java</a></span></div></div></header><div class=social__content><span>Share:</span>
<a class="social__link btn" href="https://twitter.com/intent/tweet?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f&text=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b" target=_blank title=Twitter rel=noopener><svg class="social__link-icon icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5.0-78.8 35.3-78.8 78.8.0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3C20 26 16.1 39.6 16.1 54c0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1.0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4.0-12.6-.4-18.8-1.1C34.9 299 76.3 312 120.8 312c144.9.0 224.1-120 224.1-224.1.0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
</a><a class="social__link btn" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f" target=_blank title=Facebook rel=noopener><svg class="social__link-icon icon icon-facebook" width="24" height="24" viewBox="0 0 352 352"><path fill="currentColor" d="m0 32v288c0 17.5 14.5 32 32 32h288c17.5.0 32-14.5 32-32V32c0-17.5-14.5-32-32-32H32C14.5.0.0 14.5.0 32zm320 0v288h-83V212h41.5l6-48H237v-31c0-14 3.5-23.5 23.5-23.5h26V66c-4.4-.6-19.8-1.5-37.5-1.5-36.9.0-62 22.2-62 63.5v36h-42v48h42v108H32V32z"/></svg>
</a><a class="social__link btn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f&title=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b" target=_blank title=LinkedIn rel=noopener><svg class="social__link-icon icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg>
</a><a class="social__link btn" href="https://t.me/share/url?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f&text=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b" target=_blank title=Telegram rel=noopener><svg class="social__link-icon icon icon-telegram" width="24" height="24" viewBox="0 0 132 110"><path fill="#ddd" d="M50 103c-4 0-3-1-5-5L34 60l88-52"/><path fill="#aaa" d="M50 103c3 0 4-1 6-3l16-16-20-12"/><path fill="#fff" d="M52 72l48 36c6 3 10 2 11-5l20-93c2-8-3-11-8-9L7 45c-8 4-8 8-1 10l29 9 69-43c3-2 6-1 4 1"/></svg>
</a><a class="social__link btn" href="mailto:?subject=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b&body=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f" title="Share by Email"><svg class="social__link-icon icon icon-mail" width="24" height="24" viewBox="0 0 24 24"><path d="M0 3h24v18H0zm2 16h20V7l-10 6L2 7zM22 5H2l10 6z"/></svg>
</a><a class="social__link btn" href="https://service.weibo.com/share/share.php?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f&title=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b" target=_blank title=Weibo rel=noopener><svg class="social__link-icon icon icon-telegram" viewBox="0 0 32 32" width="24" height="24" fill="none"><rect width="32" height="32" rx="8" fill="#e6162d"/><path d="M23.5 18.5c-1.2 2.5-5.2 3.7-8.2 3.7-2.7.0-5.2-.7-6.2-2.2-.7-1.1-.5-2.5.6-3.2.7-.5 1.6-.6 2.3-.2.3.2.7.1.9-.2.2-.3.1-.7-.2-.9-1.2-.7-2.7-.6-3.8.3-1.6 1.2-2 3.4-.8 5 1.4 2 4.5 2.9 7.5 2.9 3.5.0 7.9-1.4 9.3-4.3.2-.3.0-.7-.3-.9s-.7.0-.9.3z" fill="#fff"/><circle cx="15" cy="19" r="8" fill="#fff"/></svg></a></div><div class="content post__content clearfix"><p>消息是 JMS 的核心，无论是事件还是业务数据。消息由标头、自定义属性和正文组成。这是您将在 JMS 消息模型（JMS 消息剖析）中学习的内容。</p><p><img src=/images/JMS-message-model-min-1024x536.webp alt="JMS 消息模型"></p><p>JMS 消息由 Header、Properties 和 Body（Payload）组成。我们将在下面详细讨论它们。</p><ul><li><p><strong>消息头</strong>是有关消息的元数据。消息头有两种类型：开发人员设置的头和 JMS 提供商设置的头。</p></li><li><p>消息属性是用于向消息添加可选标头字段的附加标头字段。属性字段基本上有 3 种类型。</p><ul><li>应用程序特定属性 - 允许设置应用程序特定的自定义标题。</li><li>标准属性 – JMS 定义的标准属性。</li><li>JMS-Provider 特定属性。</li></ul></li><li><p><strong>消息主体</strong>是发送到目的地的有效负载。JMS 支持多种类型（格式）的有效负载。</p></li></ul><h2 id=1-消息头字段>1. 消息头字段</h2><p>一些消息头由程序员设置，一些由 JMS 提供商内部设置。消息头是 JMS 消息模型中首先要探讨的内容。</p><h3 id=11-jms-目标><strong>1.1. JMS 目标</strong></h3><p>此标头包含消息发送的目的地。收到消息时，目的地必须与分配的值相等。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSDestination(Destination)
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSDestination()
</span></span></code></pre></div><h3 id=12-jms交付模式><strong>1.2. JMS交付模式</strong></h3><p>JMS 支持 <em>PERSISTEN T</em>和 NON_PERSISTENT 消息传输模式。此标头表示传递模式。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSDeliveryMode<span style=color:#960050;background-color:#1e0010>（</span><span style=color:#66d9ef>int</span><span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSDeliveryMode()
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>DeliveryMode</span>
</span></span></code></pre></div><h3 id=13-jms消息id><strong>1.3. JMS消息ID</strong></h3><p>此标头字段值唯一标识提供商发送的每个消息。它是一个字符串值。程序员不需要处理它。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSMessageID()
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSMessageID(String)
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>MessageProducer</span><span style=color:#960050;background-color:#1e0010>#</span>setDisableMessageID(<span style=color:#66d9ef>boolean</span>)
</span></span></code></pre></div><h3 id=14-jms时间戳><strong>1.4. JMS时间戳</strong></h3><p>消息被交给提供商处理的时间戳。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSTimestamp(<span style=color:#66d9ef>long</span>)
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>MessageProducer</span><span style=color:#960050;background-color:#1e0010>#</span>setDisableMessageTimestamp(<span style=color:#66d9ef>boolean</span>)
</span></span></code></pre></div><h3 id=15-jms重新交付><strong>1.5. JMS重新交付</strong></h3><p>当客户端收到带有此标头的消息时，很可能该消息已在过去送达，但未收到确认。程序员无法更改此值。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSRedelivered<span style=color:#960050;background-color:#1e0010>（</span><span style=color:#66d9ef>boolean</span><span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSRedelivered()
</span></span></code></pre></div><h3 id=16-jmsexpiration--设置消息生存时间><strong>1.6. JMSExpiration</strong> – 设置消息生存时间</h3><p>JMS 通过添加生存时间值来为每条消息设置过期值。生存时间值在方法中指定<code>send()</code>。如果生存时间值设置为零，则 JMSExpiration 标头值也会变为零，这意味着消息不会过期。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setTimeToLive</span>(<span style=color:#66d9ef>long</span> timeToLive);
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSExpiration(<span style=color:#66d9ef>long</span>)
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSExpiration()
</span></span></code></pre></div><p>下面的示例演示了如何使用<code>producer.setTimeToLive()</code>方法来设置消息过期时间。正如您在输出中看到的那样，消息的生命周期只有 2 秒，5 秒后它将从队列中删除。因此，消费者不会收到该消息并记录 NullPointer 异常。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#f92672>package</span> lab01.message.model;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> labxx.common.settings.CommonSettings;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.jms.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MessageExpirationTest</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException, JMSException {
</span></span><span style=display:flex><span>    ConnectionFactory connectionFactory <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getConnectionFactory</span>();
</span></span><span style=display:flex><span>    Queue queue <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getDefaultQueue</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>setTimeToLive</span>(2000);
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, <span style=color:#e6db74>&#34;This message will expire soon&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      Thread.<span style=color:#a6e22e>sleep</span>(5000);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      TextMessage message <span style=color:#f92672>=</span> (TextMessage) consumer.<span style=color:#a6e22e>receive</span>(10000);
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(message.<span style=color:#a6e22e>getText</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>输出</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>Exception in thread &#34;main&#34; java.lang.NullPointerException
</span></span></code></pre></div><h3 id=17-jmspriority-标头><strong>1.7. JMSPriority 标头</strong></h3><p>JMS 定义了 10 个优先级别，从 0（最低）到 9（最高）。应用程序客户端应将 0 到 4 视为<em>普通</em>优先级消息，将 5 到 9 视为<em>加急</em>消息。加急消息优先于普通优先级消息传送。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setPriority</span>(<span style=color:#66d9ef>int</span> priority);
</span></span></code></pre></div><p>更多讨论请参阅**<a href=https://jstobigdata.com/jms/jms-prioritize-messages/ target=_blank>优先考虑 JMS 消息教程</a>**。</p><h3 id=18-jmsdeliverytime--消息传递延迟><strong>1.8. JMSDeliveryTime</strong> – 消息传递延迟</h3><p>表示投递时间。这意味着消息将在此标头所表示的时间或之后投递。通过将投递时间与指定的投递延迟相加来计算。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setDeliveryDelay</span>(<span style=color:#66d9ef>long</span> deliveryDelay);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#f92672>package</span> lab01.message.model;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> labxx.common.settings.CommonSettings;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.jms.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MessageDelayDelivery</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    ConnectionFactory connectionFactory <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getConnectionFactory</span>();
</span></span><span style=display:flex><span>    Queue queue <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getDefaultQueue</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>setDeliveryDelay</span>(3000);<span style=color:#f92672>/</span>delivered after 3 seconds
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, <span style=color:#e6db74>&#34;Message with a delay&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      TextMessage textMsg <span style=color:#f92672>=</span> (TextMessage) consumer.<span style=color:#a6e22e>receive</span>(5000);<span style=color:#f92672>/</span>Wait <span style=color:#66d9ef>for</span> 5 seconds
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Received message: &#34;</span> <span style=color:#f92672>+</span> textMsg.<span style=color:#a6e22e>getText</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>当您运行该示例时，您将看到消息在 3 秒后送达。</p><h3 id=19-jms关联id><strong>1.9. JMS关联ID</strong></h3><p>客户端使用此标头字段将一条消息与另一条消息链接起来。在请求-响应场景中很有用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setJMSCorrelationID</span>(String correlationID)
</span></span><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setJMSCorrelationIDAsBytes</span>(<span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span>)
</span></span></code></pre></div><p>我将在本教程的后半部分讨论在请求-响应场景中使用 CorrelationID。</p><h3 id=110-jms类型><strong>1.10. JMS类型</strong></h3><p>表示客户端在消息中设置的消息类型 ID。在少数 JMS 提供商中很有用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setJMSType</span>(String type);
</span></span></code></pre></div><h3 id=111-jmsreplyto><strong>1.11. JMSReplyTo</strong></h3><p>此标头包含应发送消息回复的目的地（队列或主题）。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setJMSReplyTo</span>(Destination replyTo);
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSReplyTo(Destination)
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSReplyTo()
</span></span></code></pre></div><p>您将在本教程的后半部分学习 JMSReplyTo 标头的使用。</p><h2 id=2-消息属性>2. 消息属性</h2><p>如前所述，消息属性是向消息添加可选标头字段的附加字段。消息属性有 3 种类型：自定义属性、JMS 定义属性和可选 JMS 提供程序特定属性。</p><h3 id=21-自定义属性>2.1. 自定义属性</h3><ul><li>属性名称（键）应遵循 java 标识符规则。</li><li>属性值可以是<code>boolean</code>、<code>byte</code>、<code>short</code>、<code>int</code>、和。<code>long</code>、<code>float</code>、<code>double</code>、<code>String</code></li></ul><p>下面的示例演示了消息中自定义属性的用法。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#f92672>package</span> lab01.message.model;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> labxx.common.settings.CommonSettings;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.jms.*;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Enumeration;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.UUID;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MessageCustomProperties</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test</span>()
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    ConnectionFactory connectionFactory <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getConnectionFactory</span>();
</span></span><span style=display:flex><span>    Queue queue <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getDefaultQueue</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      TextMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createTextMessage</span>(<span style=color:#e6db74>&#34;Message with a custom property&#34;</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>setBooleanProperty</span>(<span style=color:#e6db74>&#34;priorityUser&#34;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>setStringProperty</span>(<span style=color:#e6db74>&#34;authToken&#34;</span>, UUID.<span style=color:#a6e22e>randomUUID</span>().<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>      <span style=color:#75715e>//Delay for testing purpose Only</span>
</span></span><span style=display:flex><span>      TextMessage textMsg <span style=color:#f92672>=</span> (TextMessage) consumer.<span style=color:#a6e22e>receive</span>(1000);
</span></span><span style=display:flex><span>      Enumeration customProperties <span style=color:#f92672>=</span> textMsg.<span style=color:#a6e22e>getPropertyNames</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>while</span> (customProperties.<span style=color:#a6e22e>hasMoreElements</span>()) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(customProperties.<span style=color:#a6e22e>nextElement</span>());
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;priorityUser: &#34;</span> <span style=color:#f92672>+</span> textMsg.<span style=color:#a6e22e>getBooleanProperty</span>(<span style=color:#e6db74>&#34;priorityUser&#34;</span>));
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;authToken: &#34;</span> <span style=color:#f92672>+</span> textMsg.<span style=color:#a6e22e>getStringProperty</span>(<span style=color:#e6db74>&#34;authToken&#34;</span>));
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Received message: &#34;</span> <span style=color:#f92672>+</span> textMsg.<span style=color:#a6e22e>getText</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>输出</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>JMSXDeliveryCount
</span></span><span style=display:flex><span>priorityUser
</span></span><span style=display:flex><span>authToken
</span></span><span style=display:flex><span>priorityUser: true
</span></span><span style=display:flex><span>authToken: 010a908f-a3a6-4a2b-8d9f-5e177f1c223b
</span></span><span style=display:flex><span>Received message: Message with a custom property
</span></span></code></pre></div><p>您可以迭代各种消息属性，如上例所示（第 28-31 行）。</p><h3 id=22-jms-定义的属性>2.2. JMS 定义的属性</h3><p>所有 JMS 定义的属性都有<code>JMSX</code>属性名前缀。下面是属性列表、属性类型、JMS 必须实现的可选或强制属性及其用途。</p><p><strong>1. JMSXUserID</strong> — 字符串 — 可选 — 由提供商在发送时设置，
用于识别发送消息的用户。</p><p><strong>2. JMSXAppID</strong> — 字符串 — 可选 — 由提供商在发送时设置
这是发送消息的应用程序的身份。</p><p><strong>3. JMSXDeliveryCount</strong> – int – 强制 – 由提供商在接收时设置
消息传递尝试的次数。</p><p><strong>4. JMSXGroupID</strong> – 字符串 – 可选 – 由客户端设置
此消息所属消息组的标识。</p><p><strong>5. JMSXGroupSeq</strong> – int – 可选 – 由客户端设置
此消息在组内的序列号。</p><p><strong>6. JMSXProducerTXID</strong> — 字符串 — 可选 — 由提供商在发送
生成消息的事务 ID 时设置。</p><p><strong>7. JMSXConsumerTXID</strong> — 字符串 — 可选 — 由提供商在接收
使用消息的交易 ID 时设置。</p><p><strong>8. JMSXRcvTimestamp</strong> — long — 可选 — 由提供商在接收时设置
JMS 将消息传递给消费者的时间。</p><p><strong>9. JMSXState</strong> – int – 可选 – 由提供商设置
消息是否处于等待、就绪、过期或保留状态。没有 API 可供程序员检查这一点。</p><h3 id=23-jms-提供程序特定属性>2.3. JMS 提供程序特定属性</h3><p>JMS<code>JMS_&lt;vendor_name></code>为特定于供应商的属性保留了属性名称前缀。这些特定于供应商的属性适用于本机供应商/提供商客户端。程序员不能在 JMS 代码中使用。</p><h2 id=3-jms-消息体--jms-中的-5-种消息类型>3. JMS 消息体 – JMS 中的 5 种消息类型</h2><p>最后，在本次 JMS 消息模型讨论中，我们将讨论实际的消息内容。JMS 提供了 5 种形式的消息类型。</p><h3 id=1-streammessage><strong>1. StreamMessage</strong></h3><p>消息主体包含 Java 原始值流。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>StreamMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createStreamMessage</span>();
</span></span><span style=display:flex><span>message.<span style=color:#a6e22e>writeString</span>(<span style=color:#e6db74>&#34;String Content&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>StreamMessage receivedMessage <span style=color:#f92672>=</span> (StreamMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span></code></pre></div><h3 id=2-mapmessage><strong>2. MapMessage</strong></h3><p>消息主体包含键值对，键是字符串对象，值是 Java 原始类型。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>MapMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createMapMessage</span>();
</span></span><span style=display:flex><span>message.<span style=color:#a6e22e>setString</span>(<span style=color:#e6db74>&#34;sampleKey&#34;</span>, <span style=color:#e6db74>&#34;sampleValue&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MapMessage receivedMessage <span style=color:#f92672>=</span> (MapMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span></code></pre></div><h3 id=3-textmessage>**3. **TextMessage</h3><p>正文包含字符串的消息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>TextMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createTextMessage</span>(<span style=color:#e6db74>&#34;Test TextMessage Type&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TextMessage receivedMessage <span style=color:#f92672>=</span> (TextMessage) jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue).<span style=color:#a6e22e>receive</span>();
</span></span></code></pre></div><h3 id=4-objectmessage><strong>4. ObjectMessage</strong></h3><p>包含可序列化 Java 对象的消息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>ObjectMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createObjectMessage</span>();
</span></span><span style=display:flex><span>message.<span style=color:#a6e22e>setObject</span>(<span style=color:#66d9ef>new</span> UserCommand(<span style=color:#e6db74>&#34;John&#34;</span>, <span style=color:#e6db74>&#34;john@gmail.com&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ObjectMessage receivedMessage <span style=color:#f92672>=</span> (ObjectMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span></code></pre></div><h3 id=5-bytesmessage><strong>5. BytesMessage</strong></h3><p>包含未解释的字节流的消息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>BytesMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createBytesMessage</span>();
</span></span><span style=display:flex><span>message.<span style=color:#a6e22e>writeUTF</span>(<span style=color:#e6db74>&#34;नमस्ते&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BytesMessage receivedMessage <span style=color:#f92672>=</span> (BytesMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span></code></pre></div><p>以下代码从高层次演示了各种消息类型的工作方式。您还可以探索更多方法。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#f92672>package</span> lab01.message.model;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> labxx.common.settings.CommonSettings;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.BeforeAll;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.jms.*;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.Serializable;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.StringJoiner;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.UUID;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Test - TextMessage, ByteMessage, ObjectMessage, StreamMessage, MapMessage.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MessageTypesTest</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> ConnectionFactory connectionFactory <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Queue queue <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@BeforeAll</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUp</span>() {
</span></span><span style=display:flex><span>    connectionFactory <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getConnectionFactory</span>();
</span></span><span style=display:flex><span>    queue <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getDefaultQueue</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @throws JMSException
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testTextMessage</span>() <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      TextMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createTextMessage</span>(<span style=color:#e6db74>&#34;Test TextMessage Type&#34;</span>);
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span>      TextMessage receivedMessage <span style=color:#f92672>=</span> (TextMessage) jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue).<span style=color:#a6e22e>receive</span>();
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Received message: &#34;</span> <span style=color:#f92672>+</span> receivedMessage.<span style=color:#a6e22e>getText</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testByteMessage</span>() <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      BytesMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createBytesMessage</span>();
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeUTF</span>(<span style=color:#e6db74>&#34;नमस्ते&#34;</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeBoolean</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeLong</span>(12345L);
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      BytesMessage receivedMessage <span style=color:#f92672>=</span> (BytesMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;==== ByteMessage Demo ====&#34;</span>);
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readUTF</span>());
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readBoolean</span>());
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readLong</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testStreamMessage</span>() <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      StreamMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createStreamMessage</span>();
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeString</span>(<span style=color:#e6db74>&#34;String Content&#34;</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeString</span>(<span style=color:#e6db74>&#34;Another string&#34;</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeInt</span>(101);
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      StreamMessage receivedMessage <span style=color:#f92672>=</span> (StreamMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;===== StreamMessage =====&#34;</span>);
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readString</span>());
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readString</span>());
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readInt</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMapMessage</span>() <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      MapMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createMapMessage</span>();
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>setString</span>(<span style=color:#e6db74>&#34;sampleKey&#34;</span>, <span style=color:#e6db74>&#34;sampleValue&#34;</span>);
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      MapMessage receivedMessage <span style=color:#f92672>=</span> (MapMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;===== MapMessage Demo =====&#34;</span>);
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>getString</span>(<span style=color:#e6db74>&#34;sampleKey&#34;</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testObjectMessage</span>() <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      ObjectMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createObjectMessage</span>();
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>setObject</span>(<span style=color:#66d9ef>new</span> UserCommand(<span style=color:#e6db74>&#34;John&#34;</span>, <span style=color:#e6db74>&#34;john@gmail.com&#34;</span>));
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      ObjectMessage receivedMessage <span style=color:#f92672>=</span> (ObjectMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;===== ObjectMessage Demo =====&#34;</span>);
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>getObject</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserCommand</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String id;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String email;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>UserCommand</span>(String name, String email) {
</span></span><span style=display:flex><span>      id <span style=color:#f92672>=</span> UUID.<span style=color:#a6e22e>randomUUID</span>().<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> name;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>email</span> <span style=color:#f92672>=</span> email;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>toString</span>() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> StringJoiner(<span style=color:#e6db74>&#34;, &#34;</span>, UserCommand.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getSimpleName</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;[&#34;</span>, <span style=color:#e6db74>&#34;]&#34;</span>)
</span></span><span style=display:flex><span>          .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;id=&#39;&#34;</span> <span style=color:#f92672>+</span> id <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39;&#34;</span>)
</span></span><span style=display:flex><span>          .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;name=&#39;&#34;</span> <span style=color:#f92672>+</span> name <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39;&#34;</span>)
</span></span><span style=display:flex><span>          .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;email=&#39;&#34;</span> <span style=color:#f92672>+</span> email <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39;&#34;</span>)
</span></span><span style=display:flex><span>          .<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>输出</strong></p><p>您的输出可能会略有不同，但结果应该相似。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>===== StreamMessage =====
</span></span><span style=display:flex><span>String Content
</span></span><span style=display:flex><span>Another string
</span></span><span style=display:flex><span>101
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== ObjectMessage Demo =====
</span></span><span style=display:flex><span>UserCommand[id=&#39;e5e80542-7201-4418-bced-064d49bb5b8f&#39;, name=&#39;John&#39;, email=&#39;john@gmail.com&#39;]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Received message: Test TextMessage Type
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== MapMessage Demo =====
</span></span><span style=display:flex><span>sampleValue
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>==== ByteMessage Demo ====
</span></span><span style=display:flex><span>नमस्ते
</span></span><span style=display:flex><span>true
</span></span><span style=display:flex><span>12345
</span></span></code></pre></div><p>在本教程中，我通过示例简要讨论了 JMS 消息模型。请在下面的评论中告诉我您的反馈或问题。我将在单独的文章中讨论**<a href=https://jstobigdata.com/jms/jms-prioritize-messages/ target=_blank>消息优先级</a><strong>和</strong>消息** <strong>请求-响应</strong>。</p><p>原文链接：<a href=https://jstobigdata.com/jms/jms-message-model/ target=_blank>JMS Message Model</a></p></div><footer class=post__footer><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/jms/ rel=tag>jms</a></li></ul></div></footer><div class=social__content><span>Share:</span>
<a class="social__link btn" href="https://twitter.com/intent/tweet?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f&text=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b" target=_blank title=Twitter rel=noopener><svg class="social__link-icon icon icon-twitter" width="24" height="24" viewBox="0 0 384 312"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5.0-78.8 35.3-78.8 78.8.0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3C20 26 16.1 39.6 16.1 54c0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1.0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4.0-12.6-.4-18.8-1.1C34.9 299 76.3 312 120.8 312c144.9.0 224.1-120 224.1-224.1.0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
</a><a class="social__link btn" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f" target=_blank title=Facebook rel=noopener><svg class="social__link-icon icon icon-facebook" width="24" height="24" viewBox="0 0 352 352"><path fill="currentColor" d="m0 32v288c0 17.5 14.5 32 32 32h288c17.5.0 32-14.5 32-32V32c0-17.5-14.5-32-32-32H32C14.5.0.0 14.5.0 32zm320 0v288h-83V212h41.5l6-48H237v-31c0-14 3.5-23.5 23.5-23.5h26V66c-4.4-.6-19.8-1.5-37.5-1.5-36.9.0-62 22.2-62 63.5v36h-42v48h42v108H32V32z"/></svg>
</a><a class="social__link btn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f&title=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b" target=_blank title=LinkedIn rel=noopener><svg class="social__link-icon icon icon-linkedin" width="24" height="24" viewBox="0 0 352 352"><path d="M0 40v272c0 21.9 18.1 40 40 40h272c21.9.0 40-18.1 40-40V40c0-21.9-18.1-40-40-40H40C18.1.0.0 18.1.0 40zm312-8c4.6.0 8 3.4 8 8v272c0 4.6-3.4 8-8 8H40c-4.6.0-8-3.4-8-8V40c0-4.6 3.4-8 8-8H312zM59.5 87c0 15.2 12.3 27.5 27.5 27.5s27.5-12.3 27.5-27.5S102.2 59.5 87 59.5 59.5 71.8 59.5 87zM187 157h-1v-21h-45v152h47v-75c0-19.8 3.9-39 28.5-39 24.2.0 24.5 22.4 24.5 40v74h47v-83.5c0-40.9-8.7-72-56.5-72-23 0-38.2 12.6-44.5 24.5zM64 288h47.5V136H64V288z"/></svg>
</a><a class="social__link btn" href="https://t.me/share/url?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f&text=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b" target=_blank title=Telegram rel=noopener><svg class="social__link-icon icon icon-telegram" width="24" height="24" viewBox="0 0 132 110"><path fill="#ddd" d="M50 103c-4 0-3-1-5-5L34 60l88-52"/><path fill="#aaa" d="M50 103c3 0 4-1 6-3l16-16-20-12"/><path fill="#fff" d="M52 72l48 36c6 3 10 2 11-5l20-93c2-8-3-11-8-9L7 45c-8 4-8 8-1 10l29 9 69-43c3-2 6-1 4 1"/></svg>
</a><a class="social__link btn" href="mailto:?subject=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b&body=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f" title="Share by Email"><svg class="social__link-icon icon icon-mail" width="24" height="24" viewBox="0 0 24 24"><path d="M0 3h24v18H0zm2 16h20V7l-10 6L2 7zM22 5H2l10 6z"/></svg>
</a><a class="social__link btn" href="https://service.weibo.com/share/share.php?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f&title=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b" target=_blank title=Weibo rel=noopener><svg class="social__link-icon icon icon-telegram" viewBox="0 0 32 32" width="24" height="24" fill="none"><rect width="32" height="32" rx="8" fill="#e6162d"/><path d="M23.5 18.5c-1.2 2.5-5.2 3.7-8.2 3.7-2.7.0-5.2-.7-6.2-2.2-.7-1.1-.5-2.5.6-3.2.7-.5 1.6-.6 2.3-.2.3.2.7.1.9-.2.2-.3.1-.7-.2-.9-1.2-.7-2.7-.6-3.8.3-1.6 1.2-2 3.4-.8 5 1.4 2 4.5 2.9 7.5 2.9 3.5.0 7.9-1.4 9.3-4.3.2-.3.0-.7-.3-.9s-.7.0-.9.3z" fill="#fff"/><circle cx="15" cy="19" r="8" fill="#fff"/></svg></a></div></footer></article></main><nav class="pagination flex"><div class="pagination__item pagination__item--prev"><a class=pagination__link href=/posts/2024/07/23/jms-message-selectors-in-action-to-filter-messages/ rel=prev><p class=pagination__title>«&#8201;上一篇: [译]JMS 消息选择器在过滤消息中的应用</p></a></div><div class="pagination__item pagination__item--next"><a class=pagination__link href=/posts/2024/07/23/jms-transactions-in-action/ rel=next><p class=pagination__title>&#8201;» 下一篇: [译]JMS 事务的实际应用</p></a></div></nav><footer class=post__footer><div class=post-related><h3>相关文章</h3><ul class=post-related-list><li class=post-related-item><a href=/posts/2024/07/23/jms-transactions-in-action/ target=_blank title="[译]JMS 事务的实际应用">[译]JMS 事务的实际应用</a></li><li class=post-related-item><a href=/posts/2024/07/23/jms-pub-sub-messaging-model/ target=_blank title="[译]JMS 发布-订阅消息模型">[译]JMS 发布-订阅消息模型</a></li><li class=post-related-item><a href=/posts/2024/07/23/jms-prioritize-messages/ target=_blank title="[译]JMS 消息优先级">[译]JMS 消息优先级</a></li><li class=post-related-item><a href=/posts/2024/07/23/jms-message-selectors-in-action-to-filter-messages/ target=_blank title="[译]JMS 消息选择器在过滤消息中的应用">[译]JMS 消息选择器在过滤消息中的应用</a></li><li class=post-related-item><a href=/posts/2024/07/23/jms-point-to-point-messaging-in-action/ target=_blank title="[译]JMS 点对点消息传递的实际应用">[译]JMS 点对点消息传递的实际应用</a></li><li class=post-related-item><a href=/posts/2024/07/23/jms-introduction-java-message-service/ target=_blank title="[译]JMS介绍 – Java消息服务">[译]JMS介绍 – Java消息服务</a></li></ul></div></footer><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="ChenSoul avatar" src=/images/favicon.webp class=avatar height=60 width=60 loading=lazy></figure><div class=authorbox__header><span class=authorbox__name>关于 ChenSoul</span></div><div class=authorbox__description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</div></div><script defer src="https://cdn.bootcdn.net/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/>首页</a> | <a class=footer__link href=/categories/>分类</a> | <a class=footer__link href=/about/>关于</a> | <a class=footer__link href=/index.xml>RSS</a></div><div class=footer__copyright>&copy; 2025 ChenSoul.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/chensoul/hugo-rose/ rel="nofollow noopener" target=_blank>Hugo Rose</a> 主题</span></div></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></footer></div><script>"use strict";(function(t){var i=t.querySelector(".menu__btn"),o=t.querySelector(".menu__list");function a(){o.classList.toggle("menu__list--active"),o.classList.toggle("menu__list--transition"),this.classList.toggle("menu__btn--active"),this.setAttribute("aria-expanded",this.getAttribute("aria-expanded")==="true"?"false":"true")}function r(){this.classList.remove("menu__list--transition")}i&&o&&(i.addEventListener("click",a,!1),o.addEventListener("transitionend",r,!1))})(document,window)</script><script defer src=https://umami.chensoul.cc/random-string.js data-website-id=1e07d36d-bec3-4ba6-9459-876b1ac3bbe7></script></body></html>