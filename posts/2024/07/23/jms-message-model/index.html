<!doctype html><html lang=en-US prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="消息是 JMS 的核心，无论是事件还是业务数据。消息由标头、自定义属性和正文组成。这是您将在 JMS 消息模型（JMS 消息剖析）中学习的内容。
"><title>[译]JMS 消息模型 | ChenSoul</title>
<link rel=canonical href=https://blog.chensoul.cc/posts/2024/07/23/jms-message-model/><link rel=preconnect href=https://fonts.font.im><link rel=preconnect href=https://fonts.loli.net crossorigin><link href="https://fonts.loli.net/css2?family=Roboto+Slab:wght@400;500;700&display=swap" rel=stylesheet><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.chensoul.cc/images/favicon.webp"><meta name=twitter:title content="[译]JMS 消息模型"><meta name=twitter:description content="消息是 JMS 的核心，无论是事件还是业务数据。消息由标头、自定义属性和正文组成。这是您将在 JMS 消息模型（JMS 消息剖析）中学习的内容。"><meta name=twitter:creator content="@ichensoul"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="chensoul"><meta property="og:url" content="https://blog.chensoul.cc/posts/2024/07/23/jms-message-model/"><meta property="og:site_name" content="ChenSoul"><meta property="og:title" content="[译]JMS 消息模型"><meta property="og:description" content="消息是 JMS 的核心，无论是事件还是业务数据。消息由标头、自定义属性和正文组成。这是您将在 JMS 消息模型（JMS 消息剖析）中学习的内容。"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-23T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-23T00:00:00+00:00"><meta property="article:tag" content="Jms"><meta property="og:image" content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=name content="[译]JMS 消息模型"><meta itemprop=description content="消息是 JMS 的核心，无论是事件还是业务数据。消息由标头、自定义属性和正文组成。这是您将在 JMS 消息模型（JMS 消息剖析）中学习的内容。"><meta itemprop=datePublished content="2024-07-23T00:00:00+00:00"><meta itemprop=dateModified content="2024-07-23T00:00:00+00:00"><meta itemprop=wordCount content="966"><meta itemprop=image content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=keywords content="Jms"><link rel=stylesheet href=https://cdnjs.loli.net/ajax/libs/font-awesome/6.4.0/css/all.min.css media=all><link rel=stylesheet href=/main.min.css type=text/css media=all><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"TechArticle","name":"[译]JMS 消息模型","headline":"[译]JMS 消息模型","inLanguage":"en-US","url":"https://blog.chensoul.cc/posts/2024/07/23/jms-message-model/","description":"\u003cp\u003e消息是 JMS 的核心，无论是事件还是业务数据。消息由标头、自定义属性和正文组成。这是您将在 JMS 消息模型（JMS 消息剖析）中学习的内容。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/JMS-message-model-min-1024x536.webp\" alt=\"JMS 消息模型\"\u003e\u003c/p\u003e","wordCount":"966","keywords":["jms"],"datePublished":"2024-07-23T00:00:00Z","dateModified":"2024-07-23T00:00:00Z","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2024/07/23/jms-message-model/"},"publisher":{"@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/posts/2024/07/23/jms-message-model/"}},{"@context":"https://schema.org","@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/","sameAs":["https://x.com/ichensoul","https://github.com/chensoul","https://www.linkedin.com/in/","https://www.youtube.com/@chensoul","https://t.me/chensouls"]}]}</script><script defer src=https://umami.chensoul.cc/random-string.js data-website-id=4718b57b-c900-4a61-a7af-0fe1fb1d50ce></script></head><body class="home blog post-layout-one-column"><button onclick=topFunction() id=scrollTopBtn title="Go to top">
<i class="fa-solid fa-arrow-up"></i></button><div id=header-top class=header-bar-wrap></div><div id=page class=site><a class="skip-link screen-reader-text" href=#content>Skip to content</a><header id=masthead class="site-header clearfix" role=banner><div class="header-main container clearfix"><div id=logo class="site-branding clearfix"><h1 class=site-title><a href=/ title=ChenSoul rel=home>ChenSoul</a></h1><p class=site-description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</p></div><div class="header-widgets clearfix"><aside id=search-2 class="header-widget widget_search"><form role=search method=get class=search-form onsubmit="return searchSite(event)"><label><span class=screen-reader-text>Search for:</span>
<input type=search class=search-field placeholder="Enter search keyword" name=query id=query title="Enter search keyword">
</label><button type=submit class=search-submit title=Search> <span class=genericon-search></span>
<span class=screen-reader-text>Search</span></button></form></aside></div></div><div id=main-navigation-wrap class=primary-navigation-wrap><nav id=main-navigation class="primary-navigation navigation container clearfix" role=navigation><ul id=menu-home class=main-navigation-menu><li class="menu-item menu-item-type-custom menu-item-object-custom
current-menu-item current_page_item menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/spring-boot/>Spring Boot</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/architecture/>Architecture</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/microservice/>Microservice</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/kubernetes/>Kubernetes</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category
menu-item-has-children"><a href=/tutorials/>Tutorials</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/spring-boot-tutorials/>Spring Boot Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/microservice-tutorials/>Microservice Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/kubernetes-tutorials/>Kubernetes Tutorials</a></li></ul></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=https://github.com/chensoul target=_blank>About Me</a></li></ul></nav></div></header><div id=content class="site-content container clearfix"><section id=primary class="content-archive content-area post-content-area"><main id=main class=site-main role=main><article class="post type-post"><div class=post-inner-content><header class=entry-header><h2 class=entry-title><a href=https://blog.chensoul.cc/posts/2024/07/23/jms-message-model/ rel=bookmark title="[译]JMS 消息模型">[译]JMS 消息模型</a></h2><div class=entry-meta><span class=meta-date><time class="entry-date published" datetime=2024-07-23T00:00:00>2024-07-23
</time></span><span class=meta-author><span class="author vcard">chensoul</span>
</span><span class="tagcloud post-tags"><i class="fa fa-tags"></i>&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/jms/ title=jms>jms</a></span></div></header><div class=entry-content><p>消息是 JMS 的核心，无论是事件还是业务数据。消息由标头、自定义属性和正文组成。这是您将在 JMS 消息模型（JMS 消息剖析）中学习的内容。</p><p><img src=/images/JMS-message-model-min-1024x536.webp alt="JMS 消息模型"></p><p>JMS 消息由 Header、Properties 和 Body（Payload）组成。我们将在下面详细讨论它们。</p><ul><li><p><strong>消息头</strong>是有关消息的元数据。消息头有两种类型：开发人员设置的头和 JMS 提供商设置的头。</p></li><li><p>消息属性是用于向消息添加可选标头字段的附加标头字段。属性字段基本上有 3 种类型。</p><ul><li>应用程序特定属性 - 允许设置应用程序特定的自定义标题。</li><li>标准属性 – JMS 定义的标准属性。</li><li>JMS-Provider 特定属性。</li></ul></li><li><p><strong>消息主体</strong>是发送到目的地的有效负载。JMS 支持多种类型（格式）的有效负载。</p></li></ul><h2 id=1-消息头字段>1. 消息头字段</h2><p>一些消息头由程序员设置，一些由 JMS 提供商内部设置。消息头是 JMS 消息模型中首先要探讨的内容。</p><h3 id=11-jms-目标><strong>1.1. JMS 目标</strong></h3><p>此标头包含消息发送的目的地。收到消息时，目的地必须与分配的值相等。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSDestination(Destination)
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSDestination()
</span></span></code></pre></div><h3 id=12-jms交付模式><strong>1.2. JMS交付模式</strong></h3><p>JMS 支持 <em>PERSISTEN T</em>和 NON_PERSISTENT 消息传输模式。此标头表示传递模式。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSDeliveryMode<span style=color:#960050;background-color:#1e0010>（</span><span style=color:#66d9ef>int</span><span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSDeliveryMode()
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>DeliveryMode</span>
</span></span></code></pre></div><h3 id=13-jms消息id><strong>1.3. JMS消息ID</strong></h3><p>此标头字段值唯一标识提供商发送的每个消息。它是一个字符串值。程序员不需要处理它。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSMessageID()
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSMessageID(String)
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>MessageProducer</span><span style=color:#960050;background-color:#1e0010>#</span>setDisableMessageID(<span style=color:#66d9ef>boolean</span>)
</span></span></code></pre></div><h3 id=14-jms时间戳><strong>1.4. JMS时间戳</strong></h3><p>消息被交给提供商处理的时间戳。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSTimestamp(<span style=color:#66d9ef>long</span>)
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>MessageProducer</span><span style=color:#960050;background-color:#1e0010>#</span>setDisableMessageTimestamp(<span style=color:#66d9ef>boolean</span>)
</span></span></code></pre></div><h3 id=15-jms重新交付><strong>1.5. JMS重新交付</strong></h3><p>当客户端收到带有此标头的消息时，很可能该消息已在过去送达，但未收到确认。程序员无法更改此值。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSRedelivered<span style=color:#960050;background-color:#1e0010>（</span><span style=color:#66d9ef>boolean</span><span style=color:#960050;background-color:#1e0010>）</span>
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSRedelivered()
</span></span></code></pre></div><h3 id=16-jmsexpiration--设置消息生存时间><strong>1.6. JMSExpiration</strong> – 设置消息生存时间</h3><p>JMS 通过添加生存时间值来为每条消息设置过期值。生存时间值在方法中指定<code>send()</code>。如果生存时间值设置为零，则 JMSExpiration 标头值也会变为零，这意味着消息不会过期。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setTimeToLive</span>(<span style=color:#66d9ef>long</span> timeToLive);
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSExpiration(<span style=color:#66d9ef>long</span>)
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSExpiration()
</span></span></code></pre></div><p>下面的示例演示了如何使用<code>producer.setTimeToLive()</code>方法来设置消息过期时间。正如您在输出中看到的那样，消息的生命周期只有 2 秒，5 秒后它将从队列中删除。因此，消费者不会收到该消息并记录 NullPointer 异常。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#f92672>package</span> lab01.message.model;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> labxx.common.settings.CommonSettings;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.jms.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MessageExpirationTest</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> InterruptedException, JMSException {
</span></span><span style=display:flex><span>    ConnectionFactory connectionFactory <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getConnectionFactory</span>();
</span></span><span style=display:flex><span>    Queue queue <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getDefaultQueue</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>setTimeToLive</span>(2000);
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, <span style=color:#e6db74>&#34;This message will expire soon&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      Thread.<span style=color:#a6e22e>sleep</span>(5000);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      TextMessage message <span style=color:#f92672>=</span> (TextMessage) consumer.<span style=color:#a6e22e>receive</span>(10000);
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(message.<span style=color:#a6e22e>getText</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>输出</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Exception in thread &#34;main&#34; java.lang.NullPointerException
</span></span></code></pre></div><h3 id=17-jmspriority-标头><strong>1.7. JMSPriority 标头</strong></h3><p>JMS 定义了 10 个优先级别，从 0（最低）到 9（最高）。应用程序客户端应将 0 到 4 视为<em>普通</em>优先级消息，将 5 到 9 视为<em>加急</em>消息。加急消息优先于普通优先级消息传送。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setPriority</span>(<span style=color:#66d9ef>int</span> priority);
</span></span></code></pre></div><p>更多讨论请参阅**<a href=https://jstobigdata.com/jms/jms-prioritize-messages/ target=_blank>优先考虑 JMS 消息教程</a>**。</p><h3 id=18-jmsdeliverytime--消息传递延迟><strong>1.8. JMSDeliveryTime</strong> – 消息传递延迟</h3><p>表示投递时间。这意味着消息将在此标头所表示的时间或之后投递。通过将投递时间与指定的投递延迟相加来计算。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setDeliveryDelay</span>(<span style=color:#66d9ef>long</span> deliveryDelay);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#f92672>package</span> lab01.message.model;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> labxx.common.settings.CommonSettings;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.jms.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MessageDelayDelivery</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    ConnectionFactory connectionFactory <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getConnectionFactory</span>();
</span></span><span style=display:flex><span>    Queue queue <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getDefaultQueue</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>setDeliveryDelay</span>(3000);<span style=color:#75715e>//delivered after 3 seconds</span>
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, <span style=color:#e6db74>&#34;Message with a delay&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      TextMessage textMsg <span style=color:#f92672>=</span> (TextMessage) consumer.<span style=color:#a6e22e>receive</span>(5000);<span style=color:#75715e>//Wait for 5 seconds</span>
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Received message: &#34;</span> <span style=color:#f92672>+</span> textMsg.<span style=color:#a6e22e>getText</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>当您运行该示例时，您将看到消息在 3 秒后送达。</p><h3 id=19-jms关联id><strong>1.9. JMS关联ID</strong></h3><p>客户端使用此标头字段将一条消息与另一条消息链接起来。在请求-响应场景中很有用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setJMSCorrelationID</span>(String correlationID)
</span></span><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setJMSCorrelationIDAsBytes</span>(<span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span>)
</span></span></code></pre></div><p>我将在本教程的后半部分讨论在请求-响应场景中使用 CorrelationID。</p><h3 id=110-jms类型><strong>1.10. JMS类型</strong></h3><p>表示客户端在消息中设置的消息类型 ID。在少数 JMS 提供商中很有用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setJMSType</span>(String type);
</span></span></code></pre></div><h3 id=111-jmsreplyto><strong>1.11. JMSReplyTo</strong></h3><p>此标头包含应发送消息回复的目的地（队列或主题）。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>jmsProducer.<span style=color:#a6e22e>setJMSReplyTo</span>(Destination replyTo);
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>setJMSReplyTo(Destination)
</span></span><span style=display:flex><span>javax.<span style=color:#a6e22e>jms</span>.<span style=color:#a6e22e>Message</span><span style=color:#960050;background-color:#1e0010>#</span>getJMSReplyTo()
</span></span></code></pre></div><p>您将在本教程的后半部分学习 JMSReplyTo 标头的使用。</p><h2 id=2-消息属性>2. 消息属性</h2><p>如前所述，消息属性是向消息添加可选标头字段的附加字段。消息属性有 3 种类型：自定义属性、JMS 定义属性和可选 JMS 提供程序特定属性。</p><h3 id=21-自定义属性>2.1. 自定义属性</h3><ul><li>属性名称（键）应遵循 java 标识符规则。</li><li>属性值可以是<code>boolean</code>、<code>byte</code>、<code>short</code>、<code>int</code>、和。<code>long</code>、<code>float</code>、<code>double</code>、<code>String</code></li></ul><p>下面的示例演示了消息中自定义属性的用法。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#f92672>package</span> lab01.message.model;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> labxx.common.settings.CommonSettings;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.jms.*;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Enumeration;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.UUID;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MessageCustomProperties</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>test</span>()
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    ConnectionFactory connectionFactory <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getConnectionFactory</span>();
</span></span><span style=display:flex><span>    Queue queue <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getDefaultQueue</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      TextMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createTextMessage</span>(<span style=color:#e6db74>&#34;Message with a custom property&#34;</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>setBooleanProperty</span>(<span style=color:#e6db74>&#34;priorityUser&#34;</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>setStringProperty</span>(<span style=color:#e6db74>&#34;authToken&#34;</span>, UUID.<span style=color:#a6e22e>randomUUID</span>().<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>      <span style=color:#75715e>//Delay for testing purpose Only</span>
</span></span><span style=display:flex><span>      TextMessage textMsg <span style=color:#f92672>=</span> (TextMessage) consumer.<span style=color:#a6e22e>receive</span>(1000);
</span></span><span style=display:flex><span>      Enumeration customProperties <span style=color:#f92672>=</span> textMsg.<span style=color:#a6e22e>getPropertyNames</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>while</span> (customProperties.<span style=color:#a6e22e>hasMoreElements</span>()) {
</span></span><span style=display:flex><span>        System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(customProperties.<span style=color:#a6e22e>nextElement</span>());
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;priorityUser: &#34;</span> <span style=color:#f92672>+</span> textMsg.<span style=color:#a6e22e>getBooleanProperty</span>(<span style=color:#e6db74>&#34;priorityUser&#34;</span>));
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;authToken: &#34;</span> <span style=color:#f92672>+</span> textMsg.<span style=color:#a6e22e>getStringProperty</span>(<span style=color:#e6db74>&#34;authToken&#34;</span>));
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Received message: &#34;</span> <span style=color:#f92672>+</span> textMsg.<span style=color:#a6e22e>getText</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>输出</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>JMSXDeliveryCount
</span></span><span style=display:flex><span>priorityUser
</span></span><span style=display:flex><span>authToken
</span></span><span style=display:flex><span>priorityUser: true
</span></span><span style=display:flex><span>authToken: 010a908f-a3a6-4a2b-8d9f-5e177f1c223b
</span></span><span style=display:flex><span>Received message: Message with a custom property
</span></span></code></pre></div><p>您可以迭代各种消息属性，如上例所示（第 28-31 行）。</p><h3 id=22-jms-定义的属性>2.2. JMS 定义的属性</h3><p>所有 JMS 定义的属性都有<code>JMSX</code>属性名前缀。下面是属性列表、属性类型、JMS 必须实现的可选或强制属性及其用途。</p><p><strong>1. JMSXUserID</strong> — 字符串 — 可选 — 由提供商在发送时设置，
用于识别发送消息的用户。</p><p><strong>2. JMSXAppID</strong> — 字符串 — 可选 — 由提供商在发送时设置
这是发送消息的应用程序的身份。</p><p><strong>3. JMSXDeliveryCount</strong> – int – 强制 – 由提供商在接收时设置
消息传递尝试的次数。</p><p><strong>4. JMSXGroupID</strong> – 字符串 – 可选 – 由客户端设置
此消息所属消息组的标识。</p><p><strong>5. JMSXGroupSeq</strong> – int – 可选 – 由客户端设置
此消息在组内的序列号。</p><p><strong>6. JMSXProducerTXID</strong> — 字符串 — 可选 — 由提供商在发送
生成消息的事务 ID 时设置。</p><p><strong>7. JMSXConsumerTXID</strong> — 字符串 — 可选 — 由提供商在接收
使用消息的交易 ID 时设置。</p><p><strong>8. JMSXRcvTimestamp</strong> — long — 可选 — 由提供商在接收时设置
JMS 将消息传递给消费者的时间。</p><p><strong>9. JMSXState</strong> – int – 可选 – 由提供商设置
消息是否处于等待、就绪、过期或保留状态。没有 API 可供程序员检查这一点。</p><h3 id=23-jms-提供程序特定属性>2.3. JMS 提供程序特定属性</h3><p>JMS<code>JMS_&lt;vendor_name></code>为特定于供应商的属性保留了属性名称前缀。这些特定于供应商的属性适用于本机供应商/提供商客户端。程序员不能在 JMS 代码中使用。</p><h2 id=3-jms-消息体--jms-中的-5-种消息类型>3. JMS 消息体 – JMS 中的 5 种消息类型</h2><p>最后，在本次 JMS 消息模型讨论中，我们将讨论实际的消息内容。JMS 提供了 5 种形式的消息类型。</p><h3 id=1-streammessage><strong>1. StreamMessage</strong></h3><p>消息主体包含 Java 原始值流。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>StreamMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createStreamMessage</span>();
</span></span><span style=display:flex><span>message.<span style=color:#a6e22e>writeString</span>(<span style=color:#e6db74>&#34;String Content&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>StreamMessage receivedMessage <span style=color:#f92672>=</span> (StreamMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span></code></pre></div><h3 id=2-mapmessage><strong>2. MapMessage</strong></h3><p>消息主体包含键值对，键是字符串对象，值是 Java 原始类型。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>MapMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createMapMessage</span>();
</span></span><span style=display:flex><span>message.<span style=color:#a6e22e>setString</span>(<span style=color:#e6db74>&#34;sampleKey&#34;</span>, <span style=color:#e6db74>&#34;sampleValue&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>MapMessage receivedMessage <span style=color:#f92672>=</span> (MapMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span></code></pre></div><h3 id=3-textmessage>**3. **TextMessage</h3><p>正文包含字符串的消息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>TextMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createTextMessage</span>(<span style=color:#e6db74>&#34;Test TextMessage Type&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TextMessage receivedMessage <span style=color:#f92672>=</span> (TextMessage) jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue).<span style=color:#a6e22e>receive</span>();
</span></span></code></pre></div><h3 id=4-objectmessage><strong>4. ObjectMessage</strong></h3><p>包含可序列化 Java 对象的消息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>ObjectMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createObjectMessage</span>();
</span></span><span style=display:flex><span>message.<span style=color:#a6e22e>setObject</span>(<span style=color:#66d9ef>new</span> UserCommand(<span style=color:#e6db74>&#34;John&#34;</span>, <span style=color:#e6db74>&#34;john@gmail.com&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ObjectMessage receivedMessage <span style=color:#f92672>=</span> (ObjectMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span></code></pre></div><h3 id=5-bytesmessage><strong>5. BytesMessage</strong></h3><p>包含未解释的字节流的消息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>BytesMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createBytesMessage</span>();
</span></span><span style=display:flex><span>message.<span style=color:#a6e22e>writeUTF</span>(<span style=color:#e6db74>&#34;नमस्ते&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BytesMessage receivedMessage <span style=color:#f92672>=</span> (BytesMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span></code></pre></div><p>以下代码从高层次演示了各种消息类型的工作方式。您还可以探索更多方法。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span><span style=color:#f92672>package</span> lab01.message.model;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> labxx.common.settings.CommonSettings;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.BeforeAll;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.junit.jupiter.api.Test;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> javax.jms.*;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.Serializable;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.StringJoiner;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.UUID;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Test - TextMessage, ByteMessage, ObjectMessage, StreamMessage, MapMessage.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MessageTypesTest</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> ConnectionFactory connectionFactory <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Queue queue <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@BeforeAll</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setUp</span>() {
</span></span><span style=display:flex><span>    connectionFactory <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getConnectionFactory</span>();
</span></span><span style=display:flex><span>    queue <span style=color:#f92672>=</span> CommonSettings.<span style=color:#a6e22e>getDefaultQueue</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @throws JMSException
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testTextMessage</span>() <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      TextMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createTextMessage</span>(<span style=color:#e6db74>&#34;Test TextMessage Type&#34;</span>);
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span>      TextMessage receivedMessage <span style=color:#f92672>=</span> (TextMessage) jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue).<span style=color:#a6e22e>receive</span>();
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Received message: &#34;</span> <span style=color:#f92672>+</span> receivedMessage.<span style=color:#a6e22e>getText</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testByteMessage</span>() <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      BytesMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createBytesMessage</span>();
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeUTF</span>(<span style=color:#e6db74>&#34;नमस्ते&#34;</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeBoolean</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeLong</span>(12345L);
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      BytesMessage receivedMessage <span style=color:#f92672>=</span> (BytesMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;==== ByteMessage Demo ====&#34;</span>);
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readUTF</span>());
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readBoolean</span>());
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readLong</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testStreamMessage</span>() <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      StreamMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createStreamMessage</span>();
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeString</span>(<span style=color:#e6db74>&#34;String Content&#34;</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeString</span>(<span style=color:#e6db74>&#34;Another string&#34;</span>);
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>writeInt</span>(101);
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      StreamMessage receivedMessage <span style=color:#f92672>=</span> (StreamMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;===== StreamMessage =====&#34;</span>);
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readString</span>());
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readString</span>());
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>readInt</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testMapMessage</span>() <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      MapMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createMapMessage</span>();
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>setString</span>(<span style=color:#e6db74>&#34;sampleKey&#34;</span>, <span style=color:#e6db74>&#34;sampleValue&#34;</span>);
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      MapMessage receivedMessage <span style=color:#f92672>=</span> (MapMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;===== MapMessage Demo =====&#34;</span>);
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>getString</span>(<span style=color:#e6db74>&#34;sampleKey&#34;</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testObjectMessage</span>() <span style=color:#66d9ef>throws</span> JMSException {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> (JMSContext jmsContext <span style=color:#f92672>=</span> connectionFactory.<span style=color:#a6e22e>createContext</span>()) {
</span></span><span style=display:flex><span>      JMSProducer producer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createProducer</span>();
</span></span><span style=display:flex><span>      ObjectMessage message <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createObjectMessage</span>();
</span></span><span style=display:flex><span>      message.<span style=color:#a6e22e>setObject</span>(<span style=color:#66d9ef>new</span> UserCommand(<span style=color:#e6db74>&#34;John&#34;</span>, <span style=color:#e6db74>&#34;john@gmail.com&#34;</span>));
</span></span><span style=display:flex><span>      producer.<span style=color:#a6e22e>send</span>(queue, message);
</span></span><span style=display:flex><span>      JMSConsumer consumer <span style=color:#f92672>=</span> jmsContext.<span style=color:#a6e22e>createConsumer</span>(queue);
</span></span><span style=display:flex><span>      ObjectMessage receivedMessage <span style=color:#f92672>=</span> (ObjectMessage) consumer.<span style=color:#a6e22e>receive</span>();
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;===== ObjectMessage Demo =====&#34;</span>);
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(receivedMessage.<span style=color:#a6e22e>getObject</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserCommand</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String id;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String email;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>UserCommand</span>(String name, String email) {
</span></span><span style=display:flex><span>      id <span style=color:#f92672>=</span> UUID.<span style=color:#a6e22e>randomUUID</span>().<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> name;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>email</span> <span style=color:#f92672>=</span> email;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>toString</span>() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> StringJoiner(<span style=color:#e6db74>&#34;, &#34;</span>, UserCommand.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getSimpleName</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;[&#34;</span>, <span style=color:#e6db74>&#34;]&#34;</span>)
</span></span><span style=display:flex><span>          .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;id=&#39;&#34;</span> <span style=color:#f92672>+</span> id <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39;&#34;</span>)
</span></span><span style=display:flex><span>          .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;name=&#39;&#34;</span> <span style=color:#f92672>+</span> name <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39;&#34;</span>)
</span></span><span style=display:flex><span>          .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;email=&#39;&#34;</span> <span style=color:#f92672>+</span> email <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;&#39;&#34;</span>)
</span></span><span style=display:flex><span>          .<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>输出</strong></p><p>您的输出可能会略有不同，但结果应该相似。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>===== StreamMessage =====
</span></span><span style=display:flex><span>String Content
</span></span><span style=display:flex><span>Another string
</span></span><span style=display:flex><span>101
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== ObjectMessage Demo =====
</span></span><span style=display:flex><span>UserCommand[id=&#39;e5e80542-7201-4418-bced-064d49bb5b8f&#39;, name=&#39;John&#39;, email=&#39;john@gmail.com&#39;]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Received message: Test TextMessage Type
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>===== MapMessage Demo =====
</span></span><span style=display:flex><span>sampleValue
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>==== ByteMessage Demo ====
</span></span><span style=display:flex><span>नमस्ते
</span></span><span style=display:flex><span>true
</span></span><span style=display:flex><span>12345
</span></span></code></pre></div><p>在本教程中，我通过示例简要讨论了 JMS 消息模型。请在下面的评论中告诉我您的反馈或问题。我将在单独的文章中讨论**<a href=https://jstobigdata.com/jms/jms-prioritize-messages/ target=_blank>消息优先级</a><strong>和</strong>消息** <strong>请求-响应</strong>。</p><p>原文链接：<a href=https://jstobigdata.com/jms/jms-message-model/ target=_blank>JMS Message Model</a></p></div><div><div style=font-weight:700>Share this post:</div><a class=social-link-item href="https://twitter.com/intent/tweet?text=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f" target=_blank rel="noopener noreferrer" title="Click to share on Twitter"><i class="fa-brands fa-square-twitter fa-2xl" style=color:#55acee></i>
</a><a class=social-link-item href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f&title=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b" target=_blank rel="noopener noreferrer" title="Click to share on LinkedIn"><i class="fa-brands fa-linkedin fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://telegram.me/share/url?text=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f" target=_blank rel="noopener noreferrer" title="Click to share on telegram"><i class="fa-brands fa-telegram fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f&title=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b" target=_blank rel="noopener noreferrer" title="Click to share on reddit"><i class="fa-brands fa-reddit fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f" target=_blank rel="noopener noreferrer" title="Click to share on facebook"><i class="fa-brands fa-facebook fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://api.whatsapp.com/send?text=%5b%e8%af%91%5dJMS%20%e6%b6%88%e6%81%af%e6%a8%a1%e5%9e%8b%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f23%2fjms-message-model%2f" target=_blank rel="noopener noreferrer" title="Click to share on whatsapp"><i class="fa-brands fa-whatsapp fa-2xl" style=color:#007bb5></i></a></div></div></article><nav class="navigation post-navigation" role=navigation><h2 class=screen-reader-text>Post navigation</h2><div class=nav-links><div class=nav-previous><a href=/posts/2024/07/23/jms-prioritize-messages/ rel=next><span class=post-title>[译]JMS 消息优先级</span></a></div><div class=nav-next><a href=/posts/2024/07/23/jms-message-selectors-in-action-to-filter-messages/ rel=prev><span class=post-title>[译]JMS 消息选择器在过滤消息中的应用</span></a></div></div></nav><h2>Related content</h2><ul><li><a href=/posts/2024/12/03/github-actions-in-thingsboard/>ThingsBoard源码中的Github Actions</a></li><li><a href=/posts/2024/12/03/security-in-thingsboard/>ThingsBoard源码中的Security</a></li><li><a href=/posts/2024/11/14/quarkus-quick-start/>2024-11-14-Quarkus 快速入门</a></li><li><a href=/posts/2024/11/07/junit-5-migration/>[译]从JUnit4迁移到JUnit5：权威指南</a></li><li><a href=/posts/2024/08/27/activemq-source-code-broker-service/>ActiveMQ源码-BrokerService和PersistenceAdapter</a></li><li><a href=/posts/2024/08/27/thingsboard-code-source-compile/>ThingsBoard源码编译和Idea运行</a></li><li><a href=/posts/2024/08/09/debug-activemq-source-code/>ActiveMQ源码本地调试运行</a></li><li><a href=/posts/2024/08/01/publishing-a-jar-to-maven-repository-with-github-action/>Github Action 发布 Jar 到 Maven 中央仓库</a></li><li><a href=/posts/2024/07/24/what-is-new-in-jms-2-0/>[译]JMS 2.0 中的新增功能</a></li><li><a href=/posts/2024/07/23/jms-transactions-in-action/>[译]JMS 事务的实际应用</a></li></ul></main></section></div><div id=footer class=footer-wrap><footer id=colophon class="site-footer container clearfix" role=contentinfo><div id=footer-text class=site-info><span class=credit-link>Made with 🩷
by <a href=/ target=_blank rel="noopener noreferrer">ChenSoul</a></span></div></footer></div></div><script type=text/javascript src=/main.min.js></script></body></html>