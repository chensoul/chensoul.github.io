<!doctype html><html class=no-js lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>2024-01-15｜Nginx配置结构与指令语法 - ChenSoul Blog</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:url" content="https://blog.chensoul.cc/posts/2024/01/15/til/"><meta property="og:site_name" content="ChenSoul Blog"><meta property="og:title" content="2024-01-15｜Nginx配置结构与指令语法"><meta property="og:description" content="今天做了什么：
1、看 JHipster 源码发现这两个类库
jackson-datatypes-collections 支持 hppc 数据类型。hppc：Java 的高性能原始集合，HPPC 为所有 Java 基元类型提供典型集合的模板生成实现，例如列表、集合和映射。HPPC 背后的主要驱动力是针对最高性能和内存效率的优化。 Handy-URI-Templates A Java URI Template processor implementing RFC6570 2、整理文档《Nginx进程模型》、《Nginx配置结构与指令语法》 Nginx配置结构与指令语法 Nginx的配置文件使用一种块结构和指令语法来定义服务器的行为和属性。以下是Nginx配置文件的基本结构和指令语法："><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-15T00:00:00+00:00"><meta property="article:tag" content="Nginx"><meta itemprop=name content="2024-01-15｜Nginx配置结构与指令语法"><meta itemprop=description content="今天做了什么：
1、看 JHipster 源码发现这两个类库
jackson-datatypes-collections 支持 hppc 数据类型。hppc：Java 的高性能原始集合，HPPC 为所有 Java 基元类型提供典型集合的模板生成实现，例如列表、集合和映射。HPPC 背后的主要驱动力是针对最高性能和内存效率的优化。 Handy-URI-Templates A Java URI Template processor implementing RFC6570 2、整理文档《Nginx进程模型》、《Nginx配置结构与指令语法》 Nginx配置结构与指令语法 Nginx的配置文件使用一种块结构和指令语法来定义服务器的行为和属性。以下是Nginx配置文件的基本结构和指令语法："><meta itemprop=datePublished content="2024-01-15T00:00:00+00:00"><meta itemprop=dateModified content="2024-01-15T00:00:00+00:00"><meta itemprop=wordCount content="393"><meta itemprop=keywords content="Nginx"><meta name=twitter:card content="summary"><meta name=twitter:title content="2024-01-15｜Nginx配置结构与指令语法"><meta name=twitter:description content="今天做了什么：
1、看 JHipster 源码发现这两个类库
jackson-datatypes-collections 支持 hppc 数据类型。hppc：Java 的高性能原始集合，HPPC 为所有 Java 基元类型提供典型集合的模板生成实现，例如列表、集合和映射。HPPC 背后的主要驱动力是针对最高性能和内存效率的优化。 Handy-URI-Templates A Java URI Template processor implementing RFC6570 2、整理文档《Nginx进程模型》、《Nginx配置结构与指令语法》 Nginx配置结构与指令语法 Nginx的配置文件使用一种块结构和指令语法来定义服务器的行为和属性。以下是Nginx配置文件的基本结构和指令语法："><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="ChenSoul Blog" rel=home><div class="logo__item logo__text"><div class=logo__title>ChenSoul Blog</div><div class=logo__tagline>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/tools/><span class=menu__text>Tools</span></a></li><li class=menu__item><a class=menu__link href=/tutorials/><span class=menu__text>Tutorials</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>About</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>2024-01-15｜Nginx配置结构与指令语法</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 110 28 1 1 0 010-28m0 3a3 3 0 100 22 3 3 0 000-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class=meta__text datetime=2024-01-15T00:00:00Z>2024-01-15</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/review/ rel=category>Review</a></span></div></div></header><div class="content post__content clearfix"><p>今天做了什么：</p><p>1、看 JHipster 源码发现这两个类库</p><ul><li><a href=https://github.com/FasterXML/jackson-datatypes-collections target=_blank>jackson-datatypes-collections</a> 支持 hppc 数据类型。hppc：<em>Java 的高性能原始集合</em>，HPPC 为所有 Java 基元类型提供典型集合的模板生成实现，例如列表、集合和映射。HPPC 背后的主要驱动力是针对最高性能和内存效率的优化。</li><li><a href=https://github.com/damnhandy/Handy-URI-Templates target=_blank>Handy-URI-Templates</a> A Java URI Template processor implementing RFC6570
2、整理文档《Nginx进程模型》、《Nginx配置结构与指令语法》</li></ul><h2 id=nginx配置结构与指令语法>Nginx配置结构与指令语法</h2><p>Nginx的配置文件使用一种块结构和指令语法来定义服务器的行为和属性。以下是Nginx配置文件的基本结构和指令语法：</p><h3 id=基本结构和指令语法>基本结构和指令语法</h3><ol><li>配置文件结构：<ul><li>Nginx配置文件由多个块（Block）组成，每个块用花括号 <code>{}</code> 括起来。</li><li>主要的配置块是 <code>http</code> 块，用于全局HTTP配置。</li><li>在 <code>http</code> 块内部，可以包含多个 <code>server</code> 块，每个 <code>server</code> 块用于配置一个虚拟主机。</li><li>在 <code>server</code> 块内部，可以包含多个其他块（如 <code>location</code> 块），用于配置请求的处理规则。</li></ul></li><li>指令语法：<ul><li>指令是配置文件中的关键字，用于指定服务器的行为和属性。</li><li>指令通常由指令名称和参数组成，中间使用空格分隔。</li><li>指令以分号 <code>;</code> 结束。</li><li>有些指令可以包含块结构，以定义更复杂的配置规则。</li></ul></li></ol><p>以下是一个示例的Nginx配置文件的结构和指令语法：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#75715e># 全局配置块
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e># 全局指令
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>directive_name</span> <span style=color:#e6db74>parameter</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 服务器块
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e># 服务器指令
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>directive_name</span> <span style=color:#e6db74>parameter</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 位置块
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e># 位置指令
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>directive_name</span> <span style=color:#e6db74>parameter</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在上面的示例中，<code>http</code> 是全局配置块，<code>server</code> 是服务器块，<code>location</code> 是位置块。每个块内部可以包含相应的指令。</p><p>注意事项：</p><ul><li>指令名称对大小写不敏感，但通常以小写字母表示。</li><li>多个指令可以在同一行上用分号 <code>;</code> 分隔。</li><li>注释以 <code>#</code> 开头，并在行的任何位置添加。</li><li>可以使用变量和预定义变量来设置指令参数。</li></ul><h3 id=nginxconf-配置>nginx.conf 配置</h3><ol><li><code>user</code>：设置Nginx工作进程的运行用户和用户组。默认情况下，Nginx以<code>nobody</code>用户运行。<ul><li>语法：<code>user username [groupname]</code></li><li>例如：<code>user nginx;</code> 或 <code>user nginx nginx;</code></li></ul></li><li><code>worker_processes</code>：设置Nginx工作进程的数量。可以是一个整数值或<code>auto</code>。通常，建议将其设置为服务器可用CPU核心数量的一倍或两倍，以充分利用服务器的性能。<ul><li>语法：<code>worker_processes number | auto</code></li></ul></li><li><code>error_log</code>：用于设置错误日志文件的路径和级别<ul><li>语法：<code>error_log file [level];</code></li><li><code>file</code>：指定错误日志文件的路径。</li><li><code>level</code>：可选参数，指定记录的错误级别。<ul><li>常见的级别包括 <code>emerg</code>、<code>alert</code>、<code>crit</code>、<code>error</code>、<code>warn</code>、<code>notice</code>、<code>info</code> 和 <code>debug</code>。</li><li>默认情况下，错误日志的级别为 <code>error</code>。</li><li>可以使用 <code>syslog:facility.level</code> 格式将错误日志发送到系统日志（syslog）中。</li></ul></li></ul></li><li><code>events</code>：配置与Nginx事件相关的参数。<ul><li>语法：<code>events {}</code></li><li>常用的参数包括：<ul><li><code>worker_connections</code>：每个工作进程的最大并发连接数。</li><li><code>multi_accept</code>：是否接受多个请求同时处理。</li><li><code>use</code>：指定事件模块（如<code>epoll</code>、<code>kqueue</code>等）。</li></ul></li></ul></li><li><code>http</code>：<ul><li>语法：<code>http {}</code></li><li>定义全局HTTP配置。</li><li>常用的指令包括：<ul><li><code>include</code>：包含其他配置文件。</li><li><code>default_type</code>：设置默认的Content-Type。</li><li><code>access_log</code>：定义访问日志的位置和格式。</li><li><code>sendfile</code>：用于控制是否使用操作系统提供的零拷贝技术进行文件传输。当启用 <code>sendfile</code> 时，Nginx 可以直接将文件从磁盘读取并发送到客户端，而无需将文件内容复制到用户空间。这可以显著提高文件传输的效率和性能。<ul><li>当 <code>sendfile</code> 设置为 <code>on</code> 时，Nginx 将尝试使用操作系统提供的 <code>sendfile()</code> 系统调用进行文件传输。</li><li>当 <code>sendfile</code> 设置为 <code>off</code> 时，Nginx 将使用普通的方式进行文件传输，即通过将文件内容从磁盘复制到用户空间再发送给客户端。</li><li>在大多数情况下，默认值 <code>sendfile off</code> 是安全和可靠的选择，但在某些情况下，启用 <code>sendfile</code> 可能会带来更好的性能和效率。</li><li>启用 <code>sendfile</code> 可以降低 CPU 和内存的使用量，但在某些特定的操作系统或文件系统中，可能会出现某些问题，如传输不完整或文件内容损坏等。因此，在启用 <code>sendfile</code> 之前，建议进行充分的测试和评估。</li></ul></li><li><code>tcp_nopush</code>：<ul><li>当 <code>tcp_nopush</code> 设置为 <code>on</code> 时，Nginx 将启用 <code>TCP_CORK</code> 选项，数据将被缓冲并一次性发送给客户端，以提高传输效率。</li><li>当 <code>tcp_nopush</code> 设置为 <code>off</code> 时，Nginx 将禁用 <code>TCP_CORK</code> 选项，数据将立即发送给客户端，减少延迟。</li><li>在大多数情况下，使用默认值 <code>tcp_nopush off</code> 是安全和可靠的选择，可以减少延迟。</li><li>然而，在某些具体的场景中，如高带宽、低延迟的网络环境，启用 <code>tcp_nopush on</code> 可以提高传输效率，但可能会增加延迟。</li></ul></li><li><code>keepalive_timeout</code>：设置与客户端的 HTTP keep-alive 连接的超时时间。HTTP keep-alive 允许客户端和服务器之间的多个 HTTP 请求和响应共享同一个 TCP 连接，以减少连接建立和关闭的开销。<ul><li><code>keepalive_timeout</code> 指定了一个持续连接的超时时间。如果在超过指定的时间内没有新的请求到达，Nginx 将关闭 keep-alive 连接。</li><li>当客户端发送新请求时，超过 <code>keepalive_timeout</code> 的连接将被关闭，并在必要时重新创建一个新的连接。</li><li>默认情况下，<code>keepalive_timeout</code> 设置为 65 秒。</li><li>如果将 <code>keepalive_timeout</code> 设置为 0，表示禁用 keep-alive 连接，每个请求将使用独立的连接。</li><li>可以使用 <code>s</code> 后缀表示秒，或使用 <code>ms</code> 后缀表示毫秒。</li></ul></li><li><code>gzip</code>：用于启用或禁用对响应进行 Gzip 压缩。Gzip 压缩是一种在服务器端将响应内容进行压缩，然后再发送给客户端的技术，可以减少传输数据的大小，提高网络传输效率。<ul><li>当 <code>gzip</code> 设置为 <code>on</code> 时，Nginx 将对响应内容进行 Gzip 压缩。</li><li>当 <code>gzip</code> 设置为 <code>off</code> 时，Nginx 将禁用 Gzip 压缩。</li><li>启用 Gzip 压缩可以显著减少传输数据的大小，提高网络传输效率，但会增加服务器的 CPU 和内存负载。</li><li>在启用 Gzip 压缩之前，建议评估服务器的性能和资源使用情况，确保服务器具备足够的计算资源来处理压缩操作。</li><li>可以通过配置 <code>gzip_types</code> 指令来指定要进行 Gzip 压缩的 MIME 类型。</li><li>还可以通过配置 <code>gzip_comp_level</code> 指令来调整 Gzip 压缩的压缩级别。</li></ul></li></ul></li></ul></li><li><code>server</code>：<ul><li>语法：<code>server {}</code></li><li>配置虚拟主机。</li><li>常用的指令包括：<ul><li><code>listen</code>：定义监听的端口号和地址。</li><li><code>server_name</code>：定义虚拟主机的域名。</li><li><code>root</code>：指定根目录的路径。</li><li><code>index</code>：定义默认的索引文件。</li><li><code>error_page</code>：用于定义在特定 HTTP 错误状态码出现时，向客户端发送自定义错误页面的路径或重定向到其他 URL。<ul><li>语法：<code>error_page [error_code] [action];</code></li><li>适用范围：<code>http</code>, <code>server</code>, <code>location</code> 配置块内部。</li><li><code>error_page</code> 指定了特定 HTTP 错误状态码的处理方式。</li><li><code>error_code</code> 参数指定了要处理的 HTTP 错误状态码，如 404、500 等。还可以使用通配符 <code>*</code> 匹配所有错误状态码。</li><li><code>action</code> 参数定义了对应错误状态码的处理行为。可以有以下几种处理方式：<ul><li>发送自定义错误页面：<code>error_page error_code path;</code>，其中 <code>path</code> 是自定义错误页面的路径。</li><li>重定向到其他 URL：<code>error_page error_code redirect_url;</code>，其中 <code>redirect_url</code> 是要重定向的 URL。</li><li>使用默认的 Nginx 错误页面：<code>error_page error_code =default;</code>，将使用 Nginx 默认的错误页面。</li><li>返回空响应：<code>error_page error_code =;</code>，将返回一个空的响应，即不发送任何内容给客户端。</li></ul></li></ul></li></ul></li></ul></li><li><code>location</code>：<ul><li>语法：<code>location [modifier] uri {}</code></li><li>配置请求的处理规则。</li><li>常用的指令包括：<ul><li><code>root</code>：指定根目录的路径。</li><li><code>proxy_pass</code>：反向代理到指定的后端服务器。</li><li><code>try_files</code>：尝试匹配多个文件或路径。</li></ul></li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>user</span>  <span style=color:#e6db74>nginx</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>worker_processes</span>  <span style=color:#e6db74>auto</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>error_log</span>  <span style=color:#e6db74>/var/log/nginx/error.log</span> <span style=color:#e6db74>notice</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>pid</span>        <span style=color:#e6db74>/var/run/nginx.pid</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>events</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>#默认使用 epoll 模式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>use</span> <span style=color:#e6db74>epoll</span>; 
</span></span><span style=display:flex><span>    <span style=color:#f92672>worker_connections</span>  <span style=color:#ae81ff>1024</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>include</span>       <span style=color:#e6db74>/etc/nginx/mime.types</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>default_type</span>  <span style=color:#e6db74>application/octet-stream</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>log_format</span>  <span style=color:#e6db74>main</span>  <span style=color:#e6db74>&#39;</span>$remote_addr <span style=color:#e6db74>-</span> $remote_user <span style=color:#e6db74>[</span>$time_local] <span style=color:#e6db74>&#34;</span>$request&#34; <span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#39;</span>$status $body_bytes_sent <span style=color:#e6db74>&#34;</span>$http_referer&#34; <span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#39;&#34;</span>$http_user_agent&#34; <span style=color:#e6db74>&#34;</span>$http_x_forwarded_for&#34;&#39;;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>access_log</span>  <span style=color:#e6db74>/var/log/nginx/access.log</span>  <span style=color:#e6db74>main</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sendfile</span>        <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>#tcp_nopush     on;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>keepalive_timeout</span>  <span style=color:#ae81ff>65</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#gzip  on;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#gzip_types text/plain text/html;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>#gzip_comp_level 5;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>include</span> <span style=color:#e6db74>/etc/nginx/conf.d/*.conf</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 000-6 3 3 0 000 6"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/nginx/ rel=tag>nginx</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="ChenSoul avatar" src=/images/favicon.webp class=avatar height=60 width=60></figure><div class=authorbox__header><span class=authorbox__name>About ChenSoul</span></div><div class=authorbox__description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/posts/2024/01/11/til/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title>2024-01-11｜Session和Cookie的区别、单点登录和三方登录的区别</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/posts/2024/01/16/til/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>2024-01-16｜Redis安装</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/tools/>Tools</a> | <a class=footer__link href=/tutorials/>Tutorials</a> | <a class=footer__link href=/about/>About</a></div><div class=footer__copyright>&copy; 2025 ChenSoul.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/chensoul/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>